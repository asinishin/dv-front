{"version":3,"sources":["webpack:///./bundles/invoice/common sync .*\\.tpl\\.html$","webpack:///./bundles/invoice/common/invoice-load-module.service.js","webpack:///./bundles/invoice/common/invoice.controller.js","webpack:///./bundles/invoice/common/invoice.service.js","webpack:///./bundles/invoice/common/invoice.tpl.html","webpack:///./bundles/invoice/index.js"],"names":["angular","module","factory","$injector","modules","standard","alternate","id","then","m","invoke","default","reportHelper","name","reportOptions","pdfPreview","dwAddressDirective","Invoice","invoiceLoadModule","controller","$rootScope","$scope","$route","$filter","$timeout","$q","$translate","dwAlerts","debounce","state","helper","orderId","userProfileService","setupService","$ctrl","paramsChanged","loadResources","config","footer","params","centerId","getCurrentCenterId","paperLayout","date","moment","dueDate","showDates","resources","data","setPageTitle","instant","loadExtraResources","user","get","getCurrentUserId","catch","err","error","settings","getSetupSettings","invoiceTemplate","$watch","np","op","pdf","pointFirstInvalid","all","userId","result","styles","copy","header","body","columns","isSame","address","addresses","payments","items","item","type","charges","center","centers","i","invoiceNumber","reportName","taxId","userName","fullName","userCompany","company","street2","startY","report","doc","buildPdf","output","$watchCollection","include","reduce","o","selectAddress","downloadPdf","fileName","getReportFileName","extension","download","blob","offChangeCenter","$on","backOrReload","offChangeUser","$resolve","back","reload","_","$resource","datesDeserializer","deskworksConfig","desDates","url","getApiAbsUrl","res","method","transformResponse","fromJson","$promise","forEach","index","loadNewModules","InvoiceCtrl","$templateCache","ctx","require","key","put","replace"],"mappings":"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","file":"invoice~._bundles_invoice_c.js?_rev=e490fc34e283cb8faea8","sourcesContent":["var map = {\n\t\"./invoice.tpl.html\": \"./bundles/invoice/common/invoice.tpl.html\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./bundles/invoice/common sync recursive .*\\\\.tpl\\\\.html$\";","export default angular.module('deskworks.invoiceLoadModule', [])\n\n  .factory('invoiceLoadModule', function($injector) {\n    const modules = {\n      standard: () => import(/* webpackChunkName: 'invoice-standard' */ '../standard/index.js'),\n      alternate: () => import(/* webpackChunkName: 'invoice-alternate' */ '../alternate/index.js'),\n    };\n\n    return (id) => (modules[id] || modules.standard)().then(m => $injector.invoke(m.default));\n  });\n","import dwAddressDirective from 'shared/dw-controls/dw-address/dw-address.directive';\nimport pdfPreview from 'shared/reports/directives/pdf-preview.directive';\nimport reportHelper from 'shared/reports/services/report-helper.service';\nimport reportOptions from 'shared/reports/directives/report-options.directive';\nimport Invoice from './invoice.service';\nimport invoiceLoadModule from './invoice-load-module.service';\n\nexport default angular.module('deskworks.invoice', [\n  'debounce',\n  'deskworks.state',\n  'deskworks.userProfile.service',\n  'deskworks.setup.service',\n  reportHelper.name,\n  reportOptions.name,\n  pdfPreview.name,\n  dwAddressDirective.name,\n  Invoice.name,\n  invoiceLoadModule.name,\n])\n  .controller('InvoiceCtrl', function($rootScope, $scope, $route, $filter, $timeout, $q, $translate, dwAlerts, debounce,\n                                      reportHelper, state, helper, orderId, userProfileService,\n                                      Invoice, setupService, invoiceLoadModule) {\n    const $ctrl = this;\n\n    const { paramsChanged, loadResources } = reportHelper;\n\n    $ctrl.config = {\n      footer: () => null,\n  };\n    $ctrl.params = {\n      centerId: state.getCurrentCenterId(),\n      paperLayout: 'p',\n      date: moment(),\n      dueDate: moment(),\n      showDates: true,\n    };\n    $ctrl.resources = null;\n    $ctrl.data = null;\n\n    state.setPageTitle($translate.instant($translate.instant(orderId ? 'INVOICE.INVOICE_NAME' : 'INVOICE.PAGE_TITLE', { orderId })));\n\n    function loadExtraResources() {\n      const user = userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n        .catch(err => dwAlerts.error(err, 'Failed to get user profile.'));\n\n      const settings = setupService.getSetupSettings()\n        .catch(err => dwAlerts.error(err, 'Failed to get setup settings.'));\n\n      const module = settings\n        .then(settings => invoiceLoadModule(settings.invoiceTemplate));\n\n      return { user, settings, module };\n    }\n\n    /**\n     * Watch report params and generate new report\n     */\n    $scope.$watch('$ctrl.params', debounce((np, op) => {\n      $ctrl.pdf = null;\n\n      if (helper.pointFirstInvalid('#invoice')) return;\n\n      $q.all({\n        resources: $ctrl.resources || loadResources(loadExtraResources),\n        data: $ctrl.data || Invoice.get({ centerId: $ctrl.params.centerId, userId: state.getCurrentUserId(), orderId })\n          .catch(err => dwAlerts.error(err, 'Failed to get invoice.')),\n      })\n        .then(result => {\n          $ctrl.resources = result.resources;\n          $ctrl.data = result.data;\n          $ctrl.config.styles = angular.copy($ctrl.resources.module.styles);\n          $ctrl.config.header = $ctrl.resources.module.header;\n          $ctrl.config.body = $ctrl.resources.module.body;\n          $ctrl.columns = angular.copy($ctrl.resources.module.columns);\n        })\n        .then(() => {\n          if ($ctrl.data.date && !$ctrl.data.date.isSame($ctrl.params.date) || $ctrl.data.dueDate && !$ctrl.data.dueDate.isSame($ctrl.params.dueDate) || !$ctrl.params.address && $ctrl.resources.user.addresses[0]) {\n            $ctrl.params.date = $ctrl.data.date || $ctrl.params.date;\n            $ctrl.params.dueDate = $ctrl.data.dueDate || $ctrl.params.dueDate;\n            $ctrl.params.address = $ctrl.params.address || $ctrl.resources.user.addresses[0];\n            return; // skip for next firing of current watcher\n          }\n\n          $ctrl.payments = $ctrl.data.items.filter(item => item.type === 'payment' || item.type === 'refund');\n          $ctrl.charges = $ctrl.data.items.filter(item => item.type !== 'payment' && item.type !== 'refund');\n\n          const center = $ctrl.resources.centers.find(i => i.id === $ctrl.params.centerId);\n          $ctrl.config.orderId = $ctrl.data.invoiceNumber;\n          $ctrl.config.reportName = $translate.instant(center.taxId ? 'INVOICE.TAX_INVOICE_NAME' : 'INVOICE.INVOICE_NAME', { orderId: $ctrl.config.orderId });\n          $ctrl.config.userName = $ctrl.resources.user.fullName;\n          $ctrl.config.userCompany = $ctrl.resources.user.company;\n\n          if (center.street2) $ctrl.config.styles.startY += 12;\n          if (center.taxId) $ctrl.config.styles.startY += 12;\n\n          const report = $ctrl.config.body({ config: $ctrl.config, params: $ctrl.params, data: $ctrl.data, columns: $ctrl.columns, resources: $ctrl.resources });\n          const doc = reportHelper.buildPdf({ config: { ...$ctrl.config, ...$ctrl.params }, report: report, resources: $ctrl.resources });\n          $ctrl.pdf = doc.output('blob');\n        });\n    }, 100), true);\n\n    /**\n     * Items watcher\n     */\n    $scope.$watchCollection(() => $ctrl.data && $ctrl.data.items && $ctrl.data.items.map(i => i.include), () => {\n      if (!$ctrl.data || !$ctrl.data.items) return;\n      $ctrl.params.items = $ctrl.data.items.filter(i => i.include).reduce((o, i) => (o[i.id] = true, o), {});\n    });\n\n    /**\n     * Select address handler\n     */\n    $ctrl.selectAddress = (address) => {\n      $ctrl.params.address = address;\n    };\n\n    /**\n     * Download generated PDF report\n     */\n    $ctrl.downloadPdf = () => {\n      if (!$ctrl.pdf) return;\n      const fileName = reportHelper.getReportFileName({ extension: 'pdf', config: { ...$ctrl.config, ...$ctrl.params }, resources: $ctrl.resources });\n      reportHelper.download({ blob: $ctrl.pdf, fileName });\n    };\n\n    // Due to route.reloadOnSearch: false\n    const offChangeCenter = $rootScope.$on('CHANGE-CENTER', backOrReload);\n    const offChangeUser = $rootScope.$on('CHANGE-USER', backOrReload);\n    function backOrReload() {\n      if ($scope.$resolve.back) return $scope.$resolve.back();\n      $route.reload();\n    }\n\n    $scope.$on('$destroy', _ => {\n      offChangeCenter();\n      offChangeUser();\n    });\n  });\n","/**\n * Invoice service\n */\nexport default angular.module('deskworks.Invoice', [\n  'ngResource',\n  'datesDeserializer',\n  'deskworks.config',\n])\n  .factory('Invoice', function($resource, $q, datesDeserializer, deskworksConfig) {\n    const desDates = datesDeserializer(['items.date', 'date', 'dueDate']);\n\n    const url = deskworksConfig.getApiAbsUrl('/centers/:centerId/user-profiles/:userId/generate-invoices');\n\n    const res = $resource(url, { centerId: '@centerId', userId: '@userId', orderId: '@orderId' }, {\n      get: { method: 'GET', transformResponse: [angular.fromJson, desDates] }\n    });\n\n    return {\n      /**\n       * @param params.centerId\n       * @param params.userId\n       * @param params.orderId\n       */\n      get: params => res.get({ centerId: params.centerId, userId: params.userId, orderId: params.orderId }).$promise\n        .then(result => (result.items.forEach(i => { i.include = true; }), result)),\n    };\n  });\n","// Module\nvar code = \"<form name=\\\"formGenerateInvoice\\\" class=\\\"gutter-v\\\" id=\\\"invoice\\\"> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <div> <div class=\\\"ff-grid gutter-v gutter-h\\\" ng-hide=\\\"$resolve.orderId\\\"> <ff-panel flex=\\\"{lg: '0 0 50%', md: '0 0 100%'}\\\" ng-if=\\\"!$ctrl.resources.user\\\"> <div><ff-spin class=\\\"ff-spin-placeholder\\\"></ff-spin></div> </ff-panel> <ff-panel flex=\\\"{lg: '0 0 50%', md: '0 0 100%'}\\\" ng-repeat=\\\"address in $ctrl.resources.user.addresses\\\"> <ff-panel-header> <ff-row class=\\\"gutter-h-half\\\"> <span translate=\\\"INVOICE.ADDRESS.HEADER\\\"></span> <div flex=\\\"0 0 auto\\\" style=\\\"align-items:center;margin:-.5rem 0\\\"> <ff-btn sense=\\\"favorite\\\" size=\\\"sm\\\" ng-if=\\\"address === $ctrl.params.address\\\" title=\\\"{{'INVOICE.ADDRESS.BTN_SELECTED.HINT' | translate}}\\\"> <span translate=\\\"INVOICE.ADDRESS.BTN_SELECTED\\\"></span> </ff-btn> <ff-btn sense=\\\"makeFavorite\\\" size=\\\"sm\\\" ng-if=\\\"address !== $ctrl.params.address\\\" ff-click=\\\"$ctrl.selectAddress(address)\\\" title=\\\"{{'INVOICE.ADDRESS.BTN_SELECT.HINT' | translate}}\\\"> <span translate=\\\"INVOICE.ADDRESS.BTN_SELECT\\\"></span> </ff-btn> </div> </ff-row> </ff-panel-header> <fieldset dw-address=\\\"address\\\" ng-disabled=\\\"address !== $ctrl.params.address\\\"></fieldset> </ff-panel> </div> </div> <div class=\\\"ff-grid gutter-h\\\" ng-hide=\\\"$resolve.orderId\\\"> <ff-panel flex=\\\"{lg: '0 0 50%', md: '0 0 100%'}\\\"> <ff-panel-header><span translate=\\\"INVOICE.DATES.HEADER\\\"></span></ff-panel-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 116px\\\"><req translate=\\\"INVOICE.DATES.END_DATE\\\"></req></ff-label> <ff-date ff-model=\\\"$ctrl.params.date\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'INVOICE.DATES.END_DATE' | translate}}\\\"></ff-date> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 116px\\\"><req translate=\\\"INVOICE.DATES.DUE_DATE\\\"></req></ff-label> <ff-date ff-model=\\\"$ctrl.params.dueDate\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'INVOICE.DATES.DUE_DATE' | translate}}\\\"></ff-date> </label> <label> <ff-checkbox ff-model=\\\"$ctrl.params.showDates\\\" ff-click=\\\"$ctrl.columns[0].include = $ctrl.params.showDates\\\" ff-label=\\\"{{'INVOICE.DATES.ADD_DATE_TO_ALL_ITEMS' | translate}}\\\"></ff-checkbox> </label> </ff-panel> </div> <div> <div class=\\\"ff-grid gutter-v gutter-h\\\" ng-hide=\\\"$resolve.orderId\\\"> <ff-panel flex=\\\"{lg: '0 0 50%', md: '0 0 100%'}\\\"> <ff-panel-header><span translate=\\\"INVOICE.ITEMS.HEADER\\\"></span></ff-panel-header> <ff-row> <label flex=\\\"0 0 auto\\\"> <ff-include-all flex=\\\"0 0 32px\\\" items=\\\"$ctrl.charges\\\" default=\\\"true\\\"></ff-include-all> </label> </ff-row> <ff-header> <ff-row> <cell flex=\\\"0 0 32px\\\" class=\\\"ff-center\\\"><ff-icon sense=\\\"check\\\"></ff-icon></cell> <cell flex=\\\"1 1 100px\\\" ng-if=\\\"$ctrl.params.showDates\\\"><span translate=\\\"INVOICE.ITEMS.DATE\\\"></span></cell> <cell flex=\\\"2 1 100px\\\"><span translate=\\\"INVOICE.ITEMS.NAME\\\"></span></cell> <cell flex=\\\"0 0 80px\\\" class=\\\"ff-right\\\"><span translate=\\\"INVOICE.ITEMS.AMOUNT\\\"></span></cell> </ff-row> </ff-header> <div ng-if=\\\"!$ctrl.charges\\\"><ff-spin class=\\\"ff-spin-placeholder\\\"></ff-spin></div> <ff-static ng-if=\\\"$ctrl.charges && !$ctrl.charges.length\\\" class=\\\"ff-no-frame\\\"> <span translate=\\\"GLOBAL.NONE\\\"></span> </ff-static> <label ng-repeat=\\\"charge in $ctrl.charges\\\" class=\\\"ff-row\\\"> <ff-static flex=\\\"0 0 32px\\\" class=\\\"ff-center\\\"> <ff-checkbox ff-model=\\\"charge.include\\\"></ff-checkbox> </ff-static> <ff-static flex=\\\"1 1 100px\\\" ng-if=\\\"$ctrl.params.showDates\\\">{{charge.date | date:'mediumDate'}}</ff-static> <ff-static flex=\\\"2 1 100px\\\" ff-bind=\\\"charge.name\\\"></ff-static> <ff-static flex=\\\"0 0 80px\\\" ff-bind=\\\"charge.amount | ncurrency\\\" class=\\\"ff-right\\\"></ff-static> </label> </ff-panel> <ff-panel flex=\\\"{lg: '0 0 50%', md: '0 0 100%'}\\\"> <ff-panel-header><span translate=\\\"INVOICE.PAYMENTS.HEADER\\\"></span></ff-panel-header> <ff-row> <label flex=\\\"0 0 auto\\\"> <ff-include-all flex=\\\"0 0 32px\\\" items=\\\"$ctrl.payments\\\" default=\\\"true\\\"></ff-include-all> </label> </ff-row> <ff-header> <ff-row> <cell flex=\\\"0 0 32px\\\" class=\\\"ff-center\\\"><ff-icon sense=\\\"check\\\"></ff-icon></cell> <cell><span translate=\\\"INVOICE.PAYMENTS.DATE\\\"></span></cell> <cell flex=\\\"0 0 80px\\\" class=\\\"ff-right\\\"><span translate=\\\"INVOICE.PAYMENTS.AMOUNT\\\"></span></cell> </ff-row> </ff-header> <div ng-if=\\\"!$ctrl.payments\\\"><ff-spin class=\\\"ff-spin-placeholder\\\"></ff-spin></div> <ff-static ng-if=\\\"$ctrl.payments && !$ctrl.payments.length\\\" class=\\\"ff-no-frame\\\"> <span translate=\\\"GLOBAL.NONE\\\"></span> </ff-static> <label ng-repeat=\\\"payment in $ctrl.payments\\\" class=\\\"ff-row\\\"> <ff-static flex=\\\"0 0 32px\\\" class=\\\"ff-center\\\"> <ff-checkbox ff-model=\\\"payment.include\\\"></ff-checkbox> </ff-static> <ff-static ff-bind=\\\"payment.date | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"0 0 80px\\\" ff-bind=\\\"payment.amount | ncurrency\\\" class=\\\"ff-right\\\"></ff-static> </label> </ff-panel> </div> </div> <div class=\\\"ff-grid gutter-v\\\"> <ff-btn-group flex=\\\"0 0 auto\\\" class=\\\"buttons-bottom\\\" style=\\\"margin-top:0\\\"> <ff-btn sense=\\\"download\\\" ff-click=\\\"$ctrl.downloadPdf()\\\" ff-disabled=\\\"!$ctrl.pdf\\\"> <span translate=\\\"INVOICE.BTN_PDF\\\"></span> </ff-btn> <ff-btn sense=\\\"back\\\" ff-click=\\\"$resolve.back()\\\" ng-if=\\\"$resolve.back\\\"> <span translate=\\\"GLOBAL.BTN_BACK\\\"></span> </ff-btn> </ff-btn-group> <div flex=\\\"{lg: '0 0 33%', md: '0 0 100%'}\\\" style=\\\"margin-bottom:0\\\"> <report-options model=\\\"$ctrl.params\\\" no-centers=\\\"true\\\"></report-options> </div> </div> <ff-panel> <ff-panel-header><span translate=\\\"INVOICE.PREVIEW.HEADER\\\"></span></ff-panel-header> <div pdf-preview=\\\"$ctrl.pdf\\\"></div> </ff-panel> </form> \";\n// Exports\nmodule.exports = code;","import InvoiceCtrl from './common/invoice.controller';\n\nconst index = ['$injector', function index($injector) {\n  // // JS\n  // const importAll = r => r.keys().map(r);\n  // const js = importAll(require.context('./', true, /\\..+\\/.+\\.js$/));\n  // $injector.loadNewModules(js.map(m => m.default.name));\n\n  $injector.loadNewModules([InvoiceCtrl.name]);\n\n  // Templates\n  $injector.invoke(['$templateCache', function($templateCache) {\n    const ctx = require.context('./common/', true, /.*\\.tpl\\.html$/);\n    ctx.keys().forEach(key => $templateCache.put(key.replace(/^\\.\\//, ''), ctx(key)));\n  }]);\n}];\n\nexport default index;\n"],"sourceRoot":""}