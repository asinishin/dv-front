(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"2kHi":function(e,t,n){"use strict";n.r(t);var r=n("nbuU"),a=n.n(r),s=n("6RpP"),o=n.n(s),c=n("RN/2"),i=n.n(c),l=n("xcNz");t.default=angular.module("deskworks.placepayPaymentMethodDirective",["deskworks.helper","deskworks.state","deskworks.userProfile.service",l.default.name]).directive("placepayPaymentMethod",(function(){return{restrict:"E",scope:!0,template:i.a,controller:"PlacepayPaymentMethodCtrl as $ctrl",bindToController:{user:"<",reg:"<",settings:"<"}}})).controller("PlacepayPaymentMethodCtrl",["$scope","$timeout","$route","helper","state","PlacepayPay",function(e,t,n,r,s,c){var i=this;i.$onInit=function(){var e,t;i.paymentMethod=a()(e=o()(t=i.user.creditCards).call(t,i.user.eChecks)).call(e,(function(e){return e.id===i.user.paymentMethodId}))},i.onEditPaymentMethod=function(){return c.open({autopay:!0,autopayOnly:!0}).then((function(){return n.reload()}))},i.isEditable=function(){return s.getCurrentUserId()===s.getLoggedUserId()}}])},"8qXe":function(e,t,n){},KpP6:function(e,t,n){"use strict";n.r(t);var r=n("yCd9"),a=n.n(r),s=n("lRNC"),o=n.n(s),c=["$injector",function(e){var t,r,s=(t=n("yPJS"),a()(r=o()(t).call(t)).call(r,t));e.loadNewModules(a()(s).call(s,(function(e){return e.default.name})))}];t.default=c},"RN/2":function(e,t){e.exports='<div id="upBillingMethod" class="ff-grid gutter-h"> <ff-panel flex="{lg: \'0 0 50%\'}"> <ff-header><span translate="BILLING_PROFILE.BILLING_METHOD"></span></ff-header> <div class="ff-row"> <ff-static flex="auto"> <span translate="GLOBAL.NONE" ng-if="!$ctrl.paymentMethod"></span> <span> <span>{{::$ctrl.paymentMethod.number || $ctrl.paymentMethod.accountNumber}}</span> <small ng-if="$ctrl.paymentMethod.number">(expires: {{::$ctrl.paymentMethod.expiry | date}})</small> </span> </ff-static> <ff-btn-group flex="none" class="buttons-row" ng-if="$ctrl.isEditable()"> <ff-btn sense="edit" size="sm" ff-click="$ctrl.onEditPaymentMethod()" ng-if="$ctrl.paymentMethod"><span translate="GLOBAL.BTN_EDIT"></span></ff-btn> <ff-btn sense="new" size="sm" ff-click="$ctrl.onEditPaymentMethod()" ng-if="!$ctrl.paymentMethod"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> </ff-btn-group> </div> </ff-panel> </div> '},RrxA:function(e,t){e.exports='<ff-panel> <ff-panel-header> <span translate="INTEGRATIONS_SETUP.PLACEPAY.HEADER"></span> </ff-panel-header> <ff-spin ng-if="$ctrl.spinSettings || $ctrl.spinSettings || $ctrl.spinDepositAccounts"></ff-spin> <form name="form" novalidate> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="INTEGRATIONS_SETUP.PUBLIC_API_KEY"></span></ff-label> <ff-text ff-model="$ctrl.settings.publicApiKey" ff-change="$ctrl.saveSettings(form)" ff-validate-alert="{{\'INTEGRATIONS_SETUP.PUBLIC_API_KEY\' | translate}}"></ff-text> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="INTEGRATIONS_SETUP.PRIVATE_API_KEY"></span></ff-label> <ff-text ff-model="$ctrl.settings.privateApiKey" ff-change="$ctrl.saveSettings(form)" ff-validate-alert="{{\'INTEGRATIONS_SETUP.PRIVATE_API_KEY\' | translate}}"></ff-text> </label> <label class="ff-row"> <ff-label flex="0 0 120px"> <span> <span translate="INTEGRATIONS_SETUP.PLACEPAY.SANDBOX"></span> <ff-hint><span translate="INTEGRATIONS_SETUP.PLACEPAY.SANDBOX.HINT"></span></ff-hint> </span> </ff-label> <ff-static> <ff-checkbox ff-model="$ctrl.settings.sandbox" ff-change="$ctrl.saveSettings(form)"></ff-checkbox> </ff-static> </label> </form> <form name="form" novalidate ng-repeat="center in $ctrl.centers" class="animate-collapse" ng-if="$ctrl.depositAccounts"> <ff-header style="padding-top:.5rem"> <ff-row> <cell>{{::center.name}}</cell> <ff-spin flex="0 0 16px" class="ff-spin-sm" ng-if="center.$$spin"></ff-spin> </ff-row> </ff-header> <label class="ff-row"> <ff-label flex="0 1 130px"><req translate="INTEGRATIONS_SETUP.PLACEPAY.DEPOSIT_ACCOUNT"></req></ff-label> <ff-select ff-model="center.depositAccountId" ff-options="depositAccount.id as depositAccount.name for depositAccount in $ctrl.depositAccounts" ff-change="$ctrl.saveCenter(center, form)" ff-required="true" ff-validate-alert="{{\'INTEGRATIONS_SETUP.PLACEPAY.DEPOSIT_ACCOUNT\' | translate}}"> </ff-select> </label> </form> </ff-panel> '},TIpW:function(e,t,n){"use strict";n.r(t);n("JBxO"),n("FdtR");var r=n("RrxA"),a=n.n(r),s=n("sqsK"),o=n("udX/"),c=n("UYtW");t.default=angular.module("deskworks.placepaySettingsDirective",["debounce",s.default.name,o.default.name,c.default.name]).directive("placepaySettings",(function(){return{template:a.a,restrict:"E",scope:!0,controller:"PlacepaySettingsCtrl as $ctrl"}})).controller("PlacepaySettingsCtrl",["$scope","$q","debounce","dwAlerts","helper","state","PlacepaySettings","PlacepayCenter","PlacepayDepositAccount",function(e,t,n,r,a,s,o,c,i){var l=this;l.$onInit=function(){l.loadSettings()},l.loadDepositAccounts=function(){if(l.settings&&l.settings.publicApiKey&&l.settings.privateApiKey)return l.spinDepositAccounts=!0,i.query().finally((function(){l.spinDepositAccounts=!1})).catch((function(e){return l.depositAccounts=null,r.error(e,"Failed to get PlacePay deposit accounts.")})).then((function(e){l.depositAccounts=e}));l.depositAccounts=null},l.loadSettings=function(){return l.spinSettings=!0,o.get().finally((function(){l.spinSettings=!1})).catch((function(e){return r.error(e,"Failed to get PlacePay settings.")})).then((function(e){l.settings=e,l.loadDepositAccounts(),l.loadCenters()}))},l.saveSettings=n((function(e){if(e&&e.$invalid)return;return l.spinSettings=!0,o.save(l.settings).finally((function(){l.spinSettings=!1})).catch((function(e){return r.error(e,"Failed to save PlacePay settings.")})).then((function(){l.loadDepositAccounts(),l.loadCenters()}))}),500),l.loadCenters=function(){if(l.settings&&l.settings.publicApiKey&&l.settings.privateApiKey)return l.spinCenters=!0,c.query().finally((function(){l.spinCenters=!1})).catch((function(e){return r.error(e,"Failed to query PlacePay centers.")})).then((function(e){l.centers=e}));l.centers=null},l.saveCenter=n((function(e,t){if(t&&t.$invalid)return;return e.$$spin=!0,c.save(e).finally((function(){e.$$spin=!1})).catch((function(e){return r.error(e,"Failed to save PlacePay center.")}))}),500)}])},UYtW:function(e,t,n){"use strict";n.r(t),t.default=angular.module("deskworks.PlacepayDepositAccount",["ngResource","deskworks.config"]).factory("PlacepayDepositAccount",["$resource","deskworksConfig",function(e,t){var n=e(t.getApiAbsUrl("/placepay/deposit-accounts"));return{query:function(){return n.query({}).$promise}}}])},sqsK:function(e,t,n){"use strict";n.r(t),t.default=angular.module("deskworks.PlacepaySettings",["ngResource","deskworks.config"]).factory("PlacepaySettings",["$resource","deskworksConfig",function(e,t){var n=e(t.getApiAbsUrl("/placepay/settings"),{},{update:{method:"PUT"}});return{get:function(){return n.get().$promise},save:function(e){return n.update({},e).$promise}}}])},"udX/":function(e,t,n){"use strict";n.r(t),t.default=angular.module("deskworks.PlacepayCenter",["ngResource","deskworks.config"]).factory("PlacepayCenter",["$resource","deskworksConfig",function(e,t){var n=e(t.getApiAbsUrl("/placepay/centers/:id"),{},{update:{method:"PUT"}});return{query:function(){return n.query({}).$promise},save:function(e){return n.update({id:e.id},e).$promise}}}])},xcNz:function(e,t,n){"use strict";n.r(t);var r=n("fzuT"),a=n.n(r),s=(n("iPZ8"),n("kypl"),n("Muwe"),n("y89P"),n("3dw1"),n("nbuU")),o=n.n(s),c=n("gQJ2"),i=n.n(c),l=n("03wM"),f=n.n(l),u=n("Ekwr"),p=n.n(u),d=n("hsT8"),y=n.n(d),g=n("lvz6"),m=n.n(g),h=n("yKah"),P=n.n(h);n("8qXe");function v(e,t){var n=f()(e);if(p.a){var r=p()(e);t&&(r=y()(r).call(r,(function(t){return m()(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):P.a?Object.defineProperties(e,P()(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,m()(n,t))}))}return e}t.default=angular.module("deskworks.PlacepayPay",["ngResource","deskworks.config","deskworks.reservationService"]).factory("PlacepayPay",["$resource","$q","$timeout","deskworksConfig","dwAlerts","state","optsBillingMethod","reservationService",function(e,t,n,r,a,s,c,l){o()(c).call(c,(function(e){return"none"===e.id}))||c.unshift({id:"none",name:"TBD",_name:"TBD"});var f,u=e(r.getApiAbsUrl("/placepay/session-access-token")),p=e(r.getApiAbsUrl("/placepay/autopay-changed")),d=e(r.getApiAbsUrl("/placepay/complete-transaction"));return(f=document.createElement("script")).src="https://placepay.com/plugins/pay.js",document.head.appendChild(f),{open:function(e){var n=e.amount,r=e.autopay,o=e.description,c=void 0===o?"":o,f=e.orderId,y=e.reason,g=void 0===y?{}:y,m=e.reservation;return u.get({userId:s.getCurrentUserId(),centerId:s.getCurrentCenterId()}).$promise.catch((function(e){return a.error(e,"Failed to get PlacePay session.")})).then((function(e){var o=e.publicApiKey,u=e.accessToken,y=e.depositAccountId,h=e.defaultPaymentMethodId;return t((function(e,P){var v=h;Place.pay.open({key:o,access_token:u,deposit_account_id:y,autopay:r,autopay_only:!n,amount:n,autopay_required:r,description:c,on:{autopay_changed:function(e){var t;if(v=(null===(t=e.autopay)||void 0===t?void 0:t.payment_method_id)||null,!e.autopay)return a.error("Autopay is required for members. Please enable it to proceed.");var n={paymentMethodId:e.autopay.payment_method_id};p.save({userId:s.getCurrentUserId(),centerId:s.getCurrentCenterId()},n).$promise.catch((function(e){return a.error(e,"Failed to change default payment method.")})).then((function(){return a.info("Default payment method changed.")}))},closed:function(o){var c=t.when({});n&&(o.transaction_id?(m&&(c=l.save(s.getCurrentCenterId(),s.getCurrentUserId(),m).catch((function(e){return a.error(e,"Failed to make reservation.")}))),c=c.then((function(e){e.id&&(g.reservationId=e.id);var t={transactionId:o.transaction_id,orderId:f,amount:n,reason:g};return d.save({userId:s.getCurrentUserId(),centerId:s.getCurrentCenterId()},t).$promise.catch((function(e){return g.reservationId?l.delete(s.getCurrentCenterId(),s.getCurrentUserId(),g.reservationId).then((function(){return a.error(e,"Failed to complete transaction.")})):a.error(e,"Failed to complete transaction.")}))}))):(a.error("Please complete payment to proceed.").catch(angular.noop),P())),c.then((function(t){r?v?e(t):(a.error("Autopay is required for members. Please enable it to proceed.").catch(angular.noop),P()):e(t)}))},error:function(e){a.error("PlacePay error: "+i()(e).replace(/,"/g,', "'))}}})}))}))},preprocessUser:function(e){var t,n,r=o()(t=e.creditCards).call(t,(function(t){return t.id===e.paymentMethodId})),a=o()(n=e.eChecks).call(n,(function(t){return t.id===e.paymentMethodId}));return A(A({},e),{},{creditCards:r?[r]:[],eChecks:a?[a]:[]})}}}])},yPJS:function(e,t,n){var r={"./payment-method/placepay-payment-method.directive.js":"2kHi","./services/placepay-center.service.js":"udX/","./services/placepay-deposit-account.service.js":"UYtW","./services/placepay-pay.service.js":"xcNz","./services/placepay-settings.service.js":"sqsK","./settings/placepay-settings.directive.js":"TIpW"};function a(e){var t=s(e);return n(t)}function s(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=s,e.exports=a,a.id="yPJS"}}]);