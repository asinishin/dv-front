angular.module("deskworks.reports.accountsReceivableReportColumns",[]).factory("accountsReceivableReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userCompany",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.COMPANY",include:!0,minWidth:150},{dataKey:"userName",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.USER_NAME",include:!0,minWidth:120},{dataKey:"date",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.BILL_DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")},defaultOrder:!0},{dataKey:"amount",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"amountDue",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.AMOUNT_DUE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"daysLate",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.DAYS_LATE",include:!0,halign:"right"},{dataKey:"comment",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.COMMENT",include:!0,minWidth:120},{dataKey:"orderId",_title:"ACCOUNTS_RECEIVABLE_REPORT.COLUMNS.ORDER_ID",include:!1,halign:"center",width:"wrap"}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.accountsReceivableReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.accountsReceivableReport.service","deskworks.reports.accountsReceivableReportColumns"]).controller("AccountsReceivableReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","AccountsReceivableReport","accountsReceivableReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:e.reportData.payments};t.rows=p.reportBuilder.sortData(t.rows,e.reportColumns.order),f=[],t.rows=t.rows.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})});var r,o=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1});return t.rows.push(o),f.push(null),(r=a.findIndexByKeyValue(t.columns,"dataKey","daysLate"))>=0&&(t.rows.push(o.slice(0,Math.max(r-1,0)).concat(r>0?[n.instant("ACCOUNTS_RECEIVABLE_REPORT.TOTALS.AVG_DAYS_LATE")+":",e.reportData.averageDaysLate]:[e.reportData.averageDaysLate]).concat(o.slice(0,o.length-r-1))),f.push(s.h3)),(r=a.findIndexByKeyValue(t.columns,"dataKey","amountDue"))>=0&&(t.rows.push(o.slice(0,Math.max(r-1,0)).concat(r>0?[n.instant("ACCOUNTS_RECEIVABLE_REPORT.TOTALS.TOTAL_DUE")+":",e.reportData.total]:[e.reportData.total]).concat(o.slice(0,o.length-r-1))),f.push(s.h3)),t}p.config={reportName:n.instant("ACCOUNTS_RECEIVABLE_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:angular.copy(c)},reportDates:{fromDate:!1,toDate:moment()},getReportData:function(){return u.get({centerId:p.config.reportOptions.centerId,date:r("date")(p.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(p.config.reportName),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportDates:p.config.reportDates,reportColumns:p.config.reportColumns,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){if(p.pdf=null,!angular.isUndefined(p.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})}},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.accountsReceivableReport.service",["ngResource","datesDeserializer","deserializeNumbers","deskworks.config"]).factory("AccountsReceivableReport",["$resource","datesDeserializer","deserializeNumbers","deskworksConfig",function(e,t,r,n){"use strict";var o=t(["payments.date"]),a=r(["payments.amountDue","payments.amount"]);return e(n.getApiAbsUrl("/centers/:centerId/accounts-receivable-reports"),{centerId:"@centerId",date:"@date"},{get:{method:"GET",transformResponse:[angular.fromJson,o,a]}})}]),angular.module("deskworks.reports.availabilityReportColumns",[]).factory("availabilityReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n={available:[{dataKey:"name",_title:"AVAILABILITY_REPORT.COLUMNS.UNIT",include:!0,defaultOrder:!0},{dataKey:"basePrice",_title:"AVAILABILITY_REPORT.COLUMNS.PRICE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"description",_title:"AVAILABILITY_REPORT.COLUMNS.DESCRIPTION",include:!0}],unavailable:[{dataKey:"name",_title:"AVAILABILITY_REPORT.COLUMNS.UNIT",include:!0,defaultOrder:!0},{dataKey:"basePrice",_title:"AVAILABILITY_REPORT.COLUMNS.PRICE",include:!0,halign:"right",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"discount",_title:"AVAILABILITY_REPORT.COLUMNS.DISCOUNT",include:!0,halign:"right",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"netPrice",_title:"AVAILABILITY_REPORT.COLUMNS.NET_PRICE",include:!0,halign:"right",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"attachedUser",_title:"AVAILABILITY_REPORT.COLUMNS.CLIENT",include:!0}]};function o(){n.available.forEach(function(e){e.title=r.instant(e._title)}),n.unavailable.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.availabilityReport",["pdfPreview","fileSaver","jsPDF","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.availabilityReport.service","deskworks.reports.availabilityReportColumns"]).controller("AvailabilityReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","jsPDF","reportStyles","ReportBuilder","AvailabilityReport","availabilityReportColumns",function(e,t,r,n,o,a,i,s,l,u,c,d){"use strict";var p,f=this,m=[],g={0:{columnWidth:230},1:{columnWidth:60}},R={0:{columnWidth:230},1:{columnWidth:60},2:{columnWidth:60},3:{columnWidth:60}};function y(e){var t={columns:d.available,rows:[]};m=[];var r=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1}),o=0;return e.reportData.forEach(function(e,n){var a=e.reservationUnits.filter(function(e){return!e.attachedUser});a.length&&(t.rows.push([e.name].concat(r.slice(0,r.length-1))),m.push(l.h2),a.forEach(function(e,r){isNaN(e.basePrice)||(o+=+e.basePrice),t.rows.push(t.columns.map(function(t){return e[t.dataKey]})),m.push(r%2?null:l.rowOdd)}))}),t.rows.push([n.instant("AVAILABILITY_REPORT.TOTALS.VACANCY"),o].concat(r.slice(0,r.length-2))),m.push(l.h1),t}function h(e){var t={columns:d.unavailable,rows:[]};m=[];var r=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1}),o=0;return e.reportData.forEach(function(e,n){var a=e.reservationUnits.filter(function(e){return!!e.attachedUser});a.length&&(t.rows.push([e.name].concat(r.slice(0,r.length-1))),m.push(l.h2),a.forEach(function(e,r){isNaN(e.netPrice)||(o+=+e.netPrice),t.rows.push(t.columns.map(function(t){return e[t.dataKey]})),m.push(r%2?null:l.rowOdd)}))}),t.rows.push([n.instant("AVAILABILITY_REPORT.TOTALS.OCCUPIED"),!1,!1,o].concat(r.slice(0,r.length-4))),m.push(l.h1),t}f.config={reportName:n.instant("AVAILABILITY_REPORT.REPORT_NAME"),reportOptions:{},getReportData:function(){return c.query({centerId:f.config.reportOptions.centerId})},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,m[t.row.index])}},o.setPageTitle(f.config.reportName),f.reportBuilder=new u(f.config),e.$watch(function(){return{reportOptions:f.config.reportOptions,reportColumns:f.config.reportColumns}},function(e,r){p&&(t.cancel(p),p=null),p=t(function(){if(f.pdf=null,!angular.isUndefined(f.config.reportOptions.centerId)){var e=new s(f.config.reportOptions.paperLayout,"pt",f.config.reportOptions.paperSize),t=l.pageMargins[0];e.setFontSize(11),e.setFontStyle("bold"),e.autoTableText(n.instant("AVAILABILITY_REPORT.AVAILABLE")+":",l.pageMargins[3],t,{});var r=Object.assign({startY:t+15,columnStyles:g},l);f.reportBuilder.generatePdf(y,r,e).then(function(e){var t=e.autoTableEndPosY()+20;e.setFontSize(11),e.setFontStyle("bold"),e.autoTableText(n.instant("AVAILABILITY_REPORT.UNAVAILABLE")+":",l.pageMargins[3],t,{});var r=Object.assign({startY:t+15,columnStyles:R},l);f.reportBuilder.generatePdf(h,r,e).then(function(e){f.pdf=e.output("blob")})})}},100)},!0),f.downloadPdf=function(){f.pdf&&i(f.pdf,f.reportBuilder.getReportFileName("pdf"))},f.downloadCsv=function(e){f.pdf&&("vacancy"===e?i(f.reportBuilder.buildCsv(y),f.reportBuilder.getReportFileName("csv","-vacancy")):i(f.reportBuilder.buildCsv(h),f.reportBuilder.getReportFileName("csv","-occupancy")))}}]),angular.module("deskworks.reports.availabilityReport.service",["ngResource","deserializeNumbers","deskworks.config"]).factory("AvailabilityReport",["$resource","deserializeNumbers","deskworksConfig",function(e,t,r){"use strict";var n=r.getApiAbsUrl("/centers/:centerId/availability-reports"),o=t(["reservationUnits.price","reservationUnits.discount"]),a=e(n,{centerId:"@centerId"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,o]}});return{query:function(e){return a.query(e).$promise.then(function(e){return e.forEach(function(e){e.reservationUnits.forEach(function(e){isNaN(e.netPrice)||isNaN(e.discount)||(e.netPrice-=+e.discount)})}),e})}}}]),angular.module("deskworks.reports.creditBalanceReportColumns",[]).factory("creditBalanceReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"centerName",_title:"CREDIT_BALANCE_REPORT.COLUMNS.CENTER",include:!0},{dataKey:"userName",_title:"CREDIT_BALANCE_REPORT.COLUMNS.USER_NAME",include:!0},{dataKey:"date",_title:"CREDIT_BALANCE_REPORT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"order",_title:"CREDIT_BALANCE_REPORT.COLUMNS.ORDER_ID",include:!0,width:"wrap"},{dataKey:"amount",_title:"CREDIT_BALANCE_REPORT.COLUMNS.BALANCE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.creditBalanceReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.creditBalanceReport.service","deskworks.reports.creditBalanceReportColumns"]).controller("CreditBalanceReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","CreditBalanceReport","creditBalanceReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns,rows:[]};return f=[],t.rows=e.reportData.credits.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})}),t.rows.push([!1,!1,!1,!1,!1]),f.push(null),t.rows.push([!1,!1,!1,n.instant("CREDIT_BALANCE_REPORT.TOTALS.CREDIT")+":",e.reportData.total]),f.push(s.h3),t}p.config={reportName:n.instant("CREDIT_BALANCE_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:c},getReportData:function(){return u.get({centerId:p.config.reportOptions.centerId,ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(p.config.reportName),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){p.pdf=null,angular.isUndefined(p.config.reportOptions.centerId)||p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.creditBalanceReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("CreditBalanceReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["credits.date"]);return e(r.getApiAbsUrl("/centers/:centerId/credit-balance-reports"),{centerId:"@centerId"},{get:{method:"GET",transformResponse:[angular.fromJson,n]}})}]),angular.module("deskworks.reports.depositTransactionReportColumns",["deskworks.helper"]).factory("depositTransactionReportColumns",["$rootScope","$filter","$translate","helper",function(e,t,r,n){"use strict";var o=[{dataKey:"reference",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.REFERENCE",include:!0,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"userName",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.USER_NAME",include:!0,defaultOrder:!0},{dataKey:"payorName",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.PAYOR",include:!0},{dataKey:"userCompany",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.COMPANY",include:!0},{dataKey:"amount",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"subtotal",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.SUBTOTAL",include:!0,halign:"right",readonly:!0,width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"total",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.TOTAL",include:!0,halign:"right",readonly:!0,width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"orderId",_title:"DEPOSIT_TRANSACTION_REPORT.COLUMNS.ORDER_ID",include:!1,halign:"center",width:"wrap"}];function a(){o.forEach(function(e){e.title=r.instant(e._title)})}return a(),e.$on("$setTranslationsSuccess",a),o}]),angular.module("deskworks.reports.depositTransactionReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.depositTransactionReport.service","deskworks.reports.depositTransactionReportColumns"]).controller("DepositTransactionReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","DepositTransactionReport","depositTransactionReportColumns","banks","centers",function(e,t,r,n,o,a,i,s,l,u,c,d,p){"use strict";var f,m=this,g=[];function R(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};g=[];var r,o=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1});return e.reportData.forEach(function(i,l){(r=a.findIndexByKeyValue(t.columns,"dataKey","total"))>=0&&(t.rows.push([i.date].concat(o.slice(0,Math.max(r-2,0))).concat(r>1?[n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.DAILY")+":",i.total]:[i.total]).concat(o.slice(0,o.length-r-1))),g.push(s.h1)),i.billingMethods.forEach(function(i){(r=a.findIndexByKeyValue(t.columns,"dataKey","subtotal"))>=0&&(t.rows.push(0===r?[i.subtotal]:[i.name+" "+n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.DEPOSITS")].concat(o.slice(0,Math.max(r-3,0))).concat(r>2?[i.name+" "+n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.SUBTOTAL")+":",!1,i.subtotal]:2===r?[i.name+" "+n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.SUBTOTAL")+":",i.subtotal]:1===r?[i.subtotal]:[]).concat(o.slice(0,o.length-r-1))),g.push(s.h2)),m.reportBuilder.sortData([].concat.apply([],i.centers.map(function(e){return e.payments})),e.reportColumns.order).forEach(function(e,r){t.rows.push(t.columns.map(function(t){return"subtotal"!==t.dataKey&&"total"!==t.dataKey&&e[t.dataKey]})),g.push(r%2?null:s.rowOdd)}),i.centers.forEach(function(e){(r=a.findIndexByKeyValue(t.columns,"dataKey","subtotal"))>=0&&t.rows.push(o.slice(0,Math.max(r-2,0)).concat(r>2?[e.name+" "+n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.SUBTOTAL")+":",!1,e.subtotal]:r>0?[e.name+" "+n.instant("DEPOSIT_TRANSACTION_REPORT.TOTALS.SUBTOTAL")+":",e.subtotal]:[e.subtotal]).concat(o.slice(0,o.length-r-1))),g.push(s.h3)}),t.rows.push(o.slice()),g.push(null)})}),t}m.config={reportName:n.instant("DEPOSIT_TRANSACTION_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:c},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return u.query({bankId:m.config.reportOptions.bankId,centerId:m.config.reportOptions.centerId||null,fromDate:r("date")(m.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:r("date")(m.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:m.config.reportOwnerRegion.ownerId,regionId:m.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,g[t.row.index])}},o.setPageTitle(m.config.reportName),m.config.reportDates.fromDate.subtract(1,"M").date(1),m.config.reportDates.toDate.date(0),m.reportBuilder=new l(m.config),e.$watch("vm.config.reportOptions.bankId",function(e){e&&(m.centers=p.filter(function(t){return t.bankId===e}),m.centers.unshift({id:0,name:"All Centers"}),a.findByKeyValue(m.centers,"id",m.config.reportOptions.centerId)||(m.config.reportOptions.centerId=m.centers[0].id,o.setParam("centerId",m.config.reportOptions.centerId),o.replace()))}),e.$watch(function(){return{reportOptions:m.config.reportOptions,reportDates:m.config.reportDates,reportColumns:m.config.reportColumns,reportOwnerRegion:m.config.reportOwnerRegion}},function(e,r){f&&(t.cancel(f),f=null),f=t(function(){if(m.pdf=null,!angular.isUndefined(m.config.reportOptions.bankId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(m.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(m.config.reportData=null),e.reportOptions.bankId!==r.reportOptions.bankId&&(m.config.reportData=null),m.reportBuilder.buildPdf(R).then(function(e){m.pdf=e})}},100)},!0),m.downloadPdf=function(){m.pdf&&i(m.pdf,m.reportBuilder.getReportFileName("pdf"))},m.downloadCsv=function(){m.pdf&&i(m.reportBuilder.buildCsv(R),m.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.depositTransactionReport.service",["ngResource","deserializeNumbers","datesDeserializer","deskworks.config"]).factory("DepositTransactionReport",["$resource","datesDeserializer","deserializeNumbers","deskworksConfig",function(e,t,r,n){"use strict";var o=n.getApiAbsUrl("/banks/:bankId/deposit-transaction-reports"),a=t(["date","billingMethods.centers.payments.date"]),i=r(["billingMethods.centers.payments.amount"]);return e(o,{bankId:"@bankId",centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,a,i]}})}]),angular.module("chart",["deskworks.helper"]).directive("chart",["$window","systemColors",function(e,t){"use strict";return e.Chart.defaults.global.legend.labels.boxWidth=12,e.Chart.defaults.global.tooltips.cornerRadius=3,e.Chart.defaults.global.tooltips.displayColors=!1,e.Chart.defaults.global.tooltips.backgroundColor="rgba(0,0,0,0.65)",e.Chart.defaults.global.elements.rectangle.borderWidth=1,e.Chart.defaults.global.elements.rectangle.backgroundColor=t.primary,e.Chart.defaults.global.elements.arc.borderWidth=1,{restrict:"E",scope:!0,controller:"ChartCtrl as $ctrl",bindToController:{type:"@chartType",labels:"<chartLabels",data:"<chartData",options:"<chartOptions"},template:"<canvas></canvas>"}}]).controller("ChartCtrl",["$scope","$element","$window","helper",function(e,t,r,n){"use strict";var o,a=this,i={},s={maintainAspectRatio:!1};a.$onDestroy=function(){o&&o.destroy()},a.$onChanges=function(){a.options&&(i.datasets=a.data,i.labels=a.labels,o?o.update():(angular.extend(s,a.options),o=new r.Chart(t.children(),{type:a.type,data:i,options:s})))}}]),angular.module("pdfPreview",[]).directive("pdfPreview",["$window","helper",function(e,t){"use strict";return{restrict:"A",scope:!0,template:'<iframe ng-hide="ie"></iframe><ff-info class="text-warning" ng-if="ie"><ff-icon sense="warning"></ff-icon> Microsoft Edge & Internet Explorer don\'t support live PDF preview. You can download the PDF or use another browser to have live preview, e.g. Chrome/Firefox/Opera/Safari.</ff-info>',compile:function(r,n){return t.isIE()?function(e,t,r){e.ie=!0}:(r.addClass("pdf-preview"),function(t,r,n){var o,a=r.children(),i=angular.element('<div class="ff-dimmer ff-spin ff-big-spin"></div>');i.on("click",function(e){e.stopPropagation()}),a.on("load",function(){angular.element(i).remove(),r.removeClass("ff-dim")}),t.$watch(n.pdfPreview,function(t){r.append(i),r.addClass("ff-dim"),o&&(e.URL.revokeObjectURL(o),o=null),t&&(o=e.URL.createObjectURL(t),a[0].src=o)}),t.$on("$destroy",function(){o&&(e.URL.revokeObjectURL(o),o=null)})})}}}]),angular.module("deskworks.reports.reportColumns",["deskworks.helper"]).directive("reportColumns",["$compile","$templateCache",function(e,t){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",priority:2,controller:"ReportColumnsCtrl as $ctrl",bindToController:{ngModel:"<",noInclude:"<",noOrder:"<"},link:function(r,n,o,a,i){i(function(o,a){n.after(e(t.get("directives/report-columns.tpl.html"))(r))})}}}]).controller("ReportColumnsCtrl",["$scope","$location","helper",function(e,t,r){"use strict";var n=this;n.$onInit=function(){n.noOrder||(e.$watch(function(){return t.search().order},function(e){n.ngModel.order=(r.findByKeyValue(n.ngModel.columns,"dataKey",e)||r.findByKeyValue(n.ngModel.columns,"defaultOrder",!0)||n.ngModel.columns[0]).dataKey}),e.$watch("$ctrl.ngModel.order",function(){t.search("order",n.ngModel.order).replace(),(r.findByKeyValue(n.ngModel.columns,"dataKey",n.ngModel.order)||{}).include=!0})),e.$watch(function(){return t.search().columns},function(e){e&&(n.ngModel.columns.forEach(function(e){e.include=!1}),e.split(",").forEach(function(e){(r.findByKeyValue(n.ngModel.columns,"dataKey",e)||{}).include=!0}))}),e.$watchCollection(function(){return n.ngModel.columns.map(function(e){return!!e.include})},function(){(r.findByKeyValue(n.ngModel.columns,"dataKey",n.ngModel.order)||{}).include=!0,n.leftColCount=n.rightColCount=Math.floor(n.ngModel.columns.length/2),n.leftColCount+n.rightColCount<n.ngModel.columns.length&&n.leftColCount++;var e=n.ngModel.columns.filter(function(e){return e.include}).map(function(e){return e.dataKey}).join(",");t.search("columns",e).replace()})}}]),angular.module("deskworks.reports.reportDates",["deskworks.helper"]).directive("reportDates",["$compile","$templateCache",function(e,t){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",priority:2,controller:"ReportDatesCtrl as $ctrl",bindToController:{ngModel:"<",embed:"@",monthly:"<"},link:function(r,n,o,a,i){i(function(o,a){var i=e(t.get("directives/report-dates.tpl.html"))(r);angular.element(i[0].querySelector?i[0].querySelector(".panel-body"):i).append(o),n.after(i)})}}}]).controller("ReportDatesCtrl",["$scope","$location","$filter","state","helper",function(e,t,r,n,o){"use strict";var a=this;a.$onInit=function(){!1!==a.ngModel.fromDate&&(e.$watch(function(){return t.search().fromDate},function(e){var t=r("toDate")(e);a.ngModel.fromDate=moment.isMoment(t)&&!a.ngModel.fromDate.isSame(t)?t:a.ngModel.fromDate}),e.$watch("$ctrl.ngModel.fromDate",function(e){moment.isMoment(e)&&t.search("fromDate",r("date")(e,"yyyy-MM-dd")).replace()})),!1!==a.ngModel.toDate&&(e.$watch(function(){return t.search().toDate},function(e){var t=r("toDate")(e);a.ngModel.toDate=moment.isMoment(t)&&!a.ngModel.toDate.isSame(t)?t:a.ngModel.toDate}),e.$watch("$ctrl.ngModel.toDate",function(e){moment.isMoment(e)&&t.search("toDate",r("date")(e,"yyyy-MM-dd")).replace()}))}}]),angular.module("deskworks.reports.reportOptions",["deskworks.helper","deskworks.reports.optsPaperSize"]).directive("reportOptions",["$compile","$templateCache",function(e,t){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",priority:2,controller:"ReportOptionsCtrl as $ctrl",bindToController:{ngModel:"<",centers:"<",allCenters:"<",banks:"<"},link:function(r,n,o,a,i){i(function(o,a){var i=e(t.get("directives/report-options.tpl.html"))(r);angular.element(i[0].querySelector?i[0].querySelector(".panel-body"):i).append(o),n.after(i)})}}}]).controller("ReportOptionsCtrl",["$scope","$location","state","helper","optsPaperSize",function(e,t,r,n,o){"use strict";var a=this;a.optsPaperSize=o,a.$onInit=function(){!1!==a.ngModel.centerId&&(e.$watch(function(){return t.search().centerId},function(e){a.ngModel.centerId=e||0===e?+e:r.getCurrentCenterId()}),e.$watch("$ctrl.ngModel.centerId",function(r){r&&e.vm&&e.vm.config&&e.vm.config.reportOwnerRegion&&(e.vm.config.reportOwnerRegion.ownerId=e.vm.config.reportOwnerRegion.regionId=void 0),t.search("centerId",r).replace()})),a.banks&&(e.$watch(function(){return t.search().bankId},function(e){a.ngModel.bankId=e||0===e?+e:a.banks&&a.banks[0]&&a.banks[0].id}),e.$watch("$ctrl.ngModel.bankId",function(e){t.search("bankId",e).replace()})),e.$watch(function(){return t.search().paperSize},function(e){a.ngModel.paperSize=(n.findByKeyValue(a.optsPaperSize,"id",e)||a.optsPaperSize[0]).id}),e.$watch("$ctrl.ngModel.paperSize",function(e){t.search("paperSize",e).replace()}),e.$watch(function(){return t.search().paperLayout},function(e){a.ngModel.paperLayout=e||a.ngModel.paperLayout||"l"}),e.$watch("$ctrl.ngModel.paperLayout",function(e){t.search("paperLayout",e).replace()})}}]),angular.module("deskworks.reports.reportOrderBy",["deskworks.helper"]).directive("reportOrderBy",["$compile","$templateCache",function(e,t){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",priority:2,controller:"ReportOrderByCtrl as $ctrl",bindToController:{order:"=",columns:"<",levelsCount:"<levels"},link:function(r,n,o,a,i){i(function(){n.after(e(t.get("directives/report-order-by.tpl.html"))(r))})}}}]).controller("ReportOrderByCtrl",["$scope","$location","helper",function(e,t,r){"use strict";var n=this;function o(){if(!n.levels){n.levels=new Array(n.levelsCount||1);for(var e=0;e<n.levels.length;e++)n.levels[e]={}}var t=[];n.levels.forEach(function(e,r){e.cols=n.columns.filter(function(r){if(t.indexOf(r.dataKey)<0)return!0;r.dataKey===e.order&&(e.order=null)}),r&&e.cols.unshift({dataKey:null,title:"-"}),e.order&&t.push(e.order)})}n.$onInit=function(){o(),e.$watch(function(){return t.search().order},function(e){var t=(e||"").split(",");n.levels.forEach(function(e,n){e.order=(t[n]?r.find(e.cols,{dataKey:t[n]}):r.find(e.cols,{defaultOrder:!0})||e.cols[0]).dataKey})}),e.$watchCollection(function(){return n.levels.map(function(e){return e.order}).filter(function(e){return!!e})},function(e){o();var r=n.levels.map(function(e){return e.order}).filter(function(e){return!!e});t.search("order",r.join(",")).replace(),n.order=n.levelsCount>1?r:r[0]})}}]),angular.module("deskworks.reports.reportOwnerRegion",["deskworks.helper","deskworks.Owner","deskworks.Region","deskworks.setup.service"]).directive("reportOwnerRegion",["$compile","$templateCache",function(e,t){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",priority:2,controller:"ReportOwnerRegionCtrl as $ctrl",bindToController:{ngModel:"<",reportData:"="},link:function(r,n,o,a,i){i(function(o,a){var i=e(t.get("directives/report-owner-region.tpl.html"))(r);angular.element(i[0].querySelector?i[0].querySelector(".panel-body"):i).append(o),n.after(i)})}}}]).controller("ReportOwnerRegionCtrl",["$scope","$location","$translate","$q","dwAlerts","Owner","Region","setupService","state","helper",function(e,t,r,n,o,a,i,s,l,u){"use strict";var c=this;"master"===l.getLoggedUser().role&&(c.$onInit=function(){s.getSetupSettings().catch(function(e){return o(e,"Failed to get setup settings.")}).then(function(e){if(e.isFranchise)return n.all([a.query().catch(function(e){return o(e,"Failed to query owners.")}).then(function(e){c.owners=e,c.owners.unshift({name:r.instant("REPORTS.OWNER_REGION.OWNER.ALL")})}),i.query().catch(function(e){return o(e,"Failed to query regions.")}).then(function(e){c.regions=e,c.regions.unshift({name:r.instant("REPORTS.OWNER_REGION.REGION.ALL")})})])}),!1!==c.ngModel.ownerId&&(e.$watch(function(){return t.search().ownerId},function(e,t){c.ngModel.ownerId=e||0===e?+e:c.owners&&c.owners[0]&&c.owners[0].id,e!==t&&(c.reportData=null)}),e.$watch("$ctrl.ngModel.ownerId",function(e){t.search("ownerId",e).replace()})),!1!==c.ngModel.regionId&&(e.$watch(function(){return t.search().regionId},function(e,t){c.ngModel.regionId=e||0===e?+e:c.regions&&c.regions[0]&&c.regions[0].id,e!==t&&(c.reportData=null)}),e.$watch("$ctrl.ngModel.regionId",function(e){t.search("regionId",e).replace()}))},c.onChange=function(){(c.ngModel.ownerId||c.ngModel.regionId)&&(e.vm.config.reportOptions.centerId=0)})}]),angular.module("deskworks.reports.incomeByItemPieChart",[]).factory("incomeByItemPieChart",["$filter","helper",function(e,t){"use strict";return{pieBySupCategories:function(e,n){var o=[];e.forEach(function(e){var r=e.code.split("-")[0],a=t.find(o,{code:r});if(!a){var i=t.find(n,{code:r+"-00"});a={code:r,name:t.join([i?i.name:e.name,"["+r+"]"]," "),value:0,catsCount:0,cats:[]},o.push(a)}a.catsCount++,a.cats.push(e),e.products.forEach(function(e){a.value+=t.toNumber(e.amount)})});var a=(o=r(o,"value",!0)).slice(10);if(o=o.slice(0,10),a.length){var i=Math.max(a.reduce(function(e,t){return e+t.value},0),0);o.push({name:"Others",value:i})}return o},pieByCategories:function(e,n){var o=[];if(n){var a=e.filter(function(e){return 0===e.code.indexOf(n.code)});e=a}e.forEach(function(e){var r=t.findByKeyValue(o,"code",e.code);r||(r={code:e.code,name:t.join([e.name,"["+e.code+"]"]," "),value:0},o.push(r)),e.products.forEach(function(e){r.value+=t.toNumber(e.amount)})});var i=(o=r(o,"value",!0)).slice(10);if(o=o.slice(0,10),i.length){var s=Math.max(i.reduce(function(e,t){return e+t.value},0),0);o.push({name:"Others",value:s})}return o},pieByProducts:function(e,n){var o=[];return t.find(e,{code:n}).products.forEach(function(e){var r=t.find(o,{code:e.code});r||(r={code:e.code,name:t.join([e.name,"["+e.code+"]"]," "),value:0},o.push(r)),r.value+=t.toNumber(e.amount)}),o=r(o,"value",!0)},pieByUsers:function(e,n,o){var a=[];return t.find(e,{code:n}).products.forEach(function(e){if(e.code===o){var r=t.find(a,{name:e.userName});r||(r={code:e.code,name:e.userName,value:0},a.push(r)),r.value+=t.toNumber(e.amount)}}),a=r(a,"value",!0)}};function r(t,r,n){var o=[];return t=t.filter(function(e){if((e[r]||0===e[r])&&""!==e[r])return!0;o.push(e)}),e("orderBy")(t,r,n).concat(o)}}]),angular.module("deskworks.reports.incomeByItemReportColumns",[]).factory("incomeByItemReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"productCode",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.PRODUCT_CODE",include:!0,width:"wrap"},{dataKey:"productName",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.PRODUCT_NAME",include:!0},{dataKey:"userName",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.USER_NAME",include:!0},{dataKey:"date",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"qty",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.QUANTITY",include:!0,halign:"center",width:"wrap"},{dataKey:"amount",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"subtotal",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.SUBTOTAL",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"total",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.TOTAL",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.incomeByItemReport",["pdfPreview","fileSaver","chart","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.incomeByItemReport.service","deskworks.reports.incomeByItemReportColumns","deskworks.reports.incomeByMemberReportColumns","deskworks.reports.incomeByItemPieChart","deskworks.ProductCategory"]).controller("IncomeByItemReportCtrl",["$scope","$timeout","$q","$filter","$translate","$location","state","helper","dwAlerts","fileSaver","reportStyles","ReportBuilder","IncomeByItemReport","incomeByItemReportColumns","incomeByMemberReportColumns","incomeByItemPieChart","settings","ProductCategory",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f,m,g,R,y){"use strict";var h,E,C=this,O=[];function w(t){var r,o=[];return t.forEach(function(e){o=o.concat(e.productCategories)}),C.pieProduct?r=g.pieByUsers(o,C.pieCategory.code,C.pieProduct.code):C.pieCategory?r=g.pieByProducts(o,C.pieCategory.code):C.pieSupCategory||!C.multiLevelProductCategory?r=g.pieByCategories(o,C.pieSupCategory):C.multiLevelProductCategory&&(r=g.pieBySupCategories(o,h)),{codes:r.map(function(e){return e.code}),labels:r.map(function(e){return e.name}),data:[{data:r.map(function(e){return s.round(e.value)}),backgroundColor:["#317da3","#e6194b","#3cb44b","#ffe119","#f58231","#911eb4","#aa6e28","#008080","#808080","#800000","#3244a1","#e64c19","#3db372","#d1ff1a","#f5c131","#b31e81","#a89728","#005580","#806659","#804000"],hoverBorderWidth:2,hoverBorderColor:"#fff"}],options:{tooltips:{callbacks:{label:function(e,t){return t.labels[e.index]+": "+n("ncurrency")(t.datasets[0].data[e.index])}}},legend:{display:!0,position:"right"},onClick:function(t,r){e.$apply(function(){var e=r[0]&&r[0]._index;angular.isNumber(e)&&(C.pieProduct||(C.pieCategory?C.pieProduct={code:C.pie.codes[e],name:C.pie.labels[e]}:C.pieSupCategory||!C.multiLevelProductCategory?C.pieCategory={code:C.pie.codes[e],name:C.pie.labels[e]}:C.pieSupCategory={code:C.pie.codes[e],name:C.pie.labels[e]},C.pie=w(C.config.reportData)))})}}}}function I(e){var t={columns:e.reportColumns.columns,rows:[]};O=[];var r=0;return e.reportData.forEach(function(e,n){var a=0;t.rows.push([!1,o.instant("INCOME_BY_ITEM_REPORT.TOTALS.ITEM_TYPE")+": "+e.name,!1,!1,!1,!1,!1,!1]),O.push(c.h1),e.productCategories.forEach(function(e){var r=0;e.products.forEach(function(e,n){t.rows.push([e.code,e.name,e.userName,e.date,e.qty,e.amount,!1,!1]),O.push(n%2?null:c.rowOdd),r+=s.toNumber(e.amount)}),a+=r;var n=s.join([e.name,"["+e.code+"]",o.instant("INCOME_BY_ITEM_REPORT.TOTALS.TOTAL")]," ");t.rows.push([!1,n,!1,!1,!1,!1,s.round(r),!1]),O.push(c.h2)}),r+=a,t.rows.push([!1,!1,o.instant("INCOME_BY_ITEM_REPORT.TOTALS.TOTAL")+" "+e.name,!1,!1,!1,!1,s.round(a)]),O.push(c.h3),t.rows.push([!1,!1,!1,!1,!1,!1,!1,!1]),O.push(null)}),t.rows.push([!1,!1,!1,!1,!1,!1,o.instant("INCOME_BY_ITEM_REPORT.TOTALS.INCOME")+":",s.round(r)]),O.push(c.h3),t}function S(e){var t={columns:e.reportColumns.columns,rows:[]};O=[];var r=[];e.reportData.forEach(function(e){e.productCategories.forEach(function(e){e.products.forEach(function(e){var t=s.findByKeyValue(r,"name",e.userName);t||(t={name:e.userName,products:[]},r.push(t)),t.products.push(e)})})});var n=0;return(r=C.reportBuilder.sortData(r,"name")).forEach(function(e){var r=0;C.reportBuilder.sortData(e.products,"date").forEach(function(e,n){t.rows.push([e.userName,e.code,e.name,e.date,e.qty,e.amount,!1]),O.push(n%2?null:c.rowOdd),r+=s.toNumber(e.amount)}),n+=r,t.rows.push([!1,!1,!1,!1,!1,!1,s.round(r)]),O.push(c.h2)}),t.rows.push([!1,!1,!1,!1,!1,!1,!1]),O.push(null),t.rows.push([!1,!1,!1,!1,!1,o.instant("INCOME_BY_ITEM_REPORT.TOTALS.INCOME")+":",s.round(n)]),O.push(c.h3),t}C.config={reportName:o.instant("INCOME_BY_ITEM_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},orderBy:"item",reportColumns:{columns:f},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return r.all([p.query({centerId:C.config.reportOptions.centerId,fromDate:n("date")(C.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:n("date")(C.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:C.config.reportOwnerRegion.ownerId,regionId:C.config.reportOwnerRegion.regionId}).$promise,y.query(i.getCurrentCenterId())]).then(function(e){return h=e[1],e[0]})},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,O[t.row.index])}},i.setPageTitle(o.instant("INCOME_BY_ITEM_REPORT.PAGE_TITLE")),C.config.reportDates.fromDate.subtract(1,"M").date(1),C.config.reportDates.toDate.date(0),C.multiLevelProductCategory=R.multiLevelProductCategory,!1!==C.config.orderBy&&(e.$watch(function(){return a.search().orderBy},function(e){C.config.orderBy=e||"item"}),e.$watch("vm.config.orderBy",function(e){a.search("orderBy",e).replace()})),C.reportBuilder=new d(C.config),e.$watch(function(){return{reportOptions:C.config.reportOptions,reportDates:C.config.reportDates,orderBy:C.config.orderBy,reportOwnerRegion:C.config.reportOwnerRegion}},function(e,r){E&&(t.cancel(E),E=null),E=t(function(){if(C.pdf=null,angular.isDefined(C.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(C.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(C.config.reportData=null),C.config.reportColumns={columns:"member"===e.orderBy?m:f},C.reportBuilder.buildPdf("member"===e.orderBy?S:I).then(function(e){C.pdf=e}).then(function(){C.pieCategory=null,C.pieProduct=null,C.pie=w(C.config.reportData)})}},100)},!0),C.downloadPdf=function(){C.pdf&&u(C.pdf,C.reportBuilder.getReportFileName("pdf"))},C.downloadCsv=function(){C.pdf&&(C.config.reportColumns={columns:"member"===C.config.orderBy?m:f},u(C.reportBuilder.buildCsv("member"===C.config.orderBy?S:I),C.reportBuilder.getReportFileName("csv")))},C.pieBack=function(){C.pieProduct?C.pieProduct=null:C.pieCategory?C.pieCategory=null:C.pieSupCategory=null,C.pie=w(C.config.reportData)}}]),angular.module("deskworks.reports.incomeByItemReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("IncomeByItemReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["productCategories.products.date"]);return e(r.getApiAbsUrl("/centers/:centerId/income-by-item-reports"),{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,n]}})}]),angular.module("deskworks.reports.incomeByMemberReportColumns",[]).factory("incomeByMemberReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userName",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.USER_NAME",include:!0},{dataKey:"productCode",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.PRODUCT_CODE",include:!0,width:"wrap"},{dataKey:"productName",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.PRODUCT_NAME",include:!0},{dataKey:"date",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"qty",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.QUANTITY",include:!0,halign:"center",width:"wrap"},{dataKey:"amount",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"total",_title:"INCOME_BY_ITEM_REPORT.COLUMNS.TOTAL",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.incomeReportColumns",[]).factory("incomeReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userCompany",_title:"INCOME_REPORT.COLUMNS.COMPANY",include:!0,minWidth:250},{dataKey:"userName",_title:"INCOME_REPORT.COLUMNS.NAME",include:!0,minWidth:200},{dataKey:"date",_title:"INCOME_REPORT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"method",_title:"INCOME_REPORT.COLUMNS.METHOD",include:!0,width:"wrap"},{dataKey:"amount",_title:"INCOME_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.incomeReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.incomeReport.service","deskworks.reports.incomeReportColumns"]).controller("IncomeReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","IncomeReport","incomeReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns,rows:[]};return f=[],t.rows=e.reportData.payments.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})}),t.rows.push([!1,!1,!1,!1,!1]),f.push(null),t.rows.push([!1,!1,!1,n.instant("INCOME_REPORT.TOTAL_INCOME")+":",e.reportData.total]),f.push(s.h3),t}p.config={reportName:n.instant("INCOME_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:c},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return u.get({centerId:p.config.reportOptions.centerId,fromDate:r("date")(p.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:r("date")(p.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(n.instant("INCOME_REPORT.PAGE_TITLE")),p.config.reportDates.fromDate.date(1),p.config.reportDates.toDate.add(1,"M").date(0),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportDates:p.config.reportDates,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){if(p.pdf=null,!angular.isUndefined(p.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})}},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.incomeReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("IncomeReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["payments.date"]);return e(r.getApiAbsUrl("/centers/:centerId/income-reports"),{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{get:{method:"GET",transformResponse:[angular.fromJson,n]}})}]),angular.module("deskworks.reports.invoiceColumns",[]).factory("invoiceColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"date",_title:"INVOICE.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"name",_title:"INVOICE.COLUMNS.ITEM",include:!0,minWidth:150},{dataKey:"description",_title:"INVOICE.COLUMNS.DESCRIPTION",include:!0,minWidth:150,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"price",_title:"INVOICE.COLUMNS.RATE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"qty",_title:"INVOICE.COLUMNS.QUANTITY",include:!0,halign:"center",width:"wrap"},{dataKey:"amount",_title:"INVOICE.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.invoiceHeader",["deskworks.reports.invoiceStyles"]).factory("invoiceHeader",["$filter","$translate","invoiceStyles",function(e,t,r){"use strict";return function(n,o,a){var i,s,l,u=o.internal.pageSize.width;if(o.setFontStyle("normal"),o.setTextColor(r.header.textColor),o.setFontSize(14),i=a.reportName.toUpperCase(),s=(u-o.getTextWidth(i))/2,l=40,o.text(i,s,l),1===n.pageCount){o.setFontSize(10),o.setFontStyle("normal"),s=n.settings.margin.left,l=60,o.text(a.center.name,s,l),l+=12,o.text(a.center.street1||"",s,l),a.center.street2&&(l+=12,o.text(a.center.street2||"",s,l)),l+=12,o.text([a.center.city,a.center.state.name||a.center.state,a.center.zip].join(", "),s,l),l+=12,o.text(t.instant("INVOICE.HEADER.PHONE").toUpperCase()+": "+a.center.phone,s,l),a.center.taxId&&(l+=12,o.text(t.instant("INVOICE.HEADER.TAX_ID").toUpperCase()+": "+a.center.taxId,s,l));var c=l+18;if(a.logo){s=u-n.settings.margin.right,l=50;var d=140,p=50,f=d/a.logo.width,m=p/a.logo.height;f<=m?p*=f/m:d*=m/f,o.addImage(a.logo.data,s-d,l,d,p)}o.setFontSize(8),o.setFontStyle("bold"),s=n.settings.margin.left,l=c,o.text(t.instant("INVOICE.HEADER.BILL_TO").toUpperCase()+":",s,l),o.setFontSize(10),o.setFontStyle("normal"),l+=12,o.text(a.reportFor||"",s,l),l+=12,o.text(a.reportForCompany||"",s,l),a.invoice.address&&(l+=12,o.text(a.invoice.address.street||"",s,l),l+=12,o.text([a.invoice.address.city,a.invoice.address.state.name||a.invoice.address.state,a.invoice.address.zip].join(", "),s,l)),s=u-n.settings.margin.right,l=c,o.setFontSize(8),o.setFontStyle("bold"),i=t.instant("INVOICE.HEADER.DATE").toUpperCase()+":",o.text(i,s-o.getTextWidth(i),l),o.setFontSize(10),o.setFontStyle("normal"),l+=12,i=e("date")(a.invoice.date||a.invoice.endDate,"mediumDate"),o.text(i,s-o.getTextWidth(i),l),l+=12,o.setFontSize(8),o.setFontStyle("bold"),i=t.instant("INVOICE.HEADER.DUE_DATE").toUpperCase()+":",o.text(i,s-o.getTextWidth(i),l),o.setFontSize(10),o.setFontStyle("normal"),l+=12,i=e("date")(a.invoice.dueDate,"mediumDate"),o.text(i,s-o.getTextWidth(i),l)}}}]),angular.module("deskworks.reports.invoiceStyles",["systemColors","deskworks.helper","deskworks.reports.reportStyles"]).factory("invoiceStyles",["systemColors","helper","reportStyles",function(e,t,r){"use strict";var n=angular.copy(r);return n.pageMargins[0]=50,n.pageMargins[2]=30,n.startY=170,n.header.textColor="#000000",n.headerStyles={fontSize:9,fontStyle:"normal",valign:"middle",fillColor:100,textColor:255},n.h1={fontStyle:"bold",textColor:0,borderWidth:1,borderColor:[0,0,0],borderSpan:!0},n.h2={fontStyle:"bold",textColor:0,borderWidth:1,borderColor:[180,180,180],borderSpan:!0},n}]),angular.module("deskworks.reports.invoice",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportOptions","deskworks.reports.invoiceHeader","deskworks.reports.invoice.service","deskworks.reports.invoiceColumns","deskworks.reports.invoiceStyles"]).controller("InvoiceCtrl",["$rootScope","$scope","$route","$filter","$timeout","$q","$translate","dwAlerts","fileSaver","state","helper","user","center","orderId","ReportBuilder","invoiceStyles","invoiceHeader","Invoice","invoiceColumns",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f,m,g,R,y,h){"use strict";var E=this;u.setPageTitle(i.instant(f?"INVOICE.INVOICE_NAME":"INVOICE.PAGE_TITLE",{orderId:f})),E.user=d,E.invoice={endDate:moment(),dueDate:moment(),address:E.user.addresses[0],showDates:!0};var C=[];function O(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};C=[];var r=["recurring","rental","deposit","payment","refund"];u(i.instant("INVOICE.RECURRING"),e.reportData.items.filter(function(e){return e.include&&"recurring"===e.type})),u(i.instant("INVOICE.RENTAL"),e.reportData.items.filter(function(e){return e.include&&"rental"===e.type})),u(i.instant("INVOICE.DEPOSITS"),e.reportData.items.filter(function(e){return e.include&&"deposit"===e.type})),u(i.instant("INVOICE.OTHER_CHARGES"),e.reportData.items.filter(function(e){return e.include&&r.indexOf(e.type)<0}));var n,o=e.reportData.items.filter(function(e){return e.include&&"payment"!==e.type&&"refund"!==e.type}),a=o.reduce(function(e,t){return e+(+t.amount||0)},0),s=a+e.reportData.items.reduce(function(e,t){return!t.include||"payment"!==t.type&&"refund"!==t.type?e:e+(+t.amount||0)},0),l=[];return o.forEach(function(e){angular.forEach(e.taxes,function(e,t){l.length<=t&&l.push({name:e.taxName,amount:0}),l[t].amount+=+e.taxAmount})}),l.length&&((n=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=i.instant("INVOICE.CHARGES")+":",n[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=Math.round(100*a)/100,t.rows.push(n),C.push(g.h1)),l.forEach(function(e){s+=e.amount||0,(n=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=e.name,n[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=Math.round(100*e.amount)/100,t.rows.push(n),C.push(g.h1)}),u(i.instant("INVOICE.PAYMENTS"),e.reportData.items.filter(function(e){return e.include&&"payment"===e.type})),u(i.instant("INVOICE.REFUNDS"),e.reportData.items.filter(function(e){return e.include&&"refund"===e.type})),(n=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=i.instant("INVOICE.BALANCE")+":",n[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=Math.round(100*s)/100,t.rows.push(n),C.push(g.h1),t;function u(e,r){r&&r.length&&((n=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=e,t.rows.push(n),C.push(g.h2),r.forEach(function(e,r){C.push(r%2?null:g.rowOdd),t.rows.push(t.columns.map(function(t){return e[t.dataKey]}))}),(n=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","qty")]=i.instant("INVOICE.SUBTOTAL")+":",n[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=r.reduce(function(e,t){return e+ +t.amount},0),t.rows.push(n),C.push(g.h3))}}E.config={reportOptions:{centerId:!1,paperLayout:"p"},reportColumns:{columns:h},reportHeader:R,reportFooter:function(){},reportFor:E.user.firstName+" "+E.user.lastName,reportForCompany:E.user.company,pageMargins:angular.copy(g.pageMargins),startY:g.startY,getReportData:function(){return a.when(E.invoice)},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,C[t.row.index])}},p.street2&&(E.config.startY+=12),p.taxId&&(E.config.startY+=12),E.config.pageMargins[0]=74,y.get({centerId:u.getCurrentCenterId(),userId:u.getCurrentUserId(),orderId:f}).$promise.then(function(e){E.payments=e.items.filter(function(e){return"payment"===e.type||"refund"===e.type}),E.charges=e.items.filter(function(e){return"payment"!==e.type&&"refund"!==e.type}),angular.extend(E.invoice,e),E.invoice.dueDate||(E.invoice.dueDate=E.invoice.date?E.invoice.date.clone():E.invoice.endDate.clone()),E.config.invoice=E.invoice,E.config.reportName=i.instant(p.taxId?"INVOICE.TAX_INVOICE_NAME":"INVOICE.INVOICE_NAME",{orderId:E.invoice.invoiceNumber}),E.reportBuilder=new m(E.config),E.watchReportParams()}).catch(function(e){return s.error(e,"Failed to get invoice.")}),E.selectAddress=function(e){E.invoice.address=e},E.downloadPdf=function(){E.pdf&&l(E.pdf,E.reportBuilder.getReportFileName("pdf"))},E.watchReportParams=function(){var e;t.$watch(function(){return{reportOptions:E.config.reportOptions,invoice:E.invoice}},function(t,r){e&&(o.cancel(e),e=null),e=o(function(){E.pdf=null,angular.isDefined(E.config.reportOptions.centerId)&&E.reportBuilder.buildPdf(O,g).then(function(e){E.pdf=e})},100)},!0)};var w=e.$on("CHANGE-CENTER",S),I=e.$on("CHANGE-USER",S);function S(){if(t.$resolve.back)return t.$resolve.back();r.reload()}t.$on("$destroy",function(){w(),I()})}]),angular.module("deskworks.reports.invoice.service",["ngResource","datesDeserializer","deskworks.config"]).factory("Invoice",["$resource","$q","datesDeserializer","deskworksConfig",function(e,t,r,n){"use strict";var o=r(["items.date","date","dueDate"]);return e(n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/generate-invoices"),{centerId:"@centerId",userId:"@userId",orderId:"@orderId"},{get:{method:"GET",transformResponse:[angular.fromJson,o]}})}]),angular.module("deskworks.reports.mailboxReportColumns",[]).factory("mailboxReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"number",_title:"MAILBOX_REPORT.COLUMNS.BOX_ID",include:!0},{dataKey:"company",_title:"MAILBOX_REPORT.COLUMNS.COMPANY",include:!0,minWidth:150},{dataKey:"fullName",_title:"MAILBOX_REPORT.COLUMNS.USER_NAME",include:!0,minWidth:120},{dataKey:"handling",_title:"MAILBOX_REPORT.COLUMNS.HANDLING",include:!0,width:"wrap"},{dataKey:"key",_title:"MAILBOX_REPORT.COLUMNS.KEY_ID",include:!0,width:"wrap"},{dataKey:"names",_title:"MAILBOX_REPORT.COLUMNS.OTHER_NAMES",include:!0}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.mailboxReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportColumns","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.mailboxReport.service","deskworks.reports.mailboxReportColumns"]).controller("MailboxReportCtrl",["$scope","$timeout","$translate","state","helper","fileSaver","ReportBuilder","MailboxReport","mailboxReportColumns",function(e,t,r,n,o,a,i,s,l){"use strict";var u,c=this;function d(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:e.reportData};return t.rows=c.reportBuilder.sortData(t.rows,e.reportColumns.order),t.rows=t.rows.map(function(e){return t.columns.map(function(t){return e[t.dataKey]})}),t}c.config={reportName:r.instant("MAILBOX_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:angular.copy(l)},getReportData:function(){return s.query({centerId:c.config.reportOptions.centerId,ownerId:c.config.reportOwnerRegion.ownerId,regionId:c.config.reportOwnerRegion.regionId}).$promise}},n.setPageTitle(c.config.reportName),c.reportBuilder=new i(c.config),e.$watch(function(){return{reportOptions:c.config.reportOptions,reportColumns:c.config.reportColumns,reportOwnerRegion:c.config.reportOwnerRegion}},function(){u&&(t.cancel(u),u=null),u=t(function(){c.pdf=null,angular.isUndefined(c.config.reportOptions.centerId)||c.reportBuilder.buildPdf(d).then(function(e){c.pdf=e})},100)},!0),c.downloadPdf=function(){c.pdf&&a(c.pdf,c.reportBuilder.getReportFileName("pdf"))},c.downloadCsv=function(){c.pdf&&a(c.reportBuilder.buildCsv(d),c.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.mailboxReport.service",["ngResource","deskworks.config"]).factory("MailboxReport",["$resource","deskworksConfig",function(e,t){"use strict";return e(t.getApiAbsUrl("/centers/:centerId/mailbox-reports"),{centerId:"@centerId"},{query:{method:"GET",isArray:!0}})}]),angular.module("deskworks.reports.memberStatementColumns",[]).factory("memberStatementColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"date",_title:"MEMBER_STATEMENT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"item",_title:"MEMBER_STATEMENT.COLUMNS.ITEM",include:!0},{dataKey:"price",_title:"MEMBER_STATEMENT.COLUMNS.UNIT_PRICE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"qty",_title:"MEMBER_STATEMENT.COLUMNS.QUANTITY",include:!0,halign:"center",width:"wrap"},{dataKey:"amountBilled",_title:"MEMBER_STATEMENT.COLUMNS.AMOUNT_BILLED",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"amountPaid",_title:"MEMBER_STATEMENT.COLUMNS.AMOUNT_PAID",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"balance",_title:"MEMBER_STATEMENT.COLUMNS.BALANCE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.memberStatement",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.memberStatement.service","deskworks.reports.memberStatementColumns"]).controller("MemberStatementCtrl",["$rootScope","$scope","$route","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","user","MemberStatement","memberStatementColumns",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f){"use strict";var m,g=this,R=[];function y(e){var t={columns:e.reportColumns.columns,rows:[]};R=[],t.rows=e.reportData.transactions.map(function(e,r){return R.push(r%2?null:u.rowOdd),t.columns.map(function(t){return e[t.dataKey]})}),t.rows.unshift([!1,a.instant("MEMBER_STATEMENT.BALANCE_FORWARD")+":",!1,!1,e.reportData.balanceForward.amountBilled,e.reportData.balanceForward.amountPaid,e.reportData.balanceForward.balance]),R.unshift(u.h2),t.rows.push([!1,a.instant("MEMBER_STATEMENT.TOTALS")+":",!1,!1,e.reportData.totals.amountBilled,e.reportData.totals.amountPaid,e.reportData.totals.balance]),R.push(u.h2);var r=[],n=e.reportData.depositTransactions.map(function(e,n){return r.push(n%2?null:u.rowOdd),t.columns.map(function(t){return e[t.dataKey]})});return n.length>0&&(n.unshift([!1,a.instant("MEMBER_STATEMENT.SECURITY_DEPOSITS")+":",!1,!1,e.reportData.depositTotals.amountBilled,e.reportData.depositTotals.amountPaid,e.reportData.depositTotals.balance]),r.unshift(u.h2),t.rows=n.concat(t.rows),R=r.concat(R)),t}g.config={reportName:a.instant("MEMBER_STATEMENT.REPORT_NAME"),reportOptions:{centerId:!1},reportColumns:{columns:f},reportDates:{fromDate:moment(),toDate:moment()},reportFor:d.firstName+" "+d.lastName+(d.company&&", "+d.company),getReportData:function(){return p.get({centerId:i.getCurrentCenterId(),userId:i.getCurrentUserId(),fromDate:o("date")(g.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:o("date")(g.config.reportDates.toDate,"yyyy-MM-dd")}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,R[t.row.index])}},i.setPageTitle(a.instant("MEMBER_STATEMENT.PAGE_TITLE",{userName:g.config.reportFor})),g.config.reportDates.fromDate.subtract(1,"M"),g.reportBuilder=new c(g.config),t.$watch(function(){return{reportOptions:g.config.reportOptions,reportDates:g.config.reportDates}},function(e,t){m&&(n.cancel(m),m=null),m=n(function(){if(g.pdf=null,angular.isDefined(g.config.reportOptions.centerId)){var r=e.reportDates.fromDate,n=t.reportDates.fromDate;!moment.isMoment(r)||moment.isMoment(n)&&r.isSame(n)||(g.config.reportData=null),r=e.reportDates.toDate,n=t.reportDates.toDate,!moment.isMoment(r)||moment.isMoment(n)&&r.isSame(n)||(g.config.reportData=null),g.reportBuilder.buildPdf(y).then(function(e){g.pdf=e})}},100)},!0),g.downloadPdf=function(){g.pdf&&l(g.pdf,g.reportBuilder.getReportFileName("pdf"))},e.$on("CHANGE-CENTER",r.reload)}]),angular.module("deskworks.reports.memberStatement.service",["ngResource","datesDeserializer","deskworks.config"]).factory("MemberStatement",["$resource","$q","datesDeserializer","deskworksConfig",function(e,t,r,n){"use strict";var o=r(["transactions.date","depositTransactions.date"]);return e(n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/member-statements"),{centerId:"@centerId",userId:"@userId",fromDate:"@fromDate",toDate:"@toDate"},{get:{method:"GET",transformResponse:[angular.fromJson,o]}})}]),angular.module("deskworks.reports.memberUsageReportColumns",["deskworks.helper"]).factory("memberUsageReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"date",_title:"MEMBER_USAGE_REPORT.COLUMNS.DATE",include:!0,defaultOrder:!0,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"userName",_title:"MEMBER_USAGE_REPORT.COLUMNS.USER_NAME",include:!0},{dataKey:"userEmail",_title:"MEMBER_USAGE_REPORT.COLUMNS.USER_EMAIL",include:!0},{dataKey:"checkInTime",_title:"MEMBER_USAGE_REPORT.COLUMNS.CHECK_IN",include:!0,halign:"center",pdf:function(e){return t("date")(e,"shortTime")},csv:function(e){return t("date")(e,"shortTime")}},{dataKey:"checkOutTime",_title:"MEMBER_USAGE_REPORT.COLUMNS.CHECK_OUT",include:!0,halign:"center",pdf:function(e){return t("date")(e,"shortTime")},csv:function(e){return t("date")(e,"shortTime")}},{dataKey:"usageHours",_title:"MEMBER_USAGE_REPORT.COLUMNS.HOURS",include:!0,halign:"center"},{dataKey:"usagePasses",_title:"MEMBER_USAGE_REPORT.COLUMNS.PASSES",include:!0,halign:"center"}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.memberUsageReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.memberUsageReport.service","deskworks.reports.memberUsageReportColumns"]).controller("MemberUsageReportCtrl",["$rootScope","$scope","$timeout","$filter","$route","$q","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","MemberUsageReport","memberUsageReportColumns",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f){"use strict";var m,g=this,R=[];g.config={reportName:i.instant("MEMBER_USAGE_REPORT.REPORT_NAME"),reportOptions:{},reportColumns:{columns:f},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return p.query({centerId:g.config.reportOptions.centerId,userId:s.getCurrentUserId(),fromDate:n("date")(g.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:n("date")(g.config.reportDates.toDate,"yyyy-MM-dd")}).$promise.then(function(e){return angular.forEach(e,function(e){e.date=e.checkInTime.clone().hour(0).minute(0).second(0).millisecond(0)}),e})},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,R[t.row.index])}},s.setPageTitle(g.config.reportName),g.config.reportDates.fromDate.date(1),g.config.reportDates.toDate.add(1,"M").date(0),g.reportBuilder=new d(g.config),t.$watch(function(){return{reportOptions:g.config.reportOptions,reportDates:g.config.reportDates,reportColumns:g.config.reportColumns}},function(e,t){m&&(r.cancel(m),m=null),m=r(function(){if(g.pdf=null,angular.isDefined(g.config.reportOptions.centerId)){var r=e.reportDates.fromDate,n=t.reportDates.fromDate;!moment.isMoment(r)||moment.isMoment(n)&&r.isSame(n)||(g.config.reportData=null),r=e.reportDates.toDate,n=t.reportDates.toDate,!moment.isMoment(r)||moment.isMoment(n)&&r.isSame(n)||(g.config.reportData=null),g.reportBuilder.buildPdf(h).then(function(e){g.pdf=e})}},100)},!0),g.downloadPdf=function(){g.pdf&&u(g.pdf,g.reportBuilder.getReportFileName("pdf"))},g.downloadCsv=function(){g.pdf&&u(g.reportBuilder.buildCsv(h),g.reportBuilder.getReportFileName("csv"))};var y=e.$on("CHANGE-USER",o.reload);function h(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};R=[];var r=g.reportBuilder.sortData(e.reportData,e.reportColumns.order),n=l.findIndexByKeyValue(t.columns,"dataKey","usageHours"),o=l.findIndexByKeyValue(t.columns,"dataKey","usagePasses"),a=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1}),s=0,u=0;return r.forEach(function(l,d){if(R.push(d%2?null:c.rowOdd),t.rows.push(t.columns.map(function(e){return l[e.dataKey]})),s+=l.usageHours?l.usageHours:0,u+=l.usagePasses?l.usagePasses:0,("date"===e.reportColumns.order||"userName"===e.reportColumns.order)&&(n>=0||o>=0)){var p,f,m="date"===e.reportColumns.order?l[e.reportColumns.order].unix():l[e.reportColumns.order]||null;if(d<r.length-1&&(p="date"===e.reportColumns.order?r[d+1][e.reportColumns.order].unix():r[d+1][e.reportColumns.order]||null),m!==p)s=Math.round(100*s)/100,u=Math.round(100*u)/100,n>=0&&(f=a.slice(0,Math.max(n-1,0)).concat([i.instant("MEMBER_USAGE_REPORT.TOTALS.SUBTOTAL")+":",s])),o>=0&&(n>=0?f.push(u):f=a.slice(0,Math.max(o-1,0)).concat([i.instant("MEMBER_USAGE_REPORT.TOTALS.SUBTOTAL")+":",u])),t.rows.push(f),R.push(c.h2),s=0,u=0}}),t}t.$on("$destroy",y)}]),angular.module("deskworks.reports.memberUsageReport.service",["ngResource","datesDeserializer","deserializeNumbers","deskworks.config"]).factory("MemberUsageReport",["$resource","datesDeserializer","deserializeNumbers","deskworksConfig",function(e,t,r,n){"use strict";var o=n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/member-usage-reports"),a=t(["checkInTime","checkOutTime"]),i=r(["usageHours","usagePasses"]);return e(o,{centerId:"@centerId",userId:"@userId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,a,i]}})}]),angular.module("deskworks.reports.membershipReportColumns",[]).factory("membershipReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"company",_title:"MEMBERSHIP_REPORT.COLUMNS.COMPANY",include:!0,minWidth:150},{dataKey:"name",_title:"MEMBERSHIP_REPORT.COLUMNS.NAME",include:!0,minWidth:150},{dataKey:"address",_title:"MEMBERSHIP_REPORT.COLUMNS.ADDRESS",include:!1,minWidth:150},{dataKey:"comments",_title:"MEMBERSHIP_REPORT.COLUMNS.COMMENTS",include:!1,minWidth:250},{dataKey:"email",_title:"MEMBERSHIP_REPORT.COLUMNS.EMAIL",include:!1,minWidth:150},{dataKey:"phone",_title:"MEMBERSHIP_REPORT.COLUMNS.PHONE",include:!1,minWidth:100},{dataKey:"facility",_title:"MEMBERSHIP_REPORT.COLUMNS.FACILITY",include:!1,minWidth:150},{dataKey:"joinDate",_title:"MEMBERSHIP_REPORT.COLUMNS.JOIN_DATE",include:!1,minWidth:100,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"occupation",_title:"MEMBERSHIP_REPORT.COLUMNS.OCCUPATION",include:!0,minWidth:150},{dataKey:"pricelist",_title:"MEMBERSHIP_REPORT.COLUMNS.PRICE_LIST",include:!0,minWidth:160},{dataKey:"status",_title:"MEMBERSHIP_REPORT.COLUMNS.STATUS",include:!0,width:"wrap"},{dataKey:"printerCodes",_title:"MEMBERSHIP_REPORT.COLUMNS.PRINTER_CODES",include:!1}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.membershipReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportColumns","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.membershipReport.service","deskworks.reports.membershipReportColumns"]).controller("MembershipReportCtrl",["$scope","$timeout","$location","$translate","state","helper","fileSaver","ReportBuilder","MembershipReport","membershipReportColumns","fields",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this;function f(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:e.reportData};return t.rows=p.reportBuilder.sortData(t.rows,e.reportColumns.order),t.rows=t.rows.map(function(e){return t.columns.map(function(t){return e[t.dataKey]})}),t}p.config={reportName:n.instant("MEMBERSHIP_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:angular.copy(u)},getReportData:function(){var e={centerId:p.config.reportOptions.centerId,ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId};return l.query(angular.extend(e,p.membershipFilter)).$promise.then(function(e){return e.map(function(e){return e.fields&&delete(e=angular.extend(e,e.fields)).fields,e})})}},o.setPageTitle(p.config.reportName),p.reportBuilder=new s(p.config),angular.forEach(c,function(e){p.config.reportColumns.columns.push({dataKey:e.id,title:e.name,include:!1})}),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportColumns:p.config.reportColumns,reportOwnerRegion:p.config.reportOwnerRegion,membershipFilter:p.membershipFilter}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){p.pdf=null,e&&r&&e.membershipFilter!==r.membershipFilter&&(p.config.reportData=null),angular.isUndefined(p.config.reportOptions.centerId)||p.reportBuilder.buildPdf(f).then(function(e){p.pdf=e})},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(f),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.membershipReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("MembershipReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["joinDate"]);return e(r.getApiAbsUrl("/centers/:centerId/membership-reports"),{centerId:"@centerId"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,n,function(e){return angular.forEach(e,function(e){angular.forEach(e.fields,function(t){e[t.id]=t.value}),delete e.fields}),e}]}})}]),angular.module("deskworks.passUsageReportColumns",[]).factory("passUsageReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"memberCompany",_title:"PASS_USAGE_REPORT.COLUMNS.COMPANY",include:!0,minWidth:250},{dataKey:"memberName",_title:"PASS_USAGE_REPORT.COLUMNS.NAME",include:!0,minWidth:200,defaultOrder:!0},{dataKey:"passesUsedCost",_title:"PASS_USAGE_REPORT.COLUMNS.PASSES_USED_COST",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"passCreditAppliedCost",_title:"PASS_USAGE_REPORT.COLUMNS.PASS_CREDIT_APPLIED_COST",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"costBalance",_title:"PASS_USAGE_REPORT.COLUMNS.COST_BALANCE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.PassUsageReportCtrl",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.PassUsageReport","deskworks.passUsageReportColumns"]).controller("PassUsageReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","PassUsageReport","passUsageReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};f=[];var r=p.reportBuilder.sortData(e.reportData,e.reportColumns.order),o=0,i=0,l=0;r.forEach(function(e,t){o+=a.toNumber(e.passesUsedCost),i+=a.toNumber(e.passCreditAppliedCost),l+=a.toNumber(e.costBalance)}),o=a.round(o),i=a.round(i),l=a.round(l);var u=[n.instant("PASS_USAGE_REPORT.TOTALS").toUpperCase()+":",!1,o,i,l];return t.rows.push(u),f.push(s.h2),t.rows=t.rows.concat(r.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})})),r.length&&(t.rows.push(u),f.push(s.h2)),t}p.config={reportName:n.instant("PASS_USAGE_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:c},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return u.query({centerId:p.config.reportOptions.centerId,fromDate:r("date")(p.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:r("date")(p.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(p.config.reportName),p.config.reportDates.fromDate.date(1),p.config.reportDates.toDate.add(1,"M").date(0),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportDates:p.config.reportDates,reportColumns:p.config.reportColumns,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){if(p.pdf=null,!angular.isUndefined(p.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})}},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.PassUsageReport",["ngResource","deskworks.config","deserializeNumbers"]).factory("PassUsageReport",["$resource","deskworksConfig","deserializeNumbers",function(e,t,r){"use strict";var n=t.getApiAbsUrl("/centers/:centerId/pass-usage-reports"),o=r(["passesUsed","passesUsedCost","passCreditApplied","passCreditAppliedCost","passBalance","costBalance"]);return e(n,{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,o]}})}]),angular.module("deskworks.reports.priceListReportColumns",[]).factory("priceListReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"name",_title:"PRICE_LISTS.PRODUCTS.PRODUCT",include:!0},{dataKey:"passQty",_title:"PRICE_LISTS.PRODUCTS.PASSES",include:!0,halign:"center",width:"wrap"},{dataKey:"reservationCredit",_title:"PRICE_LISTS.PRODUCTS.CREDIT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"price",_title:"PRICE_LISTS.PRODUCTS.PRICE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.priceListReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportOptions","deskworks.reports.priceListReport.service","deskworks.reports.priceListReportColumns"]).controller("PriceListReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","PriceListReport","priceListReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t,o={columns:e.reportColumns.columns,rows:[]};return f=[],angular.forEach(e.reportData.pricelists,function(a){e.plNames.indexOf(a.name)<0||((t=Array.apply(null,Array(o.columns.length)).map(Boolean.prototype.valueOf,!1))[0]=n.instant("PRICE_LISTS.LIST.PRICE_LIST")+": "+a.name+" ("+n.instant("PRICE_LISTS.LAST_UPDATE")+": "+r("date")(a.updatedAt,"mediumDate")+")",o.rows.push(t),f.push(s.h1),a.productTypes.forEach(function(e){(t=Array.apply(null,Array(o.columns.length)).map(Boolean.prototype.valueOf,!1))[0]=e.id,o.rows.push(t),f.push(s.h2),e.products.forEach(function(e,t){o.rows.push(o.columns.map(function(t){return e[t.dataKey]})),f.push(t%2?null:s.rowOdd)})}))}),o}p.config={reportName:n.instant("PRICE_LISTS.LIST.HEADER"),reportOptions:{centerId:!1},reportColumns:{columns:angular.copy(c)},getReportData:function(){return u.get({centerId:o.getCurrentCenterId()}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,plNames:e.vm.priceLists.filter(function(e){return e.include}).map(function(e){return e.name})}},function(e){d&&(t.cancel(d),d=null),d=t(function(){p.pdf=null,angular.isDefined(p.config.reportOptions.centerId)&&(p.config.plNames=e.plNames,p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e}))},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.priceListReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("PriceListReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["pricelists.updatedAt"]);return e(r.getApiAbsUrl("/centers/:centerId/pricelist-reports"),{centerId:"@centerId"},{get:{method:"GET",transformResponse:[angular.fromJson,n]}})}]),angular.module("deskworks.reports.recurringBillingReportColumns",[]).factory("recurringBillingReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userCompany",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.COMPANY",include:!0},{dataKey:"userName",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.MEMBER",include:!0,minWidth:100},{dataKey:"centerName",_title:"REPORTS.COLUMNS.CENTER",include:!1},{dataKey:"lastBillDate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.LAST_BILL_DATE",include:!0,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"nextBillDate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.NEXT_BILL_DATE",include:!0,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"amount",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"billingMethod",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.BILLING_METHOD",include:!0},{dataKey:"ccExpiry",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.CC_EXPIRY",include:!1,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"discount",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.DISCOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"productName",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.PRODUCT",include:!0,minWidth:120},{dataKey:"description",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.DESCRIPTION",include:!1},{dataKey:"startDate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.START_DATE",include:!0,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"noticeDate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.NOTICE_DATE",include:!1,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"noticePeriod",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.NOTICE_PERIOD",include:!1},{dataKey:"noticeRequiredBy",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.NOTICE_REQUIRED_BY",include:!1,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"terminate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.TERMINATION_DATE",include:!1,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"renewalDate",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.RENEWAL_DATE",include:!1,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"renewalTerm",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.RENEWAL_TERM",include:!1},{dataKey:"renewalNoticePeriod",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.RENEWAL_REMINDER",include:!1},{dataKey:"useForCheckInBilling",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.USE_FOR_CHECK_IN_BILLING",include:!1,halign:"center",pdf:function(e){return t("yesno")(e)},csv:function(e){return t("yesno")(e)}},{dataKey:"total",_title:"RECURRING_BILLINGS_REPORT.COLUMNS.TOTAL",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.recurringBillingReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportColumns","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.recurringBillingReport.service","deskworks.reports.recurringBillingReportColumns"]).controller("RecurringBillingReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","RecurringBillingReport","recurringBillingReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include})};t.rows=p.reportBuilder.sortData(e.reportData.billings,e.orderBy),f=[],t.rows=t.rows.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})});var r,o,i=a.findIndexByKeyValue(t.columns,"dataKey","total");return i>=0&&(o=(o=(o=a.findIndexByKeyValue(t.columns,"dataKey","description"))<0?a.findIndexByKeyValue(t.columns,"dataKey","productName"):o)<0?t.columns.length-2:o,t.rows.push(Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1)),f.push(null),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[o]=n.instant("RECURRING_BILLINGS_REPORT.TOTALS.MONTHLY")+":",r[i]=e.reportData.totalMonthly,t.rows.push(r),f.push(s.h3),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[o]=n.instant("RECURRING_BILLINGS_REPORT.TOTALS.QUARTERLY")+":",r[i]=e.reportData.totalQuarterly,t.rows.push(r),f.push(s.h3),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[o]=n.instant("RECURRING_BILLINGS_REPORT.TOTALS.SEMI_ANNUAL")+":",r[i]=e.reportData.totalSemiAnnual,t.rows.push(r),f.push(s.h3),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[o]=n.instant("RECURRING_BILLINGS_REPORT.TOTALS.ANNUAL")+":",r[i]=e.reportData.totalAnnual,t.rows.push(r),f.push(s.h3),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[o]=n.instant("RECURRING_BILLINGS_REPORT.TOTALS.AS_NEEDED")+":",r[i]=e.reportData.totalAsNeeded,t.rows.push(r),f.push(s.h3)),t}p.config={reportName:n.instant("RECURRING_BILLINGS_REPORT.REPORT_NAME"),reportOptions:{},reportColumns:{columns:angular.copy(c)},reportOwnerRegion:{},getReportData:function(){return u.get({centerId:p.config.reportOptions.centerId,ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise.then(function(e){return e.billings.forEach(function(e){console.log("EEEE",e.renewalDate&&e.noticePeriod,e.renewalDate,e.noticePeriod),e.renewalDate&&e.noticePeriod&&(e.noticeRequiredBy=new Date(e.renewalDate-24*e.noticePeriod*36e5))}),e})},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(p.config.reportName),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportColumns:p.config.reportColumns,orderBy:p.config.orderBy,reportOwnerRegion:p.config.reportOwnerRegion}},function(){d&&(t.cancel(d),d=null),d=t(function(){p.pdf=null,angular.isUndefined(p.config.reportOptions.centerId)||p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.recurringBillingReport.service",["ngResource","datesDeserializer","deserializeNumbers","deskworks.config"]).factory("RecurringBillingReport",["$resource","datesDeserializer","deserializeNumbers","deskworksConfig",function(e,t,r,n){"use strict";var o=r(["billings.total","billings.discount","billings.amount","billings.noticePeriod","billings.renewalTerm","billings.renewalNoticePeriod"]),a=t(["billings.lastBillDate","billings.nextBillDate","billings.startDate","billings.ccExpiry","billings.terminate","billings.noticeDate","billings.renewalDate"]);return e(n.getApiAbsUrl("/centers/:centerId/recurring-billing-reports"),{centerId:"@centerId"},{get:{method:"GET",transformResponse:[angular.fromJson,a,o]}})}]),angular.module("deskworks.reports.reservationReportColumns",[]).factory("reservationReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"startTime",_title:"RESERVATION_REPORT.COLUMNS.START_TIME",include:!0,minWidth:100,pdf:function(e){return t("date")(e,"weekDate")+" "+t("date")(e,"shortTime")},csv:function(e){return t("date")(e,"shortDate")+" "+t("date")(e,"shortTime")}},{dataKey:"centerName",_title:"RESERVATION_REPORT.COLUMNS.CENTER",include:!1,minWidth:120},{dataKey:"createdAt",_title:"RESERVATION_REPORT.COLUMNS.CREATED_AT",include:!1,minWidth:80,pdf:function(e){return t("date")(e,"mediumDate")+" "+t("date")(e,"shortTime")},csv:function(e){return t("date")(e,"shortDate")+" "+t("date")(e,"shortTime")}},{dataKey:"endTime",_title:"RESERVATION_REPORT.COLUMNS.END_TIME",include:!0,minWidth:100,pdf:function(e){return t("date")(e,"weekDate")+" "+t("date")(e,"shortTime")},csv:function(e){return t("date")(e,"shortDate")+" "+t("date")(e,"shortTime")}},{dataKey:"note",_title:"RESERVATION_REPORT.COLUMNS.NOTE",include:!1,minWidth:120},{dataKey:"reservationUnitName",_title:"RESERVATION_REPORT.COLUMNS.UNIT",include:!0,minWidth:150},{dataKey:"userCompany",_title:"RESERVATION_REPORT.COLUMNS.COMPANY",include:!0,minWidth:150},{dataKey:"userName",_title:"RESERVATION_REPORT.COLUMNS.USER_NAME",include:!0,minWidth:120}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.reservationReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportColumns","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.reservationReport.service","deskworks.reports.reservationReportColumns"]).controller("ReservationReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","ReservationReport","reservationReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include})};return t.rows=p.reportBuilder.sortData(e.reportData.reservations,e.reportColumns.order),f=[],t.rows=t.rows.map(function(e,r){return f.push(r%2?null:s.rowOdd),t.columns.map(function(t){return e[t.dataKey]})}),t}p.config={reportName:n.instant("RESERVATION_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:angular.copy(c)},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return u.get({centerId:p.config.reportOptions.centerId,fromDate:r("date")(p.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:r("date")(p.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},p.config.reportDates.toDate.add(7,"d"),o.setPageTitle(p.config.reportName),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportColumns:p.config.reportColumns,reportDates:p.config.reportDates,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){if(p.pdf=null,!angular.isUndefined(p.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})}},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.reservationReport.service",["ngResource","datesDeserializer","deskworks.config"]).factory("ReservationReport",["$resource","datesDeserializer","deskworksConfig",function(e,t,r){"use strict";var n=t(["reservations.createdAt","reservations.startTime","reservations.endTime"]);return e(r.getApiAbsUrl("/centers/:centerId/reservation-reports"),{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{get:{method:"GET",transformResponse:[angular.fromJson,n]}})}]),angular.module("deskworks.reports.reservationUsageReportColumns",["deskworks.helper"]).factory("reservationUsageReportColumns",["$rootScope","$filter","$translate","helper",function(e,t,r,n){"use strict";var o=[{dataKey:"memberCompany",_title:"REPORTS.COLUMNS.USER_COMPANY",include:!0},{dataKey:"memberName",_title:"REPORTS.COLUMNS.USER_NAME",include:!0,defaultOrder:!0},{dataKey:"reservationCost",_title:"RESERVATION_USAGE_REPORT.COLUMNS.RESERVATION_COST",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"reservationCreditApplied",_title:"RESERVATION_USAGE_REPORT.COLUMNS.RES_CREDITS_APPLIED",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"reservationCostBalance",_title:"RESERVATION_USAGE_REPORT.COLUMNS.RES_COST_BALANCE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function a(){o.forEach(function(e){e.title=r.instant(e._title)})}return a(),e.$on("$setTranslationsSuccess",a),o}]),angular.module("deskworks.reports.ReservationUsageReportCtrl",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.ReservationUsageReport","deskworks.reports.reservationUsageReportColumns"]).controller("ReservationUsageReportCtrl",["$scope","$timeout","$filter","$translate","state","helper","fileSaver","reportStyles","ReportBuilder","ReservationUsageReport","reservationUsageReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};f=[];var r=e.reportData.reduce(function(e,t){return e.reservationCost=(e.reservationCost||0)+t.reservationCost,e.reservationCreditApplied=(e.reservationCreditApplied||0)+t.reservationCreditApplied,e.reservationCostBalance=(e.reservationCostBalance||0)+t.reservationCostBalance,e},{});r.memberCompany=r.memberName=n.instant("REPORTS.TOTALS").toUpperCase()+":",a.find(t.columns,{dataKey:"memberCompany"})&&a.find(t.columns,{dataKey:"memberName"})&&(r.memberName=!1);var o=t.columns.map(function(e){return angular.isNumber(r[e.dataKey])?a.round(r[e.dataKey]):r[e.dataKey]});return t.rows.push(o),f.push(s.h2),p.reportBuilder.sortData(e.reportData,e.reportColumns.order).forEach(function(e,r){t.rows.push(t.columns.map(function(t){return angular.isNumber(e[t.dataKey])?a.round(e[t.dataKey]):e[t.dataKey]})),f.push(r%2?null:s.rowOdd)}),e.reportData.length&&(t.rows.push(o),f.push(s.h2)),t}p.config={reportName:n.instant("RESERVATION_USAGE_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:c},reportDates:{fromDate:moment(),toDate:moment()},getReportData:function(){return u.query({centerId:p.config.reportOptions.centerId,fromDate:r("date")(p.config.reportDates.fromDate,"yyyy-MM-dd"),toDate:r("date")(p.config.reportDates.toDate,"yyyy-MM-dd"),ownerId:p.config.reportOwnerRegion.ownerId,regionId:p.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},o.setPageTitle(p.config.reportName),p.config.reportDates.fromDate.date(1),p.config.reportDates.toDate.add(1,"M").date(0),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportDates:p.config.reportDates,reportColumns:p.config.reportColumns,reportOwnerRegion:p.config.reportOwnerRegion}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){p.pdf=null;var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.buildPdf(m).then(function(e){p.pdf=e})},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.ReservationUsageReport",["ngResource","deskworks.config","deserializeNumbers"]).factory("ReservationUsageReport",["$resource","$q","deskworksConfig","deserializeNumbers",function(e,t,r,n){"use strict";var o=r.getApiAbsUrl("/centers/:centerId/reservation-usage-reports"),a=n(["reservationHours","reservationCost","reservationCreditApplied","reservationCostBalance"]);return e(o,{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,a]}})}]),angular.module("deskworks.reports.revenueForecastReportColumns",[]).factory("revenueForecastReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userCompany",_title:"REVENUE_FORECAST_REPORT.COLUMNS.COMPANY",include:!0},{dataKey:"userName",_title:"REVENUE_FORECAST_REPORT.COLUMNS.NAME",include:!0,defaultOrder:!0}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.revenueForecastReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportOptions","deskworks.reports.reportOrderBy","deskworks.reports.reportOwnerRegion","deskworks.reports.RevenueForecastReport","deskworks.reports.revenueForecastReportColumns"]).controller("RevenueForecastReportCtrl",["$scope","$timeout","$filter","$translate","$location","systemColors","state","helper","fileSaver","reportStyles","ReportBuilder","RevenueForecastReport","revenueForecastReportColumns",function(e,t,r,n,o,a,i,s,l,u,c,d,p){"use strict";var f,m=this,g=[],R=[];m.config={reportName:n.instant("REVENUE_FORECAST_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:p},getReportData:function(){return d.query({centerId:m.config.reportOptions.centerId||void 0,monthCount:m.config.monthCount,ownerId:m.config.reportOwnerRegion.ownerId,regionId:m.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,g[t.row.index]),R[t.column.index]&&R[t.column.index].width&&(t.column.widthStyle=R[t.column.index].width)}},i.setPageTitle(m.config.reportName),m.optsMonthCount=Array.apply(null,{length:12}).map(function(e,t){return{id:++t,name:r("months")(t)}}),m.reportBuilder=new c(m.config),e.$watch(function(){return o.search().monthCount},function(e){m.config.monthCount=e||0===e?+e:9}),e.$watch("vm.config.monthCount",function(e){o.search("monthCount",e).replace()});function y(e){var t={columns:R=e.reportColumns.columns.slice(),rows:[]};if(g=[],!e.reportData||!e.reportData.length)return t;var o=e.reportData[0].totals.map(function(o,a){var i=a?r("date")(r("toDate")(o.month+"-01"),"MMM\nyyyy"):n.instant("REVENUE_FORECAST_REPORT.COLUMNS.CURRENT_MONTH");return t.columns.push({dataKey:o.month,title:i,halign:"right",width:"wrap"}),e.reportData.reduce(function(e,t){return e+t.totals[a].amount},0)}),a=n.instant("REVENUE_FORECAST_REPORT.COMMITTED_REVENUE");return g.push(u.h3),t.rows.push([!1,a].concat(o.map(function(e){return r("ncurrency")(e)}))),a=n.instant("REVENUE_FORECAST_REPORT.AT_RISK_REVENUE"),g.push(u.h3),t.rows.push([!1,a].concat(o.map(function(e){return r("ncurrency")(o[0]-e)}))),a=n.instant("REVENUE_FORECAST_REPORT.PERCENT_OF_CURRENT_MONTH"),g.push(u.h3),t.rows.push([!1,a].concat(o.map(function(e){return r("number")(e/o[0]*100,2)+"%"}))),m.reportBuilder.sortData(e.reportData,e.orderBy).forEach(function(e,n){g.push(n%2?null:u.rowOdd),t.rows.push([e.userCompany,e.userName].concat(e.totals.map(function(e){return r("ncurrency")(e.amount)})))}),t}e.$watch(function(){return{reportOptions:m.config.reportOptions,monthCount:m.config.monthCount,reportOwnerRegion:m.config.reportOwnerRegion,orderBy:m.config.orderBy}},function(e,o){f&&(t.cancel(f),f=null),f=t(function(){m.pdf=null,angular.isUndefined(m.config.reportOptions.centerId)||(e.monthCount!==o.monthCount&&(m.config.reportData=null),m.reportBuilder.buildPdf(y).then(function(e){m.pdf=e}).then(function(){var e,t,o,i;m.chart=(e=m.config.reportData,t=e[0].totals.map(function(e,t){return r("date")(r("toDate")(e.month+"-01"),"MMM yyyy")}),o=e[0].totals.map(function(t,r){return e.reduce(function(e,t){return e+t.totals[r].amount},0)}),i=o.map(function(e){return o[0]-e}),{labels:t,data:[{name:n.instant("REVENUE_FORECAST_REPORT.COMMITTED_REVENUE"),data:o,backgroundColor:a.primary},{name:n.instant("REVENUE_FORECAST_REPORT.AT_RISK_REVENUE"),data:i,backgroundColor:a.warning}],options:{legend:{display:!1},tooltips:{mode:"index",intersect:!0,displayColors:!0,callbacks:{label:function(e,t){var n=t.datasets[e.datasetIndex];return n.name+": "+r("ncurrency")(n.data[e.index])}}},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0,ticks:{min:0,callback:function(e){return r("ncurrency")(e,void 0,0)}}}]}}})}).catch(console.error))},100)},!0),m.downloadPdf=function(){m.pdf&&l(m.pdf,m.reportBuilder.getReportFileName("pdf"))},m.downloadCsv=function(){m.pdf&&l(m.reportBuilder.buildCsv(y),m.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.RevenueForecastReport",["ngResource","deskworks.config"]).factory("RevenueForecastReport",["$resource","$filter","$q","deskworksConfig",function(e,t,r,n){"use strict";return e(n.getApiAbsUrl("/revenue-forecast-report"))}]),angular.module("deskworks.reports.securityDepositReportColumns",[]).factory("securityDepositReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"userName",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.USER_NAME",include:!0,minWidth:120},{dataKey:"userCompany",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.COMPANY",include:!0,minWidth:150},{dataKey:"date",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.DATE",include:!0,width:"wrap",pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")},defaultOrder:!0},{dataKey:"orderId",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.ORDER_ID",include:!1,width:"wrap"},{dataKey:"initialAmount",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.INITIAL_AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"balance",_title:"SECURITY_DEPOSIT_REPORT.COLUMNS.BALANCE",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e.title=r.instant(e._title)})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.securityDepositReport",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.reports.reportOwnerRegion","deskworks.reports.securityDepositReport.service","deskworks.reports.securityDepositReportColumns"]).controller("SecurityDepositReportCtrl",["$scope","$timeout","$filter","$translate","$location","state","helper","fileSaver","reportStyles","ReportBuilder","SecurityDepositReport","securityDepositReportColumns",function(e,t,r,n,o,a,i,s,l,u,c,d){"use strict";var p,f=this,m=[];function g(e){var t={columns:e.reportColumns.columns.filter(function(e){return e.include}),rows:[]},r=f.reportBuilder.sortData(e.reportData.deposits,e.reportColumns.order);m=[];var o,a=Array.apply(null,new Array(t.columns.length)).map(function(e){return!1}),s=i.findIndexByKeyValue(t.columns,"dataKey","date"),u=i.findIndexByKeyValue(t.columns,"dataKey","balance"),c=i.findIndexByKeyValue(t.columns,"dataKey","userName");return c<0&&(c=i.findIndexByKeyValue(t.columns,"dataKey","userCompany")),r.forEach(function(r,n){m.push(e.showDetails?l.h2:n%2?null:l.rowOdd),t.rows.push(t.columns.map(function(e){return r[e.dataKey]})),e.showDetails&&r.details.forEach(function(e,r){m.push(r%2?null:l.rowOdd);var n=a.slice(0,t.columns.length);s>=0&&(n[s]=e.date),u>=0&&(n[u]=e.amount),c>=0&&(n[c]=e.notes),t.rows.push(n)})}),t.rows.push(a),m.push(null),(o=i.findIndexByKeyValue(t.columns,"dataKey","balance"))>=0&&(t.rows.push(a.slice(0,Math.max(o-1,0)).concat(o>0?[n.instant("SECURITY_DEPOSIT_REPORT.TOTALS.TOTAL")+":",e.reportData.total]:[e.reportData.total]).concat(a.slice(0,a.length-o-1))),m.push(l.h3)),t}f.config={reportName:n.instant("SECURITY_DEPOSIT_REPORT.REPORT_NAME"),reportOptions:{},reportOwnerRegion:{},reportColumns:{columns:angular.copy(d)},showDetails:!1,getReportData:function(){return c.get({centerId:f.config.reportOptions.centerId,ownerId:f.config.reportOwnerRegion.ownerId,regionId:f.config.reportOwnerRegion.regionId}).$promise},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,m[t.row.index])}},a.setPageTitle(f.config.reportName),e.$watch(function(){return o.search().showDetails},function(e){f.config.showDetails=e}),e.$watch("vm.config.showDetails",function(e){o.search("showDetails",e||null).replace()}),f.reportBuilder=new u(f.config),e.$watch(function(){return{reportOptions:f.config.reportOptions,reportColumns:f.config.reportColumns,reportOwnerRegion:f.config.reportOwnerRegion,showDetails:f.config.showDetails}},function(e,r){p&&(t.cancel(p),p=null),p=t(function(){f.pdf=null,angular.isUndefined(f.config.reportOptions.centerId)||f.reportBuilder.buildPdf(g).then(function(e){f.pdf=e})},100)},!0),f.downloadPdf=function(){f.pdf&&s(f.pdf,f.reportBuilder.getReportFileName("pdf"))},f.downloadCsv=function(){f.pdf&&s(f.reportBuilder.buildCsv(g),f.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.reports.securityDepositReport.service",["ngResource","datesDeserializer","deserializeNumbers","deskworks.config"]).factory("SecurityDepositReport",["$resource","datesDeserializer","deserializeNumbers","deskworksConfig",function(e,t,r,n){"use strict";var o=t(["deposits.date","deposits.details.date"]),a=r(["deposits.initialAmount","deposits.balance","deposits.details.amount"]);return e(n.getApiAbsUrl("/centers/:centerId/security-deposit-reports"),{centerId:"@centerId"},{get:{method:"GET",transformResponse:[angular.fromJson,o,a]}})}]),angular.module("b64",[]).factory("b64",["$window",function(e){"use strict";var t=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array;return function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=e.length;n<o;++n)t[n]=e[n],r[e.charCodeAt(n)]=n;r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63}(),{toByteArray:function(e){var t,o,a,i,s,l,u=e.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[u-2]?2:"="===e[u-1]?1:0,l=new n(3*u/4-s),a=s>0?u-4:u;var c=0;for(t=0,o=0;t<a;t+=4,o+=3)i=r[e.charCodeAt(t)]<<18|r[e.charCodeAt(t+1)]<<12|r[e.charCodeAt(t+2)]<<6|r[e.charCodeAt(t+3)],l[c++]=i>>16&255,l[c++]=i>>8&255,l[c++]=255&i;2===s?(i=r[e.charCodeAt(t)]<<2|r[e.charCodeAt(t+1)]>>4,l[c++]=255&i):1===s&&(i=r[e.charCodeAt(t)]<<10|r[e.charCodeAt(t+1)]<<4|r[e.charCodeAt(t+2)]>>2,l[c++]=i>>8&255,l[c++]=255&i);return l},fromByteArray:function(e){for(var r,n=e.length,a=n%3,i="",s=[],l=0,u=n-a;l<u;l+=16383)s.push(o(e,l,l+16383>u?u:l+16383));1===a?(r=e[n-1],i+=t[r>>2],i+=t[r<<4&63],i+="=="):2===a&&(r=(e[n-2]<<8)+e[n-1],i+=t[r>>10],i+=t[r>>4&63],i+=t[r<<2&63],i+="=");return s.push(i),s.join("")}};function o(e,r,n){for(var o,a,i=[],s=r;s<n;s+=3)o=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(t[(a=o)>>18&63]+t[a>>12&63]+t[a>>6&63]+t[63&a]);return i.join("")}}]),angular.module("csvMake",[]).service("csvMake",["$q","$timeout","$window","$document",function(e,t,r,n){"use strict";this.generate=function(e,t){return t.txtDelim=t.txtDelim||'"',t.decimalSep=t.decimalSep||".",t.fieldSep=t.fieldSep||",",t.charset=t.charset||"utf-8",t.fieldSep=this.isSpecialChar(t.fieldSep)?this.getSpecialChar(t.fieldSep):t.fieldSep,this.stringify(e,t)};var o="\r\n",a={"\\t":"\t","\\b":"\b","\\v":"\v","\\f":"\f","\\r":"\r"};this.stringifyField=function(e,t){return"locale"===t.decimalSep&&this.isFloat(e)?e.toLocaleString():"."!==t.decimalSep&&this.isFloat(e)?e.toString().replace(".",t.decimalSep):"string"==typeof e?(e=e.replace(/"/g,'""'),(t.quoteStrings||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=t.txtDelim+e+t.txtDelim),e):"boolean"==typeof e?e?"TRUE":"FALSE":e},this.isFloat=function(e){return+e===e&&(!isFinite(e)||Boolean(e%1))},this.stringifyAsync=function(t,r){var n=e.defer(),a=this,i="",s="",l=e.when(t).then(function(e){var t,l;angular.isDefined(r.header)&&r.header&&(t=[],angular.forEach(r.header,function(e,t){this.push(a.stringifyField(e,r))},t),l=t.join(r.fieldSep?r.fieldSep:","),s+=l+o);var u,c,d=[];(angular.isArray(e)?d=e:angular.isFunction(e)&&(d=e()),angular.isDefined(r.label)&&r.label&&"boolean"==typeof r.label)&&(u=[],angular.forEach(d[0],function(e,t){this.push(a.stringifyField(t,r))},u),c=u.join(r.fieldSep?r.fieldSep:","),s+=c+o);angular.forEach(d,function(e,t){var n,i,l=angular.copy(d[t]);i=[];var u=r.columnOrder?r.columnOrder:l;angular.forEach(u,function(e,t){var n=r.columnOrder?l[e]:e;this.push(a.stringifyField(n,r))},i),n=i.join(r.fieldSep?r.fieldSep:","),s+=t<d.length?n+o:n}),r.addByteOrderMarker&&(i+="\ufeff"),i+=s,n.resolve(i)});return"function"==typeof l.catch&&l.catch(function(e){n.reject(e)}),n.promise},this.stringify=function(e,t){var r,n,a=this,i="",s="";angular.isDefined(t.header)&&t.header&&(r=[],angular.forEach(t.header,function(e,r){this.push(a.stringifyField(e,t))},r),n=r.join(t.fieldSep?t.fieldSep:","),s+=n+o);var l,u,c=e;angular.isDefined(t.label)&&t.label&&"boolean"==typeof t.label&&(l=[],angular.forEach(c[0],function(e,r){this.push(a.stringifyField(r,t))},l),u=l.join(t.fieldSep?t.fieldSep:","),s+=u+o);return angular.forEach(c,function(e,r){var n,i,l=angular.copy(c[r]);i=[];var u=t.columnOrder?t.columnOrder:l;angular.forEach(u,function(e,r){var n=t.columnOrder?l[e]:e;this.push(a.stringifyField(n,t))},i),n=i.join(t.fieldSep?t.fieldSep:","),s+=r<c.length?n+o:n}),t.addByteOrderMarker&&(i+="\ufeff"),i+=s},this.isSpecialChar=function(e){return void 0!==a[e]},this.getSpecialChar=function(e){return a[e]}}]),angular.module("fileSaver",[]).factory("fileSaver",["$window",function(e){"use strict";return e.saveAs||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=function(){return e.URL||e.webkitURL||e},r=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,o=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),a=e.webkitRequestFileSystem,i=e.requestFileSystem||a||e.mozRequestFileSystem,s=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,c=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},d=function(e,t,r){for(var n=(t=[].concat(t)).length;n--;){var o=e["on"+t[n]];if("function"==typeof o)try{o.call(e,r||e)}catch(e){s(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},f=function(s,f,m){m||(s=p(s));var g,R,y,h=this,E=s.type,C=!1,O=function(){d(h,"writestart progress write writeend".split(" "))},w=function(){if(R&&o&&"undefined"!=typeof FileReader){var r=new FileReader;return r.onloadend=function(){var e=r.result;R.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),h.readyState=h.DONE,O()},r.readAsDataURL(s),void(h.readyState=h.INIT)}(!C&&g||(g=t().createObjectURL(s)),R)?R.location.href=g:void 0===e.open(g,"_blank")&&o&&(e.location.href=g);h.readyState=h.DONE,O(),c(g)},I=function(e){return function(){if(h.readyState!==h.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1};if(h.readyState=h.INIT,f||(f="download"),n)return g=t().createObjectURL(s),void setTimeout(function(){var e,t;r.href=g,r.download=f,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),O(),c(g),h.readyState=h.DONE});e.chrome&&E&&E!==l&&(y=s.slice||s.webkitSlice,s=y.call(s,0,s.size,l),C=!0),a&&"download"!==f&&(f+=".download"),(E===l||a)&&(R=e),i?(u+=s.size,i(e.TEMPORARY,u,I(function(e){e.root.getDirectory("saved",S,I(function(e){var t=function(){e.getFile(f,S,I(function(e){e.createWriter(I(function(t){t.onwriteend=function(t){R.location.href=e.toURL(),h.readyState=h.DONE,d(h,"writeend",t),c(e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=h["on"+e]}),t.write(s),h.abort=function(){t.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),w)}),w)};e.getFile(f,{create:!1},I(function(e){e.remove(),t()}),I(function(e){e.code===e.NOT_FOUND_ERR?t():w()}))}),w)}),w)):w()},m=f.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return r||(e=p(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(m.abort=function(){this.readyState=this.DONE,d(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(e,t,r){return new f(e,t,r)})}}("undefined"!=typeof self&&self||void 0!==e&&e||this.content)}]),angular.module("jsPDF",[]).factory("jsPDF",["$window",function(e){"use strict";return e.jsPDF||console.error("No jsPDF. Please include vendor/jspdf/dist/jspdf.min.js script."),e.jsPDF}]),angular.module("deskworks.logo",[]).factory("logo",["$window","$http","$q",function(e,t,r){"use strict";var n;return{getSiteLogo:function(){return n=n||r.all([o("::before"),o("::after")]).then(function(e){var t=0,r=0;if(!e[0]&&!e[1])return null;e.forEach(function(e){e&&(e.width>t&&(t=e.width),r+=e.height)});var n=document.createElement("canvas");document.body.appendChild(n),n.width=t,n.height=r;var o=n.getContext("2d");e.reduce(function(e,t){return t?(o.drawImage(t,0,e),e+t.height):e},0);var a=n.toDataURL("image/png");return document.body.removeChild(n),{width:t,height:r,data:a}})}};function o(t){return r(function(r){var n=e.getComputedStyle(document.querySelector(".sidebar-whitelabel > a"),t).getPropertyValue("background-image").match(/url\(['"]?([^'"]+)['"]?\)/i);if(!n)return r(null);n=n[1];var o=new Image;o.src=n,o.onerror=function(){console.warn("Report failed to load site logo."),r(null),o=null},o.onload=function(){r(o),o=null}})}}]),angular.module("deskworks.reports.optsPaperSize",[]).factory("optsPaperSize",function(){"use strict";return[{id:"letter",name:"Letter"},{id:"A4",name:"A4"},{id:"A3",name:"A3"},{id:"A2",name:"A2"},{id:"A1",name:"A1"},{id:"A0",name:"A0"}]}),angular.module("deskworks.reports.ReportBuilder",["csvMake","jsPDF","deskworks.logo","deskworks.reports.reportStyles","deskworks.reports.reportHeader","deskworks.reports.reportFooter","deskworks.center.service"]).factory("ReportBuilder",["$rootScope","$q","$timeout","$window","$filter","$http","dwAlerts","state","logo","jsPDF","csvMake","centerService","reportStyles","reportHeader","reportFooter",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f,m){"use strict";return function(r){var n=this;function a(e,t,r,n){if(!(e.styles.colSpan&&t.column.index>0)){var o=t.settings.margin;e.styles.fillColor&&(angular.isArray(e.styles.fillColor)?(r.setFillColor.apply(null,e.styles.fillColor),r.setDrawColor.apply(null,e.styles.fillColor)):(r.setFillColor(e.styles.fillColor),r.setDrawColor(e.styles.fillColor)),r.rect(e.x,e.y,e.width,e.height,"DF")),angular.isNumber(e.styles.textColor)?r.setTextColor(e.styles.textColor):r.setTextColor.apply(null,e.styles.textColor),r.setFontStyle(e.styles.fontStyle);var a=e.styles.cellPadding,i=e.styles.borderWidth,s=e.styles.borderColor,l=e.styles.colSpan?o.left+a:e.textPos.x,u=e.textPos.y,c=e.styles.colSpan?t.table.width:e.width,d=e.height,p=n[t.column.dataKey].halign||e.styles.halign;return"center"===p?l+=c/2-a:"right"===p&&(l+=c-2*a),r.autoTableText(e.text,l,u,{halign:p,valign:e.styles.valign}),e.styles.borderSpan&&0===t.column.index&&s&&i&&(r.setLineWidth(i),r.setDrawColor(s[0],s[1],s[2]),r.rect(o.left+i/2,t.row.y+i/2,t.table.width-i,t.row.height-2*i,"S")),!e.styles.borderSpan&&s&&i&&(r.setLineWidth(i),r.setDrawColor(s[0],s[1],s[2]),r.rect(e.x,e.y,c,d,"S")),!1}}e.$watch(function(){return r.reportOptions.centerId},function(e,t){e!==t&&(r.reportData=null,r.center=null)}),n.resolve=function(){return t.all({reportData:r.reportData||r.getReportData().catch(function(e){return i.error(e,"Failed to load report data.")}),center:r.center||d.get(+r.reportOptions.centerId||s.getCurrentCenterId()).catch(function(e){return i.error(e,"Failed to load center data.")}),logo:r.logo||l.getSiteLogo()}).then(function(e){return r.reportData=e.reportData,r.center=e.center,r.logo=e.logo,r})},n.buildPdf=function(e,t){return n.generatePdf(e,t).then(function(e){return e.output("blob")})},n.generatePdf=function(e,t,o){return n.resolve().then(function(){var n=o||new u(r.reportOptions.paperLayout,"pt",r.reportOptions.paperSize),i=e(r);i.rows.forEach(function(e){i.columns.forEach(function(t,r){!1===e[r]?e[r]="":(t.pdf&&(e[r]=t.pdf(e[r])),e[r]=angular.isUndefined(e[r])||null===e[r]||""===e[r]?"-":e[r])})});var s={headerStyles:(t||p).headerStyles,bodyStyles:(t||p).bodyStyles,columnStyles:(t||p).columnStyles,margin:(t||p).pageMargins,startY:r.startY||(t||p).startY||!1,addPageContent:function(e){(r.reportHeader||f)(e,n,r),(r.reportFooter||m)(e,n,r)},createdHeaderCell:function(e,t){var r=i.columns[t.column.index];t.column.widthStyle=r.width||t.column.widthStyle,r.minWidth&&(t.column.minWidth=r.minWidth)}};return r.stylesInjector&&(s.createdCell=r.stylesInjector,s.drawCell=function(e,t){return a(e,t,n,i.columns)},s.drawHeaderCell=function(e,t){return a(e,t,n,i.columns)}),n.autoTable(i.columns.map(function(e){return r.noTitleUpperCase?e.title:e.title.toUpperCase()}),i.rows,s),n})},n.buildCsv=function(e){var t={charset:"utf-8"},n=e(r);return n.rows.forEach(function(e){n.columns.forEach(function(t,r){t.csv&&(e[r]=t.csv(e[r])),e[r]=angular.isUndefined(e[r])||null===e[r]||!1===e[r]||""===e[r]?"":e[r]})}),n.rows.unshift(n.columns.map(function(e){return e.title.toUpperCase()})),new Blob([c.generate(n.rows,t)],{type:"text/csv;charset="+t.charset+";"})},n.getReportFileName=function(e,t){var n=!1===r.reportOptions.centerId||+r.reportOptions.centerId?r.center.shortName:"all-centers",a=r.reportName;return n=(n||"").toLowerCase().replace(/\s+/g,"-"),a=(a||"").toLowerCase().replace(/\s+/g,"-"),e=(e||"pdf").toLowerCase(),a+"-"+n+"-"+o("date")(moment(),"yyyyMMdd-HHmmss")+(t||"")+"."+e},n.sortData=function(e,t,r){return angular.isArray(t)||(t=[t]),t=t.map(function(e){return e+' || "~~~~~~~~~~"'}),o("orderBy")(e,t,r)}}}]),angular.module("deskworks.reports.reportFooter",["deskworks.reports.reportStyles"]).factory("reportFooter",["$filter","reportStyles",function(e,t){"use strict";return function(e,r,n){var o,a=r.internal.pageSize.width,i=r.internal.pageSize.height;r.setFontStyle("normal"),r.setTextColor(t.footer.textColor),r.setFontSize(9),o=[n.center.name,n.center.phone,n.center.street1],n.center.street2&&o.push(n.center.street2),o.push(n.center.city),o.push(n.center.state.name||n.center.state),o.push(n.center.zip),o=o.join(" / "),r.text(o,(a-r.getTextWidth(o))/2,i-30)}}]),angular.module("deskworks.reports.reportHeader",["deskworks.reports.reportStyles"]).factory("reportHeader",["$filter","$translate","reportStyles",function(e,t,r){"use strict";return function(n,o,a){var i,s,l,u=o.internal.pageSize.width;o.setFontStyle("normal"),o.setTextColor(r.header.textColor),s=n.settings.margin.left,l=40,o.setFontSize(14),i=a.reportName.toUpperCase(),o.text(i,s,l),s+=o.getTextWidth(i)+3,a.reportDates&&(o.setFontSize(7),i=t.instant("REPORTS.HEADER.FOR_PERIOD").toUpperCase(),a.reportDates.fromDate&&(i+=" "+t.instant("REPORTS.HEADER.FROM").toUpperCase()+":"),o.text(i,s,l),s+=o.getTextWidth(i)+3,a.reportDates.fromDate&&(o.setFontSize(9),i=e("date")(a.reportDates.fromDate,a.reportDates.format||"mediumDate")||"",o.text(i,s,l),s+=o.getTextWidth(i)+3),o.setFontSize(7),i=t.instant("REPORTS.HEADER.THROUGH").toUpperCase()+":",o.text(i,s,l),s+=o.getTextWidth(i)+3,o.setFontSize(9),i=e("date")(a.reportDates.toDate,a.reportDates.format||"mediumDate")||"",o.text(i,s,l),s+=o.getTextWidth(i)+3),s=u-n.settings.margin.right,o.setFontSize(9),i=""+n.pageCount,s-=o.getTextWidth(i),o.text(i,s,l),o.setFontSize(7),i=t.instant("REPORTS.HEADER.PAGE").toUpperCase()+":",s-=o.getTextWidth(i+" "),o.text(i,s,l-.6),s=n.settings.margin.left,l+=11,o.setFontSize(7),i=t.instant("REPORTS.HEADER.REPORT_FOR").toUpperCase()+":",o.text(i,s,l-.6),s+=o.getTextWidth(i+" "),o.setFontSize(9),i=a.reportFor||(!1===a.reportOptions.centerId||+a.reportOptions.centerId)&&[a.center.name,a.center.city,a.center.state.name].join(", ")||"All Centers",o.text(i,s,l),s+=o.getTextWidth(i+" "),s=u-n.settings.margin.right,o.setFontSize(9),i=e("date")(moment(),"mediumDate"),s-=o.getTextWidth(i),o.text(i,s,l),o.setFontSize(7),i=t.instant("REPORTS.HEADER.REPORT_DATE").toUpperCase()+":",s-=o.getTextWidth(i+" "),o.text(i,s,l-.6)}}]),angular.module("deskworks.reports.reportStyles",["systemColors","deskworks.helper"]).factory("reportStyles",["systemColors","helper",function(e,t){"use strict";return{pageMargins:[60,25,50,25],headerStyles:{fontSize:9,fontStyle:"normal",valign:"middle",fillColor:t.hex2rgbArr(e.info),textColor:255},bodyStyles:{overflow:"linebreak",textColor:0},header:{textColor:e.primary},footer:{textColor:e.primary},rowOdd:{fillColor:[245,245,245]},h1:{fontStyle:"bold",fillColor:t.hex2rgbArr(e.primary),textColor:[255,255,255]},h2:{fontStyle:"bold",textColor:t.hex2rgbArr(e.info),borderWidth:1,borderColor:t.hex2rgbArr(e.info),borderSpan:!0},h3:{fontStyle:"bold"}}}]),angular.module("systemColors",[]).factory("systemColors",["$window","$timeout","helper",function(e,t,r){"use strict";var n={},o=angular.element('<div class="ee111" style="display: none"></div>');return o.append('<div class="text-text"></div>'),o.append('<div class="text-success"></div>'),o.append('<div class="text-primary"></div>'),o.append('<div class="text-warning"></div>'),document.body.appendChild(o[0]),n.text=r.rgb2hex(e.getComputedStyle(o.children()[0]).getPropertyValue("color"))||"#444",n.info=r.rgb2hex(e.getComputedStyle(o.children()[1]).getPropertyValue("color"))||"#7dc12f",n.primary=r.rgb2hex(e.getComputedStyle(o.children()[2]).getPropertyValue("color"))||"#29b2e2",n.warning=r.rgb2hex(e.getComputedStyle(o.children()[3]).getPropertyValue("color"))||"#ff9b00",o.remove(),n}]),angular.module("deskworks.spaceUtilizationReportColumns",[]).factory("spaceUtilizationReportColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"name",_title:"SPACE_UTILIZATION_REPORT.REPORT_NAME",minWidth:150},{dataKey:"available",_title:"SPACE_UTILIZATION_REPORT.COLUMNS.HOURS_AVAILABLE",halign:"center"},{dataKey:"used",_title:"SPACE_UTILIZATION_REPORT.COLUMNS.HOURS_USED",halign:"center"},{dataKey:"utilization",_title:"SPACE_UTILIZATION_REPORT.COLUMNS.UTILIZATION",halign:"center",pdf:o,csv:o}];function o(e){return e+"%"}function a(){n.forEach(function(e){e.title=r.instant(e._title)})}return a(),e.$on("$setTranslationsSuccess",a),n}]),angular.module("deskworks.SpaceUtilizationReportCtrl",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.reportStyles","deskworks.reports.ReportBuilder","deskworks.reports.reportDates","deskworks.reports.reportOptions","deskworks.SpaceUtilizationReport","deskworks.spaceUtilizationReportColumns"]).controller("SpaceUtilizationReportCtrl",["$scope","$timeout","$translate","$filter","helper","state","fileSaver","reportStyles","ReportBuilder","SpaceUtilizationReport","spaceUtilizationReportColumns",function(e,t,r,n,o,a,i,s,l,u,c){"use strict";var d,p=this,f=[];function m(e){var t={columns:e.reportColumns,rows:[],styles:[]};return t.rows.push([r.instant("REPORTS.TOTALS"),e.reportData.$$totalAvailable,e.reportData.$$totalUsed,e.reportData.$$totalUtilization]),t.styles.push(s.h1),e.reportData.forEach(function(e){t.rows.push([e.name,e.available,e.used,e.utilization]),t.styles.push(s.h2),e.units.forEach(function(e,r){t.rows.push([e.name,e.available,e.used,e.utilization]),t.styles.push(r%2?null:s.rowOdd)})}),f=t.styles,t}p.config={reportName:r.instant("SPACE_UTILIZATION_REPORT.REPORT_NAME"),reportOptions:{},reportColumns:c,reportDates:{fromDate:moment(),toDate:moment(),format:"MMM yyyy"},getReportData:function(){return u.query({centerId:p.config.reportOptions.centerId||void 0,fromYear:p.config.reportDates.fromDate&&p.config.reportDates.fromDate.year(),fromMonth:p.config.reportDates.fromDate&&p.config.reportDates.fromDate.month()+1,toYear:p.config.reportDates.toDate&&p.config.reportDates.toDate.year(),toMonth:p.config.reportDates.toDate&&p.config.reportDates.toDate.month()+1})},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,f[t.row.index])}},a.setPageTitle(p.config.reportName),p.reportBuilder=new l(p.config),e.$watch(function(){return{reportOptions:p.config.reportOptions,reportDates:p.config.reportDates}},function(e,r){d&&(t.cancel(d),d=null),d=t(function(){if(p.pdf=null,moment.isMoment(p.config.reportDates.fromDate)&&moment.isMoment(p.config.reportDates.toDate)&&!angular.isUndefined(p.config.reportOptions.centerId)){var t=e.reportDates.fromDate,n=r.reportDates.fromDate;!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),t=e.reportDates.toDate,n=r.reportDates.toDate,!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(p.config.reportData=null),p.reportBuilder.generatePdf(m).then(function(e){p.pdf=e.output("blob")})}},100)},!0),p.downloadPdf=function(){p.pdf&&i(p.pdf,p.reportBuilder.getReportFileName("pdf"))},p.downloadCsv=function(){p.pdf&&i(p.reportBuilder.buildCsv(m),p.reportBuilder.getReportFileName("csv"))}}]),angular.module("deskworks.SpaceUtilizationReport",["ngResource","deskworks.config"]).factory("SpaceUtilizationReport",["$resource","deskworksConfig","helper",function(e,t,r){"use strict";var n=e(t.getApiAbsUrl("/space-utilization-report"),{centerId:"@centerId",fromDate:"@fromDate",toDate:"@toDate"},{query:{method:"GET",isArray:!0}});return{query:function(e){return n.query(e).$promise.then(o)}};function o(e){return e.$$totalAvailable=0,e.$$totalUsed=0,e.forEach(function(t){t.available=0,t.used=0,t.units.forEach(function(e){e.available>0?(e.utilization=r.round(e.used/e.available*100,1),t.available+=e.available):e.utilization=0,t.used+=e.used||0}),t.utilization=t.available?r.round(t.used/t.available*100,1):0,e.$$totalAvailable+=t.available,e.$$totalUsed+=t.used,t.available=r.round(t.available),t.used=r.round(t.used)}),e.$$totalUtilization=e.$$totalAvailable?r.round(e.$$totalUsed/e.$$totalAvailable*100,1):0,e.$$totalAvailable=r.round(e.$$totalAvailable),e.$$totalUsed=r.round(e.$$totalUsed),e}}]),angular.module("deskworks.reports.invoiceColumns",[]).factory("invoiceColumns",["$rootScope","$filter","$translate",function(e,t,r){"use strict";var n=[{dataKey:"date",title:"Date Added",include:!0,width:90,pdf:function(e){return t("date")(e,"mediumDate")},csv:function(e){return t("date")(e,"shortDate")}},{dataKey:"name",_title:"INVOICE.COLUMNS.ITEM",include:!0},{dataKey:"description",_title:"INVOICE.COLUMNS.DESCRIPTION",include:!0},{dataKey:"price",title:"Price",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}},{dataKey:"qty",title:"Quantity",include:!0,halign:"center",width:"wrap"},{dataKey:"amount",_title:"INVOICE.COLUMNS.AMOUNT",include:!0,halign:"right",width:"wrap",pdf:function(e){return t("ncurrency")(e)},csv:function(e){return t("ncurrency")(e)}}];function o(){n.forEach(function(e){e._title&&(e.title=r.instant(e._title))})}return o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.reports.invoiceHeader",["deskworks.reports.invoiceStyles"]).factory("invoiceHeader",["$filter","$translate","invoiceStyles",function(e,t,r){"use strict";return function(n,o,a){var i,s,l,u=o.internal.pageSize.width,c=o.internal.pageSize.height,d=n.settings.margin,p=r.framePadding;if(o.setFontStyle("normal"),o.setTextColor(r.header.textColor),o.setLineWidth(1),o.setDrawColor(0,0,0),o.rect(d.left-p[3],d.top-p[0],u-d.right-d.left+p[3]+p[1],c-d.top-d.bottom+p[0]+p[2],"S"),o.setFillColor(255,255,255),o.rect(u/2-100,d.top-p[0]-1,200,2,"F"),o.rect(u/2-100,c-d.top+p[0]+p[2]-1,200,2,"F"),a.logo){s=u/2,l=d.top-p[0]-14;var f=140,m=80,g=f/a.logo.width,R=m/a.logo.height;g<=R?m*=g/R:f*=R/g,o.addImage(a.logo.data,s-f/2,l,f,m)}o.setFontSize(9),i="Thank you for being a member at CANOPY",s=(u-o.getTextWidth(i))/2,l=c-d.top+p[0]+p[2]+3,o.text(i,s,l),s=d.left,l=d.top,o.setFontSize(11),o.setFontStyle("normal"),1===n.pageCount&&(i=t.instant("INVOICE.HEADER.DATE")+": "+e("date")(a.invoice.date||a.invoice.endDate,"mediumDate"),o.text(i,s,l),l+=26,o.text(a.reportForCompany||"",s,l),l+=13,a.invoice.address&&(o.text(a.invoice.address.street||"",s,l),l+=13,o.text([a.invoice.address.city,a.invoice.address.state.name||a.invoice.address.state,a.invoice.address.zip].join(", "),s,l),l+=26),o.text("Dear "+(a.reportFor||"")+",",s,l),l+=26,o.text("This is your invoice for membership charges for the coming month.",s,l),l+=26,o.text("Your credit card will be charged in a few days.",s,l),l+=26,o.setFontStyle("bold"),o.text("ORDER ID: "+a.invoice.invoiceNumber,s,l),o.setFontStyle("normal"))}}]),angular.module("deskworks.reports.invoiceStyles",["systemColors","deskworks.helper","deskworks.reports.reportStyles"]).factory("invoiceStyles",["systemColors","helper","reportStyles",function(e,t,r){"use strict";var n=angular.copy(r);return n.framePadding=[120,12,12,12],n.pageMargins=[160,40,40,40],n.startY=330,n.header.textColor="#000000",n.bodyStyles.borderWidth=1,n.bodyStyles.borderColor=[0,0,0],n.bodyStyles.cellPadding=8,n.bodyStyles.fontSize=11,n.headerStyles={fontSize:11,fontStyle:"bold",valign:"middle",fillColor:null,textColor:0,cellPadding:8,borderWidth:1,borderColor:[0,0,0]},n.h1={colSpan:!0,halign:"right",fontStyle:"bold",overflow:"visible"},n.h2={colSpan:!0,fontStyle:"bold",overflow:"visible"},n.h3={colSpan:!0,halign:"right",overflow:"visible"},n}]),angular.module("deskworks.reports.invoice",["pdfPreview","fileSaver","deskworks.state","deskworks.reports.ReportBuilder","deskworks.reports.reportOptions","deskworks.reports.invoiceHeader","deskworks.reports.invoice.service","deskworks.reports.invoiceColumns","deskworks.reports.invoiceStyles"]).controller("InvoiceCtrl",["$rootScope","$scope","$route","$filter","$timeout","$q","$translate","dwAlerts","fileSaver","state","helper","user","center","orderId","ReportBuilder","invoiceStyles","invoiceHeader","Invoice","invoiceColumns",function(e,t,r,n,o,a,i,s,l,u,c,d,p,f,m,g,R,y,h){"use strict";var E=this;u.setPageTitle(i.instant(f?"INVOICE.INVOICE_NAME":"INVOICE.PAGE_TITLE",{orderId:f})),E.user=d,E.invoice={endDate:moment(),dueDate:moment().add(14,"d"),address:E.user.addresses[0],showDates:!0};var C=[],O=[];function w(e){var t={columns:O=e.reportColumns.columns.filter(function(e){return e.include}),rows:[]};C=[],u(i.instant("INVOICE.RECURRING"),e.reportData.items.filter(function(e){return e.include&&"recurring"===e.type})),u(i.instant("INVOICE.RENTAL"),e.reportData.items.filter(function(e){return e.include&&"rental"===e.type})),u(i.instant("INVOICE.RESERVATIONS"),e.reportData.items.filter(function(e){return e.include&&"reservation"===e.type})),u(i.instant("INVOICE.DEPOSITS"),e.reportData.items.filter(function(e){return e.include&&"deposit"===e.type})),u(i.instant("INVOICE.OTHER_CHARGES"),e.reportData.items.filter(function(e){return e.include&&"other"===e.type}));var r,o=e.reportData.items.filter(function(e){return e.include&&"payment"!==e.type&&"refund"!==e.type}),a=o.reduce(function(e,t){return e+(+t.amount||0)},0),s=a+e.reportData.items.reduce(function(e,t){return!t.include||"payment"!==t.type&&"refund"!==t.type?e:e+(+t.amount||0)},0),l=[];return o.forEach(function(e){angular.forEach(e.taxes,function(e,t){l.length<=t&&l.push({name:e.taxName,amount:0}),l[t].amount+=+e.taxAmount})}),l.length&&((r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=i.instant("INVOICE.CHARGES")+":",r[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=Math.round(100*a)/100,t.rows.push(r),C.push(g.h1)),l.forEach(function(e){s+=e.amount||0,(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[c.findIndexByKeyValue(t.columns,"dataKey","name")]=e.name,r[c.findIndexByKeyValue(t.columns,"dataKey","amount")]=Math.round(100*e.amount)/100,t.rows.push(r),C.push(g.h1)}),u(i.instant("INVOICE.PAYMENTS"),e.reportData.items.filter(function(e){return e.include&&"payment"===e.type})),u(i.instant("INVOICE.REFUNDS"),e.reportData.items.filter(function(e){return e.include&&"refund"===e.type})),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[0]="Total:  "+n("ncurrency")(c.round(s)),t.rows.push(r),C.push(g.h1),t;function u(e,o){o&&o.length&&((r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[0]=e,t.rows.push(r),C.push(g.h2),o.forEach(function(e,r){C.push(null),t.rows.push(t.columns.map(function(t){return e[t.dataKey]}))}),(r=Array.apply(null,Array(t.columns.length)).map(Boolean.prototype.valueOf,!1))[0]="Total "+e+":  "+n("ncurrency")(o.reduce(function(e,t){return e+ +t.amount},0)),t.rows.push(r),C.push(g.h3))}}E.config={noTitleUpperCase:!0,reportOptions:{centerId:!1,paperLayout:"p"},reportColumns:{columns:h},reportHeader:R,reportFooter:function(){},reportFor:E.user.firstName+" "+E.user.lastName,reportForCompany:E.user.company,pageMargins:angular.copy(g.pageMargins),startY:g.startY,getReportData:function(){return a.when(E.invoice)},stylesInjector:function(e,t){e.styles.fillColor=!1,angular.extend(e.styles,C[t.row.index]),O[t.column.index]&&O[t.column.index].width&&(t.column.widthStyle=O[t.column.index].width)}},p.street2&&(E.config.startY+=12),p.taxId&&(E.config.startY+=12),E.config.pageMargins[0]=74,y.get({centerId:u.getCurrentCenterId(),userId:u.getCurrentUserId(),orderId:f}).$promise.then(function(e){E.payments=e.items.filter(function(e){return"payment"===e.type||"refund"===e.type}),E.charges=e.items.filter(function(e){return"payment"!==e.type&&"refund"!==e.type}),angular.extend(E.invoice,e),E.invoice.dueDate||(E.invoice.dueDate=E.invoice.date?E.invoice.date.clone():E.invoice.endDate.clone(),E.invoice.dueDate.add(14,"d")),E.config.invoice=E.invoice,E.config.reportName=i.instant(p.taxId?"INVOICE.TAX_INVOICE_NAME":"INVOICE.INVOICE_NAME",{orderId:E.invoice.invoiceNumber}),E.reportBuilder=new m(E.config),E.watchReportParams()}).catch(function(e){return s.error(e,"Failed to get invoice.")}),E.selectAddress=function(e){E.invoice.address=e},E.downloadPdf=function(){E.pdf&&l(E.pdf,E.reportBuilder.getReportFileName("pdf"))},E.watchReportParams=function(){var e;t.$watch(function(){return{reportOptions:E.config.reportOptions,invoice:E.invoice}},function(t,r){e&&(o.cancel(e),e=null),e=o(function(){E.pdf=null,angular.isDefined(E.config.reportOptions.centerId)&&E.reportBuilder.buildPdf(w,g).then(function(e){E.pdf=e})},100)},!0)};var I=e.$on("CHANGE-CENTER",v),S=e.$on("CHANGE-USER",v);function v(){if(t.$resolve.back)return t.$resolve.back();r.reload()}t.$on("$destroy",function(){I(),S()})}]);