{"version":3,"sources":["webpack:///./common sync .*\\.html$","webpack:///./common/billing/billing-profile/billing-profile-edit.controller.js","webpack:///./common/billing/billing-profile/billing-profile-edit.tpl.html","webpack:///./common/billing/billing.module.js","webpack:///./common/billing/purchase/audit/purchase-audit.directive.js","webpack:///./common/billing/purchase/audit/purchase-audit.service.js","webpack:///./common/billing/purchase/audit/purchase-audit.tpl.html","webpack:///./common/billing/purchase/dw-add-charges.directive.js","webpack:///./common/billing/purchase/dw-add-charges.scss?4a3a","webpack:///./common/billing/purchase/dw-add-charges.tpl.html","webpack:///./common/billing/purchase/purchase-edit.controller.js","webpack:///./common/billing/purchase/purchase-edit.tpl.html","webpack:///./common/billing/purchase/purchase-list.controller.js","webpack:///./common/billing/purchase/purchase-list.tpl.html","webpack:///./common/billing/purchase/purchase-payment-types.service.js","webpack:///./common/billing/purchase/purchase-payment.directive.js","webpack:///./common/billing/purchase/purchase-payment.tpl.html","webpack:///./common/billing/purchase/purchase.scss?05ce","webpack:///./common/billing/recurring-billing/recurring-charge-audit.directive.js","webpack:///./common/billing/recurring-billing/recurring-charge-audit.service.js","webpack:///./common/billing/recurring-billing/recurring-charge-audit.tpl.html","webpack:///./common/billing/recurring-billing/recurring-edit.controller.js","webpack:///./common/billing/recurring-billing/recurring-edit.tpl.html","webpack:///./common/billing/recurring-billing/recurring-list.controller.js","webpack:///./common/billing/recurring-billing/recurring-list.tpl.html"],"names":["angular","module","config","$routeProvider","when","templateUrl","controller","label","routeBranch","translations","resolve","reg","userProfile","dwAlerts","userProfileService","state","routeHelper","resolveTimezone","auth","then","selectUser","get","getCurrentCenterId","getCurrentUserId","catch","err","error","settings","setupService","getSetupSettings","controllerAs","member","selfRegistration","step","stepCount","$route","current","params","userId","$scope","$translate","$q","helper","purchaseService","vm","creditCardTypes","ccType","enable","creditCards","forEach","cc","type","length","eChecks","creditCard","new","push","setPageTitle","instant","userName","fullNameCompany","next","options","skipBillingProfile","pointFirstInvalid","promise","billingMethod","saveBillingMethod","saveBillingProfile","complete","createPurchase","id","getParam","result","setPath","getPath","back","bindTestBillingGenerator","niceTimeDirective","name","directive","restrict","scope","bindToController","purchaseId","PurchaseAudit","$ctrl","$onInit","centerId","offset","limit","entries","fetch","eof","fetching","query","finally","$on","factory","$resource","$timeout","deskworksConfig","datesDeserializer","desDates","res","getApiAbsUrl","method","isArray","transformResponse","fromJson","$promise","purchase","updateInvoice","userPriceList","noCollapse","$filter","collapsed","$onChanges","isLoggedAdmin","chargeTypes","packages","price","chargeType","pkg","chargedAt","moment","quantity","notes","createCharge","product","data","packageName","isTaxable","packageId","productId","lazyLoaders","ReservationUnit","purchasePaymentDirective","dwInvoice","user","center","centerService","lazy","$injector","session","priceListService","SecurityDepositRecord","autoSave","backPath","$watch","nv","ov","showOrderDates","limitRefund","limitRefundProcessingTo","allowRefundProcessing","role","every","key","isDefined","redirect","centerName","membershipPriceListId","getPricelist","queryConsolidations","consolidations","consolidationId","backToPurchases","consolidatePurchase","consolidate","_","$broadcast","updateSecurityDepositRecords","securityDepositRecords","update","all","filterBillingMethods","val","sdr","lastBalanceRecord","reverse","rec","balance","onOrderDateChange","wrap","pick","orderSpin","isPaymentsAssignmentEnabled","isAdmin","has","paymentAssignment","open","$new","purchases","types","orders","p","editPurchase","order","viewPurchase","optsPaymentBillingMethod","optsRefundBillingMethod","payment","hasProcessingFee","optsBillingMethod","header","negativeAmount","btnSubmit","btnRecord","hintSubmit","hintRecord","securityDepositHint","submit","createPayment","deposit","createDeposit","discount","createDiscount","refund","createRefund","purchasePaymentTypes","template","defaultAmount","paymentMethods","postDate","receivedAt","i","processPaymentMethods","paymentMethodKey","optsPaymentMethod","o","paymentMethodId","amount","m","number","replace","bankRoutingNumber","bankAccountNumber","join","getMaxAmount","$$collapsed","form","$setPristine","getAmountWithFee","rate","paymentProcessingRates","enablePaymentProcessingCharges","fee","round","getSubmitText","forceSubmit","priceListProducts","reservationUnits","recurringChargeId","RecurringChargeAudit","props","getProps","makeProps","entry","prop","old","$rootScope","optsBillingFrequency","optsRecurringChargeStatus","optsNoticePeriod","optsDiscountType","optsMonthsOfDiscount","optsRecurringChargeTerminate","optsRenewalTerm","optsRenewalNoticePeriod","dateFilter","getOptsFilter","opts","isString","_name","filter","translate","opt","recurringId","charge","recurringChargeService","charges","resUnits","initialStatus","status","startDate","entryDate","billingFrequencyProducts","billingFrequencies","noticePeriods","discountTypes","discountTrialOccurrences","optsTerminate","chargeStatuses","isLoggedRole","priceListProduct","billingFrequency","resUnit","attachedUserId","attachedReservationUnitId","activeChargesCount","c","billingFrequencyChange","priceListProductId","terminate","months","isMoment","lastBillDate","nextBillDate","clone","add","prorateAtStart","date","onChangeStatus","makeMemberInactive","makeCoMembersInactive","calcTerminationDate","noticeDate","noticePeriod","isNextBillDateDisabled","isSameOrBefore","backToList","saveCharge","refill","description","customPrice","undefined","enableRenewalNotices","renewalDate","renewalTerm","renewalNoticePeriod","discountType","discountTypeId","discountValue","discountStartDate","passBalance","postProration","updateCharge","resetCache","reload","edit","saveUseForCheckInBilling","ch","useForCheckInBilling","$spin","setUseForCheckInBilling"],"mappings":"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","file":"main~._common .js?_rev=e2f8c2dd1e2f26dff1dc","sourcesContent":["var map = {\n\t\"./billing/billing-profile/billing-profile-edit.tpl.html\": \"./common/billing/billing-profile/billing-profile-edit.tpl.html\",\n\t\"./billing/purchase/audit/purchase-audit.tpl.html\": \"./common/billing/purchase/audit/purchase-audit.tpl.html\",\n\t\"./billing/purchase/dw-add-charges.tpl.html\": \"./common/billing/purchase/dw-add-charges.tpl.html\",\n\t\"./billing/purchase/purchase-edit.tpl.html\": \"./common/billing/purchase/purchase-edit.tpl.html\",\n\t\"./billing/purchase/purchase-list.tpl.html\": \"./common/billing/purchase/purchase-list.tpl.html\",\n\t\"./billing/purchase/purchase-payment.tpl.html\": \"./common/billing/purchase/purchase-payment.tpl.html\",\n\t\"./billing/recurring-billing/recurring-charge-audit.tpl.html\": \"./common/billing/recurring-billing/recurring-charge-audit.tpl.html\",\n\t\"./billing/recurring-billing/recurring-edit.tpl.html\": \"./common/billing/recurring-billing/recurring-edit.tpl.html\",\n\t\"./billing/recurring-billing/recurring-list.tpl.html\": \"./common/billing/recurring-billing/recurring-list.tpl.html\",\n\t\"./flex-forms/controls/ff-control.tpl.html\": \"./common/flex-forms/controls/ff-control.tpl.html\",\n\t\"./flex-forms/ff-datepicker/ff-datepicker.tpl.html\": \"./common/flex-forms/ff-datepicker/ff-datepicker.tpl.html\",\n\t\"./members/our-members/our-member-modal.tpl.html\": \"./common/members/our-members/our-member-modal.tpl.html\",\n\t\"./members/our-members/our-members-embedding.tpl.html\": \"./common/members/our-members/our-members-embedding.tpl.html\",\n\t\"./members/our-members/our-members.tpl.html\": \"./common/members/our-members/our-members.tpl.html\",\n\t\"./members/user-profile/billing-sections/up-billing-method.tpl.html\": \"./common/members/user-profile/billing-sections/up-billing-method.tpl.html\",\n\t\"./members/user-profile/billing-sections/up-credit-cards.tpl.html\": \"./common/members/user-profile/billing-sections/up-credit-cards.tpl.html\",\n\t\"./members/user-profile/billing-sections/up-e-checks.tpl.html\": \"./common/members/user-profile/billing-sections/up-e-checks.tpl.html\",\n\t\"./members/user-profile/sections/up-access-codes.tpl.html\": \"./common/members/user-profile/sections/up-access-codes.tpl.html\",\n\t\"./members/user-profile/sections/up-addresses.tpl.html\": \"./common/members/user-profile/sections/up-addresses.tpl.html\",\n\t\"./members/user-profile/sections/up-co-members.tpl.html\": \"./common/members/user-profile/sections/up-co-members.tpl.html\",\n\t\"./members/user-profile/sections/up-comments.tpl.html\": \"./common/members/user-profile/sections/up-comments.tpl.html\",\n\t\"./members/user-profile/sections/up-custom-fields.tpl.html\": \"./common/members/user-profile/sections/up-custom-fields.tpl.html\",\n\t\"./members/user-profile/sections/up-documents.tpl.html\": \"./common/members/user-profile/sections/up-documents.tpl.html\",\n\t\"./members/user-profile/sections/up-lead-source.tpl.html\": \"./common/members/user-profile/sections/up-lead-source.tpl.html\",\n\t\"./members/user-profile/sections/up-login-info.tpl.html\": \"./common/members/user-profile/sections/up-login-info.tpl.html\",\n\t\"./members/user-profile/sections/up-mailboxes.tpl.html\": \"./common/members/user-profile/sections/up-mailboxes.tpl.html\",\n\t\"./members/user-profile/sections/up-membership.tpl.html\": \"./common/members/user-profile/sections/up-membership.tpl.html\",\n\t\"./members/user-profile/sections/up-personal-info.tpl.html\": \"./common/members/user-profile/sections/up-personal-info.tpl.html\",\n\t\"./members/user-profile/sections/up-phones.tpl.html\": \"./common/members/user-profile/sections/up-phones.tpl.html\",\n\t\"./members/user-profile/sections/up-photo.tpl.html\": \"./common/members/user-profile/sections/up-photo.tpl.html\",\n\t\"./members/user-profile/sections/up-printer-codes.tpl.html\": \"./common/members/user-profile/sections/up-printer-codes.tpl.html\",\n\t\"./members/user-profile/sections/up-shareable.tpl.html\": \"./common/members/user-profile/sections/up-shareable.tpl.html\",\n\t\"./members/user-profile/sections/up-system-info.tpl.html\": \"./common/members/user-profile/sections/up-system-info.tpl.html\",\n\t\"./members/user-profile/sections/up-terms-of-service.tpl.html\": \"./common/members/user-profile/sections/up-terms-of-service.tpl.html\",\n\t\"./members/user-profile/user-profile.tpl.html\": \"./common/members/user-profile/user-profile.tpl.html\",\n\t\"./members/user-search/user-search.tpl.html\": \"./common/members/user-search/user-search.tpl.html\",\n\t\"./sidebar/sidebar.tpl.html\": \"./common/sidebar/sidebar.tpl.html\",\n\t\"./sign-in/dw-sign-in.tpl.html\": \"./common/sign-in/dw-sign-in.tpl.html\",\n\t\"./sign-in/sign-in.tpl.html\": \"./common/sign-in/sign-in.tpl.html\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./common sync recursive .*\\\\.html$\";","angular.module('deskworks.members.billingProfile.edit', [\n  'ngRoute',\n  'deskworks.routeHelper',\n  'deskworks.userProfile.service',\n  'deskworks.purchase.service',\n  'deskworks.setup.service',\n])\n  .config(function($routeProvider) { 'use strict';\n\n    $routeProvider.when('/billing-profiles', {\n      templateUrl: 'billing/billing-profile/billing-profile-edit.tpl.html',\n      controller: 'BillingProfileEditCtrl as vm',\n      label: 'Billing Profile',\n      routeBranch: 'billing-profiles',\n      translations: ['billing-profile', 'user-profile'],\n      resolve: {\n        reg: function() {},\n        userProfile: function(dwAlerts, userProfileService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to load billing profile.')));\n        },\n        settings: function(dwAlerts, setupService) {\n          return setupService.getSetupSettings()\n            .catch(err => dwAlerts.error(err, 'Failed to load setup settings.'));\n        },\n      }\n    })\n      .when('/new-user/:userId/membership/billing-profile', {\n        templateUrl: 'billing/billing-profile/billing-profile-edit.tpl.html',\n        controller: 'BillingProfileEditCtrl',\n        controllerAs: 'vm',\n        label: 'Billing Profile',\n        routeBranch: 'new-user',\n        translations: ['billing-profile', 'user-profile'],\n        resolve: {\n          reg: function() { return { member: false, selfRegistration: false, step: 2, stepCount: 2 }; },\n          userProfile: function(dwAlerts, $route, state, userProfileService, routeHelper, resolveTimezone) {\n            return routeHelper.auth()\n              .then(() => routeHelper.selectUser())\n              .then(() => resolveTimezone())\n              .then(() => userProfileService.get(state.getCurrentCenterId(), $route.current.params.userId)\n                .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n          },\n          settings: function(dwAlerts, setupService) {\n            return setupService.getSetupSettings()\n              .catch(err => dwAlerts.error(err, 'Failed to load setup settings.'));\n          },\n        }\n      })\n      .when('/new-member/:userId/membership/billing-profile', {\n        templateUrl: 'billing/billing-profile/billing-profile-edit.tpl.html',\n        controller: 'BillingProfileEditCtrl',\n        controllerAs: 'vm',\n        label: 'Billing Profile',\n        routeBranch: 'new-member',\n        translations: ['billing-profile', 'user-profile'],\n        resolve: {\n          reg: function() { return { member: true, selfRegistration: false, step: 2, stepCount: 3 }; },\n          userProfile: function(dwAlerts, $route, state, userProfileService, routeHelper, resolveTimezone) {\n            return routeHelper.auth()\n              .then(() => routeHelper.selectUser())\n              .then(() => resolveTimezone())\n              .then(() => userProfileService.get(state.getCurrentCenterId(), $route.current.params.userId)\n                .catch(err => dwAlerts.error(err, 'Failed to load billing profile.')));\n          },\n          settings: function(dwAlerts, setupService) {\n            return setupService.getSetupSettings()\n              .catch(err => dwAlerts.error(err, 'Failed to load setup settings.'));\n          },\n        }\n      });\n  })\n\n  .controller('BillingProfileEditCtrl', function($scope, $translate, $q, dwAlerts, state, helper, reg,\n                                                 userProfile, settings, userProfileService, purchaseService) { 'use strict';\n    const vm = this;\n\n    vm.reg = reg;\n    vm.userProfile = userProfile;\n    vm.settings = settings;\n\n    // filter credit card types according to settings\n    settings.creditCardTypes = settings.creditCardTypes.filter(ccType => ccType.enable);\n\n    vm.userProfile.creditCards.forEach(cc => {\n      cc.type = helper.find(settings.creditCardTypes, cc.type) || cc.type || {};\n    });\n\n    // In registration mode, require at least one CC or ACH\n    vm.userProfile.creditCards = vm.userProfile.creditCards || [];\n    if (reg && !vm.userProfile.creditCards.length && !vm.userProfile.eChecks.length) {\n      const cc = userProfileService.creditCard.new(vm.userProfile);\n      cc.type = settings.creditCardTypes[0];\n      vm.userProfile.creditCards.push(cc);\n    }\n\n    state.setPageTitle($translate.instant('BILLING_PROFILE.PAGE_TITLE', { userName: vm.userProfile.fullNameCompany }));\n\n    /**\n     * Next button handler\n     */\n    vm.next = function(options) {\n      options = options || {};\n\n      if (!options.skipBillingProfile && helper.pointFirstInvalid('#billingProfile')) return;\n      let promise = $q.when();\n      if (options.skipBillingProfile) {\n        if (vm.userProfile.billingMethod === 'emailInvoice' || vm.userProfile.billingMethod === 'paperInvoice') {\n          promise = userProfileService.saveBillingMethod(state.getCurrentCenterId(), vm.userProfile);\n        }\n      } else {\n        promise = userProfileService.saveBillingProfile(state.getCurrentCenterId(), vm.userProfile);\n      }\n      return promise\n        .then(() => {\n          if (vm.reg && !vm.reg.member) {\n            vm.complete = true;\n            return; // Complete registration for non-member registration by coordinator\n          }\n\n          const promise = purchaseService.createPurchase(\n            state.getCurrentCenterId(),\n            vm.userProfile.id,\n            true,\n            +state.getParam('productId'),\n            state.getParam('attachedReservationUnitId'),\n            state.getParam('membershipStartDate'));\n\n          return promise\n            .catch(err => dwAlerts.error(err, 'Failed to create purchase.'))\n            .then(result => state.setPath(state.getPath() + '/purchase/' + result.id));\n        });\n    };\n\n    /**\n     * Back button handler\n     */\n    vm.back = state.back;\n\n    /**\n     * Bind test user data generator\n     */\n    userProfileService.bindTestBillingGenerator($scope, vm.userProfile, vm.reg);\n  });\n","// Module\nvar code = \"<div id=\\\"billingProfile\\\" ff-bulk-read-only> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <div class=\\\"ff-grid gutter-v\\\"> <ff-panel ng-if=\\\"vm.complete\\\"> <span translate=\\\"BILLING_PROFILE.REGISTRATION.COMPLETE\\\" translate-values=\\\"{ userName: vm.userProfile.fullNameCompany }\\\"></span> </ff-panel> <up-billing-method user=\\\"vm.userProfile\\\" reg=\\\"vm.reg\\\" settings=\\\"vm.settings\\\" ng-if=\\\"!vm.complete\\\" auto-save=\\\"!vm.reg\\\" new-payment-methods=\\\"!!vm.reg\\\"></up-billing-method> <up-credit-cards user-profile=\\\"vm.userProfile\\\" reg=\\\"vm.reg\\\" settings=\\\"vm.settings\\\" ng-if=\\\"!vm.complete\\\"></up-credit-cards> <up-e-checks user-profile=\\\"vm.userProfile\\\" reg=\\\"vm.reg\\\" ng-if=\\\"!vm.complete && vm.settings.enableEChecks\\\"></up-e-checks> </div> <ff-btn-group class=\\\"buttons-bottom\\\" ng-if=\\\"vm.reg && !vm.complete\\\"> <ff-btn sense=\\\"next\\\" ng-if=\\\"vm.reg && !vm.reg.selfRegistration\\\" ff-click=\\\"vm.next({ skipBillingProfile: true })\\\"> <span translate=\\\"BILLING_PROFILE.REGISTRATION.SKIP_BILLING\\\"></span> </ff-btn> <ff-btn sense=\\\"back\\\" ff-click=\\\"vm.back()\\\"><span translate=\\\"GLOBAL.BTN_BACK\\\"></span></ff-btn> <ff-btn sense=\\\"next\\\" ng-if=\\\"vm.reg\\\" ff-click=\\\"vm.next()\\\"><span translate=\\\"GLOBAL.BTN_NEXT\\\"></span></ff-btn> </ff-btn-group> </div> \";\n// Exports\nmodule.exports = code;","angular.module('deskworks.billing', [\n  'deskworks.billing.purchase.list',\n  'deskworks.billing.purchase.edit',\n  'deskworks.billing.recurringCharge.list',\n  'deskworks.billing.recurringCharge.edit',\n]);\n","import niceTimeDirective from 'shared/nice-date-time/nice-time.directive';\n\n/**\n * purchaseAudit directive -\n */\nexport default angular.module('deskworks.purchaseAuditDirective', [\n  'deskworks.helper',\n  'deskworks.PurchaseAudit',\n  niceTimeDirective.name,\n])\n\n  .directive('purchaseAudit', function() {\n    const templateUrl = 'billing/purchase/audit/purchase-audit.tpl.html';\n\n    return {\n      templateUrl,\n      restrict: 'E',\n      scope: true,\n      controller: 'PurchaseAuditCtrl as $ctrl',\n      bindToController: {\n        purchaseId: '<',\n      },\n    };\n  })\n\n  .controller('PurchaseAuditCtrl', function($scope, state, dwAlerts, PurchaseAudit) {\n    const $ctrl = this;\n\n    $ctrl.$onInit = () => {\n      $ctrl.centerId = state.getCurrentCenterId();\n      $ctrl.userId = state.getCurrentUserId();\n      $ctrl.offset = 0;\n      $ctrl.limit = 100;\n      $ctrl.entries = [];\n      $ctrl.fetch();\n    };\n\n    /**\n     * Fetch\n     */\n    $ctrl.fetch = () => {\n      if ($ctrl.eof || $ctrl.fetching) return $ctrl.fetching;\n      $ctrl.fetching = PurchaseAudit.query({\n        centerId: $ctrl.centerId, userId: $ctrl.userId, purchaseId: $ctrl.purchaseId,\n        offset: $ctrl.offset, limit: $ctrl.limit,\n      })\n        .catch(err => dwAlerts.error(err, 'Failed to query audit log.'))\n        .finally(() => { $ctrl.fetching = null; })\n        .then(entries => {\n          // $ctrl.entries = $ctrl.entries.concat(entries);\n          $ctrl.entries = entries;\n          $ctrl.offset += entries.length;\n          $ctrl.eof = entries.length < $ctrl.limit;\n        });\n    };\n\n    $scope.$on('purchase:update', () => {\n      $ctrl.eof = false;\n      $ctrl.fetch();\n    });\n  });\n","/**\n * PurchaseAudit service -\n */\nexport default angular.module('deskworks.PurchaseAudit', [\n  'ngResource',\n  'datesDeserializer',\n  'deskworks.config',\n])\n\n  .factory('PurchaseAudit', function($resource, $timeout, deskworksConfig, datesDeserializer) {\n\n\n    const desDates = datesDeserializer(['createdAt', 'itemDeleted.billedAt', 'itemDeleted.addedAt']);\n\n    const res = $resource(deskworksConfig.getApiAbsUrl('/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/audit'), {}, {\n      query: { method: 'GET', isArray: true, transformResponse: [angular.fromJson, desDates] },\n    });\n\n    return {\n      /**\n       * Get purchase changes log\n       */\n      query: (params) =>\n        res.query(params).$promise,\n    };\n  });\n","// Module\nvar code = \"<ff-panel style=\\\"margin:1.5rem 0\\\"> <ff-panel-header><span translate=\\\"PURCHASE.AUDIT.HEADER\\\"></span></ff-panel-header> <div ng-if=\\\"!$ctrl.entries.length && !$ctrl.fetching\\\" class=\\\"animate-collapse\\\"> <span translate=\\\"GLOBAL.NONE\\\"></span> </div> <ff-header ng-if=\\\"$ctrl.entries.length\\\" class=\\\"animate-collapse\\\"> <ff-row> <cell flex=\\\"4 0 40px\\\" class=\\\"invoice-date ff-center\\\"><span translate=\\\"PURCHASE.INVOICE.DATE\\\"></span></cell> <cell flex=\\\"4 1 40px\\\" class=\\\"invoice-date-created ff-center show-lg\\\"><span translate=\\\"PURCHASE.INVOICE.DATE_CREATED\\\"></span></cell> <cell flex=\\\"4 1 40px\\\" class=\\\"invoice-added-by ff-center show-lg\\\"><span translate=\\\"PURCHASE.INVOICE.ADDED_BY\\\"></span></cell> <cell flex=\\\"4 0 70px\\\" class=\\\"invoice-product\\\"><span translate=\\\"PURCHASE.INVOICE.PRODUCT\\\"></span></cell> <cell flex=\\\"10 1 100px\\\" class=\\\"invoice-description show-md\\\"><span translate=\\\"PURCHASE.INVOICE.DESCRIPTION\\\"></span></cell> <cell flex=\\\"0 0 46px\\\" class=\\\"invoice-quantity ff-center show-sm\\\"><span translate=\\\"PURCHASE.INVOICE.QUANTITY\\\"></span></cell> <cell flex=\\\"0 0 80px\\\" class=\\\"invoice-price ff-right show-sm\\\"><span translate=\\\"PURCHASE.INVOICE.PRICE\\\"></span></cell> <cell flex=\\\"0 0 80px\\\" class=\\\"invoice-amount ff-right\\\"><span translate=\\\"PURCHASE.INVOICE.AMOUNT\\\"></span></cell> </ff-row> </ff-header> <ff-col infinite-scroll=\\\"$ctrl.fetch()\\\" infinite-scroll-distance=\\\"2\\\" infinite-scroll-container=\\\"'.snap-content-scroller'\\\"> <div ng-repeat=\\\"entry in $ctrl.entries\\\" class=\\\"animate-collapse\\\"> <ff-row> <ff-label class=\\\"standout\\\"><span> {{entry.createdAt | date:'mediumDate'}} <span nice-time=\\\"entry.createdAt\\\"></span>, item deleted by {{entry.createdBy}} </span></ff-label> </ff-row> <ff-row> <ff-static flex=\\\"4 0 40px\\\" class=\\\"invoice-date ff-center\\\" ff-bind=\\\"::entry.itemDeleted.billedAt | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"4 1 40px\\\" class=\\\"invoice-date-created ff-center show-lg\\\" ff-bind=\\\"::entry.itemDeleted.addedAt | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"4 1 40px\\\" class=\\\"invoice-added-by ff-center show-lg\\\" ff-bind=\\\"::entry.itemDeleted.addedBy\\\"></ff-static> <ff-static flex=\\\"4 0 70px\\\" class=\\\"invoice-product\\\" ff-bind=\\\"::entry.itemDeleted.name\\\"></ff-static> <ff-static flex=\\\"10 1 100px\\\" class=\\\"invoice-description show-md\\\" ff-bind=\\\"::entry.itemDeleted.description\\\"></ff-static> <ff-static flex=\\\"0 0 46px\\\" class=\\\"invoice-quantity ff-center show-sm\\\" ff-bind=\\\"::entry.itemDeleted.quantity | round\\\"></ff-static> <ff-static flex=\\\"0 0 80px\\\" class=\\\"invoice-price ff-right show-sm\\\" ff-bind=\\\"::entry.itemDeleted.price | ncurrency\\\"></ff-static> <ff-static flex=\\\"0 0 80px\\\" class=\\\"invoice-amount ff-right\\\" ff-bind=\\\"::entry.itemDeleted.amount | ncurrency\\\"></ff-static> </ff-row> </div> </ff-col> <ff-row ff-dim=\\\"true\\\" ng-if=\\\"$ctrl.fetching\\\" class=\\\"animate-collapse\\\"><ff-static></ff-static></ff-row> </ff-panel> \";\n// Exports\nmodule.exports = code;","import './dw-add-charges.scss';\n\n/**\n * dwAddCharges directive - 'Add Charges' section of purchase\n */\nexport default angular.module('deskworks.dwAddCharges', [\n  'ngRoute',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.purchase.service',\n])\n\n  .directive('dwAddCharges', function() {\n    return {\n      restrict: 'EAC',\n      scope: true,\n      templateUrl: 'billing/purchase/dw-add-charges.tpl.html',\n      controller: 'dwAddChargesCtrl as $ctrl',\n      bindToController: {\n        purchase: '<',\n        updateInvoice: '&',\n        userPriceList: '<',\n        noCollapse: '<',\n      },\n    };\n  })\n\n  .controller('dwAddChargesCtrl', function($scope, $filter, $route, $translate, dwAlerts, helper, state,\n                                           purchaseService) {\n    const $ctrl = this;\n\n    $ctrl.collapsed = {};\n\n    /**\n     * $onInit\n     */\n    $ctrl.$onInit = function() {};\n\n    /**\n     * $onChanges\n     */\n    $ctrl.$onChanges = function() {\n      // Add custom charge\n      if ($ctrl.purchase && $ctrl.purchase.options && state.isLoggedAdmin() && !helper.find($ctrl.purchase.options.chargeTypes, 'custom')) {\n        $ctrl.purchase.options.chargeTypes.push({\n          id: 'custom',\n          name: $translate.instant('PURCHASE.CHARGES.CUSTOM'),\n          packages: [{ name: $translate.instant('PURCHASE.CHARGES.CUSTOM'), price: '0.0' }]\n        });\n      }\n      // Additional init for packages\n      if ($ctrl.purchase && $ctrl.purchase.options) {\n        $ctrl.purchase.options.chargeTypes.forEach(chargeType => {\n          chargeType.packages.forEach(pkg => {\n            pkg.chargedAt = moment();\n            pkg.quantity = 1;\n            pkg.notes = '';\n          });\n        });\n      }\n    };\n\n    /**\n     * Create Charge handler\n     */\n    $ctrl.createCharge = function(chargeType, product) {\n      if (helper.pointFirstInvalid('#product' + product.id)) return;\n\n      const data = {\n        chargedAt: $filter('date')(product.chargedAt, 'yyyy-MM-dd'),\n        notes: product.notes,\n        quantity: product.quantity\n      };\n\n      if (chargeType.id === 'custom') {\n        data.packageName = product.name;\n        data.price = product.price;\n        data.isTaxable = product.isTaxable;\n      } else {\n        data.packageId = product.id;\n      }\n\n      return purchaseService.createCharge(\n        state.getCurrentCenterId(),\n        state.getCurrentUserId(),\n        $ctrl.purchase.id,\n        data,\n        chargeType.id === 'custom',\n        !!$route.current.params.productId,\n        $route.current.params.productId\n      )\n        .catch(err => dwAlerts.error(err, 'Failed to add charge.'))\n        .then(() => $ctrl.updateInvoice());\n    };\n  });\n","// extracted by extract-css-chunks-webpack-plugin","// Module\nvar code = \"<div> <div class=\\\"em ff-bmargin\\\" ng-if=\\\"!$ctrl.noCollapse\\\"> <span translate=\\\"PURCHASE.CHARGES.HEADER\\\"></span><span ng-if=\\\"$ctrl.userPriceList\\\">, <span translate=\\\"PURCHASE.USER_PRICE_LIST\\\"></span>: <span ng-bind=\\\"$ctrl.userPriceList.name || '-'\\\"></span> </span> </div> <div id=\\\"chargeType-{{chargeType.id}}\\\" ng-repeat=\\\"chargeType in $ctrl.purchase.options.chargeTypes\\\"> <ff-btn sense=\\\"collapse\\\" ff-click=\\\"$ctrl.collapsed[chargeType.id] = !$ctrl.collapsed[chargeType.id]\\\" ng-class=\\\"{ collapsed: !$ctrl.collapsed[chargeType.id] }\\\" class=\\\"dw-add-charges-collapse-btn\\\" ng-if=\\\"!$ctrl.noCollapse\\\">{{chargeType.name}}</ff-btn> <div ng-collapse=\\\"!$ctrl.collapsed[chargeType.id] && !$ctrl.noCollapse\\\"> <ff-panel class=\\\"ff-bmargin\\\" role=\\\"article\\\" aria-label=\\\"{{'PURCHASE.CHARGES.ADD_CHARGES' | translate: { chargeType: chargeType.name } }}\\\"> <ff-panel-header ng-if=\\\"$ctrl.noCollapse\\\">{{chargeType.name}}</ff-panel-header> <form name=\\\"formProduct\\\" id=\\\"product{{product.id}}\\\" ng-repeat=\\\"product in chargeType.packages\\\"> <div class=\\\"ff-bmargin\\\"> <ff-header>{{product.name}} - {{product.price | ncurrency}}</ff-header> <div class=\\\"ff-grid gutter-h-half\\\"> <label flex=\\\"{md: '0 0 50%'}\\\" class=\\\"ff-row\\\" ng-if=\\\"chargeType.id === 'custom'\\\"> <ff-label flex=\\\"0 0 78px\\\" ff-required=\\\"true\\\"><span translate=\\\"PURCHASE.CHARGES.NAME\\\"></span></ff-label> <ff-text name=\\\"name\\\" ff-model=\\\"product.name\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'PURCHASE.CHARGES.NAME' | translate}}\\\"></ff-text> </label> <ff-row flex=\\\"{md: '0 0 50%'}\\\" ng-if=\\\"chargeType.id === 'custom'\\\"> <label flex=\\\"0 1 160px\\\"> <ff-label flex=\\\"0 0 78px\\\" ff-required=\\\"true\\\"><span translate=\\\"PURCHASE.CHARGES.PRICE\\\"></span></ff-label> <ff-price name=\\\"price\\\" ff-model=\\\"product.price\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'PURCHASE.CHARGES.PRICE' | translate}}\\\"></ff-price> </label> <label flex=\\\"0 0 auto\\\"> <ff-checkbox flex=\\\"0 0 auto\\\" name=\\\"isTaxable\\\" ff-model=\\\"product.isTaxable\\\">Is Taxable</ff-checkbox> </label> </ff-row> <ff-row flex=\\\"{md: '0 0 50%'}\\\"> <label flex=\\\"0 0 34%\\\"> <ff-label flex=\\\"0 0 78px\\\" ff-required=\\\"true\\\"><span translate=\\\"PURCHASE.CHARGES.QUANTITY\\\"></span></ff-label> <ff-number flex=\\\"1 1 1%\\\" name=\\\"qty\\\" ff-model=\\\"product.quantity\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'PURCHASE.CHARGES.QUANTITY' | translate}}\\\"></ff-number> </label> <label flex=\\\"0 0 66%\\\"> <ff-label flex=\\\"0 0 78px\\\"><req translate=\\\"PURCHASE.CHARGES.USE_DATE\\\"></req></ff-label> <ff-date flex=\\\"1 1 1%\\\" name=\\\"chargedAt\\\" ff-model=\\\"product.chargedAt\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'PURCHASE.CHARGES.USE_DATE' | translate}}\\\"></ff-date> </label> </ff-row> <ff-row flex=\\\"{md: '0 0 50%'}\\\"> <label flex=\\\"1 1 auto\\\"> <ff-label flex=\\\"0 0 78px\\\"><span translate=\\\"PURCHASE.CHARGES.NOTES\\\"></span></ff-label> <ff-text flex=\\\"1 1 1%\\\" name=\\\"notes\\\" ff-model=\\\"product.notes\\\"></ff-text> </label> <ff-btn-group flex=\\\"none\\\"> <ff-btn sense=\\\"save\\\" size=\\\"sm\\\" type=\\\"submit\\\" ff-click=\\\"$ctrl.createCharge(chargeType, product)\\\"> <span translate=\\\"PURCHASE.CHARGES.BTN_ADD\\\"></span> </ff-btn> </ff-btn-group> </ff-row> </div> </div> </form> </ff-panel> </div> </div> </div> \";\n// Exports\nmodule.exports = code;","import './purchase.scss';\nimport ReservationUnit from 'shared/services/inventory/reservation-unit.service';\nimport purchasePaymentDirective from './purchase-payment.directive';\nimport dwInvoice from 'shared/dw-invoice/dw-invoice.directive';\nimport lazyLoaders from 'bundles/lazy-loaders.service';\n\nexport default angular.module('deskworks.billing.purchase.edit', [\n  'ngRoute',\n  lazyLoaders.name,\n  'autoSave',\n  'deskworks.center.service',\n  'deskworks.purchase.service',\n  'deskworks.userProfile.service',\n  'deskworks.inventory.priceList.service',\n  'deskworks.routeHelper',\n  'deskworks.helper',\n  'deskworks.dwAddCharges',\n  ReservationUnit.name,\n  'deskworks.SecurityDepositRecord',\n  purchasePaymentDirective.name,\n  dwInvoice.name,\n  'deskworks.purchaseAuditDirective',\n])\n\n  .config(function($routeProvider) {\n    /**\n     * Post Payment and Charges\n     */\n    $routeProvider.when('/purchases/:purchaseId/edit', {\n      templateUrl: 'billing/purchase/purchase-edit.tpl.html',\n      controller: 'PurchaseEditCtrl as $ctrl',\n      label: 'Edit',\n      routeBranch: 'purchases',\n      translations: ['purchase', 'billing-profile', 'payments-assignment'],\n      resolve: {\n        reg: function() {},\n        purchase: function($route, dwAlerts, state, purchaseService, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => purchaseService.get(state.getCurrentCenterId(), state.getCurrentUserId(), $route.current.params.purchaseId)\n              .catch(err => dwAlerts.error(err, 'Failed to get purchase.')));\n        },\n        user: function(dwAlerts, routeHelper, state, userProfileService, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n        },\n        center: function(dwAlerts, centerService, state) {\n          return centerService.get(state.getCurrentCenterId(state.getCurrentCenterId()))\n            .catch(err => dwAlerts.error(err, 'Failed to get center.'));\n        },\n        settings: (dwAlerts, setupService) => setupService.getSetupSettings()\n          .catch(err => dwAlerts.error(err, 'Failed to load setup settings.')),\n        lazy: 'lazyLoadPaymentsAssignment',\n      },\n    });\n\n    /**\n     * Register new member by coordinator\n     */\n    $routeProvider.when('/new-member/:userId/membership/billing-profile/purchase/:purchaseId', {\n      templateUrl: 'billing/purchase/purchase-edit.tpl.html',\n      controller: 'PurchaseEditCtrl as $ctrl',\n      label: 'Purchase',\n      routeBranch: 'new-member',\n      translations: ['purchase', 'billing-profile', 'payments-assignment'],\n      resolve: {\n        reg: () => { return { member: true, selfRegistration: false, step: 3, stepCount: 3 }; },\n        purchase: function($route, dwAlerts, state, purchaseService, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => purchaseService.get(state.getCurrentCenterId(), $route.current.params.userId, $route.current.params.purchaseId)\n              .catch(err => dwAlerts.error(err, 'Failed to get purchase.')));\n        },\n        user: function(dwAlerts, routeHelper, state, userProfileService) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n        },\n        center: function(dwAlerts, centerService, state) {\n          return centerService.get(state.getCurrentCenterId(state.getCurrentCenterId()))\n            .catch(err => dwAlerts.error(err, 'Failed to get center.'));\n        },\n        settings: (dwAlerts, setupService) => setupService.getSetupSettings()\n          .catch(err => dwAlerts.error(err, 'Failed to load setup settings.')),\n        lazy: 'lazyLoadPaymentsAssignment',\n      },\n    });\n  })\n\n  .controller('PurchaseEditCtrl', function($scope, $filter, $translate, $q, $injector, dwAlerts, state,\n                                           center, purchase, helper, reg, user, settings, session,\n                                           purchaseService, priceListService, SecurityDepositRecord, autoSave) {\n    const $ctrl = this;\n\n    $scope.backPath = '/purchases';\n    $scope.$watch('state.getCurrentCenterId()', (nv, ov) => { if (nv !== ov) state.setPath($scope.backPath); });\n\n    $ctrl.center = center;\n    $ctrl.reg = reg;\n    $ctrl.user = user;\n    $ctrl.showOrderDates = state.isLoggedAdmin();\n\n    const limitRefund = settings.limitRefundProcessingTo;\n    $ctrl.allowRefundProcessing = limitRefund[session.user.role] || Object.keys(limitRefund).every(key => !limitRefund[key]);\n\n    $ctrl.purchase = purchase;\n\n    if (angular.isDefined(state.getParam('redirect'))) {\n      $ctrl.redirect = state.getParam('redirect');\n    }\n\n    state.setPageTitle($translate.instant('PURCHASE.PAGE_TITLE', { userName: user.fullNameCompany, centerName: center.name }));\n\n    if (user.membershipPriceListId) {\n      priceListService.getPricelist(state.getCurrentCenterId(), user.membershipPriceListId)\n        .then(result => { $ctrl.userPriceList = result; });\n    }\n\n    /**\n     * For simple purchase edit, prepare \"Consolidate Order With Purchase\" dropdown\n     */\n    $ctrl.queryConsolidations = () => {\n      if (!$ctrl.reg) {\n        purchaseService.queryConsolidations({\n          centerId: state.getCurrentCenterId(),\n          userId: $ctrl.user.id,\n          purchaseId: $ctrl.purchase.id,\n        })\n          .then(result => {\n            $ctrl.consolidations = result;\n            $ctrl.consolidationId = ($ctrl.consolidations[0] || {}).id;\n          });\n      }\n    };\n    $ctrl.queryConsolidations();\n\n    /**\n     * Back to Purchases handler. Redirects to Post Payments and charges screen.\n     */\n\n    $ctrl.backToPurchases = () => state.setPath('/purchases');\n\n    /**\n     * Consolidate Order With Purchase handler\n     */\n    $ctrl.consolidatePurchase = function(consolidationId) {\n      return purchaseService.consolidate(state.getCurrentCenterId(), state.getCurrentUserId(), $ctrl.purchase.id, consolidationId)\n        .catch(err => dwAlerts.error(err, 'Failed to consolidate order with purchase.'))\n        .then(() => $ctrl.updateInvoice());\n    };\n\n    /**\n     * Gets updated invoice data from server and refreshes the invoice\n     */\n    $ctrl.updateInvoice = function() {\n      return purchaseService.get(state.getCurrentCenterId(), state.getCurrentUserId(), $ctrl.purchase.id)\n        .catch(err => dwAlerts.error(err, 'Failed to get purchase order.'))\n        .then(result => {\n          $ctrl.purchase = result;\n          $ctrl.queryConsolidations();\n        })\n        .then(_ => $scope.$broadcast('purchase:update'));\n    };\n\n    /**\n     * Get updated records from server\n     */\n    $ctrl.updateSecurityDepositRecords = function() {\n      return SecurityDepositRecord.query({ centerId: state.getCurrentCenterId(), userId: state.getCurrentUserId() })\n        .catch(err => dwAlerts.error(err, 'Failed to query security deposit records.'))\n        .then(result => { $ctrl.securityDepositRecords = result; });\n    };\n    $ctrl.updateSecurityDepositRecords(); // initial loading\n\n    /**\n     * Update invoice and security deposit records\n     */\n    $ctrl.update = () => $q.all([$ctrl.updateInvoice(), $ctrl.updateSecurityDepositRecords()]);\n\n    /**\n     * Filter security deposit payments/refunds\n     */\n    $ctrl.filterBillingMethods = val => {\n      const sdr = $ctrl.securityDepositRecords && $ctrl.securityDepositRecords.slice() || [];\n      const lastBalanceRecord = sdr.reverse().find(rec => angular.isDefined(rec.balance));\n      return val.id !== 'securityDeposit' || lastBalanceRecord && lastBalanceRecord.balance > 0;\n    };\n\n    /**\n     * Bill Date / Due Date change handler\n     */\n    $ctrl.onOrderDateChange = autoSave.wrap(onOrderDateChange);\n    function onOrderDateChange() {\n      if (helper.pointFirstInvalid('.purchase-dates')) return;\n\n      const data = helper.pick($ctrl.purchase, ['billDate', 'dueDate']);\n\n      $ctrl.orderSpin = true;\n      return purchaseService.update(state.getCurrentCenterId(), state.getCurrentUserId(), $ctrl.purchase.id, data)\n        .catch(err => dwAlerts.error(err, 'Failed to update purchase order.'))\n        .finally(_ => $ctrl.orderSpin = false);\n    }\n\n    $ctrl.isPaymentsAssignmentEnabled = () => session.isAdmin() && $injector.has('paymentsAssignmentDialog');\n\n    $ctrl.paymentAssignment = () => $injector.get('paymentsAssignmentDialog')\n      .open({ scope: $scope.$new(), purchaseId: $ctrl.purchase.id });\n  });\n","// Module\nvar code = \"<div class=\\\"purchase\\\" ff-bulk-read-only> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <div class=\\\"gutter-v\\\"> <ff-panel> <ff-spin ng-if=\\\"$ctrl.orderSpin\\\"></ff-spin> <ff-panel-header ng-if=\\\"$ctrl.reg\\\"><span translate=\\\"GLOBAL.STEP_X_OF_Y\\\" translate-values=\\\"$ctrl.reg\\\"></span></ff-panel-header> <ff-header style=\\\"margin-bottom:.5rem\\\"> <div class=\\\"ff-grid gutter-v-half\\\"> <div flex=\\\"none\\\"><span translate=\\\"PURCHASE.LIST.ORDER_ID\\\"></span>: {{$ctrl.purchase.orderId}}</div> <div flex=\\\"auto\\\" ng-if=\\\"$ctrl.showOrderDates\\\"> <div class=\\\"ff-grid purchase-dates\\\"> <label flex=\\\"0 0 200px\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 82px\\\"><req translate=\\\"PURCHASE.INVOICE.BILL_DATE\\\"></req></ff-label> <ff-date name=\\\"billDate\\\" ff-model=\\\"$ctrl.purchase.billDate\\\" ff-change=\\\"$ctrl.onOrderDateChange()\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{ 'PURCHASE.INVOICE.BILL_DATE' | translate }}\\\"></ff-date> </label> <label flex=\\\"0 0 200px\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 82px\\\"><req translate=\\\"PURCHASE.INVOICE.DUE_DATE\\\"></req></ff-label> <ff-date name=\\\"dueDate\\\" ff-model=\\\"$ctrl.purchase.dueDate\\\" ff-change=\\\"$ctrl.onOrderDateChange()\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{ 'PURCHASE.INVOICE.DUE_DATE' | translate }}\\\"></ff-date> </label> </div> </div> </div> </ff-header> <dw-invoice invoice=\\\"$ctrl.purchase\\\" center=\\\"$ctrl.center\\\" update-invoice=\\\"$ctrl.updateInvoice()\\\"></dw-invoice> </ff-panel> <form name=\\\"formConsolidate\\\" ng-if=\\\"$ctrl.consolidations.length > 0\\\"> <ff-panel> <ff-header><span translate=\\\"PURCHASE.CONSOLIDATE\\\"></span></ff-header> <ff-row class=\\\"gutter-h-half\\\"> <ff-select flex=\\\"0 0 120px\\\" name=\\\"consolidation\\\" ff-model=\\\"$ctrl.consolidationId\\\" ff-options=\\\"opt.id as opt.orderId for opt in $ctrl.consolidations\\\"></ff-select> <ff-btn flex=\\\"none\\\" type=\\\"submit\\\" sense=\\\"merge\\\" size=\\\"sm\\\" ff-click=\\\"$ctrl.consolidatePurchase($ctrl.consolidationId)\\\"> <span translate=\\\"PURCHASE.BTN_COMBINE\\\"></span> </ff-btn> </ff-row> </ff-panel> </form> <div ng-if=\\\"$ctrl.reg\\\"> <purchase-payment type=\\\"payment\\\" settings=\\\"$resolve.settings\\\" user=\\\"$resolve.user\\\" purchase-id=\\\"$ctrl.purchase.id\\\" update-invoice=\\\"$ctrl.update()\\\" default-amount=\\\"$ctrl.purchase.balance\\\" filter-billing-methods=\\\"$ctrl.filterBillingMethods\\\"></purchase-payment> </div> <div ng-if=\\\"!$ctrl.reg\\\" style=\\\"margin-bottom:.5rem\\\"> <div> <ff-btn sense=\\\"collapse\\\" ff-click=\\\"$ctrl.paymentCollapsed = !$ctrl.paymentCollapsed\\\" class=\\\"dw-add-charges-collapse-btn\\\" ng-class=\\\"{ collapsed: !$ctrl.paymentCollapsed }\\\"> <span translate=\\\"PURCHASE.PAYMENT.BTN_ADD\\\"></span> </ff-btn> <div ng-collapse=\\\"!$ctrl.paymentCollapsed\\\"> <purchase-payment type=\\\"payment\\\" settings=\\\"$resolve.settings\\\" user=\\\"$resolve.user\\\" purchase-id=\\\"$ctrl.purchase.id\\\" update-invoice=\\\"$ctrl.update()\\\" default-amount=\\\"$ctrl.purchase.balance\\\" filter-billing-methods=\\\"$ctrl.filterBillingMethods\\\"></purchase-payment> </div> </div> <div> <ff-btn sense=\\\"collapse\\\" ff-click=\\\"$ctrl.depositCollapsed = !$ctrl.depositCollapsed\\\" class=\\\"dw-add-charges-collapse-btn\\\" ng-class=\\\"{ collapsed: !$ctrl.depositCollapsed }\\\"> <span translate=\\\"PURCHASE.DEPOSIT.BTN_ADD\\\"></span> </ff-btn> <div ng-collapse=\\\"!$ctrl.depositCollapsed\\\"> <purchase-payment type=\\\"deposit\\\" settings=\\\"$resolve.settings\\\" user=\\\"$resolve.user\\\" purchase-id=\\\"$ctrl.purchase.id\\\" update-invoice=\\\"$ctrl.update()\\\"></purchase-payment> </div> </div> <div> <ff-btn sense=\\\"collapse\\\" ff-click=\\\"$ctrl.discountCollapsed = !$ctrl.discountCollapsed\\\" class=\\\"dw-add-charges-collapse-btn\\\" ng-class=\\\"{ collapsed: !$ctrl.discountCollapsed }\\\"> <span translate=\\\"PURCHASE.DISCOUNT.BTN_ADD\\\"></span> </ff-btn> <div ng-collapse=\\\"!$ctrl.discountCollapsed\\\"> <purchase-payment type=\\\"discount\\\" settings=\\\"$resolve.settings\\\" user=\\\"$resolve.user\\\" purchase-id=\\\"$ctrl.purchase.id\\\" update-invoice=\\\"$ctrl.updateInvoice()\\\"></purchase-payment> </div> </div> <div ng-if=\\\"$ctrl.allowRefundProcessing\\\"> <ff-btn sense=\\\"collapse\\\" ff-click=\\\"$ctrl.refundCollapsed = !$ctrl.refundCollapsed\\\" class=\\\"dw-add-charges-collapse-btn\\\" ng-class=\\\"{ collapsed: !$ctrl.refundCollapsed }\\\"> <span translate=\\\"PURCHASE.REFUND.BTN_ADD\\\"></span> </ff-btn> <div ng-collapse=\\\"!$ctrl.refundCollapsed\\\"> <purchase-payment type=\\\"refund\\\" settings=\\\"$resolve.settings\\\" user=\\\"$resolve.user\\\" purchase-id=\\\"$ctrl.purchase.id\\\" payment-methods=\\\"$ctrl.purchase.options.refundCreditCards\\\" update-invoice=\\\"$ctrl.update()\\\" filter-billing-methods=\\\"$ctrl.filterBillingMethods\\\"></purchase-payment> </div> </div> </div> <dw-add-charges purchase=\\\"$ctrl.purchase\\\" update-invoice=\\\"$ctrl.update()\\\" user-price-list=\\\"$ctrl.userPriceList\\\"></dw-add-charges> <ff-btn-group class=\\\"buttons-bottom\\\" ng-if=\\\"!$ctrl.reg\\\"> <ff-btn sense=\\\"back\\\" ff-click=\\\"$ctrl.backToPurchases()\\\"><span translate=\\\"GLOBAL.BTN_BACK\\\"></span></ff-btn> <ff-btn sense=\\\"charge\\\" ng-if=\\\"$ctrl.isPaymentsAssignmentEnabled()\\\" ff-click=\\\"$ctrl.paymentAssignment()\\\"> <span translate=\\\"PAYMENTS_ASSIGNMENT.BTN_ASSIGN\\\"></span> </ff-btn> <ff-btn sense=\\\"collapseBtn\\\" ng-if=\\\"$ctrl.purchase.id && state.isLoggedAdmin()\\\" ff-click=\\\"$ctrl.showAudit = !$ctrl.showAudit\\\" ng-class=\\\"{ collapsed: !$ctrl.showAudit }\\\"> <span translate=\\\"GLOBAL.BTN_AUDIT\\\"></span> </ff-btn> </ff-btn-group> </div> </div> <div ng-if=\\\"$ctrl.showAudit\\\" class=\\\"animate-collapse\\\"> <purchase-audit purchase-id=\\\"$ctrl.purchase.id\\\"></purchase-audit> </div> \";\n// Exports\nmodule.exports = code;","export default angular.module('deskworks.billing.purchase.list', [\n  'deskworks.center.service',\n  'deskworks.purchase.service',\n  'deskworks.routeHelper',\n  'deskworks.SecurityDepositRecord'\n])\n\n  .config(function($routeProvider) {\n    $routeProvider.when('/purchases', {\n      templateUrl: 'billing/purchase/purchase-list.tpl.html',\n      controller: 'PurchaseListCtrl as $ctrl',\n      label: 'Purchases',\n      routeBranch: 'purchases',\n      translations: ['purchase'],\n      resolve: {\n        purchases: function(dwAlerts, purchaseService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => purchaseService.query(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to query purchases.')));\n        },\n        user: function(dwAlerts, userProfileService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n        },\n        center: function(dwAlerts, centerService, state) {\n          return centerService.get(state.getCurrentCenterId(state.getCurrentCenterId()))\n            .catch(err => dwAlerts.error(err, 'Failed to get center.'));\n        },\n        securityDepositRecords: (dwAlerts, state, routeHelper, resolveTimezone, SecurityDepositRecord) => {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => SecurityDepositRecord.query({ centerId: state.getCurrentCenterId(), userId: state.getCurrentUserId() })\n              .catch(err => dwAlerts.error(err, 'Failed to query security deposit records.')));\n        },\n      }\n    });\n  })\n\n  .controller('PurchaseListCtrl', function($scope, $translate, dwAlerts, center, purchases, state, helper, user,\n                                           purchaseService) {\n    const $ctrl = this;\n\n    $ctrl.center = center;\n    $ctrl.purchases = purchases;\n    $ctrl.types = [\n      { id: 'credit', name: 'PURCHASE.LIST.CREDIT.HEADER' },\n      { id: 'open', name: 'PURCHASE.LIST.OPEN.HEADER' },\n      { id: 'paid', name: 'PURCHASE.LIST.PAID.HEADER' },\n    ];\n    $ctrl.types.forEach(type => { type.orders = $ctrl.purchases.filter(p => p.type === type.id); });\n\n    state.setPageTitle($translate.instant('PURCHASE.LIST.PAGE_TITLE', { userName: user.fullNameCompany, centerName: center.name }));\n\n    /**\n     * Edit Purchase handler\n     */\n    $ctrl.editPurchase = order => state.setPath('/purchases/' + order.id + '/edit');\n\n    /**\n     * View Purchase handler\n     */\n    $ctrl.viewPurchase = order => state.setPath('/purchases/' + order.id + '/view');\n\n    /**\n     * Create New Purchase handler\n     */\n    $ctrl.createPurchase = function() {\n      return purchaseService.createPurchase(state.getCurrentCenterId(), state.getCurrentUserId())\n        .catch(err => dwAlerts.error(err, 'Failed to create purchase'))\n        .then(result => state.setPath('/purchases/' + result.id + '/edit'));\n    };\n  });\n","// Module\nvar code = \"<div class=\\\"purchase-list ff-grid\\\" ff-bulk-read-only> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <div class=\\\"ff-grid gutter-v\\\"> <ng-include src=\\\"'securityDepositRecords'\\\"></ng-include> <ff-btn-group ng-if=\\\"$ctrl.purchases.length > 5\\\"> <ff-btn sense=\\\"new\\\" ff-click=\\\"$ctrl.createPurchase()\\\"><span translate=\\\"PURCHASE.LIST.BTN_NEW\\\"></span></ff-btn> </ff-btn-group> <ff-panel ng-repeat=\\\"type in $ctrl.types\\\" ng-if=\\\"type.orders.length\\\"> <ff-panel-header><span translate=\\\"{{type.name}}\\\"></span></ff-panel-header> <ff-header> <ff-row> <cell flex=\\\"1 1 12%\\\"><span translate=\\\"PURCHASE.LIST.ORDER_ID\\\"></span></cell> <cell flex=\\\"1 1 15%\\\" class=\\\"ff-right show-sm\\\"><span translate=\\\"PURCHASE.LIST.FIRST_OPENED\\\"></span></cell> <cell flex=\\\"1 1 15%\\\" class=\\\"ff-right show-md\\\"><span translate=\\\"PURCHASE.LIST.LAST_MODIFIED\\\"></span></cell> <cell flex=\\\"1 1 15%\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.LIST.PURCHASE_TOTAL\\\"></span></cell> <cell flex=\\\"1 1 12%\\\" class=\\\"ff-right show-sm\\\" ng-if=\\\"$ctrl.center.taxRates.length\\\"><span translate=\\\"PURCHASE.LIST.TAX_TOTAL\\\"></span></cell> <cell flex=\\\"1 1 15%\\\" class=\\\"ff-right show-xs\\\"><span translate=\\\"PURCHASE.LIST.PAYMENT_TOTAL\\\"></span></cell> <cell flex=\\\"1 1 15%\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.LIST.BALANCE_DUE\\\"></span></cell> <ff-btn-group flex=\\\"0 0 auto\\\" class=\\\"buttons-row zero-height\\\"> <ff-btn sense=\\\"view\\\" size=\\\"xs\\\"></ff-btn> <ff-btn sense=\\\"edit\\\" size=\\\"xs\\\"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-row ng-repeat=\\\"order in type.orders\\\"> <ff-static flex=\\\"1 1 12%\\\" ff-bind=\\\"order.id\\\"></ff-static> <ff-static flex=\\\"1 1 15%\\\" class=\\\"ff-right show-sm\\\" ff-bind=\\\"order.firstOpened | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"1 1 15%\\\" class=\\\"ff-right show-md\\\" ff-bind=\\\"order.lastModified | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"1 1 15%\\\" class=\\\"ff-right\\\" ff-bind=\\\"order.chargesTotal | ncurrency\\\"></ff-static> <ff-static flex=\\\"1 1 12%\\\" class=\\\"ff-right show-sm\\\" ff-bind=\\\"order.taxTotal | ncurrency\\\" ng-if=\\\"$ctrl.center.taxRates.length\\\"></ff-static> <ff-static flex=\\\"1 1 15%\\\" class=\\\"ff-right show-xs\\\" ff-bind=\\\"order.paymentTotal | ncurrency\\\"></ff-static> <ff-static flex=\\\"1 1 15%\\\" class=\\\"ff-right\\\" ff-bind=\\\"order.balance | ncurrency\\\"></ff-static> <ff-btn-group flex=\\\"0 0 auto\\\" class=\\\"buttons-row\\\"> <ff-btn sense=\\\"view\\\" size=\\\"xs\\\" ff-click=\\\"$ctrl.viewPurchase(order)\\\" title=\\\"{{'PURCHASE.LIST.BTN_VIEW' | translate}}\\\"></ff-btn> <ff-btn sense=\\\"edit\\\" size=\\\"xs\\\" ff-click=\\\"$ctrl.editPurchase(order)\\\" title=\\\"{{'GLOBAL.BTN_EDIT' | translate}}\\\"></ff-btn> </ff-btn-group> </ff-row> </ff-panel> </div> <ff-btn-group class=\\\"buttons-bottom\\\"> <ff-btn sense=\\\"new\\\" ff-click=\\\"$ctrl.createPurchase()\\\"><span translate=\\\"PURCHASE.LIST.BTN_NEW\\\"></span></ff-btn> </ff-btn-group> </div> <script type=\\\"text/ng-template\\\" id=\\\"securityDepositRecords\\\"> <ff-panel ng-if=\\\"$resolve.securityDepositRecords.length > 0\\\" class=\\\"animate-collapse\\\">\\n    <ff-panel-header style=\\\"margin-bottom: .5rem\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.HEADER\\\"></span></ff-panel-header>\\n    <ff-header>\\n      <ff-row>\\n        <cell flex=\\\"0 0 72px\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.ORDER_NO\\\"></span></cell>\\n        <cell flex=\\\"1 0 95px\\\" class=\\\"ff-right show-md\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.DATE\\\"></span></cell>\\n        <cell flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.CHARGED\\\"></span></cell>\\n        <cell flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.PAID\\\"></span></cell>\\n        <cell flex=\\\"1 0 72px\\\" class=\\\"ff-right show-sm\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.USED\\\"></span></cell>\\n        <cell flex=\\\"1 0 72px\\\" class=\\\"ff-right show-sm\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.REFUND\\\"></span></cell>\\n        <cell flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.BALANCE\\\"></span></cell>\\n        <cell flex=\\\"2 1 250px\\\" class=\\\"show-lg\\\"><span translate=\\\"PURCHASE.SECURITY_DEPOSIT_RECORDS.DESCRIPTION\\\"></span></cell>\\n      </ff-row>\\n    </ff-header>\\n\\n    <ff-row ng-repeat=\\\"rec in $resolve.securityDepositRecords\\\">\\n      <ff-static flex=\\\"0 0 72px\\\" class=\\\"ff-right\\\">{{::rec.orderId}}</ff-static>\\n      <ff-static flex=\\\"1 0 95px\\\" class=\\\"ff-right show-md\\\">{{::rec.date | date:'mediumDate'}}</ff-static>\\n      <ff-static flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\">{{::rec.charged | ncurrency | nd}}</ff-static>\\n      <ff-static flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\">{{::rec.paid | ncurrency | nd}}</ff-static>\\n      <ff-static flex=\\\"1 0 72px\\\" class=\\\"ff-right show-sm\\\">{{::rec.used | ncurrency | nd}}</ff-static>\\n      <ff-static flex=\\\"1 0 72px\\\" class=\\\"ff-right show-sm\\\">{{::rec.refund | ncurrency | nd}}</ff-static>\\n      <ff-static flex=\\\"1 0 72px\\\" class=\\\"ff-right\\\">{{::rec.balance | ncurrency | nd}}</ff-static>\\n      <ff-static flex=\\\"2 1 250px\\\" class=\\\"show-lg\\\">{{::rec.description | nd}}</ff-static>\\n    </ff-row>\\n  </ff-panel> </script> \";\n// Exports\nmodule.exports = code;","export default angular.module('deskworks.purchasePaymentTypes', [\n  'deskworks.purchase.service',\n  'deskworks.optsPaymentBillingMethod',\n  'deskworks.optsRefundBillingMethod',\n])\n\n.factory('purchasePaymentTypes', function(dwAlerts, purchaseService, optsPaymentBillingMethod, optsRefundBillingMethod) {\n  return {\n    payment: {\n      hasProcessingFee: true,\n      optsBillingMethod: optsPaymentBillingMethod,\n      header: 'PURCHASE.PAYMENT.HEADER',\n      negativeAmount: 'PURCHASE.PAYMENT.AMOUNT.NEGATIVE',\n      btnSubmit: 'PURCHASE.PAYMENT.BTN_SUBMIT',\n      btnRecord: 'PURCHASE.PAYMENT.BTN_RECORD',\n      hintSubmit: 'PURCHASE.PAYMENT.HINT_SUBMIT',\n      hintRecord: 'PURCHASE.PAYMENT.HINT_RECORD',\n      securityDepositHint: 'PURCHASE.PAYMENT.SECURITY_DEPOSIT.HINT_RECORD',\n      submit: (...params) => purchaseService.createPayment(...params).catch(err => dwAlerts.error(err, 'Failed to make payment.')),\n    },\n    deposit: {\n      hasProcessingFee: true,\n      header: 'PURCHASE.DEPOSIT.HEADER',\n      negativeAmount: 'PURCHASE.PAYMENT.AMOUNT.NEGATIVE',\n      btnSubmit: 'PURCHASE.DEPOSIT.BTN_SUBMIT',\n      btnRecord: 'PURCHASE.DEPOSIT.BTN_RECORD',\n      hintSubmit: 'PURCHASE.DEPOSIT.HINT_SUBMIT',\n      hintRecord: 'PURCHASE.DEPOSIT.HINT_RECORD',\n      submit: (...params) => purchaseService.createDeposit(...params).catch(err => dwAlerts.error(err, 'Failed to make deposit.')),\n    },\n    discount: {\n      hasProcessingFee: false,\n      header: 'PURCHASE.DISCOUNT.HEADER',\n      negativeAmount: 'PURCHASE.DISCOUNT.AMOUNT.NEGATIVE',\n      btnSubmit: 'PURCHASE.DISCOUNT.BTN_SUBMIT',\n      btnRecord: 'PURCHASE.DISCOUNT.BTN_RECORD',\n      submit: (...params) => purchaseService.createDiscount(...params).catch(err => dwAlerts.error(err, 'Failed to make discount.')),\n    },\n    refund: {\n      hasProcessingFee: false,\n      optsBillingMethod: optsRefundBillingMethod,\n      header: 'PURCHASE.REFUND.HEADER',\n      negativeAmount: 'PURCHASE.REFUND.AMOUNT.NEGATIVE',\n      btnSubmit: 'PURCHASE.REFUND.BTN_SUBMIT',\n      btnRecord: 'PURCHASE.REFUND.BTN_RECORD',\n      hintSubmit: 'PURCHASE.REFUND.HINT_SUBMIT',\n      hintRecord: 'PURCHASE.REFUND.HINT_RECORD',\n      submit: (...params) => purchaseService.createRefund(...params).catch(err => dwAlerts.error(err, 'Failed to make refund.')),\n    },\n  };\n});\n","import template from './purchase-payment.tpl.html';\nimport purchasePaymentTypes from './purchase-payment-types.service';\n\n/**\n * purchasePayment directive - ....\n */\nexport default angular.module('deskworks.purchasePaymentDirective', [\n  purchasePaymentTypes.name,\n])\n\n  .directive('purchasePayment', () => ({\n    template,\n    restrict: 'E',\n    scope: true,\n    controller: 'PurchasePaymentDirectiveCtrl as $ctrl',\n    bindToController: {\n      type: '@',\n      settings: '<',\n      user: '<',\n      purchaseId: '<',\n      defaultAmount: '<',\n      updateInvoice: '&',\n      filterBillingMethods: '<?',\n      paymentMethods: '<?',\n    },\n  }))\n\n  .controller('PurchasePaymentDirectiveCtrl', function($scope, $filter, state, helper, purchasePaymentTypes) {\n    const $ctrl = this;\n\n    /**\n     * $onInit\n     */\n    $ctrl.$onInit = () => {\n      $ctrl.types = purchasePaymentTypes;\n      $ctrl.postDate = moment();\n      $ctrl.payment = $ctrl.payment || {};\n\n      $ctrl.payment.receivedAt = moment();\n\n      if ($ctrl.types[$ctrl.type].optsBillingMethod) {\n        $scope.$watch('$ctrl.billingMethod', () => {\n          if (!$ctrl.billingMethod) { // initialize billingMethod\n            $ctrl.billingMethod = $ctrl.types[$ctrl.type].optsBillingMethod.find(i => i.id === $ctrl.user.billingMethod);\n            $ctrl.billingMethod = $ctrl.billingMethod || $ctrl.types[$ctrl.type].optsBillingMethod[0];\n          }\n\n          $ctrl.processPaymentMethods();\n\n          if ($ctrl.billingMethod.paymentMethodKey) { // initialize paymentMethodId according to billingMethod\n            $ctrl.payment.receivedAt = moment(); // real payments only today\n            if ($ctrl.user.billingMethod === $ctrl.billingMethod.id && $ctrl.optsPaymentMethod.find(o => o.id === $ctrl.user.paymentMethodId)) {\n              $ctrl.payment.paymentMethodId = $ctrl.user.paymentMethodId;\n            } else {\n              if ($ctrl.paymentMethods ? $ctrl.paymentMethods.length === 1 : $ctrl.user[$ctrl.billingMethod.paymentMethodKey].length === 1) { // if one method only, select it\n                $ctrl.payment.paymentMethodId = $ctrl.paymentMethods ? $ctrl.paymentMethods[0].id : $ctrl.user[$ctrl.billingMethod.paymentMethodKey][0].id;\n              }\n              else {\n                delete $ctrl.payment.paymentMethodId;\n              }\n            }\n          } else {\n            delete $ctrl.payment.paymentMethodId;\n          }\n        });\n\n        $scope.$watch('$ctrl.payment.paymentMethodId', paymentMethodId => {\n          if (paymentMethodId && $ctrl.optsPaymentMethod) {\n            const method = $ctrl.optsPaymentMethod.find(o => o.id === paymentMethodId);\n            if (method && method.amount) {\n              $ctrl.payment.amount = method.amount;\n            }\n          }\n        });\n      }\n    };\n\n    $ctrl.processPaymentMethods = () => {\n      if (!$ctrl.billingMethod) { return; }\n      $ctrl.optsPaymentMethod = ($ctrl.paymentMethods || $ctrl.user[$ctrl.billingMethod.paymentMethodKey] || [])\n        .map(m => {\n          const result = { id: m.id };\n          if (m.number) {\n            result.name = m.number.replace('XXXX-XXXX-XXXX', '*');\n          }\n          if (m.bankRoutingNumber && m.bankAccountNumber) {\n            result.name = [m.bankRoutingNumber, m.bankAccountNumber].join(' / ');\n          }\n          if (m.amount) {\n            result.name += ` (${$filter('currency')(m.amount)})`;\n            result.amount = m.amount;\n          }\n          return result;\n        });\n    };\n\n    $ctrl.getMaxAmount = () => {\n      if (!$ctrl.optsPaymentMethod || !$ctrl.payment.paymentMethodId) {\n        return null;\n      }\n      const method = $ctrl.optsPaymentMethod.find(m => m.id === $ctrl.payment.paymentMethodId) || { amount: null };\n      return method.amount;\n    }\n\n    /**\n     * $onChanges\n     */\n    $ctrl.$onChanges = () => {\n      $ctrl.payment = $ctrl.payment || {};\n      if ($ctrl.defaultAmount) $ctrl.payment.amount = $ctrl.defaultAmount;\n      $ctrl.processPaymentMethods();\n    };\n\n    /**\n     * Create payment/deposit/discount/refund handler\n     */\n    $ctrl.createPayment = () => {\n      if (helper.pointFirstInvalid(`purchase-payment[type=${$ctrl.type}]`)) return;\n\n      if ($ctrl.types[$ctrl.type].optsBillingMethod) {\n        $ctrl.payment.billingMethod = $ctrl.billingMethod.id;\n      } else {\n        delete $ctrl.payment.billingMethod;\n        delete $ctrl.payment.paymentMethodId;\n      }\n\n      return $ctrl.types[$ctrl.type].submit(state.getCurrentCenterId(), state.getCurrentUserId(), $ctrl.purchaseId, $ctrl.payment)\n        .then(() => $ctrl.updateInvoice())\n        .then(() => {\n          $ctrl.payment.$$collapsed = true;\n          $ctrl.form.$setPristine();\n          if ($ctrl.type !== 'payment') {\n            $ctrl.payment.amount = null;\n          }\n        });\n    };\n\n    /**\n     * Add payment processing fee to amount\n     */\n    $ctrl.getAmountWithFee = () => {\n      const rate = $ctrl.settings.paymentProcessingRates[$ctrl.billingMethod && $ctrl.billingMethod.id];\n      if (!$ctrl.settings.enablePaymentProcessingCharges || !rate || !$ctrl.types[$ctrl.type].hasProcessingFee) return 0;\n      const fee = helper.round(rate * +$ctrl.payment.amount / 100);\n      return +$ctrl.payment.amount + fee;\n    };\n\n    /**\n     * Get submit/record button text\n     */\n    $ctrl.getSubmitText = () => {\n      const type = $ctrl.types[$ctrl.type];\n      const { paymentMethodKey, forceSubmit } = $ctrl.billingMethod || {};\n      return paymentMethodKey || forceSubmit ? type.btnSubmit : type.btnRecord\n    };\n  });\n","// Module\nvar code = \"<form name=\\\"$ctrl.form\\\" novalidate id=\\\"add-{{$ctrl.type}}\\\"> <ff-panel class=\\\"ff-bmargin\\\"> <ff-header><span translate=\\\"{{$ctrl.types[$ctrl.type].header}}\\\"></span></ff-header> <div class=\\\"ff-grid gutter-h-half\\\"> <label flex=\\\"{md: '0 0 50%'}\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 104px\\\"><span translate=\\\"PURCHASE.PAYMENT.POST_DATE\\\"></span></ff-label> <ff-static>{{$ctrl.postDate | date}}</ff-static> </label> <label flex=\\\"{md: '0 0 50%'}\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 104px\\\"><req translate=\\\"PURCHASE.PAYMENT.RECEIVED_DATE\\\"></req></ff-label> <ff-date name=\\\"receivedAt\\\" ff-model=\\\"$ctrl.payment.receivedAt\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'PURCHASE.PAYMENT.RECEIVED_DATE' | translate}}\\\" ff-disabled=\\\"$ctrl.billingMethod.id === 'cc' || $ctrl.billingMethod.paymentMethodKey\\\"></ff-date> </label> <label flex=\\\"{md: '0 0 50%'}\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 104px\\\"><req translate=\\\"PURCHASE.PAYMENT.AMOUNT\\\"></req></ff-label> <ff-price flex=\\\"0 0 70px\\\" name=\\\"amount\\\" ff-model=\\\"$ctrl.payment.amount\\\" ff-required=\\\"true\\\" ff-gt=\\\"0\\\" ff-lte=\\\"$ctrl.getMaxAmount()\\\" ff-validate-alert=\\\"{ field: ('PURCHASE.PAYMENT.AMOUNT' | translate), gt: ($ctrl.types[$ctrl.type].negativeAmount | translate) }\\\"></ff-price> <ff-label> <span ng-if=\\\"$ctrl.getAmountWithFee()\\\"> + {{$ctrl.settings.paymentProcessingRates[$ctrl.billingMethod.id]}}% <span translate=\\\"PURCHASE.PAYMENT_PROCESSING_FEE\\\"></span> = <strong>{{$ctrl.getAmountWithFee() | ncurrency}}</strong> </span> </ff-label> <discount-assignment-btn flex=\\\"none\\\" discount=\\\"$ctrl.payment\\\" ng-if=\\\"$ctrl.type === 'discount'\\\"></discount-assignment-btn> </label> <label flex=\\\"{md: '0 0 50%'}\\\" class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 104px\\\"><span translate=\\\"PURCHASE.PAYMENT.NOTES\\\"></span></ff-label> <ff-text name=\\\"notes\\\" ff-model=\\\"$ctrl.payment.notes\\\" ff-maxlength=\\\"256\\\"></ff-text> </label> <discount-assignment flex=\\\"{md: '0 0 50.05%'}\\\" purchase-id=\\\"$ctrl.purchaseId\\\" discount=\\\"$ctrl.payment\\\" class=\\\"animate-collapse\\\" ng-if=\\\"$ctrl.type === 'discount' && !$ctrl.payment.$$collapsed\\\"></discount-assignment> <div class=\\\"payment-submit\\\" flex=\\\"{md: '0 0 50%'}\\\"> <div class=\\\"ff-grid\\\"> <ff-btn flex=\\\"{sm: 'none'}\\\" sense=\\\"save\\\" size=\\\"sm\\\" type=\\\"submit\\\" ff-click=\\\"$ctrl.createPayment()\\\" ff-disabled=\\\"$ctrl.type !== 'payment' && $ctrl.type !== 'refund' && $ctrl.form.$pristine\\\"> <span translate=\\\"{{$ctrl.getSubmitText()}}\\\"></span> </ff-btn> <div class=\\\"ff-grid\\\" flex=\\\"1 1 315px\\\" ng-if=\\\"$ctrl.types[$ctrl.type].optsBillingMethod\\\"> <label flex=\\\"{sm: '1 0 185px'}\\\" class=\\\"ff-row\\\"> <span flex=\\\"none\\\" translate=\\\"PURCHASE.PAYMENT.USING\\\"></span> <ff-select flex=\\\"1 1 auto\\\" name=\\\"billingMethod\\\" ff-model=\\\"$ctrl.billingMethod\\\" ff-options=\\\"method.name for method in $ctrl.types[$ctrl.type].optsBillingMethod | filter: $ctrl.filterBillingMethods\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'BILLING_PROFILE.BILLING_METHOD' | translate}}\\\"></ff-select> </label> <ff-select flex=\\\"{sm: 'none'}\\\" name=\\\"paymentMethod\\\" ng-if=\\\"$ctrl.billingMethod.paymentMethodKey\\\" ff-model=\\\"$ctrl.payment.paymentMethodId\\\" style=\\\"min-width:72px\\\" ff-style=\\\"{'padding-right': '1.4rem'}\\\" ff-options=\\\"m.id as m.name for m in $ctrl.optsPaymentMethod\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'BILLING_PROFILE.PAYMENT_METHOD' | translate}}\\\"> </ff-select> </div> </div> </div> <div flex=\\\"{md: '0 0 50%'}\\\" class=\\\"payment-hint\\\" ng-if=\\\"$ctrl.types[$ctrl.type].hintSubmit || $ctrl.types[$ctrl.type].hintRecord\\\"> <ff-static> <span> <ff-icon sense=\\\"info\\\"></ff-icon> <span translate=\\\"{{$ctrl.types[$ctrl.type][$ctrl.billingMethod.id + 'Hint'] || $ctrl.types[$ctrl.type][$ctrl.billingMethod.paymentMethodKey || $ctrl.billingMethod.forceSubmit ? 'hintSubmit' : 'hintRecord']}}\\\"></span> </span> </ff-static> </div> </div> </ff-panel> </form> \";\n// Exports\nmodule.exports = code;","// extracted by extract-css-chunks-webpack-plugin","import niceTimeDirective from 'shared/nice-date-time/nice-time.directive';\n\n/**\n * recurringChargeAudit directive -\n */\nangular.module('deskworks.recurringChargeAudit', [\n  'deskworks.helper',\n  'deskworks.RecurringChargeAudit',\n  niceTimeDirective.name,\n])\n\n  .directive('recurringChargeAudit', function() {\n    const templateUrl = 'billing/recurring-billing/recurring-charge-audit.tpl.html';\n\n    return {\n      restrict: 'E',\n      scope: true,\n      templateUrl: templateUrl,\n      controller: 'RecurringChargeAuditCtrl as $ctrl',\n      bindToController: {\n        priceListProducts: '<',\n        reservationUnits: '<',\n        recurringChargeId: '<',\n      },\n    };\n  })\n\n  .controller('RecurringChargeAuditCtrl', function(state, dwAlerts, RecurringChargeAudit) {\n    const $ctrl = this;\n\n    $ctrl.$onInit = () => {\n      $ctrl.props = RecurringChargeAudit.getProps();\n      $ctrl.centerId = state.getCurrentCenterId();\n      $ctrl.userId = state.getCurrentUserId();\n      $ctrl.offset = 0;\n      $ctrl.limit = 20;\n      $ctrl.entries = [];\n      $ctrl.fetch();\n    };\n\n    /**\n     * Fetch\n     */\n    $ctrl.fetch = () => {\n      if ($ctrl.eof || $ctrl.fetching) return $ctrl.fetching;\n      $ctrl.fetching = RecurringChargeAudit.query($ctrl.centerId, $ctrl.userId, $ctrl.recurringChargeId, $ctrl.offset, $ctrl.limit)\n        .catch(err => dwAlerts.error(err, 'Failed to query audit log.'))\n        .finally(() => { $ctrl.fetching = null; })\n        .then(entries => {\n          $ctrl.entries = $ctrl.entries.concat(makeProps(entries));\n          $ctrl.offset += entries.length;\n          $ctrl.eof = entries.length < $ctrl.limit;\n        });\n    };\n\n    function makeProps(entries) {\n      entries.forEach(entry => {\n        if (entry.props) return;\n        entry.props = $ctrl.props\n          .filter(prop => entry[prop.id])\n          .map(prop => {\n            return {\n              name: prop.name,\n              old: prop.filter ? prop.filter(entry[prop.id].old, $ctrl) : entry[prop.id].old,\n              new: prop.filter ? prop.filter(entry[prop.id].new, $ctrl) : entry[prop.id].new,\n            };\n          });\n      });\n      return entries;\n    }\n  });\n","/**\n * RecurringChargeAudit service -\n */\nangular.module('deskworks.RecurringChargeAudit', [\n  'ngResource',\n  'datesDeserializer',\n  'deskworks.config',\n  'deskworks.billing.optsBillingFrequency',\n  'deskworks.billing.optsRecurringChargeStatus',\n  'deskworks.billing.optsNoticePeriod',\n  'deskworks.billing.optsDiscountType',\n  'deskworks.userProfile.optsMonthsOfDiscount',\n  'deskworks.billing.optsRecurringChargeTerminate',\n  'deskworks.billing.optsRenewalTerm',\n  'deskworks.billing.optsRenewalNoticePeriod',\n])\n\n  .factory('RecurringChargeAudit', function($resource, $q, $timeout, $filter, $rootScope, $translate,\n                                            deskworksConfig, helper, datesDeserializer,\n                                            optsBillingFrequency, optsRecurringChargeStatus, optsNoticePeriod,\n                                            optsDiscountType, optsMonthsOfDiscount, optsRecurringChargeTerminate,\n                                            optsRenewalTerm, optsRenewalNoticePeriod) { 'use strict';\n\n    const dateFilter = val => $filter('date')(val, 'mediumDate');\n\n    const getOptsFilter = (opts, name) => {\n      name = name || 'name';\n      if (angular.isString(opts)) { // from controller\n        return (val, $ctrl) => (helper.find($ctrl[opts], val) || {})[name] || '-';\n      } else { // from variable directly\n        return (val, $ctrl) => (helper.find(opts, val) || {})[name] || '-';\n      }\n    };\n\n    const props = [\n      { id: 'priceListProductId', _name: 'RECURRING_BILLING.GENERAL.PRODUCT', filter: getOptsFilter('priceListProducts', 'productName') },\n      { id: 'description', _name: 'RECURRING_BILLING.GENERAL.DESCRIPTION' },\n      { id: 'quantity', _name: 'RECURRING_BILLING.GENERAL.QUANTITY' },\n      { id: 'attachedReservationUnitId', _name: 'RECURRING_BILLING.GENERAL.ATTACHED_RES_UNIT', filter: getOptsFilter('reservationUnits') },\n      { id: 'passBalance', _name: 'RECURRING_BILLING.GENERAL.PASS_BALANCE' },\n      { id: 'invoiceSent', _name: 'RECURRING_BILLING.GENERAL.INVOICE_SENT', filter: val => $filter('yesno')(val)},\n\n      { id: 'lastBillDate', _name: 'RECURRING_BILLING.DATES.LAST_BILL_DATE', filter: dateFilter },\n      { id: 'nextBillDate', _name: 'RECURRING_BILLING.DATES.NEXT_BILL_DATE', filter: dateFilter },\n      { id: 'startDate', _name: 'RECURRING_BILLING.DATES.START_DATE', filter: dateFilter },\n\n      { id: 'noticeDate', _name: 'RECURRING_BILLING.DATES.NOTICE_DATE', filter: dateFilter },\n      { id: 'noticePeriod', _name: 'RECURRING_BILLING.DATES.NOTICE_PERIOD', filter: getOptsFilter(optsNoticePeriod) },\n      { id: 'terminate', _name: 'RECURRING_BILLING.DATES.TERMINATE',\n        filter: (val, $ctrl) => (helper.find(optsRecurringChargeTerminate, val) || {}).name || dateFilter(val) || '-',\n      },\n\n      { id: 'renewalDate', _name: 'RECURRING_BILLING.RENEWAL_DATE', filter: dateFilter },\n      { id: 'renewalTerm', _name: 'RECURRING_BILLING.RENEWAL_TERM', filter: getOptsFilter(optsRenewalTerm) },\n      { id: 'renewalNoticePeriod', _name: 'RECURRING_BILLING.RENEWAL_NOTICE_PERIOD', filter: getOptsFilter(optsRenewalNoticePeriod) },\n\n      { id: 'discountTypeId', _name: 'RECURRING_BILLING.DISCOUNT.TYPE', filter: getOptsFilter(optsDiscountType) },\n      { id: 'discountValue', _name: 'RECURRING_BILLING.DISCOUNT.VALUE' },\n      { id: 'discountTrialOccurrences', _name: 'RECURRING_BILLING.DISCOUNT.MONTHS', filter: getOptsFilter(optsMonthsOfDiscount) },\n      { id: 'discountStartDate', _name: 'RECURRING_BILLING.DISCOUNT.START_DATE', filter: dateFilter },\n\n      { id: 'status', _name: 'RECURRING_BILLING.STATUS_NOTES.STATUS', filter: getOptsFilter(optsRecurringChargeStatus) },\n      { id: 'notes', _name: 'RECURRING_BILLING.STATUS_NOTES.NOTES' },\n    ];\n\n    translate();\n    $rootScope.$on('$setTranslationsSuccess', translate);\n    function translate() { props.forEach(opt => { opt.name = $translate.instant(opt._name); }); }\n\n    const desDates = datesDeserializer([\n      'createdAt', 'lastBillDate.old', 'lastBillDate.new', 'nextBillDate.old', 'nextBillDate.new',\n      'startDate.old', 'startDate.new', 'noticeDate.old', 'noticeDate.new', 'renewalDate.old', 'renewalDate.new',\n      'discountStartDate.old', 'discountStartDate.new', 'terminate.old', 'terminate.new',\n    ]);\n\n    const res = $resource(deskworksConfig.getApiAbsUrl('/centers/:centerId/user-profiles/:userId/recurring-charges/:recurringId/audit'), {}, {\n      query: { method: 'GET', isArray: true, transformResponse: [angular.fromJson, desDates] },\n    });\n\n    return {\n      /**\n       * Get Recurring Charge changes log\n       */\n      query: (centerId, userId, recurringId, offset, limit) =>\n        res.query({ centerId: centerId, userId: userId, recurringId: recurringId, offset: offset, limit: limit }).$promise,\n\n      getProps: () => props,\n    };\n  });\n","// Module\nvar code = \"<ff-panel style=\\\"margin:1.5rem 0\\\"> <ff-panel-header><span translate=\\\"RECURRING_BILLING.AUDIT.HEADER\\\"></span></ff-panel-header> <div ng-if=\\\"!$ctrl.entries.length && !$ctrl.fetching\\\" class=\\\"animate-collapse\\\"> <span translate=\\\"GLOBAL.NONE\\\"></span> </div> <ff-header ng-if=\\\"$ctrl.entries.length\\\" class=\\\"animate-collapse\\\"> <ff-row> <cell><span translate=\\\"RECURRING_BILLING.AUDIT.PROPERTY\\\"></span></cell> <cell><span translate=\\\"RECURRING_BILLING.AUDIT.OLD_VALUE\\\"></span></cell> <cell><span translate=\\\"RECURRING_BILLING.AUDIT.NEW_VALUE\\\"></span></cell> </ff-row> </ff-header> <ff-col infinite-scroll=\\\"$ctrl.fetch()\\\" infinite-scroll-distance=\\\"2\\\" infinite-scroll-container=\\\"'.snap-content-scroller'\\\"> <div ng-repeat=\\\"entry in $ctrl.entries\\\" class=\\\"animate-collapse\\\"> <ff-row> <ff-label class=\\\"standout\\\"><span> {{entry.createdAt | date:'mediumDate'}} <span nice-time=\\\"entry.createdAt\\\"></span> by {{entry.createdBy}} </span></ff-label> </ff-row> <ff-row ng-repeat=\\\"prop in entry.props\\\"> <ff-static>{{prop.name}}</ff-static> <ff-static>{{prop.old | nd}}</ff-static> <ff-static>{{prop.new | nd}}</ff-static> </ff-row> </div> </ff-col> <ff-row ff-dim=\\\"true\\\" ng-if=\\\"$ctrl.fetching\\\" class=\\\"animate-collapse\\\"><ff-static></ff-static></ff-row> </ff-panel> \";\n// Exports\nmodule.exports = code;","import ReservationUnit from 'shared/services/inventory/reservation-unit.service';\n\nexport default angular.module('deskworks.billing.recurringCharge.edit', [\n  'deskworks.recurringCharge.service',\n  'deskworks.userProfile.service',\n  'deskworks.recurringCharge.service',\n  'deskworks.routeHelper',\n  'deskworks.recurringChargeAudit',\n  ReservationUnit.name,\n])\n\n  .config(function($routeProvider) {\n    $routeProvider.when('/recurring-charges/:recurringId/edit', {\n      templateUrl: 'billing/recurring-billing/recurring-edit.tpl.html',\n      controller: 'RecurringChargeEditCtrl as $ctrl',\n      label: 'Edit',\n      routeBranch: 'recurring-charges',\n      translations: ['recurring-billing'],\n      resolve: {\n        charge: function(dwAlerts, $route, recurringChargeService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => recurringChargeService.get(state.getCurrentCenterId(), state.getCurrentUserId(), $route.current.params.recurringId)\n              .catch(err => dwAlerts.error(err, 'Failed to get recurring charge.')));\n        },\n        charges: function(dwAlerts, $route, recurringChargeService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => recurringChargeService.query(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get recurring charge.')));\n        },\n        settings: function(dwAlerts, setupService, state, routeHelper) {\n          return routeHelper.auth()\n            .then(() => setupService.getSetupSettings(state.getCurrentCenterId())\n              .catch(err => dwAlerts.error(err, 'Failed to get setup settings.')));\n        },\n        user: function(dwAlerts, userProfileService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n        },\n        resUnits: function(dwAlerts, state, ReservationUnit) {\n          return ReservationUnit.query(state.getCurrentCenterId())\n            .catch(err => dwAlerts.error(err, 'Failed to query reservation units'));\n        },\n      },\n    });\n  })\n\n  .controller('RecurringChargeEditCtrl', function($scope, $route, $translate, dwAlerts, recurringChargeService,\n                                                  userProfileService, ReservationUnit, charge, charges, settings, user,\n                                                  state, helper, optsBillingFrequency, optsRecurringChargeStatus,\n                                                  optsNoticePeriod, optsDiscountType, optsMonthsOfDiscount,\n                                                  optsRecurringChargeTerminate, resUnits,\n                                                  optsRenewalTerm, optsRenewalNoticePeriod) {\n    const $ctrl = this;\n\n    $scope.backPath = '/recurring-charges';\n    $scope.$watch('state.getCurrentCenterId()', (nv, ov) => { if (nv !== ov) state.setPath($scope.backPath); });\n\n    state.setPageTitle($translate.instant('RECURRING_BILLING.PAGE_TITLE', { userName: user.fullNameCompany }));\n\n    $ctrl.charge = charge;\n    $ctrl.initialStatus = $ctrl.charge.status;\n    $ctrl.charge.startDate = $ctrl.charge.startDate || $ctrl.charge.entryDate;\n\n    $ctrl.billingFrequencyProducts = {};\n    $ctrl.billingFrequencies = optsBillingFrequency;\n    $ctrl.noticePeriods = optsNoticePeriod;\n    $ctrl.discountTypes = optsDiscountType;\n    $ctrl.discountTrialOccurrences = optsMonthsOfDiscount;\n    $ctrl.optsTerminate = optsRecurringChargeTerminate;\n    $ctrl.optsRenewalTerm = optsRenewalTerm;\n    $ctrl.optsRenewalNoticePeriod = optsRenewalNoticePeriod;\n\n    $ctrl.chargeStatuses = optsRecurringChargeStatus\n      .filter(status => status.id !== 'deleted' || !state.isLoggedRole('coordinator'));\n    if ($route.current.params.recurringId === 'new') $ctrl.chargeStatuses = optsRecurringChargeStatus.slice(0, 1);\n\n    // Sort priceListProducts by billingFrequency\n    charge.options.priceListProducts.forEach(priceListProduct => {\n      const billingFrequency = helper.find($ctrl.billingFrequencies, priceListProduct.billingFrequency);\n      if (billingFrequency) {\n        $ctrl.billingFrequencyProducts[billingFrequency.id] = $ctrl.billingFrequencyProducts[billingFrequency.id] || [];\n        $ctrl.billingFrequencyProducts[billingFrequency.id].push(priceListProduct);\n      }\n    });\n\n    $ctrl.reservationUnits = resUnits.filter(resUnit => !resUnit.attachedUserId || resUnit.id == $ctrl.charge.attachedReservationUnitId);\n\n    $ctrl.activeChargesCount = charges.filter(c => c.status.id === 'active').length;\n\n    /**\n     * Billing Frequency change handler, inits Recurring Item\n     */\n    $ctrl.billingFrequencyChange = function() {\n      if ($ctrl.charge.billingFrequency && $ctrl.billingFrequencyProducts[$ctrl.charge.billingFrequency.id]) {\n        $ctrl.charge.priceListProduct = helper.find($ctrl.billingFrequencyProducts[$ctrl.charge.billingFrequency.id], $ctrl.charge.priceListProductId);\n      }\n\n      $ctrl.charge.terminate = $ctrl.charge.billingFrequency.id === 'asNeeded' ? optsRecurringChargeTerminate[0] : '';\n\n      // calculate nextBillDate as lastBillDate + billingFrequency.months size\n      if ($ctrl.charge.billingFrequency.months && moment.isMoment($ctrl.charge.lastBillDate)) {\n        $ctrl.charge.nextBillDate = $ctrl.charge.lastBillDate.clone().add($ctrl.charge.billingFrequency.months, 'M');\n        if (settings.prorateAtStart && $ctrl.charge.billingFrequency.id === 'monthly') {\n          $ctrl.charge.nextBillDate.date(1); // shift next bill date to first day of month if pro-ration at start is enabled\n        }\n      }\n    };\n    if (!$ctrl.charge.id) $ctrl.billingFrequencyChange(); // run it on init of new charge\n\n    /**\n     * Delete checkboxes' values in Status/Notes section if selected option changes from 'Deleted' or 'Inactive' to 'Active'\n     */\n    $ctrl.onChangeStatus = () => {\n      if ($ctrl.initialStatus.id !== 'active') return;\n      if ($ctrl.charge.status.id === 'active') {\n        if (typeof $ctrl.charge.makeMemberInactive === 'boolean') delete $ctrl.charge.makeMemberInactive;\n        if (typeof $ctrl.charge.makeCoMembersInactive === 'boolean') delete $ctrl.charge.makeCoMembersInactive;\n      }\n    };\n\n    /**\n     * Calculate Termination Date\n     */\n    $ctrl.calcTerminationDate = function() {\n      if ($ctrl.charge.billingFrequency.id !== 'asNeeded' && $ctrl.charge.noticeDate && $ctrl.charge.noticePeriod) {\n        $ctrl.charge.terminate = $ctrl.charge.noticeDate.clone().add($ctrl.charge.noticePeriod.id, 'd');\n      }\n    };\n\n    /**\n     * Is NextBillDate disabled\n     */\n    $ctrl.isNextBillDateDisabled = function() {\n      return $ctrl.charge.nextBillDate === null && moment.isMoment($ctrl.charge.terminate) ||\n        (moment.isMoment($ctrl.charge.terminate) && moment.isMoment($ctrl.charge.nextBillDate) &&\n          $ctrl.charge.terminate.isSameOrBefore($ctrl.charge.nextBillDate, 'date'));\n    };\n\n    /**\n     * Back handler\n     */\n    $ctrl.backToList = function() {\n      return state.setPath('/recurring-charges');\n    };\n\n    /**\n     * Save Charge handler\n     */\n    $ctrl.saveCharge = function(refill) {\n      if (helper.pointFirstInvalid('#recurringCharge')) return;\n\n      const data = {\n        description: $ctrl.charge.description,\n        priceListProductId: angular.isDefined($ctrl.charge.priceListProduct) ? $ctrl.charge.priceListProduct.id : null,\n        customPrice: $ctrl.charge.customPrice || $ctrl.charge.customPrice === 0 ? +$ctrl.charge.customPrice : null,\n        startDate: $ctrl.charge.startDate,\n        nextBillDate: $ctrl.isNextBillDateDisabled() ? null : $ctrl.charge.nextBillDate,\n        lastBillDate: $ctrl.charge.lastBillDate,\n        noticeDate: $ctrl.charge.noticeDate || null,\n        terminate: $ctrl.charge.billingFrequency.id === 'asNeeded' ? $ctrl.charge.terminate.id : $ctrl.charge.terminate || null,\n        quantity: $ctrl.charge.quantity,\n        noticePeriod: $ctrl.charge.noticePeriod && $ctrl.charge.noticePeriod.id,\n        status: angular.isDefined($ctrl.charge.status) ? $ctrl.charge.status.id : undefined,\n        notes: $ctrl.charge.notes,\n        attachedReservationUnitId: $ctrl.charge.attachedReservationUnitId ? +$ctrl.charge.attachedReservationUnitId : null,\n      };\n\n      if (settings.enableRenewalNotices) {\n        data.renewalDate = $ctrl.charge.renewalDate;\n        data.renewalTerm = $ctrl.charge.renewalTerm;\n        data.renewalNoticePeriod = $ctrl.charge.renewalNoticePeriod;\n      }\n\n      if ($ctrl.charge.discountType.id) {\n        data.discountTypeId = $ctrl.charge.discountType.id;\n        data.discountValue = $ctrl.charge.discountValue;\n        if ($ctrl.charge.discountTrialOccurrences) {\n          data.discountTrialOccurrences = $ctrl.charge.discountTrialOccurrences.id;\n        }\n        data.discountStartDate = $ctrl.charge.discountStartDate;\n      } else {\n        data.discountTypeId = 0;\n      }\n\n      if ($ctrl.charge.billingFrequency.id === 'asNeeded') {\n        data.passBalance = +$ctrl.charge.passBalance;\n        data.refill = refill;\n      }\n\n      // Add checkboxes' values from Status/Notes section\n      if (typeof $ctrl.charge.makeMemberInactive === 'boolean') data.makeMemberInactive = $ctrl.charge.makeMemberInactive;\n      if (typeof $ctrl.charge.makeCoMembersInactive === 'boolean') data.makeCoMembersInactive = $ctrl.charge.makeCoMembersInactive;\n\n      let promise;\n      if ($route.current.params.recurringId === 'new') {\n        data.postProration = !!$ctrl.charge.postProration;\n        promise = recurringChargeService.createCharge(state.getCurrentCenterId(), state.getCurrentUserId(), data);\n      } else {\n        promise = recurringChargeService.updateCharge(state.getCurrentCenterId(), state.getCurrentUserId(), $route.current.params.recurringId, data);\n      }\n\n      return promise\n        .then(function() {\n          if ($ctrl.charge.makeMemberInactive) userProfileService.resetCache();\n\n          if (refill) {\n            $route.reload();\n          } else {\n            return state.setPath('/recurring-charges');\n          }\n        })\n        .catch(err => dwAlerts.error(err, 'Failed to save recurring charge.'));\n    };\n  });\n","// Module\nvar code = \"<form name=\\\"chargeForm\\\" class=\\\"recurring-charges\\\" id=\\\"recurringCharge\\\" ff-bulk-read-only> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <div class=\\\"ff-grid gutter-v gutter-h\\\"> <ff-panel flex=\\\"{md: '0 0 50%'}\\\"> <ff-panel-header><span translate=\\\"RECURRING_BILLING.GENERAL.HEADER\\\"></span></ff-panel-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><req translate=\\\"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY\\\"></req></ff-label> <ff-select ff-model=\\\"$ctrl.charge.billingFrequency\\\" ff-required=\\\"true\\\" name=\\\"billingFrequency\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.GENERAL.BILLING_FREQUENCY' | translate}}\\\" ff-options=\\\"freq.name for freq in $ctrl.billingFrequencies\\\" ff-change=\\\"$ctrl.billingFrequencyChange()\\\"> </ff-select> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><req translate=\\\"RECURRING_BILLING.GENERAL.PRODUCT\\\"></req></ff-label> <ff-select ff-model=\\\"$ctrl.charge.priceListProduct\\\" ff-required=\\\"true\\\" name=\\\"priceListProduct\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.GENERAL.PRODUCT' | translate}}\\\" ff-options=\\\"priceListProduct.productName for priceListProduct in $ctrl.billingFrequencyProducts[$ctrl.charge.billingFrequency.id]\\\"> </ff-select> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.GENERAL.CUSTOM_PRICE\\\"></span> <ff-hint hint-type=\\\"primary\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.CUSTOM_PRICE.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-number ff-model=\\\"$ctrl.charge.customPrice\\\" name=\\\"customPrice\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.GENERAL.CUSTOM_PRICE' | translate}}\\\"></ff-number> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.PRICE_LIST\\\"></span></ff-label> <ff-static>{{$ctrl.charge.priceListProduct.priceListName | nd}}</ff-static> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.DESCRIPTION\\\"></span></ff-label> <ff-text ff-model=\\\"$ctrl.charge.description\\\" name=\\\"description\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.GENERAL.DESCRIPTION' | translate}}\\\"></ff-text> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><req translate=\\\"RECURRING_BILLING.GENERAL.QUANTITY\\\"></req></ff-label> <ff-number name=\\\"quantity\\\" ff-model=\\\"$ctrl.charge.quantity\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.GENERAL.QUANTITY' | translate}}\\\"></ff-number> </label> <ff-row> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.INVOICE_SENT\\\"></span></ff-label> <ff-static ff-bind=\\\"::$ctrl.charge.invoiceSent | yesno\\\" name=\\\"invoiceSent\\\"></ff-static> </ff-row> <label class=\\\"ff-row\\\" ng-if=\\\"!$ctrl.charge.id && $resolve.settings.prorateAtStart && $ctrl.charge.billingFrequency.id === 'monthly'\\\"> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.POST_PRO_RATION\\\"></span></ff-label> <ff-label> <ff-checkbox name=\\\"postProration\\\" ff-model=\\\"$ctrl.charge.postProration\\\"></ff-checkbox> </ff-label> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.GENERAL.ATTACHED_RES_UNIT\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.GENERAL.ATTACHED_RES_UNIT.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-select ff-model=\\\"$ctrl.charge.attachedReservationUnitId\\\" name=\\\"attachedReservationUnit\\\"> <option translate=\\\"GLOBAL.NONE\\\"></option> <option ng-repeat=\\\"resUnit in $ctrl.reservationUnits\\\" ng-value=\\\"resUnit.id\\\">{{resUnit.name}}</option> </ff-select> </label> <ff-row ng-if=\\\"$ctrl.charge.billingFrequency.id === 'asNeeded'\\\"> <label flex=\\\"1 1 auto\\\"> <ff-label flex=\\\"0 0 126px\\\"><req translate=\\\"RECURRING_BILLING.DATES.PASS_BALANCE\\\"></req></ff-label> <ff-number flex=\\\"1 1 1%\\\" name=\\\"passBalance\\\" ff-model=\\\"$ctrl.charge.passBalance\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.PASS_BALANCE' | translate}}\\\"></ff-number> </label> <ff-btn-group flex=\\\"0 0 auto\\\" ng-if=\\\"$ctrl.charge.id\\\" style=\\\"z-index:3\\\"> <ff-btn sense=\\\"ok\\\" size=\\\"sm\\\" ff-click=\\\"$ctrl.saveCharge(true)\\\"> <span translate=\\\"RECURRING_BILLING.DATES.BTN_REFILL\\\"></span> </ff-btn> </ff-btn-group> </ff-row> </ff-panel> <ff-panel flex=\\\"{md: '0 0 50%'}\\\"> <ff-panel-header><span translate=\\\"RECURRING_BILLING.DATES.HEADER\\\"></span></ff-panel-header> <ff-header><span translate=\\\"RECURRING_BILLING.DATES.BILLING_DATES\\\"></span></ff-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\" ff-required=\\\"true\\\"> <span translate=\\\"RECURRING_BILLING.DATES.LAST_BILL_DATE\\\"></span> </ff-label> <ff-date ff-model=\\\"$ctrl.charge.lastBillDate\\\" ff-required=\\\"true\\\" name=\\\"lastBillDate\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.LAST_BILL_DATE' | translate}}\\\"></ff-date> </label> <label class=\\\"ff-row\\\" ng-if=\\\"$ctrl.charge.billingFrequency.id !== 'asNeeded'\\\"> <ff-label flex=\\\"0 0 126px\\\" ff-required=\\\"{{!$ctrl.isNextBillDateDisabled()}}\\\" ng-disabled=\\\"$ctrl.isNextBillDateDisabled()\\\"> <span translate=\\\"RECURRING_BILLING.DATES.NEXT_BILL_DATE\\\"></span> </ff-label> <ff-date ff-model=\\\"$ctrl.charge.nextBillDate\\\" ff-required=\\\"true\\\" name=\\\"nextBillDate\\\" ng-if=\\\"!$ctrl.isNextBillDateDisabled()\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.NEXT_BILL_DATE' | translate}}\\\"></ff-date> <ff-static ff-disabled=\\\"true\\\" ng-if=\\\"$ctrl.isNextBillDateDisabled()\\\">-</ff-static> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.DATES.ENTRY_DATE\\\"></span></ff-label> <ff-static name=\\\"entryDate\\\" ff-bind=\\\"$ctrl.charge.entryDate | date:'mediumDate'\\\"></ff-static> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <req translate=\\\"RECURRING_BILLING.DATES.START_DATE\\\"></req> <ff-hint><span translate=\\\"RECURRING_BILLING.DATES.START_DATE.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-date name=\\\"startDate\\\" ff-model=\\\"$ctrl.charge.startDate\\\" ff-required=\\\"true\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.START_DATE' | translate}}\\\"></ff-date> </label> <ff-header style=\\\"padding-top:.5rem\\\"><span translate=\\\"RECURRING_BILLING.DATES.NOTICE_DATES\\\"></span></ff-header> <label class=\\\"ff-row\\\" ng-if=\\\"$ctrl.charge.billingFrequency.id !== 'asNeeded'\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.DATES.NOTICE_DATE\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.DATES.NOTICE_DATE.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-date ff-model=\\\"$ctrl.charge.noticeDate\\\" name=\\\"noticeDate\\\" ff-change=\\\"$ctrl.calcTerminationDate()\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.NOTICE_DATE' | translate}}\\\"></ff-date> </label> <label class=\\\"ff-row\\\" ng-if=\\\"$ctrl.charge.billingFrequency.id !== 'asNeeded'\\\" ng-show=\\\"$ctrl.charge.noticeDate\\\"> <ff-label flex=\\\"0 0 126px\\\"><small translate=\\\"RECURRING_BILLING.DATES.NOTICE_DATE.ADDED_BY\\\"></small></ff-label> <ff-static ff-bind=\\\"$ctrl.charge.noticeDateAddedBy || (state.getLoggedUser().firstName + ' ' + state.getLoggedUser().lastName)\\\"></ff-static> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.DATES.NOTICE_PERIOD\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.DATES.NOTICE_PERIOD.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-select name=\\\"noticePeriod\\\" ff-model=\\\"$ctrl.charge.noticePeriod\\\" ff-options=\\\"period.name for period in $ctrl.noticePeriods\\\" ff-change=\\\"$ctrl.calcTerminationDate()\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.NOTICE_PERIOD' | translate}}\\\"> </ff-select> </label> <label class=\\\"ff-row\\\" ng-if=\\\"$resolve.settings.enableRenewalNotices\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.DATES.NOTICE_REQUIRED_BY\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.DATES.NOTICE_REQUIRED_BY.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-static ng-if=\\\"$ctrl.charge.renewalDate && $ctrl.charge.noticePeriod\\\"> <span ng-bind=\\\"($ctrl.charge.renewalDate - $ctrl.charge.noticePeriod.id * 24 * 3600000) | date:'mediumDate'\\\"></span> </ff-static> <ff-static ng-if=\\\"!$ctrl.charge.renewalDate || !$ctrl.charge.noticePeriod\\\">-</ff-static> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.DATES.TERMINATE\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.DATES.TERMINATE.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-date name=\\\"terminate\\\" ff-model=\\\"$ctrl.charge.terminate\\\" ng-if=\\\"$ctrl.charge.billingFrequency.id !== 'asNeeded'\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.TERMINATE' | translate}}\\\"></ff-date> <ff-select name=\\\"terminate\\\" ff-model=\\\"$ctrl.charge.terminate\\\" ng-if=\\\"$ctrl.charge.billingFrequency.id === 'asNeeded'\\\" ff-options=\\\"opt.name for opt in $ctrl.optsTerminate\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DATES.TERMINATE' | translate}}\\\"></ff-select> </label> <div ng-if=\\\"$resolve.settings.enableRenewalNotices\\\"> <ff-header style=\\\"padding-top:.5rem\\\"><span translate=\\\"RECURRING_BILLING.DATES.RENEWAL_DATES\\\"></span></ff-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span translate=\\\"RECURRING_BILLING.RENEWAL_DATE\\\"></span> </ff-label> <ff-date name=\\\"renewalDate\\\" ff-model=\\\"$ctrl.charge.renewalDate\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.RENEWAL_DATE' | translate}}\\\"></ff-date> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span translate=\\\"RECURRING_BILLING.RENEWAL_TERM\\\"></span> </ff-label> <ff-select name=\\\"renewalTerm\\\" ff-model=\\\"$ctrl.charge.renewalTerm\\\" ff-required=\\\"true\\\" ff-options=\\\"opt.id as opt.name for opt in $ctrl.optsRenewalTerm\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.RENEWAL_TERM' | translate}}\\\"></ff-select> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <span translate=\\\"RECURRING_BILLING.RENEWAL_NOTICE_PERIOD\\\"></span> <ff-hint><span translate=\\\"RECURRING_BILLING.RENEWAL_NOTICE_PERIOD.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-select name=\\\"renewalNoticePeriod\\\" ff-model=\\\"$ctrl.charge.renewalNoticePeriod\\\" ff-options=\\\"opt.id as opt.name for opt in $ctrl.optsRenewalNoticePeriod\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.RENEWAL_NOTICE_PERIOD' | translate}}\\\"></ff-select> </label> </div> </ff-panel> <ff-panel flex=\\\"{md: '0 0 50%'}\\\"> <ff-panel-header><span translate=\\\"RECURRING_BILLING.DISCOUNT.HEADER\\\"></span></ff-panel-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"><span translate=\\\"RECURRING_BILLING.DISCOUNT.TYPE\\\"></span></ff-label> <ff-select ff-model=\\\"$ctrl.charge.discountType\\\" ff-required=\\\"true\\\" name=\\\"discountType\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DISCOUNT.TYPE' | translate}}\\\" ff-options=\\\"type.name for type in $ctrl.discountTypes\\\"> </ff-select> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\" ng-disabled=\\\"!$ctrl.charge.discountType.id\\\"> <req translate=\\\"RECURRING_BILLING.DISCOUNT.VALUE\\\"></req> </ff-label> <ff-text ff-model=\\\"$ctrl.charge.discountValue\\\" name=\\\"discountValue\\\" ff-required=\\\"$ctrl.charge.discountType.id\\\" ff-disabled=\\\"!$ctrl.charge.discountType.id\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DISCOUNT.VALUE' | translate}}\\\"></ff-text> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\" ng-disabled=\\\"!$ctrl.charge.discountType.id\\\"> <req translate=\\\"RECURRING_BILLING.DISCOUNT.MONTHS\\\"></req> </ff-label> <ff-select ff-model=\\\"$ctrl.charge.discountTrialOccurrences\\\" name=\\\"discountTrialOccurrences\\\" ff-required=\\\"$ctrl.charge.discountType.id\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DISCOUNT.MONTHS' | translate}}\\\" ff-options=\\\"trial.name for trial in $ctrl.discountTrialOccurrences\\\" ff-disabled=\\\"!$ctrl.charge.discountType.id\\\"> </ff-select> </label> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\" ng-disabled=\\\"!$ctrl.charge.discountType.id\\\"> <req translate=\\\"RECURRING_BILLING.DISCOUNT.START_DATE\\\"></req> </ff-label> <ff-date ff-model=\\\"$ctrl.charge.discountStartDate\\\" ff-required=\\\"$ctrl.charge.discountType.id\\\" name=\\\"discountStartDate\\\" ff-disabled=\\\"!$ctrl.charge.discountType.id\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.DISCOUNT.START_DATE' | translate}}\\\"></ff-date> </label> </ff-panel> <ff-panel flex=\\\"{md: '0 0 50%'}\\\"> <ff-panel-header><span translate=\\\"RECURRING_BILLING.STATUS_NOTES.HEADER\\\"></span></ff-panel-header> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"0 0 126px\\\"> <span> <req translate=\\\"RECURRING_BILLING.STATUS_NOTES.STATUS\\\"></req> <ff-hint ng-if=\\\"$ctrl.charge.status.id === 'active'\\\"> <span translate=\\\"RECURRING_BILLING.STATUS_NOTES.STATUS.HINT\\\"></span> </ff-hint> <ff-hint hint-type=\\\"warning\\\" ng-if=\\\"$ctrl.charge.existOutstandingUsages && ($ctrl.charge.status.id === 'deleted' || $ctrl.charge.status.id === 'inactive')\\\"> <span translate=\\\"RECURRING_BILLING.STATUS_NOTES.STATUS.WARNING\\\"></span> </ff-hint> </span> </ff-label> <ff-select ff-model=\\\"$ctrl.charge.status\\\" ff-required=\\\"true\\\" name=\\\"status\\\" ff-options=\\\"status.name for status in $ctrl.chargeStatuses\\\" ff-validate-alert=\\\"{{'RECURRING_BILLING.STATUS_NOTES.STATUS' | translate}}\\\" ff-change=\\\"$ctrl.onChangeStatus()\\\"> </ff-select> </label> <ff-static ng-if=\\\"$ctrl.activeChargesCount < 2 && $ctrl.initialStatus.id === 'active' && ($ctrl.charge.status.id === 'inactive' || $ctrl.charge.status.id === 'deleted')\\\"> <ff-col> <label> <ff-checkbox name=\\\"makeMemberInactive\\\" ff-model=\\\"$ctrl.charge.makeMemberInactive\\\"> <span translate=\\\"RECURRING_BILLING.STATUS_NOTES.INACTIVATE_MEMBER\\\"></span> </ff-checkbox> </label> <label> <ff-checkbox name=\\\"makeCoMembersInactive\\\" ff-model=\\\"$ctrl.charge.makeCoMembersInactive\\\"> <span translate=\\\"RECURRING_BILLING.STATUS_NOTES.INACTIVATE_CO_MEMBERS\\\"></span> </ff-checkbox> </label> </ff-col> </ff-static> <label class=\\\"ff-row\\\"> <ff-label flex=\\\"{xs: '0 0 60px', lg: '0 0 126px'}\\\"> <span translate=\\\"RECURRING_BILLING.STATUS_NOTES.NOTES\\\" class=\\\"ff-flex-start\\\" style=\\\"padding-top:.5rem\\\"></span> </ff-label> <ff-textarea ff-model=\\\"$ctrl.charge.notes\\\" name=\\\"notes\\\" rowspan=\\\"3\\\"></ff-textarea> </label> </ff-panel> <ff-btn-group> <ff-btn sense=\\\"save\\\" ff-click=\\\"$ctrl.saveCharge()\\\" ff-disabled=\\\"chargeForm.$pristine\\\"> <span translate=\\\"GLOBAL.BTN_SAVE\\\"></span> </ff-btn> <ff-btn sense=\\\"back\\\" ff-click=\\\"$ctrl.backToList()\\\"><span translate=\\\"GLOBAL.BTN_BACK\\\"></span></ff-btn> <ff-btn sense=\\\"collapseBtn\\\" ng-if=\\\"$ctrl.charge.id\\\" ff-click=\\\"$ctrl.showAudit = !$ctrl.showAudit\\\" ng-class=\\\"{ collapsed: !$ctrl.showAudit }\\\"> <span translate=\\\"GLOBAL.BTN_AUDIT\\\"></span> </ff-btn> </ff-btn-group> </div> </form> <div ng-if=\\\"$ctrl.showAudit\\\" class=\\\"animate-collapse\\\"> <recurring-charge-audit price-list-products=\\\"$ctrl.charge.options.priceListProducts\\\" recurring-charge-id=\\\"$ctrl.charge.id\\\" reservation-units=\\\"$resolve.resUnits\\\"></recurring-charge-audit> </div> \";\n// Exports\nmodule.exports = code;","angular.module('deskworks.billing.recurringCharge.list', [\n  'deskworks.recurringCharge.service',\n])\n  .config(function($routeProvider) { 'use strict';\n    $routeProvider.when('/recurring-charges', {\n      templateUrl: 'billing/recurring-billing/recurring-list.tpl.html',\n      controller: 'RecurringChargeListCtrl as $ctrl',\n      label: 'Recurring Billing',\n      routeBranch: 'recurring-charges',\n      translations: ['recurring-billing'],\n      resolve: {\n        charges: function(dwAlerts, recurringChargeService, state, routeHelper) {\n          return routeHelper.auth().then(function() {\n            return routeHelper.selectUser().then(function() {\n              return recurringChargeService.query(state.getCurrentCenterId(), state.getCurrentUserId())\n                .catch(function(err) { return dwAlerts.error(err, 'Failed to query recurring charges.'); });\n            });\n          });\n        },\n        user: function(dwAlerts, userProfileService, state, routeHelper, resolveTimezone) {\n          return routeHelper.auth()\n            .then(() => routeHelper.selectUser())\n            .then(() => resolveTimezone())\n            .then(() => userProfileService.get(state.getCurrentCenterId(), state.getCurrentUserId())\n              .catch(err => dwAlerts.error(err, 'Failed to get user profile.')));\n        },\n      }\n    });\n  })\n\n  .controller('RecurringChargeListCtrl', function($scope, $translate, dwAlerts, recurringChargeService,\n                                                  user, charges, state, helper) { 'use strict';\n    const $ctrl = this;\n    $ctrl.charges = charges;\n\n    state.setPageTitle($translate.instant('RECURRING_BILLING.LIST.PAGE_TITLE', { userName: user.fullNameCompany }));\n\n    /**\n     * New Charge button handler\n     */\n    $ctrl.new = () => state.setPath('/recurring-charges/new/edit');\n\n    /**\n     * Edit Charge button handler\n     */\n    $ctrl.edit = charge => state.setPath('/recurring-charges/' + charge.id + '/edit');\n\n    /**\n     * Saves 'Use for Check-In Billing' status\n     */\n    $ctrl.saveUseForCheckInBilling = function(charge) {\n      $ctrl.charges.forEach(ch => { // reset other checkboxes\n        if (ch.useForCheckInBilling && ch !== charge) ch.useForCheckInBilling = false;\n      });\n      charge.$spin = true;\n      recurringChargeService.setUseForCheckInBilling(state.getCurrentCenterId(), state.getCurrentUserId(), charge.id)\n        .catch(err => dwAlerts.error(err, 'Failed to set \"Use for Check-In Billing\".'))\n        .finally(() => { charge.$spin = false; });\n    };\n  });\n","// Module\nvar code = \"<div class=\\\"recurring-charges\\\" ff-bulk-read-only> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <ff-panel> <ff-header> <ff-row> <cell><span translate=\\\"RECURRING_BILLING.LIST.PRODUCT\\\"></span></cell> <cell flex=\\\"0 0 25%\\\"><span translate=\\\"RECURRING_BILLING.GENERAL.DESCRIPTION\\\"></span></cell> <cell flex=\\\"0 0 17%\\\" class=\\\"ff-right\\\"><span translate=\\\"RECURRING_BILLING.LIST.NEXT_BILLED\\\"></span></cell> <cell flex=\\\"0 0 17%\\\" class=\\\"ff-center\\\"><span translate=\\\"RECURRING_BILLING.LIST.STATUS\\\"></span></cell> <cell flex=\\\"{xs: '0 0 90px', sm: '0 0 120px'}\\\" class=\\\"ff-center\\\"><span translate=\\\"RECURRING_BILLING.LIST.USE_FOR_CHECK_IN_BILLING\\\"></span></cell> <ff-btn-group flex=\\\"0 0 auto\\\" class=\\\"buttons-row zero-height\\\"> <ff-btn sense=\\\"edit\\\" size=\\\"xs\\\"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-row ng-repeat=\\\"charge in $ctrl.charges\\\"> <ff-static ff-bind=\\\"::charge.productName\\\"></ff-static> <ff-static flex=\\\"0 0 25%\\\" ff-bind=\\\"::charge.description\\\"></ff-static> <ff-static flex=\\\"0 0 17%\\\" class=\\\"ff-right\\\" ff-bind=\\\"::charge.nextBilled | date:'mediumDate'\\\"></ff-static> <ff-static flex=\\\"0 0 17%\\\" class=\\\"ff-center\\\" ff-bind=\\\"::charge.status.name\\\"></ff-static> <ff-label flex=\\\"{xs: '0 0 90px', sm: '0 0 120px'}\\\" class=\\\"ff-center\\\" ff-dim=\\\"charge.$spin\\\"> <ff-checkbox ff-model=\\\"charge.useForCheckInBilling\\\" ff-value=\\\"true\\\" ff-change=\\\"$ctrl.saveUseForCheckInBilling(charge)\\\" ng-if=\\\"::charge.productHasPasses\\\"></ff-checkbox> <span ng-if=\\\"::!charge.productHasPasses\\\" translate=\\\"RECURRING_BILLING.LIST.NOT_AVAILABLE\\\"></span> </ff-label> <ff-btn-group flex=\\\"0 0 auto\\\" class=\\\"buttons-row\\\"> <ff-btn sense=\\\"edit\\\" size=\\\"xs\\\" ff-click=\\\"$ctrl.edit(charge)\\\" title=\\\"{{'GLOBAL.BTN_EDIT' | translate}}\\\"></ff-btn> </ff-btn-group> </ff-row> </ff-panel> <ff-btn-group class=\\\"buttons-bottom\\\"> <ff-btn sense=\\\"new\\\" ff-click=\\\"$ctrl.new()\\\"><span translate=\\\"RECURRING_BILLING.LIST.BTN_NEW\\\"></span></ff-btn> </ff-btn-group> </div> \";\n// Exports\nmodule.exports = code;"],"sourceRoot":""}