{"version":3,"sources":["webpack:///./assets/new-center-startup-workbook.xlsx","webpack:///./bundles/import sync .*\\.tpl\\.html$","webpack:///./bundles/import sync \\..+\\/.+\\.js$","webpack:///./bundles/import/handsontable/handsontable.directive.js","webpack:///./bundles/import/handsontable/handsontable.scss?885e","webpack:///./bundles/import/handsontable/ht-body-extra.directive.js","webpack:///./bundles/import/handsontable/ht-header-extra.directive.js","webpack:///./bundles/import/handsontable/ht-row-extra.directive.js","webpack:///./bundles/import/handsontable/import-handsontable.directive.js","webpack:///./bundles/import/handsontable/import-handsontable.scss?2200","webpack:///./bundles/import/handsontable/import-handsontable.tpl.html","webpack:///./bundles/import/index.js","webpack:///./bundles/import/services/auto-map-columns.service.js","webpack:///./bundles/import/services/collect-stats.service.js","webpack:///./bundles/import/services/detect-head-row-idx.service.js","webpack:///./bundles/import/services/detect-subgroups.service.js","webpack:///./bundles/import/services/excel.service.js","webpack:///./bundles/import/services/init-meta-data.service.js","webpack:///./bundles/import/services/parsers.service.js","webpack:///./bundles/import/services/purge.service.js","webpack:///./bundles/import/services/sheet-detector.service.js","webpack:///./bundles/import/services/srip-data-comments.service.js","webpack:///./bundles/import/services/validate-cell.service.js","webpack:///./bundles/import/services/validate-data.service.js","webpack:///./bundles/import/services/wire-data.service.js","webpack:///./bundles/import/step-components/import-dashboard.tpl.html","webpack:///./bundles/import/step-components/import-sheet-selector.tpl.html","webpack:///./bundles/import/step-components/step-complete.component.js","webpack:///./bundles/import/step-components/step-complete.tpl.html","webpack:///./bundles/import/step-components/step-import.component.js","webpack:///./bundles/import/step-components/step-import.tpl.html","webpack:///./bundles/import/step-components/step-init.component.js","webpack:///./bundles/import/step-components/step-init.tpl.html","webpack:///./bundles/import/step-fields/fields-members.service.js","webpack:///./bundles/import/step-fields/fields-membership-products.service.js","webpack:///./bundles/import/step-fields/fields-other-products.service.js","webpack:///./bundles/import/step-fields/fields-reservation-categories.service.js","webpack:///./bundles/import/step-fields/fields-reservation-units.service.js","webpack:///./bundles/import/step-hooks/hooks-members.service.js","webpack:///./bundles/import/step-hooks/hooks-membership-products.service.js","webpack:///./bundles/import/step-hooks/hooks-other-products.service.js","webpack:///./bundles/import/step-hooks/hooks-reservation-categories.service.js","webpack:///./bundles/import/step-hooks/hooks-reservation-units.service.js","webpack:///./bundles/import/wizard/import.controller.js","webpack:///./bundles/import/wizard/import.tpl.html","webpack:///./bundles/import/wizard/steps.service.js","webpack:///./shared/drag-n-drop/keese.service.js","webpack:///fs (ignored)","webpack:///crypto (ignored)","webpack:///stream (ignored)"],"names":["angular","module","directive","window","Handsontable","restrict","scope","controller","bindToController","data","renderer","manualColumnWidths","compile","link","$scope","$element","$attrs","ht","console","error","$watch","val","isArray","settings","instance","updateSettings","$broadcast","$on","destroy","$timeout","hti","document","getElementById","origAddEventListener","addEventListener","eventName","apply","arguments","rowHeaders","colHeaders","manualColumnResize","autoWrapRow","autoWrapCol","autoInsertRow","autoRowSize","autoColumnSize","allowInsertColumn","enterBeginsEditing","cells","contextMenu","afterSelectionEnd","row","col","$apply","$emit","afterDeselect","afterChange","$root","$$phase","afterRender","afterCreateRow","index","count","afterRemoveRow","init","self","getPlugin","afterUpdateSettings","recalculateAllRowsHeight","afterGetColHeader","th","setAttribute","afterGetRowHeader","$event","value","editor","getActiveEditor","_opened","setValue","focus","close","render","$compile","require","tElement","tAttrs","bodyExtraTpl","html","remove","htElem","parent","bodyExtraElement","replace","addClass","stopPropagation","extrasContainer","element","querySelector","append","repositionBodyExtra","erow","ecol","td","css","offsetTop","Math","floor","offsetLeft","offsetWidth","fields","availableFields","mapping","controllers","$ctrl","container","colIdx","options","name","field","id","unmappedFieldsLength","indexOf","length","ngInvalid","eventInterceptor","event","target","nodeName","className","select","parentNode","getAttribute","rowExtraTpl","rowExtraScopes","fm","$new","forEach","querySelectorAll","tt","style","display","extra","left","top","width","height","offsetHeight","destroyExtras","$destroy","templateUrl","step","sheet","onValidate","unMappedFields","$window","dwAlerts","helper","importStripDataComments","importDetectHeadRowIdx","importAutoMapColumns","mappedToStep","headRowIdx","rowsMeta","createRowsMeta","ignorePreHeaderRows","cellsMeta","Array","rowMeta","ignore","headRow","mappingFields","obj","start","mid","end","cellRenderer","rowIdx","prop","cellProperties","innerHTML","invalid","attr","onClickRowIcon","onSelectValidData","newVal","$row","$col","dupCount","reduce","sum","ri","text","confirm","$injector","importAll","r","js","loadNewModules","m","default","invoke","$templateCache","ctx","key","put","factory","columns","columnsPool","cell","mi","match","pattern","stats","create","update","existing","empty","rowRanks","rowRank","max","headRowRank","subgroups","subgroup","push","nonEmptyCount","prevSubgroup","subgroupKeyIndex","findIndexByKeyValue","isUndefined","service","$q","read","file","resolve","fileReader","FileReader","onload","e","sheets","workbook","XLSX","result","type","decoder","createElement","SheetNames","sheetName","Sheets","range","getTrimmedRange","rows","s","cols","ci","c","utils","encode_cell","w","readAsBinaryString","decode_range","cellTrimMax","rowTrimMax","cellTrim","isDefined","v","cellMeta","searchSoft","bool","int","parseInt","undefined","uint","float","parseFloat","currency","ufloat","date","format","moment","isValid","$resource","deskworksConfig","resGlobal","getApiAbsUrl","resCenter","purgeProducts","types","delete","entity","productTypes","$promise","purgePriceLists","centerId","purgeMembershipTypes","purgeReservationCategories","purgeReservationUnits","purgeMembers","importSteps","detect","sheetPattern","i","isObject","required","ref","refField","$eval","minLength","unique","equalCount","toLowerCase","msg","importValidateCell","invalidCount","fieldsSet","wireRow","rowObj","component","bindings","purge","state","navSidebar","preventDefault","setPath","hash","home","back","importSheetDetector","importInitMetaData","importDetectSubgroups","importWireData","importValidateData","importCollectStats","steps","when","hooks","then","validateData","import","promiseProducer","spin","importRow","catch","err","status","statusText","finally","pool","PromisePool","promise","preImport","excel","$onInit","xlsTemplateUrl","upload","$files","$invalidFiles","optsCountry","optsState","optsMembershipStatus","optsBillingMethod","optsRenewalTerm","optsRenewalNoticePeriod","subgroupKey","optsProductType","opt","optsWhoCanReserve","ReservationUnit","$filter","importParsers","productService","priceListService","membershipCategoryService","systemService","userProfileService","recurringChargeService","optsDiscountType","all","getProducts","products","product","getLeadSources","leadSources","query","activeMembers","inactiveMembers","activeCoMembers","inactiveCoMembers","nonMembers","users","getCurrentCenterId","members","getPricelists","priceLists","monthlyPriceList","getPricelist","resUnits","reservationUnits","billingMethods","countries","recurringProductIdx","user","firstName","lastName","company","login","password","passwordConfirmation","email","comments","leadSource","membershipStatus","billingMethod","recurringCharges","riOrig","rMeta","rData","rc","new","priceListProduct","rcProduct","productId","priceListId","nextBillDate","quantity","discountValue","discountType","discountTrialOccurrences","attachedReservationUnitId","membershipProduct","membershipType","membershipTypeId","membershipPriceList","address","street","city","country","zip","phone","number","printerCode","code","mailbox","accessCard","effectiveDate","save","reccurings","productName","promises","userId","createAccessCard","ownerIdx","fullName","isMember","recurringProduct","keese","ProductCategory","productsRental","getPriceLists","membershipCategories","copy","categories","productCategories","priceList","visibleForVisitors","useFor","found","membershipCategory","order","generate","note","productCategory","isCreditable","hasPasses","passProduct","showInSelfRegistration","productCategoryId","productNumber","description","monthlyItem","price","reservationCredit","passQty","savePriceItem","monthlyPriceItem","reservationCategoryService","reservationCategories","requiredPriceLists","plist","walkinPriceList","allowReservationCredits","passSize","reservationTypeId","walkingItem","priceItem","monthlyPrice","walkinPriceItem","walkinPrice","resCategory","ReservationRules","getMembershipProducts","productsMembership","resUnit","fullTimeProductId","reservationUnitId","rules","rule","uid","$localStorage","purgeService","importVersion","importStorage","localStorage","$ls","setPageTitle","importFieldsReservationCategories","importHooksReservationCategories","importFieldsReservationUnits","importHooksReservationUnits","importFieldsOtherProducts","importHooksOtherProducts","importFieldsMembershipProducts","importHooksMembershipProducts","importFieldsMembers","importHooksMembers","alphabet","radix","order_specifier","values","low","high","multi_keese","single_keese","average","increment","recurse","low_value","high_value","low_index","high_index","mid_index","mid_value","n","parse","digits","substr","order_length","add","Error","a","b","pad_to_equal_order","b_carry","max_digit_length","a_value","b_value","half_distance_value","half_distance_digits","j","half_distance","construct","result_digits","lastIndexOf","charAt","pad_in_place"],"mappings":";;;;;;;;;;AAAA;AAAe,oFAAuB,oFAAoF,E;;;;;;;;;;;ACA1H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uE;;;;;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uE;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACeA,sEAAO,CAACC,MAAR,CAAe,wBAAf,EAAyC,CACtD,sCADsD,EAEtD,mCAFsD,EAGtD,oCAHsD,CAAzC,EAMZC,SANY,CAMF,cANE,EAMc,YAAW;AAEpCC,QAAM,CAACC,YAAP,GAAsBA,mDAAtB;AAEA,SAAO;AACLC,YAAQ,EAAE,GADL;AAELC,SAAK,EAAE,IAFF;AAGLC,cAAU,EAAE,wBAHP;AAILC,oBAAgB,EAAE;AAChBC,UAAI,EAAE,SADU;AAEhBC,cAAQ,EAAE,aAFM;AAGhBC,wBAAkB,EAAE;AAHJ,KAJb;AAULC,WAAO,EAAE,mBAAM;AACb,aAAO,SAASC,IAAT,CAAcC,MAAd,EAAsBC,QAAtB,EAAgCC,MAAhC,EAAwCC,EAAxC,EAA4C;AACjD,YAAI,CAACd,MAAM,CAACC,YAAZ,EAA0B,OAAOc,OAAO,CAACC,KAAR,CAAc,sCAAd,CAAP,CADuB,CAGjD;;AAEA;AACV;AACA;;AACUL,cAAM,CAACM,MAAP,CAAc,SAAd,EAAyB,UAAAC,GAAG,EAAI;AAC9B,cAAI,CAACrB,OAAO,CAACsB,OAAR,CAAgBD,GAAhB,CAAD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","file":"import~._a.js?_rev=27c1596257c3d01cdeaf","sourcesContent":["export default __webpack_public_path__ + \"./assets/new-center-startup-workbook.xlsx?_rev=8c5caafdc20958c74eedc8dc5b3f74d7\";","var map = {\n\t\"./handsontable/import-handsontable.tpl.html\": \"./bundles/import/handsontable/import-handsontable.tpl.html\",\n\t\"./step-components/import-dashboard.tpl.html\": \"./bundles/import/step-components/import-dashboard.tpl.html\",\n\t\"./step-components/import-sheet-selector.tpl.html\": \"./bundles/import/step-components/import-sheet-selector.tpl.html\",\n\t\"./step-components/step-complete.tpl.html\": \"./bundles/import/step-components/step-complete.tpl.html\",\n\t\"./step-components/step-import.tpl.html\": \"./bundles/import/step-components/step-import.tpl.html\",\n\t\"./step-components/step-init.tpl.html\": \"./bundles/import/step-components/step-init.tpl.html\",\n\t\"./wizard/import.tpl.html\": \"./bundles/import/wizard/import.tpl.html\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./bundles/import sync recursive .*\\\\.tpl\\\\.html$\";","var map = {\n\t\"./handsontable/handsontable.directive.js\": \"./bundles/import/handsontable/handsontable.directive.js\",\n\t\"./handsontable/ht-body-extra.directive.js\": \"./bundles/import/handsontable/ht-body-extra.directive.js\",\n\t\"./handsontable/ht-header-extra.directive.js\": \"./bundles/import/handsontable/ht-header-extra.directive.js\",\n\t\"./handsontable/ht-row-extra.directive.js\": \"./bundles/import/handsontable/ht-row-extra.directive.js\",\n\t\"./handsontable/import-handsontable.directive.js\": \"./bundles/import/handsontable/import-handsontable.directive.js\",\n\t\"./services/auto-map-columns.service.js\": \"./bundles/import/services/auto-map-columns.service.js\",\n\t\"./services/collect-stats.service.js\": \"./bundles/import/services/collect-stats.service.js\",\n\t\"./services/detect-head-row-idx.service.js\": \"./bundles/import/services/detect-head-row-idx.service.js\",\n\t\"./services/detect-subgroups.service.js\": \"./bundles/import/services/detect-subgroups.service.js\",\n\t\"./services/excel.service.js\": \"./bundles/import/services/excel.service.js\",\n\t\"./services/init-meta-data.service.js\": \"./bundles/import/services/init-meta-data.service.js\",\n\t\"./services/parsers.service.js\": \"./bundles/import/services/parsers.service.js\",\n\t\"./services/purge.service.js\": \"./bundles/import/services/purge.service.js\",\n\t\"./services/sheet-detector.service.js\": \"./bundles/import/services/sheet-detector.service.js\",\n\t\"./services/srip-data-comments.service.js\": \"./bundles/import/services/srip-data-comments.service.js\",\n\t\"./services/validate-cell.service.js\": \"./bundles/import/services/validate-cell.service.js\",\n\t\"./services/validate-data.service.js\": \"./bundles/import/services/validate-data.service.js\",\n\t\"./services/wire-data.service.js\": \"./bundles/import/services/wire-data.service.js\",\n\t\"./step-components/step-complete.component.js\": \"./bundles/import/step-components/step-complete.component.js\",\n\t\"./step-components/step-import.component.js\": \"./bundles/import/step-components/step-import.component.js\",\n\t\"./step-components/step-init.component.js\": \"./bundles/import/step-components/step-init.component.js\",\n\t\"./step-fields/fields-members.service.js\": \"./bundles/import/step-fields/fields-members.service.js\",\n\t\"./step-fields/fields-membership-products.service.js\": \"./bundles/import/step-fields/fields-membership-products.service.js\",\n\t\"./step-fields/fields-other-products.service.js\": \"./bundles/import/step-fields/fields-other-products.service.js\",\n\t\"./step-fields/fields-reservation-categories.service.js\": \"./bundles/import/step-fields/fields-reservation-categories.service.js\",\n\t\"./step-fields/fields-reservation-units.service.js\": \"./bundles/import/step-fields/fields-reservation-units.service.js\",\n\t\"./step-hooks/hooks-members.service.js\": \"./bundles/import/step-hooks/hooks-members.service.js\",\n\t\"./step-hooks/hooks-membership-products.service.js\": \"./bundles/import/step-hooks/hooks-membership-products.service.js\",\n\t\"./step-hooks/hooks-other-products.service.js\": \"./bundles/import/step-hooks/hooks-other-products.service.js\",\n\t\"./step-hooks/hooks-reservation-categories.service.js\": \"./bundles/import/step-hooks/hooks-reservation-categories.service.js\",\n\t\"./step-hooks/hooks-reservation-units.service.js\": \"./bundles/import/step-hooks/hooks-reservation-units.service.js\",\n\t\"./wizard/import.controller.js\": \"./bundles/import/wizard/import.controller.js\",\n\t\"./wizard/steps.service.js\": \"./bundles/import/wizard/steps.service.js\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./bundles/import sync recursive \\\\..+\\\\/.+\\\\.js$\";","import Handsontable from 'handsontable';\nimport './handsontable.scss';\n\n/**\n * handsontable directive - wrapper for Handsontable component (Excel-like grid)\n *\n * Example of manual col-headers generation:\n    colHeaders: function(col) {\n      var charHi = Math.floor(col / 26);\n      var charLo = col % 26;\n      var code = charHi ? String.fromCharCode(65 + charHi - 1, 65 + charLo) : String.fromCharCode(65 + charLo);\n      return '<span ht-col=\"' + col + '\">' + code + '</span>';\n    }\n */\nexport default angular.module('deskworks.handsontable', [\n  'deskworks.handsontable.htHeaderExtra',\n  'deskworks.handsontable.htRowExtra',\n  'deskworks.handsontable.htBodyExtra',\n])\n\n  .directive('handsontable', function() {\n\n    window.Handsontable = Handsontable;\n\n    return {\n      restrict: 'E',\n      scope: true,\n      controller: 'HandsontableCtrl as ht',\n      bindToController: {\n        data: '<htData',\n        renderer: '<htRenderer',\n        manualColumnWidths: '<htManualColumnWidths',\n      },\n\n      compile: () => {\n        return function link($scope, $element, $attrs, ht) {\n          if (!window.Handsontable) return console.error('Handsontable component is not found.');\n\n          // ht.instance = new Handsontable($element[0], ht.settings);\n\n          /**\n           * Watch for handsontable data and update settings\n           */\n          $scope.$watch('ht.data', val => {\n            if (!angular.isArray(val) || !angular.isArray(val[0])) return;\n\n            ht.settings.data = val;\n\n            if (ht.instance) {\n              ht.instance.updateSettings(ht.settings);\n            } else {\n              ht.instance = new Handsontable($element[0], ht.settings);\n            }\n\n            $scope.$broadcast('ht:dataChange', ht.settings.data);\n          });\n\n          /**\n           * Destroy event handler\n           */\n          $scope.$on('$destroy', () => {\n            if (ht.instance) {\n              ht.instance.destroy();\n              delete ht.instance;\n            }\n          });\n        };\n      }\n    };\n  })\n\n  .controller('HandsontableCtrl', function($scope, $element, $attrs, $timeout) {\n    const ht = this;\n\n    // Hack for fixing vertical scrolling with cursor over handsontable\n    const hti = document.getElementById('htImport');\n    const origAddEventListener = hti.addEventListener;\n    hti.addEventListener = eventName => {\n      if (eventName === 'wheel') return; // don't allow to bind to wheel event as it breaks vertical scrolling\n      return origAddEventListener.apply(hti, arguments);\n    };\n\n    ht.settings = {\n      data: ht.data,\n      rowHeaders: true,\n      colHeaders: true,\n      manualColumnResize: true,\n      autoWrapRow: true,\n      autoWrapCol: true,\n      autoInsertRow: false,\n      autoRowSize: true,\n      autoColumnSize: true,\n      allowInsertColumn: false,\n      enterBeginsEditing: false,\n      // renderAllRows: true,\n      // viewportColumnRenderingOffset: 100, // prevent disappearing columns on horizontal scroll\n      cells: () => { return { renderer: ht.renderer }; },\n      contextMenu: ['row_above', 'row_below', 'remove_row'],\n\n      afterSelectionEnd: (row, col) => {\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterSelection', row, col);\n        });\n      },\n\n      afterDeselect: () => {\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterDeselect');\n        });\n      },\n\n      afterChange: () => {\n        // if($scope.$root.$$phase) return $scope.$emit('ht:afterChange');\n        if ($scope.$root.$$phase) return;\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterChange');\n        });\n      },\n\n      afterRender: () => {\n        // if($scope.$root.$$phase) return $scope.$emit('ht:afterRender');\n        if ($scope.$root.$$phase) return $timeout(() => { $scope.$emit('ht:afterRender'); });\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterRender');\n        });\n      },\n\n      afterCreateRow: (index, count) => {\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterCreateRow', index, count);\n        });\n      },\n\n      afterRemoveRow: (index, count) => {\n        $scope.$apply(() => {\n          $scope.$emit('ht:afterRemoveRow', index, count);\n        });\n      },\n\n      /**\n       * Init. Wires widths of manualColumnResize plugin to sheet\n       */\n      init: function() {\n        const self = this;\n        self.getPlugin('manualColumnResize').manualColumnWidths = ht.manualColumnWidths || [];\n      },\n\n      /**\n       * Re-init. Wires widths of manualColumnResize plugin to sheet and re-calculates row heights\n       */\n      afterUpdateSettings: function() {\n        const self = this;\n        self.getPlugin('manualColumnResize').manualColumnWidths = ht.manualColumnWidths || [];\n        self.getPlugin('autoRowSize').recalculateAllRowsHeight();\n      },\n\n      /**\n       * afterGetColHeader marks col-headers with its index to let col-extras know which col their bound to\n       */\n      afterGetColHeader: (col, th) => {\n        if (col >= 0) th.setAttribute('htcol', col);\n      },\n\n      /**\n       * afterGetRowHeader marks row-headers with its index to let row-extras know which row their bound to\n       */\n      afterGetRowHeader: (row, th) => {\n        if (row >= 0) th.setAttribute('htrow', row);\n      }\n    };\n\n    /**\n     * Commits value selected in cell extra drop-down to active editor\n     */\n    $scope.$on('ht:commitValue', ($event, value) => {\n      const editor = ht.instance.getActiveEditor();\n      if (editor && editor._opened) {\n        editor.setValue(value);\n        editor.focus();\n        editor.close();\n      }\n    });\n\n    /**\n     * Force rendering handsontable\n     */\n    $scope.$on('ht:render', () => {\n      if (ht.instance) ht.instance.render();\n    });\n  });\n","// extracted by extract-css-chunks-webpack-plugin","/**\n * Defines body cell extra for Handsontable. For example, tooltips.\n * Template code is compiled automatically and child scope auto-managed.\n */\nexport default angular.module('deskworks.handsontable.htBodyExtra', [])\n  .directive('htBodyExtra', function($compile) {\n    return {\n      restrict: 'E',\n      require: '^handsontable',\n\n      compile: (tElement, tAttrs) => {\n        const bodyExtraTpl = tElement.html(); // store ht-extra template\n        tElement.remove(); // remove itself from dom, the template is already stored\n\n        return function link($scope, $element, $attrs, ht) {\n          const htElem = $element.parent()[0]; // parent Handsontable element\n\n          if (!ht.bodyExtraElement) { // create extra body element\n            ht.bodyExtraElement = $compile(bodyExtraTpl.replace(/\\$row/g, 'ht.erow')\n              .replace(/\\$col/g, 'ht.ecol'))($scope)\n              .addClass('ht-body-extra');\n          }\n\n          /**\n           * Handsontable:afterRender event handler.\n           * Creates extras, shows/hides/positions them on rendered grid.\n           */\n          $scope.$on('ht:afterRender', $event => {\n            $event.stopPropagation();\n\n            const extrasContainer = angular.element(htElem.querySelector('.ht_master .wtSpreader'));\n\n            if (!extrasContainer[0].querySelector('.ht-body-extra')) {\n              extrasContainer.append(ht.bodyExtraElement);\n            }\n\n            ht.repositionBodyExtra();\n          });\n\n          /**\n           * Repositions body extra element according to ht.erow and ht.ecol\n           */\n          ht.repositionBodyExtra = () => {\n            if (ht.erow >= 0 && ht.ecol >= 0) {\n              const td = htElem.querySelector('td[rc=\"' + ht.erow + 'x' + ht.ecol + '\"]');\n              if (td) {\n                ht.bodyExtraElement.css('top', td.offsetTop + 'px');\n                ht.bodyExtraElement.css('left', Math.floor(td.offsetLeft + td.offsetWidth / 2) + 'px');\n              }\n            }\n          };\n\n          /**\n           * Handsontable:afterSelection event handler, watches for selected cell and repositions body extra element\n           */\n          $scope.$on('ht:afterSelection', ($event, row, col) => {\n            $event.stopPropagation();\n\n            ht.erow = row;\n            ht.ecol = col;\n\n            ht.repositionBodyExtra();\n          });\n\n          /**\n           * Handsontable:afterDeselect event handler, resets selected cell for body extra\n           */\n          $scope.$on('ht:afterDeselect', ($event, row, col) => {\n            $event.stopPropagation();\n\n            ht.erow = -1;\n            ht.ecol = -1;\n          });\n        };\n      }\n    };\n  });\n","import Handsontable from 'handsontable';\n\n/**\n * Defines column header extra for Handsontable. For example, tooltips.\n * Template code is compiled automatically and child scopes auto-managed.\n */\nexport default angular.module('deskworks.handsontable.htHeaderExtra', [])\n  .directive('htHeaderExtra', function($timeout) {\n    return {\n      scope: true,\n      restrict: 'E',\n      require: ['htHeaderExtra', '^handsontable'],\n      controller: function() {},\n      bindToController: {\n        fields: '<htFields',\n        availableFields: '<htAvailableFields',\n        mapping: '<htMapping',\n      },\n\n      compile: (tElement, tAttrs) => {\n        tElement.remove(); // remove itself from dom, the template is already stored\n\n        return function link($scope, $element, $attrs, controllers) {\n          const [$ctrl, ht] = controllers;\n          const container = $element.parent();\n\n          ht.settings.colHeaders = colIdx => {\n            const options = [{ name: 'UNKNOWN' }].concat($ctrl.availableFields[colIdx])\n              .map(field => `<option value=\"${field.id || ''}\" ${$ctrl.mapping[colIdx] === field.id ? 'selected' : ''}>${field.name}</option>`);\n\n            const unmappedFieldsLength = $ctrl.fields.filter(field => $ctrl.mapping.indexOf(field.id) < 0).length;\n            const ngInvalid = !$ctrl.mapping[colIdx] && !!unmappedFieldsLength ? 'ng-invalid' : '';\n\n            return `<select class=\"ht-mapping-select form-control ff-select ff-control ${ngInvalid}\">${options}</select>`;\n          };\n\n          $timeout(() => {\n            const eventInterceptor = container[0].querySelector('.ht_clone_top .htCore');\n\n            eventInterceptor.addEventListener('mousedown', event => {\n              if (event.target.nodeName !== 'SELECT' || event.target.className.indexOf('ht-mapping-select') < 0) return;\n              event.stopPropagation();\n            });\n\n            eventInterceptor.addEventListener('mouseup', event => {\n              if (event.target.nodeName !== 'SELECT' || event.target.className.indexOf('ht-mapping-select') < 0) return;\n              event.stopPropagation();\n            });\n\n            eventInterceptor.addEventListener('change', event => {\n              if (event.target.nodeName !== 'SELECT' || event.target.className.indexOf('ht-mapping-select') < 0) return;\n              event.stopPropagation();\n              $scope.$apply(() => {\n                const select = event.target;\n                const colIdx = +select.parentNode.parentNode.parentNode.getAttribute('htcol');\n                $ctrl.mapping[colIdx] = select.value;\n              });\n            });\n\n          });\n\n        };\n      },\n\n    };\n  });\n","/**\n * Defines row header extra for Handsontable. For example, tooltips.\n * Template code is compiled automatically and child scopes auto-managed.\n */\nexport default angular.module('deskworks.handsontable.htRowExtra', [])\n  .directive('htRowExtra', function($compile) {\n    return {\n      restrict: 'E',\n      require: '^handsontable',\n\n      compile: (tElement, tAttrs) => {\n        // Store ht-extra template\n        const rowExtraTpl = tElement.html();\n\n        // Remove itself from dom, the template is already stored\n        tElement.remove();\n\n        return function link($scope, $element, $attrs, ht) {\n          const htElem = $element.parent()[0]; // Parent Handsontable element\n\n          /**\n           * Handsontable:afterRender event handler.\n           * Creates extras, shows/hides/positions them on rendered grid.\n           */\n          $scope.$on('ht:afterRender', $event => {\n            //$event.stopPropagation();\n\n            const extrasContainer = angular.element(htElem.querySelector('.ht_clone_left .wtSpreader'));\n\n            // First rendering, create row extras\n            if (!ht.rowExtraScopes) {\n              if (angular.isArray(ht.settings.data) && angular.isArray(ht.settings.data[0])) {\n                ht.rowExtraScopes = ht.settings.data.map((fm, index) => {\n                  const scope = $scope.$new();\n                  extrasContainer.append($compile(rowExtraTpl.replace(/\\$row/g, index))(scope).addClass('ht-row-extra'));\n                  return scope;\n                });\n              }\n            }\n\n            // Hide all extras to show only necessary ones later\n            angular.forEach(extrasContainer[0].querySelectorAll('.ht-row-extra'), tt => {\n              tt.style.display = 'none';\n            });\n\n            // Show and position extras for rendered THs\n            angular.forEach(htElem.querySelectorAll('.ht_clone_left th[htrow]'), th => {\n              const extra = extrasContainer[0].querySelectorAll('.ht-row-extra')[th.getAttribute('htrow')];\n              extra.style.left = th.offsetLeft + 'px';\n              extra.style.top = th.offsetTop + 'px';\n              extra.style.width = th.offsetWidth + 'px';\n              extra.style.height = th.offsetHeight + 'px';\n              extra.style.display = '';\n            });\n          });\n\n          /**\n           * Destroys all extras to get new ones created on next rendering\n           */\n          function destroyExtras($event, data) {\n            const extrasContainer = htElem.querySelector('.ht_clone_left .wtSpreader');\n            if (ht.rowExtraScopes) {\n              angular.element(extrasContainer.querySelectorAll('.ht-row-extra')).remove();\n              angular.forEach(ht.rowExtraScopes, scope => {\n                scope.$destroy();\n              });\n              delete ht.rowExtraScopes;\n            }\n          }\n\n          $scope.$on('ht:afterCreateRow', destroyExtras);\n          $scope.$on('ht:afterRemoveRow', destroyExtras);\n          $scope.$on('ht:dataChange', destroyExtras);\n        };\n      }\n    };\n  });\n","import './import-handsontable.scss';\n\nexport default angular.module('deskworks.importHandsontable', [\n  'deskworks.helper',\n  'deskworks.dwAlerts',\n  'deskworks.importStripDataComments',\n  'deskworks.importDetectHeadRowIdx',\n  'deskworks.importAutoMapColumns',\n])\n\n  .directive('importHandsontable', function() {\n    return {\n      restrict: 'E',\n      scope: true,\n      templateUrl: 'handsontable/import-handsontable.tpl.html',\n      controller: 'ImportHandsontableCtrl as $ctrl',\n      bindToController: {\n        step: '<',\n        sheet: '<',\n        fields: '<',\n        onValidate: '&',\n        unMappedFields: '=',\n      },\n    };\n  })\n\n  .controller('ImportHandsontableCtrl', function($scope, $window, $timeout, dwAlerts, helper,\n                                                 importStripDataComments, importDetectHeadRowIdx,\n                                                 importAutoMapColumns) {\n    const $ctrl = this;\n\n    $scope.$watch('$ctrl.sheet', () => {\n      if (!$ctrl.sheet) return;\n\n      if (!$ctrl.sheet.mappedToStep) {\n        importStripDataComments($ctrl.sheet.data);\n        $ctrl.sheet.headRowIdx = importDetectHeadRowIdx($ctrl.sheet.data, $ctrl.fields);\n        $ctrl.sheet.mapping = importAutoMapColumns($ctrl.sheet.data, $ctrl.fields, $ctrl.sheet.headRowIdx);\n        if ($ctrl.sheet.headRowIdx >= 0) { // sheet auto-mapped successfully\n          $ctrl.sheet.mappedToStep = $ctrl.step;\n          $ctrl.sheet.rowsMeta = createRowsMeta($ctrl.sheet.data);\n          ignorePreHeaderRows($ctrl.sheet);\n        } else {\n          $ctrl.sheet.rowsMeta = $ctrl.sheet.rowsMeta || createRowsMeta($ctrl.sheet.data);\n        }\n      }\n\n      $timeout(() => { $scope.$broadcast('ht:render'); }); // workaround for partly rendered table vertically\n    });\n\n    function createRowsMeta(data) {\n      return data.map(row => {\n        return { cellsMeta: Array.apply(null, Array(row.length)).map(() => { return {}; }) };\n      });\n    }\n\n    function ignorePreHeaderRows(sheet) {\n      if (sheet.headRowIdx < 0) return sheet;\n      sheet.rowsMeta.slice(0, sheet.headRowIdx)\n        .forEach(rowMeta => {\n          rowMeta.ignore = true;\n        });\n      sheet.rowsMeta[sheet.headRowIdx].headRow = true;\n      return sheet;\n    }\n\n    $scope.$watch('$ctrl.sheet.mapping', mapping => {\n      if (!mapping) return;\n      $ctrl.unMappedFields = $ctrl.fields.filter(field => mapping.indexOf(field.id) < 0);\n      $ctrl.availableFields = mapping.map(id =>\n        $ctrl.fields.filter(field => field.id === id || mapping.indexOf(field.id) < 0)\n      );\n      $ctrl.mappingFields = mapping.map(id => $ctrl.fields.find(obj => obj.id === id));\n      $ctrl.onValidate();\n    }, true);\n\n    /**\n     * Handsontable:afterCreateRow handler, syncs sheet.rowsMeta to just changed sheet.data\n     */\n    $scope.$on('ht:afterCreateRow', ($event, index, count) => {\n      $event.stopPropagation();\n      if ($ctrl.sheet.headRowIdx >= index) $ctrl.sheet.headRowIdx += count; // shift sheet.headRowIdx\n\n      const start = $ctrl.sheet.rowsMeta.slice(0, index);\n      const mid = Array.apply(null, Array(count)).map(() => {\n        return { cellsMeta: Array.apply(null, Array($ctrl.sheet.data[0].length)).map(() => { return {}; }) };\n      });\n      const end = $ctrl.sheet.rowsMeta.slice(index);\n\n      $ctrl.sheet.rowsMeta = start.concat(mid).concat(end);\n      $ctrl.onValidate();\n    });\n\n    /**\n     * Handsontable:afterRemoveRow handler, syncs sheet.rowsMeta to just changed sheet.data\n     */\n    $scope.$on('ht:afterRemoveRow', ($event, index, count) => {\n      $event.stopPropagation();\n      if ($ctrl.sheet.headRowIdx >= index + count) $ctrl.sheet.headRowIdx -= count; // shift sheet.headRowIdx\n      else if ($ctrl.sheet.headRowIdx >= index) $ctrl.sheet.headRowIdx = -1;\n\n      $ctrl.sheet.rowsMeta.splice(index, count);\n      $ctrl.onValidate();\n    });\n\n    /**\n     * Handsontable:afterChange handler, re-validates data\n     */\n    $scope.$on('ht:afterChange', $event => {\n      $event.stopPropagation();\n      $ctrl.onValidate();\n    });\n\n    /**\n     * Custom cell renderer for Handsontable\n     */\n    $ctrl.cellRenderer = (instance, td, rowIdx, colIdx, prop, value, cellProperties) => {\n      td.innerHTML = value;\n      td = angular.element(td);\n\n      if (!$ctrl.sheet.rowsMeta || !$ctrl.sheet.rowsMeta[rowIdx] || !$ctrl.sheet.rowsMeta[rowIdx].cellsMeta || !$ctrl.sheet.rowsMeta[rowIdx].cellsMeta[colIdx]) return;\n\n      if ($ctrl.sheet.rowsMeta[rowIdx].cellsMeta[colIdx].invalid) {\n        td.addClass('ht-invalid');\n        td[0].innerHTML += '<span class=\"fa fa-exclamation-triangle\"></span>';\n      }\n\n      if ($ctrl.sheet.rowsMeta[rowIdx].headRow) td.addClass('ht-head-row');\n      if ($ctrl.sheet.rowsMeta[rowIdx].ignore) td.addClass('ht-ignore');\n\n      td.attr('rc', rowIdx + 'x' + colIdx); // mark each TD with its own coordinates\n\n      return td[0];\n    };\n\n    /**\n     * Row Icon click handler\n     */\n    $ctrl.onClickRowIcon = rowIdx => {\n      const rowMeta = $ctrl.sheet.rowsMeta[rowIdx];\n      if (rowMeta.headRow) return;\n\n      rowMeta.ignore = !rowMeta.ignore;\n\n      $ctrl.onValidate();\n    };\n\n    /**\n     * Select Valid Data select onChange event handler. Commits change, checks for smart replacement and runs validation.\n     */\n    $ctrl.onSelectValidData = (newVal, $row, $col) => {\n\n      const dupCount = $ctrl.sheet.data // detect smart replacement\n        .reduce((sum, row, ri) => {\n          return $ctrl.sheet.rowsMeta[ri].invalid && (row[$col] || '') === ($ctrl.sheet.data[$row][$col] || '') ? ++sum : sum;\n        }, 0);\n\n      if (dupCount > 1) { // confirm smart replacement\n        const field = $ctrl.fields.find(obj => obj.id === $ctrl.sheet.mapping[$col]);\n\n        const text = '\"' + field.name + '\" column contains more \"' + ($ctrl.sheet.data[$row][$col] || 'empty') +\n          '\" occurrences. Fix them all to \"' + newVal + '\" automatically?';\n\n        if (confirm(text)) {\n          for (var ri = 0; ri < $ctrl.sheet.data.length; ri++) {\n            if (ri !== $row && $ctrl.sheet.rowsMeta[ri].invalid && ($ctrl.sheet.data[ri][$col] || '') === ($ctrl.sheet.data[$row][$col] || '')) {\n              $ctrl.sheet.data[ri][$col] = newVal;\n            }\n          }\n        }\n      }\n\n      $ctrl.sheet.data[$row][$col] = newVal; // commit value\n      $scope.$broadcast('ht:commitValue', newVal);\n\n      $ctrl.onValidate();\n    };\n  });\n","// extracted by extract-css-chunks-webpack-plugin","// Module\nvar code = \"<handsontable id=\\\"htImport\\\" class=\\\"ht-import\\\" ht-data=\\\"$ctrl.sheet.data\\\" ht-rows-meta=\\\"$ctrl.sheet.rowsMeta\\\" ht-renderer=\\\"$ctrl.cellRenderer\\\" ht-manual-column-widths=\\\"$ctrl.sheet.manualColumnWidths\\\"> <ht-header-extra ht-fields=\\\"$ctrl.fields\\\" ht-available-fields=\\\"$ctrl.availableFields\\\" ht-mapping=\\\"$ctrl.sheet.mapping\\\"></ht-header-extra> <ht-row-extra> <div class=\\\"ht-row-extra\\\" ng-init=\\\"rowMeta = $ctrl.sheet.rowsMeta[$row]\\\" ng-show=\\\"!$ctrl.unMappedFields.length\\\"> <ff-icon sense=\\\"error\\\" ng-if=\\\"rowMeta.error && rowMeta.ignore\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" title=\\\"{{rowMeta.error}}\\\"> </ff-icon> <ff-icon sense=\\\"warning\\\" ng-if=\\\"rowMeta.invalid && !rowMeta.ignore\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" title=\\\"This row contains invalid values. Fix them or click this icon to ignore this row.\\\"></ff-icon> <ff-icon sense=\\\"check\\\" ng-if=\\\"rowMeta.id && !rowMeta.invalid && rowMeta.ignore && !rowMeta.error\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" title=\\\"Existing data, this row will not be imported.\\\"></ff-icon> <ff-icon sense=\\\"refresh\\\" ng-if=\\\"rowMeta.id && !rowMeta.invalid && !rowMeta.ignore\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" ng-class=\\\"{ rotate: rowMeta.spin }\\\" title=\\\"Existing data, this row will be updated.\\\"></ff-icon> <ff-icon sense=\\\"plus\\\" ng-if=\\\"!rowMeta.id && !rowMeta.ignore && !rowMeta.headRow && !rowMeta.empty && !rowMeta.invalid\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" ng-class=\\\"{ rotate: rowMeta.spin }\\\" title=\\\"This row is new and will be imported.\\\"></ff-icon> <ff-icon sense=\\\"ignore\\\" ng-if=\\\"!rowMeta.id && rowMeta.ignore && !rowMeta.error\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" title=\\\"This row is ignored. Click this icon to stop ignoring this row.\\\"></ff-icon> <ff-icon sense=\\\"header\\\" ng-if=\\\"rowMeta.headRow\\\" ng-click=\\\"$ctrl.onClickRowIcon($row)\\\" title=\\\"This row is recognized as header.\\\"></ff-icon> </div> </ht-row-extra> <ht-body-extra> <div class=\\\"itooltip ht-body-tooltip\\\" ng-show=\\\"$ctrl.sheet.rowsMeta[$row].cellsMeta[$col].invalid\\\"> <span ng-if=\\\"$ctrl.sheet.rowsMeta[$row].cellsMeta[$col].invalid | isString\\\" ng-bind-html=\\\"$ctrl.sheet.rowsMeta[$row].cellsMeta[$col].invalid\\\"></span> <ff-select ff-model=\\\"newVal\\\" ff-options=\\\"opt.name as opt.name for opt in $ctrl.sheet.rowsMeta[$row].cellsMeta[$col].invalid\\\" ff-change=\\\"$ctrl.onSelectValidData(newVal, $row, $col)\\\" ng-if=\\\"$ctrl.sheet.rowsMeta[$row].cellsMeta[$col].invalid | isArray\\\"> <option value=\\\"\\\">please select</option> </ff-select> </div> </ht-body-extra> </handsontable> \";\n// Exports\nmodule.exports = code;","const index = ['$injector', function index($injector) {\n  // JS\n  const importAll = r => r.keys().map(r);\n  const js = importAll(require.context('./', true, /\\..+\\/.+\\.js$/));\n  $injector.loadNewModules(js.map(m => m.default.name));\n\n  // Templates\n  $injector.invoke(['$templateCache', function($templateCache) {\n    const ctx = require.context('./', true, /.*\\.tpl\\.html$/);\n    ctx.keys().forEach(key => $templateCache.put(key.replace(/^\\.\\//, ''), ctx(key)));\n  }]);\n}];\n\nexport default index;\n","/**\n * Maps import columns to given 'array of arrays' presentation of Excel sheet\n */\nexport default angular.module('deskworks.importAutoMapColumns', [])\n\n  .factory('importAutoMapColumns', function(helper) {\n\n    return (data, columns, headRowIdx) => {\n      if (!angular.isArray(columns) || !angular.isArray(data)) return;\n      if (headRowIdx < 0) return Array.apply(null, Array(data[0].length)).map(() => null);\n\n      const columnsPool = columns.slice(); // shallow copy columns as we are going to delete mapped columns\n\n      return data[headRowIdx]\n        .map(cell => {\n          for (let mi = 0; mi < columnsPool.length; mi++) {\n            if (helper.trim(cell).match(columnsPool[mi].pattern)) {\n              return columnsPool.splice(mi, 1)[0].id; // remove matched column to prevent mapping twice\n            }\n          }\n        });\n    };\n\n  });\n","/**\n * Collect stats for rowsMeta\n */\nexport default angular.module('deskworks.importCollectStats', [])\n\n  .factory('importCollectStats', function() {\n    return function(rowsMeta) {\n      const stats = { create: 0, update: 0, existing: 0, ignore: 0, invalid: 0, error: 0 };\n\n      angular.forEach(rowsMeta, rowMeta => {\n        if (rowMeta.ignore && !rowMeta.headRow && !rowMeta.id) stats.ignore++;\n        if (!rowMeta.id && !rowMeta.ignore && !rowMeta.headRow && !rowMeta.empty && !rowMeta.invalid) stats.create++;\n        if (rowMeta.id && !rowMeta.ignore && !rowMeta.invalid) stats.update++;\n        if (rowMeta.id && rowMeta.ignore) stats.existing++;\n        if (rowMeta.invalid) stats.invalid++;\n        if (rowMeta.error && rowMeta.ignore) stats.error++;\n      });\n\n      return stats;\n    };\n  });\n","/**\n * Detects 'head row' index in given 'array of arrays' presentation of Excel sheet\n */\nexport default angular.module('deskworks.importDetectHeadRowIdx', [])\n\n  .factory('importDetectHeadRowIdx', function(helper) {\n\n    return (data, columns) => {\n      if (!angular.isArray(columns) || !angular.isArray(data)) return;\n\n      const columnsPool = columns.slice(); // shallow copy columns as we are going to delete mapped columns\n\n      const rowRanks = data.slice(0, 5) // first 5 rows\n        .map(row => {\n          let rowRank = 0;\n\n          row.forEach(cell => {\n            for (let mi = 0; mi < columnsPool.length; mi++) {\n              if (helper.trim(cell).match(columnsPool[mi].pattern)) {\n                columnsPool.splice(mi, 1); // remove matched column to prevent mapping twice\n                rowRank++;\n                break;\n              }\n            }\n          });\n\n          return rowRank;\n        });\n\n      const headRowIdx = rowRanks.indexOf(Math.max.apply(Math, rowRanks));\n      const headRowRank = rowRanks[headRowIdx];\n\n      // Accept headRow only if number of matches is at least 2/3 of total columns length\n      return headRowRank >= columns.length / 1.5 ? headRowIdx : -1;\n    };\n\n  });\n","/**\n * Detects subgroups in sheet data\n */\nexport default angular.module('deskworks.importDetectSubgroups', [\n  'deskworks.helper',\n])\n\n  .factory('importDetectSubgroups', function(helper) {\n    return ($ctrl, sheet, fields) => {\n\n      const subgroups = fields.reduce((subgroups, field) => { // collect subgroups\n        let subgroup = subgroups.find(obj => obj.id === (field.subgroup || 'nosubgroup'));\n        if (!subgroup) {\n          subgroup = { id: field.subgroup, fields: [] };\n          subgroups.push(subgroup);\n        }\n        subgroup.fields.push(field);\n        return subgroups;\n      }, [{ id: 'nosubgroup', fields: [] }]);\n\n      sheet.data // apply group to each row\n        .forEach((row, ri) => {\n          const rowMeta = sheet.rowsMeta[ri];\n          if (rowMeta.empty || rowMeta.headRow) return;\n\n          subgroups.forEach(subgroup => {\n            subgroup.nonEmptyCount = subgroup.fields.reduce((count, field) =>\n              helper.trim(row[sheet.mapping.indexOf(field.id)]) ? ++count : count, 0);\n          });\n\n          if (!subgroups[0].nonEmptyCount && subgroups.length > 1) { // subgroup\n            const subgroup = subgroups.slice(1, subgroups.length)\n              .reduce((prevSubgroup, subgroup) =>\n                !prevSubgroup || subgroup.nonEmptyCount > prevSubgroup.nonEmptyCount ? subgroup : prevSubgroup);\n            rowMeta.subgroup = subgroup.id;\n\n            const subgroupKeyIndex = helper.findIndexByKeyValue(fields, 'subgroupKey', true);\n            if (subgroupKeyIndex >= 0 && !row[subgroupKeyIndex] && angular.isUndefined(rowMeta.ignore)) {\n              rowMeta.ignore = true;\n            }\n          }\n        });\n    };\n  });\n","import XLSX from 'xlsx';\n\n/**\n * Excel (.xls/.xlsx) document reader, converts to 'array of arrays' format, based on XLSX component\n */\nexport default angular.module('deskworks.excel', [])\n  .service('excel', function($q, helper) {\n    const self = this;\n\n    /**\n     * Read Excel document and convert to 'array of arrays' format\n     */\n    self.read = file => {\n      return $q(resolve => {\n        const fileReader = new FileReader();\n\n        fileReader.onload = function(e) {\n          const sheets = [];\n\n          // Read Excel workbook via XLSX component\n          const workbook = XLSX.read(e.target.result, { type: 'binary' });\n\n          // HTML -> plain text decoder (set innerHTML, get value)\n          const decoder = document.createElement('textarea');\n\n          // Process all sheets in Excel\n          angular.forEach(workbook.SheetNames, sheetName => {\n            const sheet = workbook.Sheets[sheetName];\n            const range = getTrimmedRange(sheet);\n            const rows = [];\n\n            // Iterate through rows and expand sheet data to matrix (array of arrays)\n            for (let ri = range.s.r; ri <= range.e.r; ri++) {\n              const cols = [];\n\n              // Iterate through cols and accumulate row\n              for (let ci = range.s.c; ci <= range.e.c; ci++) {\n                const cell = sheet[XLSX.utils.encode_cell({ r: ri, c: ci })];\n                cols.push(helper.trim((cell || {}).w || ''));\n              }\n\n              // Decode HTML entities and tags to plain text\n              decoder.innerHTML = sheetName;\n\n              // Store converted row\n              rows.push(cols);\n            }\n\n            // Store converted sheet\n            sheets.push({name: decoder.value, data: rows});\n            // console.log('cell', angular.toJson(rows));\n          });\n\n          resolve(sheets);\n        };\n\n        fileReader.readAsBinaryString(file);\n      });\n    };\n\n    /**\n     * Get precised range from Excel sheet with trimming right/bottom whitespace.\n     */\n    function getTrimmedRange(sheet) {\n      const range = XLSX.utils.decode_range(sheet['!ref'] || 'A1:Z1000');\n      let cellTrimMax = 0;\n      let rowTrimMax = 0;\n\n      // Iterate over rows to find last non-empty row within sheet range\n      for (let ri = range.e.r; ri >= range.s.r; ri--) {\n        let cellTrim = -1;\n\n        // Iterate over cols to find last-non empty within sheet range\n        for (let ci = range.e.c; ci >= range.s.c; ci--) {\n          const cell = sheet[XLSX.utils.encode_cell({ r: ri, c: ci })];\n\n          // If current cell is non-empty, break cols-loop and store current index\n          if (cell && angular.isDefined(cell.v) && cell.v !== null && cell.v !== '' && cellTrim < 0) {\n            cellTrim = ci; // Store index of last non-empty column\n            break;\n          }\n        }\n\n        // Accumulate cellTrimMax -> range.e.c\n        cellTrimMax = cellTrimMax > cellTrim ? cellTrimMax : cellTrim;\n\n        // If current row is non-empty, store current index\n        if (cellTrim >= 0 && !rowTrimMax) {\n          rowTrimMax = ri; // Store index of last non-empty row\n        }\n      }\n\n      return { s: { r: range.s.r, c: range.s.c }, e: { r:rowTrimMax , c: cellTrimMax } };\n    }\n  });\n","/**\n * Initializes all sheet meta-data\n */\nexport default angular.module('deskworks.importInitMetaData', [\n  'deskworks.helper',\n])\n\n  .factory('importInitMetaData', function(helper) {\n    return function(sheet) {\n\n      sheet.rowsMeta.forEach((rowMeta, ri) => {\n        rowMeta.invalid = false; // mark everything as valid\n        rowMeta.empty = true;\n        rowMeta.id = null; // mark everything as un-wired\n        rowMeta.subgroup = null;\n        rowMeta.cellsMeta.forEach((cellMeta, ci) => {\n          cellMeta.invalid = false;\n          rowMeta.empty = rowMeta.empty && !helper.trim(sheet.data[ri][ci]);\n        });\n      });\n    };\n  });\n","/**\n * Import parsers service - set of functions to parse each type during import\n */\nexport default angular.module('deskworks.importParsers', [\n  'deskworks.helper',\n])\n  .service('importParsers', function(helper) {\n    const self = this;\n\n    /**\n     * Options type parser\n     */\n    self.options = (data, options) =>\n      helper.searchSoft(options, ['name', 'id', 'import'], data);\n\n    /**\n     * bool type parser\n     */\n    self.bool = data =>\n      !!helper.trim(data).match(/^Yes|Y|true$/i);\n\n    /**\n     * int type parser\n     */\n    self.int = data => {\n      data = helper.trim(data).replace(/,/g, '');\n      return data.length ? parseInt(data) : undefined;\n    };\n\n    /**\n     * uint type parser\n     */\n    self.uint = self.int;\n\n    /**\n     * float type parser\n     */\n    self.float = data => {\n      data = helper.trim(data).replace(/,/g, '');\n      return data.length ? parseFloat(data) : undefined;\n    };\n\n    /**\n     * currency type parser\n     */\n    self.currency = data => {\n      data = helper.trim(data).replace(/[,\\$]/g, '');\n      return data.length ? parseFloat(data) : undefined;\n    };\n\n    /**\n     * ufloat type parser\n     */\n    self.ufloat = self.float;\n\n    /**\n     * date type parser\n     */\n    self.date = data => {\n      let format;\n\n      data = helper.trim(data);\n\n      // 28 Mar 2015\n      if (data.match(/(?:^(?:\\s*)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|January|February|March|April|May|June|July|August|September|October|November|December)(?:\\s|-|\\.|\\/)(?:\\d{4})(?:\\s*)$)/i)) {\n        data = data.replace(/\\s|-|\\.|\\//g, ' '); // Comb delimiters\n        format = 'DD MMM YYYY';\n      }\n      // 03/28/2015\n      else if (data.match(/(?:^(?:\\s*)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{4})(?:\\s*)$)/i)) {\n        data = data.replace(/\\s|-|\\./g, '/'); // Comb delimiters\n        format = 'MM/DD/YYYY';\n      }\n      // 2015-03-28\n      else if (data.match(/(?:^(?:\\s*)(?:\\d{4})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s*)$)/i)) {\n        data = data.replace(/\\s|-|\\./g, '-'); // Comb delimiters\n        format = 'YYYY-MM-DD';\n      }\n\n      if (format){\n        const date = moment(data, format);\n        if (date.isValid()) return date;\n      }\n\n    };\n  });\n","/**\n * Purge service - purges existing data during import\n */\nexport default angular.module('deskworks.purge.service', [\n  'ngResource',\n  'deskworks.config',\n])\n\n  .factory('purgeService', function($resource, deskworksConfig) {\n    const resGlobal = $resource(deskworksConfig.getApiAbsUrl('/purge/:entity'));\n    const resCenter = $resource(deskworksConfig.getApiAbsUrl('/purge/centers/:centerId/:entity'));\n\n    return {\n      purgeProducts: types =>\n        resGlobal.delete({ entity: 'products', productTypes: types }).$promise,\n\n      purgePriceLists: centerId =>\n        resCenter.delete({ centerId: centerId, entity: 'price-lists' }).$promise,\n\n      purgeMembershipTypes: () =>\n        resGlobal.delete({ entity: 'membership-types' }).$promise,\n\n      purgeReservationCategories: () =>\n        resGlobal.delete({ entity: 'reservation-types' }).$promise,\n\n      purgeReservationUnits: centerId =>\n        resCenter.delete({ centerId: centerId, entity: 'reservation-units' }).$promise,\n\n      purgeMembers: () =>\n        resGlobal.delete({ entity: 'members' }).$promise,\n    };\n  });\n","/**\n * Auto-detects sheet appropriate for each step\n */\nexport default angular.module('deskworks.importSheetDetector', [\n  'deskworks.importSteps',\n])\n  .service('importSheetDetector', function(helper, importSteps) {\n    const self = this;\n\n    /**\n     * Detects sheet appropriate for given step\n     */\n    self.detect = (sheets, step) => {\n      if (angular.isArray(sheets) && importSteps[step].sheetPattern) {\n        for (let i = 0; i < sheets.length; i++) {\n          if (helper.trim(sheets[i].name).match(importSteps[step].sheetPattern)) {\n            return sheets[i];\n          }\n        }\n      }\n\n      return (sheets || [])[0];\n    };\n  });\n","/**\n * Strip service comments from first 5 rows of excel data\n */\nexport default angular.module('deskworks.importStripDataComments', [])\n\n  .factory('importStripDataComments', function() {\n\n    return data => {\n      if (!angular.isArray(data)) return;\n\n      data.slice(0, 5) // first 5 rows\n        .forEach(row => {\n          row.forEach((cell, ci) => {\n            row[ci] = cell.replace(/\\(?PLEASE CHANGE SAMPLE DATA AS NEEDED\\)?/i, '');\n          });\n        });\n    };\n\n  });\n","/**\n * Validates cell value according to field validators\n * @param data - data matrix with cell to validate\n * @param ri - row index\n * @param ci - cell index\n * @param fields - step fields\n * @param mapping - sheet fields mapping\n * @param $scope - $scope to $eval options expressions\n * @returns {*}\n */\nexport default angular.module('deskworks.importValidateCell', [\n  'deskworks.helper',\n])\n\n  .factory('importValidateCell', function(helper) {\n    return (data, ri, ci, rowsMeta, fields, mapping, $scope) => {\n      const field = fields.find(obj => obj.id === mapping[ci]);\n      if (!field) return;\n\n      let val = helper.trim(data[ri][ci]);\n\n      /**\n       * Options type validation\n       */\n      if (angular.isObject(field.type) && field.type.options) {\n        if (field.required || val !== '') {\n          let options;\n          if (field.type.ref) {\n            let ref = data[ri][mapping.indexOf(field.type.ref)]; // field value\n            const refField = fields.find(obj => obj.id === field.type.ref); // field conf\n            ref = helper.searchSoft(refField.type.options, ['id', 'name', 'import'], ref);\t// final field\n            options = $scope.$eval(field.type.options.replace(/\\$id/g, (ref || {}).id));\n          } else {\n            options = angular.isArray(field.type.options) ? field.type.options : $scope.$eval(field.type.options);\n          }\n          if (angular.isArray(options) && !helper.searchSoft(options, ['name', 'id', 'import'], val)) return options;\n        }\n      }\n\n      /**\n       * Required validation\n       */\n      if (field.required) {\n        if (val === '') return field.name + ' is required.';\n      } else if (val === '') {\n        return; // if field is not required and empty, stop redundant validation\n      }\n\n      /**\n       * Basic types validation\n       */\n      if (field.type === 'uint' && !val.match(/^\\d*,?\\d+$/i)) {\n        return field.name + ' should be a positive integer number, e.g. 100 or 0';\n      }\n      else if (field.type === 'int' && !val.match(/^-?\\d*,?\\d+$/i)) {\n        return field.name + ' should be an integer number, e.g. -10 or 50';\n      }\n      else if (field.type === 'ufloat' && !val.match(/^[\\d,]*\\.?\\d+$/i)) {\n        return field.name + ' should be a positive number, e.g. 10 or 10.50';\n      }\n      else if (field.type === 'float' && !val.match(/^-?[\\d,]*\\.?\\d+$/i)) {\n        return field.name + ' should be a number, e.g. 100 or -20 or 5.5';\n      }\n      else if (field.type === 'bool' && !val.match(/^Yes|No|Y|N|true|false$/i)) {\n        return field.name + ' should be Yes/No, Y/N, true/false';\n      }\n      else if (field.type === 'currency' && !val.match(/^\\$?[\\d,]*\\.?\\d+$/i)) {\n        return field.name + ' should be currency, e.g. $10 or $10.50 or 12.00';\n      }\n      else if (field.type === 'email' && !val.match(/^[\\w\\.%\\+\\-]+@(?:[A-Z0-9\\-]+\\.)+(?:[A-Z]+)$/i)) {\n        return field.name + ' should be valid';\n      }\n      else if (field.type === 'date') {\n        let format;\n\n        // 28 Mar 2015\n        if (val.match(/(?:^(?:\\s*)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|January|February|March|April|May|June|July|August|September|October|November|December)(?:\\s|-|\\.|\\/)(?:\\d{4})(?:\\s*)$)/i)) {\n          val = val.replace(/\\s|-|\\.|\\//g, ' '); // Comb delimiters\n          format = 'DD MMM YYYY';\n        }\n        // 03/28/2015\n        else if (val.match(/(?:^(?:\\s*)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{4})(?:\\s*)$)/i)) {\n          val = val.replace(/\\s|-|\\./g, '/'); // Comb delimiters\n          format = 'MM/DD/YYYY';\n        }\n        // 2015-03-28\n        else if (val.match(/(?:^(?:\\s*)(?:\\d{4})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s|-|\\.|\\/)(?:\\d{1,2})(?:\\s*)$)/i)) {\n          val = val.replace(/\\s|-|\\./g, '-'); // Comb delimiters\n          format = 'YYYY-MM-DD';\n        }\n\n        if (format && moment(val, format).isValid()) return;\n\n        return field.name + ' format is 06/22/2015 or 22&nbsp;Jun&nbsp;2015';\n      }\n\n      /**\n       * Min length validation\n       */\n      if (field.minLength) {\n        if (val.length < field.minLength) return field.name + ' min length is ' + field.minLength;\n      }\n\n      /**\n       * Unique value within col validation\n       */\n      if (field.unique) {\n        const equalCount = data\n          .filter((row, ri) => !rowsMeta[ri].empty && !rowsMeta[ri].ignore && !rowsMeta[ri].headRow)\n          .reduce((sum, row) => helper.trim(row[ci] || '').toLowerCase() === (val || '').toLowerCase() ? ++sum : sum, 0);\n        if (equalCount > 1) return field.name + ' contains duplicate values. Must be unique.';\n      }\n\n      /**\n       * Pattern type validation\n       */\n      if (angular.isObject(field.type) && field.type.pattern) {\n        if (!val.match(field.type.pattern)) return field.type.msg;\n      }\n    };\n  });\n","/**\n * Validates all sheet data\n */\nexport default angular.module('deskworks.importValidateData', [\n  'deskworks.helper',\n  'deskworks.importValidateCell',\n])\n\n  .factory('importValidateData', function(helper, importValidateCell) {\n    return function(sheet, fields, $scope) {\n      let invalidCount = 0;\n\n      sheet.data\n        .forEach((row, ri) => {\n          const rowMeta = sheet.rowsMeta[ri];\n\n          let fieldsSet = fields;\n          if (rowMeta.subgroup) fieldsSet = fields.filter(field => field.subgroup === rowMeta.subgroup);\n\n          rowMeta.invalid = fieldsSet.reduce((invalid, field) => {\n            const ci = sheet.mapping.indexOf(field.id);\n            const cellMeta = rowMeta.cellsMeta[ci];\n\n            // skip empty and ignored rows\n            if (rowMeta.empty || rowMeta.headRow || rowMeta.ignore) {\n              cellMeta.invalid = false; return invalid;\n            }\n\n            cellMeta.invalid = importValidateCell(sheet.data, ri, ci, sheet.rowsMeta, fields, sheet.mapping, $scope);\n            if (cellMeta.invalid) invalidCount++;\n\n            return invalid || cellMeta.invalid;\n          }, false);\n\n        });\n\n      return invalidCount;\n    };\n  });\n","/**\n * Wires sheet data to existing data\n */\nexport default angular.module('deskworks.importWireData', [\n  'deskworks.helper',\n  'deskworks.importSteps',\n])\n\n  .factory('importWireData', function(helper) {\n    return ($ctrl, sheet, fields, wireRow) => {\n      sheet.data // all fields mapped, proceed with wiring\n        .forEach((row, ri) => {\n          const rowMeta = sheet.rowsMeta[ri];\n\n          if (rowMeta.empty || rowMeta.headRow) return;\n\n          const rowObj = sheet.mapping.reduce((obj, id, colIdx) => { obj[id] = row[colIdx]; return obj; }, {});\n          rowMeta.id = wireRow($ctrl, rowObj, rowMeta, sheet.rowsMeta);\n          if (rowMeta.id && angular.isUndefined(rowMeta.ignore)) rowMeta.ignore = true;\n        });\n    };\n  });\n","// Module\nvar code = \"<ff-panel ng-if=\\\"$ctrl.sheet && $ctrl.sheet.mappedToStep === $ctrl.step\\\"> <div class=\\\"ff-grid gutter-v-half gutter-h-half import-dashboard\\\"> <div flex=\\\"0 0 320px\\\" class=\\\"import-stats\\\" ng-if=\\\"!$ctrl.unMappedFields.length\\\"> <div class=\\\"text-brand\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.create}}</span> <ff-icon sense=\\\"plus\\\"></ff-icon> <span class=\\\"text\\\">Create</span> </div> <div class=\\\"text-brand\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.update}}</span> <ff-icon sense=\\\"refresh\\\"></ff-icon> <span class=\\\"text\\\">Update</span> </div> <div class=\\\"text-text\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.existing}}</span> <ff-icon sense=\\\"check\\\"></ff-icon> <span class=\\\"text\\\">Existing</span> </div> <div class=\\\"text-text\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.ignore}}</span> <ff-icon sense=\\\"ignore\\\"></ff-icon> <span class=\\\"text\\\">Ignore</span> </div> <div class=\\\"text-danger\\\" ng-if=\\\"!$ctrl.stats.invalid\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.error}}</span> <ff-icon sense=\\\"error\\\"></ff-icon> <span class=\\\"text\\\">Error</span> </div> <div class=\\\"text-danger\\\" ng-if=\\\"$ctrl.stats.invalid\\\"> <span class=\\\"counter\\\">{{$ctrl.stats.invalid}}</span> <ff-icon sense=\\\"warning\\\"></ff-icon> <span class=\\\"text\\\">Invalid</span> </div> </div> <span ng-if=\\\"$ctrl.sheet.mappedToStep === $ctrl.step && $ctrl.unMappedFields.length\\\" class=\\\"text-danger\\\"> Some columns are unmapped. Please map them manually. Check <b><u>UNKNOWN</u></b> markers and select correct field mapping from the drop-down. </span> <span ng-if=\\\"$ctrl.sheet.mappedToStep === $ctrl.step && !$ctrl.unMappedFields.length && $ctrl.invalidCount\\\" class=\\\"text-danger\\\"> Invalid values detected. Please fix them manually to proceed to the next step. Look for cells with <ff-icon sense=\\\"warning\\\"></ff-icon> icon and fix their values. You can also ignore some rows by clicking <ff-icon sense=\\\"warning\\\"></ff-icon> icons near the row indexes at left. </span> <span ng-if=\\\"$ctrl.sheet.mappedToStep === $ctrl.step && !$ctrl.unMappedFields.length && !$ctrl.invalidCount\\\"> Click Next to proceed to the next step. </span> </div> </ff-panel> \";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<ff-panel ff-dim=\\\"$ctrl.spin || !$ctrl.sheet\\\"> <div class=\\\"ff-grid gutter-v-half\\\"> <label class=\\\"ff-row ff-no-frame\\\"> <ff-label flex=\\\"0 0 120px\\\" ff-required=\\\"true\\\">Select Sheet</ff-label> <ff-select ff-model=\\\"$ctrl.sheet\\\" ff-options=\\\"sheet.name for sheet in $ctrl.sheets\\\" ff-required=\\\"true\\\" ff-valdate-alert=\\\"Sheet\\\"></ff-select> </label> <div ng-if=\\\"$ctrl.sheet && !$ctrl.sheet.mappedToStep\\\" class=\\\"text-danger\\\"> <ff-icon sense=\\\"info\\\"></ff-icon> This sheet seems to misfit to current import step. Please select another sheet or map all columns manually. </div> <div ng-if=\\\"$ctrl.sheet && $ctrl.sheet.mappedToStep && $ctrl.sheet.mappedToStep !== $ctrl.step\\\" class=\\\"text-danger\\\"> <ff-icon sense=\\\"info\\\"></ff-icon> This sheet is already mapped to \\\"{{$ctrl.steps[$ctrl.sheet.mappedToStep].name}}\\\" step, please select another sheet or <ff-btn sense=\\\"remove\\\" size=\\\"sm\\\" ff-click=\\\"$ctrl.remapFields()\\\">Remap Fields</ff-btn> </div> </div> </ff-panel> \";\n// Exports\nmodule.exports = code;","/**\n * Import -> Complete\n */\nexport default angular.module('deskworks.importStepComplete', [\n  'deskworks.state',\n])\n\n  .component('importStepComplete', {\n    templateUrl: 'step-components/step-complete.tpl.html',\n    controller: 'ImportStepCompleteCtrl',\n    bindings: {\n      step: '=',\n      purge: '<',\n    },\n  })\n\n  .controller('ImportStepCompleteCtrl', function(state) {\n    const $ctrl = this;\n\n    $ctrl.navSidebar = $event => {\n      $event.preventDefault();\n      $event.stopPropagation();\n      return state.setPath($event.target.hash.replace('#', ''));\n    };\n\n    $ctrl.home = () => state.setPath('/dashboard');\n\n    $ctrl.back = () => { $ctrl.step--; };\n  });\n","// Module\nvar code = \"<div> <p>Congratulations! You have completed the import. You can manage imported data through sidebar:</p> <p><a href=\\\"#/reservation-types\\\" ng-click=\\\"$ctrl.navSidebar($event)\\\">Inventory <ff-icon sense=\\\"breadcrumb\\\"></ff-icon> Reservation Categories</a></p> <p><a href=\\\"#/reservation-units\\\" ng-click=\\\"$ctrl.navSidebar($event)\\\">Inventory <ff-icon sense=\\\"breadcrumb\\\"></ff-icon> Reservation Units</a></p> <p><a href=\\\"#/products\\\" ng-click=\\\"$ctrl.navSidebar($event)\\\">Inventory <ff-icon sense=\\\"breadcrumb\\\"></ff-icon> Products</a></p> <p><a href=\\\"#/user-search\\\" ng-click=\\\"$ctrl.navSidebar($event)\\\">Members <ff-icon sense=\\\"breadcrumb\\\"></ff-icon> View/Edit Profile</a></p> </div> <ff-btn-group class=\\\"buttons-bottom\\\"> <ff-btn sense=\\\"back\\\" ff-click=\\\"$ctrl.back()\\\">Back To Step {{$ctrl.step}}</ff-btn> <ff-btn sense=\\\"home\\\" ff-click=\\\"$ctrl.home()\\\">Go To Dashboard</ff-btn> <ff-btn sense=\\\"remove\\\" ff-click=\\\"$ctrl.purge()\\\">Purge & Start From Scratch</ff-btn> </ff-btn-group> \";\n// Exports\nmodule.exports = code;","import PromisePool from 'es6-promise-pool';\n\n/**\n * Import -> Import Sheet\n */\nexport default angular.module('deskworks.importStepImport', [\n  'deskworks.dwAlerts',\n  'deskworks.handsontable',\n  'deskworks.importHandsontable',\n  'deskworks.importSheetDetector',\n  'deskworks.importSteps',\n  'deskworks.importInitMetaData',\n  'deskworks.importDetectSubgroups',\n  'deskworks.importWireData',\n  'deskworks.importValidateData',\n  'deskworks.importCollectStats',\n])\n\n  .component('importStepImport', {\n    templateUrl: 'step-components/step-import.tpl.html',\n    controller: 'ImportStepImportCtrl',\n    bindings: {\n      step: '=',\n      sheets: '<',\n      purge: '<',\n    },\n  })\n\n  .controller('ImportStepImportCtrl', function($scope, $q, $timeout, dwAlerts, state, helper,\n                                               importSheetDetector, importSteps,\n                                               importInitMetaData, importDetectSubgroups, importWireData,\n                                               importValidateData, importCollectStats) {\n    const $ctrl = this;\n\n    $ctrl.steps = importSteps;\n\n    // $ctrl.$onInit = function() {};\n    // $ctrl.$onChanges = function() {};\n\n    $scope.$watch('$ctrl.step', () => {\n      if (!$ctrl.step) return;\n      const step = $ctrl.steps[$ctrl.step];\n      $ctrl.fields = step.fields;\n\n      $ctrl.sheet = null;\n      $q.when(step.hooks && step.hooks.init && step.hooks.init($ctrl)) // init hook call\n        .then(() => {\n          $ctrl.sheet = importSheetDetector.detect($ctrl.sheets, $ctrl.step);\n        });\n    });\n\n    /**\n     * Back button handler\n     */\n    $ctrl.back = () => { $ctrl.step--; };\n\n    /**\n     * Validate Data\n     */\n    $ctrl.validateData = () => {\n      importInitMetaData($ctrl.sheet);\n\n      if (!$ctrl.fields.filter(field => $ctrl.sheet.mapping.indexOf(field.id) < 0).length) { // all fields mapped\n        importDetectSubgroups($ctrl, $ctrl.sheet, $ctrl.fields);\n        importWireData($ctrl, $ctrl.sheet, $ctrl.fields, $ctrl.steps[$ctrl.step].hooks.wireRow);\n        $ctrl.invalidCount = importValidateData($ctrl.sheet, $ctrl.fields, $scope);\n        $ctrl.stats = importCollectStats($ctrl.sheet.rowsMeta);\n      }\n\n      $scope.$broadcast('ht:render'); // force re-render handsontable\n    };\n\n    /**\n     * Import Data\n     */\n    $ctrl.import = () => {\n      if ($ctrl.unMappedFields.length)\n        return dwAlerts.error('Some columns unmapped. Please check red UNKNOWN markers and map them to appropriate fields.');\n      if ($ctrl.invalidCount)\n        return dwAlerts.error($ctrl.invalidCount + ' invalid values found. Please fix them manually to proceed to the next step.');\n\n      const step = $ctrl.steps[$ctrl.step];\n\n      let ri = 0;\n      const promiseProducer = function() {\n        while (ri < $ctrl.sheet.data.length && ($ctrl.sheet.rowsMeta[ri].ignore || $ctrl.sheet.rowsMeta[ri].subgroup ||\n          $ctrl.sheet.rowsMeta[ri].headRow || $ctrl.sheet.rowsMeta[ri].empty)) ri++;\n\n        if (ri >= $ctrl.sheet.data.length) return null;\n        const rowMeta = $ctrl.sheet.rowsMeta[ri];\n\n        rowMeta.spin = true;\n        return step.hooks.importRow($ctrl, $ctrl.sheet.data[ri++], rowMeta, $ctrl.sheet.mapping, $ctrl.fields)\n          .then(result => {\n            rowMeta.id = result.id || rowMeta.id;\n            rowMeta.error = null;\n          })\n          .catch(err => {\n            rowMeta.error = err.data && err.data.error || (err.status + ' ' + err.statusText);\n          })\n          .finally(() => {\n            $ctrl.stats = importCollectStats($ctrl.sheet.rowsMeta);\n            rowMeta.spin = false;\n            rowMeta.ignore = true;\n          });\n      };\n\n      const pool = new PromisePool(promiseProducer, 5, { promise: $q });\n\n      $ctrl.spin = true;\n      return $q.when(step.hooks && step.hooks.preImport && step.hooks.preImport($ctrl, $ctrl.sheet, $ctrl.fields))\n        .then(() => pool.start())\n        .then(() => {\n          $ctrl.validateData();\n          return $timeout(() => {\n            $ctrl.spin = false;\n            $ctrl.step++;\n          }, 1000);\n        });\n      // return pool.start()\n      //   .then(function() {\n      //     $ctrl.validateData();\n      //     return $timeout(function() {\n      //       $ctrl.spin = false;\n      //       $ctrl.step++;\n      //     }, 1000);\n      //   });\n    };\n  });\n","// Module\nvar code = \"<div class=\\\"ff-grid gutter-h gutter-v\\\"> <div style1=\\\"margin-bottom: .25rem\\\" ng-if=\\\"$ctrl.steps[$ls.step].id !== 'complete'\\\"> <span class=\\\"em\\\">Step {{$ls.step + 1}} of {{$ctrl.steps.length - 2}}</span> &nbsp; This step allows you to import <b ng-bind=\\\"$ctrl.steps[$ctrl.step].name\\\"></b>. Please select correct Excel sheet, check & fix columns mapping, fix invalid values, then import. </div> <div flex=\\\"{lg: '0 0 400px'}\\\" class=\\\"ff-grid\\\" ng-include=\\\"'step-components/import-sheet-selector.tpl.html'\\\"></div> <div flex=\\\"{lg: '1 1 360px'}\\\" class=\\\"ff-grid\\\" ng-include=\\\"'step-components/import-dashboard.tpl.html'\\\"></div> <ff-btn-group> <ff-btn sense=\\\"next\\\" ff-click=\\\"$ctrl.import()\\\">Next</ff-btn> <ff-btn sense=\\\"back\\\" ff-click=\\\"$ctrl.back()\\\">Back To Step {{$ctrl.step}}</ff-btn> <ff-btn sense=\\\"remove\\\" ff-click=\\\"$ctrl.purge()\\\">Purge & Start From Scratch</ff-btn> </ff-btn-group> <ff-panel class=\\\"ht-panel\\\" ng-if=\\\"$ctrl.sheet\\\" ff-dim=\\\"$ctrl.spin\\\"> <import-handsontable step=\\\"$ctrl.step\\\" sheet=\\\"$ctrl.sheet\\\" fields=\\\"$ctrl.fields\\\" on-validate=\\\"$ctrl.validateData()\\\" un-mapped-fields=\\\"$ctrl.unMappedFields\\\"></import-handsontable> </ff-panel> </div> \";\n// Exports\nmodule.exports = code;","import xlsTemplateUrl from 'assets/new-center-startup-workbook.xlsx';\n\n/**\n * Import -> Init\n */\nexport default angular.module('deskworks.importStepInit', [\n  'ngFileUpload',\n  'deskworks.dwAlerts',\n  'deskworks.excel',\n])\n\n  .component('importStepInit', {\n    templateUrl: 'step-components/step-init.tpl.html',\n    controller: 'ImportStepInitCtrl',\n    bindings: {\n      step: '=',\n      sheets: '=',\n      purge: '<',\n    },\n  })\n\n  .controller('ImportStepInitCtrl', function(dwAlerts, excel) {\n    const $ctrl = this;\n\n    /**\n     * $onInit\n     */\n    $ctrl.$onInit = () => {\n      $ctrl.xlsTemplateUrl = xlsTemplateUrl;\n    };\n\n    /**\n     * $onChanges\n     */\n    // $ctrl.$onChanges = () => {};\n\n    /**\n     * Upload new file handler\n     */\n    $ctrl.upload = function($files, $invalidFiles) {\n      if ($invalidFiles && $invalidFiles.length > 0) return dwAlerts.error('Please use .xls or .xlsx files.');\n\n      if (!window.FileReader) return dwAlerts.error('FileReader is not supported by your web browser.');\n\n      if (!$files || !$files.length) return;\n\n      excel.read($files[0])\n        .then(result => {\n          $ctrl.sheets = result;\n          $ctrl.step++;\n        });\n    };\n  });\n","// Module\nvar code = \"<div class=\\\"gutter-v\\\"> <ff-panel> <div class=\\\"em\\\"><ff-icon sense=\\\"info\\\"></ff-icon>&nbsp;&nbsp;This wizard will guide you through the following import steps:</div> <ff-label> <span>Reservation Categories</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Other Products</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Membership Products</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Reservation Units</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Members</span> </ff-label> <div class=\\\"em\\\"><ff-icon sense=\\\"info\\\"></ff-icon>&nbsp;&nbsp;The workflow for each step is:</div> <ff-label> <span>Select sheet in Excel file</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Map fields</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Fix invalid data</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Import</span><ff-icon sense=\\\"breadcrumb\\\"></ff-icon> <span>Move to next step</span> </ff-label> <p><ff-icon sense=\\\"info\\\"></ff-icon>&nbsp;&nbsp;Please download import template, open it in Excel (Numbers on Mac), replace sample data with your real data, then start import by selecting the file you've made.</p> <p><ff-icon sense=\\\"warning\\\"></ff-icon>&nbsp;&nbsp;Don't add/remove columns in the template, but you may add/remove rows.</p> </ff-panel> <ff-btn-group> <ff-btn sense=\\\"upload\\\" ngf-select=\\\"$ctrl.upload($files, $invalidFiles)\\\" ngf-pattern=\\\"'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel'\\\" accept=\\\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\\\"> Select Excel File to Import </ff-btn> <a ng-href=\\\"{{$ctrl.xlsTemplateUrl}}\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\" download> <ff-btn sense=\\\"download\\\">Download Import Template</ff-btn> </a> </ff-btn-group> </div> \";\n// Exports\nmodule.exports = code;","/**\n * Fields configuration for Import -> Members\n */\nexport default angular.module('deskworks.importFieldsMembers', [\n  'deskworks.userProfile.optsCountry',\n  'deskworks.userProfile.optsState',\n  'deskworks.userProfile.optsMembershipStatus',\n  'deskworks.userProfile.optsBillingMethod',\n  'deskworks.billing.optsRenewalTerm',\n  'deskworks.billing.optsRenewalNoticePeriod',\n])\n\n  .factory('importFieldsMembers', function(optsCountry, optsState, optsMembershipStatus, optsBillingMethod,\n                                           optsRenewalTerm, optsRenewalNoticePeriod) {\n    return [\n      {\n        id: 'firstName', name: 'First Name', pattern: /First\\s+Name/i,\n        required: true,\n      },\n      {\n        id: 'lastName', name: 'Last Name', pattern: /Last\\s+Name/i,\n        required: true, type: { pattern: /^[^\\\\<>\\/&]*$/, msg: 'Last Name should not contain special characters' },\n      },\n      {\n        id: 'email', name: 'Email', pattern: /Email/i,\n        required: true, unique: true, type: 'email',\n      },\n      {\n        id: 'company', name: 'Company', pattern: /Company/i,\n      },\n      {\n        id: 'login', name: 'Login', pattern: /Login/i,\n        required: true, unique: true, minLength: 3,\n        type: { pattern: /^\\w[\\w\\.\\-_@]+$/, msg: 'Login should have only letters, numbers, and .-_@' },\n      },\n      {\n        id: 'password', name: 'Password', pattern: /Password/i,\n        required: true, minLength: 6,\n      },\n      {\n        id: 'addressStreet', name: 'Street', pattern: /Street/i,\n        required: true,\n      },\n      {\n        id: 'addressCity', name: 'City', pattern: /City/i,\n        required: true,\n      },\n      {\n        id: 'addressCountry', name: 'Country', pattern: /Country/i,\n        required: true, type: { options: optsCountry },\n      },\n      {\n        id: 'addressState', name: 'State/Province', pattern: /State\\s*\\/\\s*Province/i,\n        required: true, type: { options: '$ctrl.optsState.$id', ref: 'addressCountry' },\n      },\n      {\n        id: 'addressZip', name: 'Zip/Postal', pattern: /Zip\\s*\\/\\s*Post/i,\n        required: true,\n      },\n      {\n        id: 'phoneNumber', name: 'Phone Number', pattern: /Number/i,\n        required: true,\n        type: {\n          pattern: /^((\\+\\d{1,3}[-. ]?\\(?\\d\\)?[-. ]?\\d{1,5})|(\\(?\\d{2,6}\\)?))[-. ]?(\\d{3,4})[-. ]?(\\d{4})$/,\n          msg: 'Phone number examples: 888-379-2865, +1-888-379-2865, 888 379 2865, 888.379.2865',\n        },\n      },\n      {\n        id: 'mailboxNumber', name: 'Mailbox #', pattern: /Mailbox #/i,\n      },\n      {\n        id: 'printerCode', name: 'Printer Code', pattern: /Printer\\s+Code/i,\n      },\n      {\n        id: 'accessCode', name: 'Access Code', pattern: /Access\\s+Code/i,\n      },\n      {\n        id: 'leadSource', name: 'Lead Source', pattern: /Lead\\s+Source/i,\n        required: true, type: { options: '$ctrl.leadSources' },\n      },\n      {\n        id: 'comments', name: 'Comments', pattern: /Comments/i,\n      },\n      {\n        id: 'billingMethod', name: 'Billing Method', pattern: /Bill\\s+By/i,\n        required: true, type: { options: optsBillingMethod },\n      },\n      {\n        id: 'recurringProduct', name: 'Recurring Billing', pattern: /Recurring\\s+Billing/i,\n        type: { options: '$ctrl.products' }, subgroup: 'recurring', subgroupKey: true,\n      },\n      {\n        id: 'recurringQuantity', name: 'Qty', pattern: /Qty/i,\n        type: 'uint', subgroup: 'recurring',\n      },\n      {\n        id: 'recurringDiscount', name: 'Discount', pattern: /^Discount/i,\n        type: 'currency', subgroup: 'recurring',\n      },\n      {\n        id: 'recurringMonthsOfDiscount', name: 'Months of Discount', pattern: /Months\\s+of\\s+Discount/i,\n        type: 'uint', subgroup: 'recurring',\n      },\n      {\n        id: 'recurringAttachedReservationUnit', name: 'Attached Reservation Unit', pattern: /Make\\s+Matching\\s+Reservation\\s+Unit\\s+Unavailable/i,\n        unique: true, type: { options: '$ctrl.reservationUnits' }, subgroup: 'recurring',\n      },\n      {\n        id: 'recurringNextBillDate', name: 'Next Bill Date', pattern: /Next\\s+Bill\\s+Date/i,\n        type: 'date', subgroup: 'recurring',\n      },\n      // {\n      //   id: 'renewalDate', name: 'Renewal Date', pattern: /Renewal\\s+Date/i,\n      //   type: 'date', subgroup: 'recurring',\n      // },\n      // {\n      //   id: 'renewalTerm', name: 'Renewal Term', pattern: /Renewal\\s+Term/i,\n      //   type: { options: optsRenewalTerm }, subgroup: 'recurring',\n      // },\n      // {\n      //   id: 'renewalNoticePeriod', name: 'Renewal Notice Period', pattern: /Renewal\\s+Notice\\s+Period/i,\n      //   type: { options: optsRenewalNoticePeriod }, subgroup: 'recurring',\n      // },\n    ];\n  });\n","/**\n * Fields configuration for Import -> Membership Products\n */\nexport default angular.module('deskworks.importFieldsMembershipProducts', [])\n\n  .factory('importFieldsMembershipProducts', function() {\n    return [\n      {\n        id: 'name', name: 'Product Name', pattern: /Product\\s+Name/i,\n        required: true, unique: true,\n      },\n      {\n        id: 'membershipCategory', name: 'Membership Category', pattern: /Membership\\s+Category/i,\n        required: true,\n      },\n      {\n        id: 'isCreditable', name: 'Has Reservation Credit?', pattern: /Has\\s+Reservation\\s+Credit/i,\n        type: 'bool',\n      },\n      {\n        id: 'hasPasses', name: 'Has Passes?', pattern: /Has\\s+Passes/i,\n        type: 'bool',\n      },\n      {\n        id: 'passProduct', name: 'Product to use for pass', pattern: /Product.+for.+pass/i,\n        type: { options: '$ctrl.productsRental' },\n      },\n      {\n        id: 'showInSelfRegistration', name: 'Show for Self-Registration', pattern: /Show.+Self.*Regis/i,\n        type: 'bool',\n      },\n      {\n        id: 'productCategoryCode', name: 'Product Category Code', pattern: /Product\\s+Category\\s+Code/i,\n        required: true,\n      },\n      {\n        id: 'productCategoryName', name: 'Product Category Name', pattern: /Product\\s+Category\\s+Name/i,\n      },\n      {\n        id: 'productNumber', name: 'Part Number Code', pattern: /Part\\s+Number\\s+Code/i,\n        required: true, type: 'uint',\n      },\n      {\n        id: 'price', name: 'Price', pattern: /^Price/i,\n        required: true, type: 'currency',\n      },\n      {\n        id: 'reservationCredit', name: 'Reservation Credit', pattern: /^Reservation\\s+Credit/i,\n        type: 'currency',\n      },\n      {\n        id: 'passQty', name: 'Passes', pattern: /^Passes/i,\n        type: 'uint',\n      },\n      {\n        id: 'description', name: 'Description', pattern: /Description/i,\n      },\n    ];\n  });\n","/**\n * Fields configuration for Import -> Other Products\n */\nexport default angular.module('deskworks.importFieldsOtherProducts', [\n  'deskworks.inventory.optsProductType',\n])\n\n  .factory('importFieldsOtherProducts', function(optsProductType) {\n    return [\n      {\n        id: 'name', name: 'Product Name', pattern: /Product\\s+Name/i,\n        required: true, unique: true,\n      },\n      {\n        id: 'type', name: 'Product Type', pattern: /Product\\s+Type/i,\n        required: true, type: { options: optsProductType.filter(function(opt) { return opt.id !== 'membership'; }) },\n      },\n      {\n        id: 'allowReservationCredits', name: 'Can use Reservation Credits', pattern: /Can\\s+use\\s+Reservation\\s+Credit/i,\n        type: 'bool',\n      },\n      {\n        id: 'passSize', name: 'Pass Size', pattern: /Pass\\s+Size/i,\n        type: 'uint',\n      },\n      {\n        id: 'reservationCategory', name: 'Reservation Category', pattern: /Reservation\\s+Category/i,\n        type: { options: '$ctrl.reservationCategories' },\n      },\n      {\n        id: 'productCategoryCode', name: 'Product Category Code', pattern: /Product\\s+Category\\s+Code/i,\n        required: true,\n      },\n      {\n        id: 'productCategoryName', name: 'Product Category Name', pattern: /Product\\s+Category\\s+Name/i,\n      },\n      {\n        id: 'productNumber', name: 'Part Number Code', pattern: /Part\\s+Number\\s+Code/i,\n        required: true, type: 'uint',\n      },\n      {\n        id: 'monthlyPrice', name: 'Monthly Members Price List', pattern: /Monthly\\s+Members\\s+Price\\s?list/i,\n        type: 'currency',\n      },\n      {\n        id: 'walkinPrice', name: 'Walkin Price List', pattern: /Walkin\\s+Price\\s?list/i,\n        type: 'currency',\n      },\n      {\n        id: 'description', name: 'Product Description', pattern: /^Product\\s+Description/i,\n      },\n    ];\n  });\n","/**\n * Fields configuration for Import -> Reservation Categories\n */\nexport default angular.module('deskworks.importFieldsReservationCategories', [])\n  .factory('importFieldsReservationCategories', function() {\n    return [\n      {\n        id: 'name', name: 'Reservation Category', pattern: /^Reservation\\s+Category/i,\n        required: true, unique: true,\n      },\n      {\n        id: 'description', name: 'Description', pattern: /^Description/i,\n      },\n    ];\n  });\n","/**\n * Fields configuration for Import -> Reservation Units\n */\nexport default angular.module('deskworks.importFieldsReservationUnits', [\n  'deskworks.reservationRules.optsWhoCanReserve',\n])\n\n  .factory('importFieldsReservationUnits', function(optsWhoCanReserve) {\n    return [\n      {\n        id: 'name', name: 'Reservation Unit', pattern: /^Reservation\\s+Unit$/i,\n        required: true, unique: true,\n      },\n      {\n        id: 'reservationCategory', name: 'Reservation Category', pattern: /^Reservation\\s+Category$/i,\n        required: true, type: { options: '$ctrl.reservationCategories' },\n      },\n      {\n        id: 'whoCanReserve', name: 'Who can reserve?', pattern: /^Who\\s+can\\s+reserve/i,\n        required: true, type: { options: optsWhoCanReserve },\n      },\n      {\n        id: 'fullTimeProduct', name: 'Full-time Product', pattern: /^Full-time\\s+Product/i,\n        type: { options: '$ctrl.productsMembership' },\n      },\n    ];\n  });\n","import ReservationUnit from 'shared/services/inventory/reservation-unit.service';\n\n/**\n * Hooks for Import -> Members\n */\nexport default angular.module('deskworks.importHooksMembers', [\n  'deskworks.dwAlerts',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.importParsers',\n  'deskworks.inventory.product.service',\n  'deskworks.inventory.priceList.service',\n  'deskworks.inventory.membershipCategory.service',\n  'deskworks.system.service',\n  'deskworks.userProfile.service',\n  'deskworks.recurringCharge.service',\n  'deskworks.userProfile.optsMembershipStatus',\n  'deskworks.userProfile.optsState',\n  'deskworks.billing.optsDiscountType',\n  ReservationUnit.name,\n])\n\n  .factory('importHooksMembers', function($q, $filter, dwAlerts, helper, state, importParsers,\n                                          productService, priceListService, membershipCategoryService, systemService,\n                                          userProfileService, recurringChargeService, ReservationUnit,\n                                          optsMembershipStatus, optsState, optsDiscountType) {\n    return {\n      init: init,\n      importRow: importRow,\n      wireRow: wireRow,\n    };\n\n    /**\n     * Init hook\n     */\n    function init($ctrl) {\n      return $q.all([\n        productService.getProducts()\n          .catch(err => dwAlerts.error(err, 'Failed to query products.'))\n          .then(products => {\n            $ctrl.products = products.filter(product => product.type === 'membership' || product.type === 'services');\n          }),\n\n        systemService.getLeadSources()\n          .catch(err => dwAlerts.error(err, 'Failed to query lead sources.'))\n          .then(leadSources => { $ctrl.leadSources = leadSources; }),\n\n        userProfileService.query(0, { activeMembers: true, inactiveMembers: true, activeCoMembers: true, inactiveCoMembers: true, nonMembers: true })\n          .catch(err => dwAlerts.error(err, 'Failed to query all users.'))\n          .then(users => { $ctrl.users = users; }),\n\n        userProfileService.query(state.getCurrentCenterId(), { activeMembers: true })\n          .catch(err => dwAlerts.error(err, 'Failed to query members.'))\n          .then(members => { $ctrl.members = members; }),\n\n        priceListService.getPricelists(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to query price lists.'))\n          .then(priceLists => {\n            $ctrl.monthlyPriceList = priceLists.find(obj => obj.name === 'Monthly Plans');\n            return priceListService.getPricelist(state.getCurrentCenterId(), $ctrl.monthlyPriceList.id)\n              .then(monthlyPriceList => { $ctrl.monthlyPriceList = monthlyPriceList; });\n          }),\n\n        ReservationUnit.query(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to query reservation units'))\n          .then(resUnits => { $ctrl.reservationUnits = resUnits; }),\n      ]);\n    }\n\n    /**\n     * Import Row hook\n     */\n    function importRow($ctrl, row, rowMeta, mapping, fields) {\n      const billingMethods = fields.find(obj => obj.id === 'billingMethod').type.options;\n      const countries = fields.find(obj => obj.id === 'addressCountry').type.options;\n      const recurringProductIdx = mapping.indexOf('recurringProduct');\n      // const renewalTerms = fields.find(obj => obj.id === 'renewalTerm').type.options;\n      // const renewalNoticePeriods = fields.find(obj => obj.id === 'renewalNoticePeriod').type.options;\n\n      const user = {\n        id: rowMeta.id || undefined, //|| helper.uid(),\n        firstName: helper.trim(row[mapping.indexOf('firstName')]),\n        lastName: helper.trim(row[mapping.indexOf('lastName')]),\n        company: helper.trim(row[mapping.indexOf('company')]),\n        login: helper.trim(row[mapping.indexOf('login')]),\n        password: helper.trim(row[mapping.indexOf('password')]),\n        passwordConfirmation: helper.trim(row[mapping.indexOf('password')]),\n        email: helper.trim(row[mapping.indexOf('email')]),\n        //occupation: helper.trim(row[cmap.occupation.col]),\n        comments: helper.trim(row[mapping.indexOf('comments')]),\n        leadSource: importParsers.options(row[mapping.indexOf('leadSource')], $ctrl.leadSources),\n        membershipStatus: optsMembershipStatus.find(obj => obj.id === 'nonMember'),\n        billingMethod: importParsers.options(row[mapping.indexOf('billingMethod')], billingMethods),\n      };\n\n      const recurringCharges = [];\n      const riOrig = $ctrl.sheet.data.indexOf(row);\n      let ri = riOrig;\n      while(ri < $ctrl.sheet.data.length && ($ctrl.sheet.rowsMeta[ri].subgroup || ri === riOrig ||\n                                             $ctrl.sheet.rowsMeta[ri].headRow || $ctrl.sheet.rowsMeta[ri].empty)) {\n        const rMeta = $ctrl.sheet.rowsMeta[ri];\n        const rData = $ctrl.sheet.data[ri];\n\n        if (!rMeta.ignore && !rMeta.headRow && !rMeta.empty && helper.trim(rData[recurringProductIdx])) {\n          const rc = recurringChargeService.new();\n          rc.priceListProduct = {};\n          const rcProduct = importParsers.options(rData[recurringProductIdx], $ctrl.products) || {};\n          rc.priceListProduct.id = $ctrl.monthlyPriceList.products.find(obj => obj.productId === rcProduct.id).id;\n          rc.priceListProduct.productId = rcProduct.id;\n          rc.priceListProduct.priceListId = $ctrl.monthlyPriceList.id;\n          rc.name = rcProduct.name;\n          rc.nextBillDate = importParsers.date(rData[mapping.indexOf('recurringNextBillDate')]) || moment();\n          rc.quantity = importParsers.uint(rData[mapping.indexOf('recurringQuantity')]) || 1;\n          rc.discountValue = importParsers.currency(rData[mapping.indexOf('recurringDiscount')]);\n          if (rc.discountValue) {\n            rc.discountType = optsDiscountType[1]; // $\n            rc.discountTrialOccurrences = { id: importParsers.uint(rData[mapping.indexOf('recurringMonthsOfDiscount')]) || 1 };\n          }\n          rc.attachedReservationUnitId = (importParsers.options(rData[mapping.indexOf('recurringAttachedReservationUnit')], $ctrl.reservationUnits) || {}).id;\n          // rc.renewalDate = importParsers.date(rData[mapping.indexOf('renewalDate')]);\n          // rc.renewalTerm = (importParsers.options(rData[mapping.indexOf('renewalTerm')], renewalTerms) || {}).id;\n          // rc.renewalNoticePeriod = (importParsers.options(rData[mapping.indexOf('renewalNoticePeriod')], renewalNoticePeriods) || {}).id;\n\n          recurringCharges.push(rc);\n        }\n\n        ri++;\n      }\n\n      // Member if has membership product, otherwise, non-member\n      if (recurringCharges.length) {\n        user.membershipProduct = importParsers.options(recurringCharges[0].name, $ctrl.products);\n        user.membershipStatus = optsMembershipStatus.find(obj => obj.id === 'active');\n        user.membershipType = { id: user.membershipProduct.membershipTypeId };\n        user.membershipPriceList = $ctrl.monthlyPriceList;\n      }\n\n      const address = userProfileService.address.new();\n      address.street = helper.trim(row[mapping.indexOf('addressStreet')]);\n      address.city = helper.trim(row[mapping.indexOf('addressCity')]);\n      address.country = importParsers.options(row[mapping.indexOf('addressCountry')], countries);\n      address.state = optsState[address.country.id] ?\n        importParsers.options(row[mapping.indexOf('addressState')], optsState[address.country.id]) :\n        helper.trim(row[mapping.indexOf('addressState')]);\n      address.zip = helper.trim(row[mapping.indexOf('addressZip')]);\n\n      const phone = userProfileService.phone.new();\n      phone.number = helper.trim(row[mapping.indexOf('phoneNumber')]);\n\n      const printerCode = userProfileService.printerCode.new();\n      printerCode.code = helper.trim(row[mapping.indexOf('printerCode')]);\n\n      const mailbox = userProfileService.mailbox.new();\n      mailbox.number = helper.trim(row[mapping.indexOf('mailboxNumber')]);\n\n      const accessCard = {\n        number: helper.trim(row[mapping.indexOf('accessCode')]),\n        effectiveDate: $filter('date')(moment(), 'yyyy-MM-dd'),\n      };\n\n      return userProfileService.save(state.getCurrentCenterId(), user)\n        .then(() => {\n          if (rowMeta.id) { // existing user, create recurring charge if doesn't exist\n            if (!user.membershipProduct) return user;\n\n            return recurringChargeService.query(state.getCurrentCenterId(), user.id)\n              .then(reccurings => {\n                return $q.all(recurringCharges.map(rc => {\n                  rc.id = (reccurings.find(obj => obj.productName === rc.name) || {}).id || rc.id;\n                  return recurringChargeService.save(state.getCurrentCenterId(), user.id, rc);\n                }))\n                  .then(() => user);\n              });\n          }\n\n          const promises = [];\n          promises.push(userProfileService.address.save(state.getCurrentCenterId(), user.id, address));\n          promises.push(userProfileService.phone.save(state.getCurrentCenterId(), user.id, phone));\n\n          if (printerCode.code !== '') {\n            promises.push(userProfileService.printerCode.save(state.getCurrentCenterId(), user.id, printerCode));\n          }\n\n          if (mailbox.number !== '') {\n            promises.push(userProfileService.mailbox.save(state.getCurrentCenterId(), user.id, mailbox));\n          }\n\n          if (accessCard.number !== '') {\n            accessCard.userId = user.id;\n            promises.push(systemService.createAccessCard(state.getCurrentCenterId(), accessCard));\n          }\n\n          recurringCharges.forEach(rc => {\n            promises.push(recurringChargeService.save(state.getCurrentCenterId(), user.id, rc));\n          });\n\n          return $q.all(promises)\n            .then(() => user);\n        });\n    }\n\n    /**\n     * Wire Row hook\n     */\n    function wireRow($ctrl, rowObj, rowMeta, rowsMeta) {\n      if (rowMeta.subgroup === 'recurring') {\n        let ownerIdx = rowsMeta.indexOf(rowMeta) - 1;\n        while(ownerIdx >= 0 && (rowsMeta[ownerIdx].empty || rowsMeta[ownerIdx].headRow || rowsMeta[ownerIdx].subgroup)) ownerIdx--;\n        rowMeta.ignore = rowMeta.ignore || rowsMeta[ownerIdx].ignore;\n        rowMeta.id = rowsMeta[ownerIdx].id;\n        return rowMeta.id;\n      }\n\n      rowMeta.id = ($ctrl.users.find(obj => obj.fullName === rowObj.firstName + ' ' + rowObj.lastName) || {}).id || null;\n\n      if (rowMeta.id) {\n        const isMember = !!$ctrl.members.find(obj => obj.fullName === rowObj.firstName + ' ' + rowObj.lastName);\n        if (!isMember && rowObj.recurringProduct && angular.isUndefined(rowMeta.ignore)) {\n          rowMeta.ignore = false;\n        }\n      }\n\n      return rowMeta.id;\n    }\n  });\n","import keese from 'shared/drag-n-drop/keese.service';\n\n/**\n * Hooks for Import -> Membership Products\n */\nexport default angular.module('deskworks.importHooksMembershipProducts', [\n  keese.name,\n  'deskworks.dwAlerts',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.importParsers',\n  'deskworks.inventory.product.service',\n  'deskworks.inventory.priceList.service',\n  'deskworks.inventory.membershipCategory.service',\n  'deskworks.ProductCategory',\n])\n\n  .factory('importHooksMembershipProducts', function($q, dwAlerts, helper, state, importParsers, keese, ProductCategory,\n                                                     productService, priceListService, membershipCategoryService) {\n    return {\n      init: init,\n      preImport: preImport,\n      importRow: importRow,\n      wireRow: wireRow,\n    };\n\n    /**\n     * Init hook\n     */\n    function init($ctrl) {\n      return $q.all([\n        productService.getProducts()\n          .catch(err => dwAlerts.error(err, 'Failed to get products.'))\n          .then(products => {\n            $ctrl.products = products.filter(product => product.type === 'membership');\n            $ctrl.productsRental = products.filter(product => product.type === 'rental');\n          }),\n\n        getPriceLists($ctrl),\n\n        membershipCategoryService.query()\n          .catch(err => dwAlerts.error(err, 'Failed to get membership categories.'))\n          .then(membershipCategories => { $ctrl.membershipCategories = angular.copy(membershipCategories); }),\n\n        ProductCategory.query()\n          .catch(err => dwAlerts.error(err, 'Failed to query product categories.'))\n          .then(categories => { $ctrl.productCategories = angular.copy(categories); }),\n      ]);\n\n      function getPriceLists($ctrl) {\n        const priceList = { name: 'Monthly Plans', visibleForVisitors: true, useFor: 'members' };\n\n        return priceListService.getPricelists(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to get price lists.'))\n          .then(priceLists => {\n            const found = priceLists.find(obj => obj.name === priceList.name);\n            return found || priceListService.save(state.getCurrentCenterId(), priceList)\n              .catch(err => dwAlerts.error(err, 'Failed to create \"' + priceList.name + '\" price list.'))\n              .then(() => priceList);\n          })\n          .then(priceList =>\n            priceListService.getPricelist(state.getCurrentCenterId(), priceList.id)\n              .catch(err => dwAlerts.error(err, 'Failed to get price list ' + priceList.name + '.'))\n          )\n          .then(priceList => { $ctrl.monthlyPriceList = priceList; });\n      }\n    }\n\n    /**\n     * Pre-Import hook\n     */\n    function preImport($ctrl, sheet, fields) {\n      const promises = [];\n      sheet.data.forEach((row, ri) => {\n        const rowMeta = sheet.rowsMeta[ri];\n        if (rowMeta.ignore || rowMeta.headRow || rowMeta.empty) return;\n\n        let value = helper.trim(row[sheet.mapping.indexOf('membershipCategory')]);\n        let membershipCategory = importParsers.options(value, $ctrl.membershipCategories);\n\n        if (!membershipCategory) {\n          membershipCategory = {\n            name: value,\n            order: keese.generate($ctrl.membershipCategories.length && $ctrl.membershipCategories[$ctrl.membershipCategories.length - 1].order),\n            note: helper.trim(row[sheet.mapping.indexOf('description')]),\n          };\n          $ctrl.membershipCategories.push(membershipCategory);\n          promises.push(\n            membershipCategoryService.save(membershipCategory)\n            .catch(err => dwAlerts.error(err, 'Failed to create membership category.'))\n          );\n        }\n\n        value = helper.trim(row[sheet.mapping.indexOf('productCategoryCode')]);\n        let productCategory = helper.find($ctrl.productCategories, { code: value });\n\n        if (!productCategory) {\n          productCategory = {\n            code: value,\n            name: helper.trim(row[sheet.mapping.indexOf('productCategoryName')]),\n          };\n          $ctrl.productCategories.push(productCategory);\n          promises.push(\n            ProductCategory.save(productCategory)\n              .catch(err => dwAlerts.error(err, 'Failed to create product category.'))\n          );\n        }\n      });\n\n      return $q.all(promises);\n    }\n\n    /**\n     * Import Row hook\n     */\n    function importRow($ctrl, row, rowMeta, mapping, fields) {\n      const product = productService.new();\n      product.id = rowMeta.id || undefined;\n      product.name = helper.trim(row[mapping.indexOf('name')]);\n      product.membershipType = importParsers.options(row[mapping.indexOf('membershipCategory')], $ctrl.membershipCategories);\n      product.isCreditable = importParsers.bool(row[mapping.indexOf('isCreditable')]);\n      product.hasPasses = importParsers.bool(row[mapping.indexOf('hasPasses')]);\n      product.passProduct = importParsers.options(row[mapping.indexOf('passProduct')], $ctrl.productsRental);\n      product.showInSelfRegistration = importParsers.bool(row[mapping.indexOf('showInSelfRegistration')]);\n      product.productCategoryId = helper.find($ctrl.productCategories, { code: helper.trim(row[mapping.indexOf('productCategoryCode')]) }).id;\n      product.productNumber = importParsers.uint(row[mapping.indexOf('productNumber')]);\n      product.description = helper.trim(row[mapping.indexOf('description')]);\n\n      return productService.save(product)\n        .then(result => { if (!rowMeta.id && result.id) $ctrl.products.push(product); })\n        .then(() => {\n          const monthlyItem = {\n            id: ($ctrl.monthlyPriceList.products.find(obj => obj.productId === product.id) || {}).id,\n            priceListId: $ctrl.monthlyPriceList.id,\n            price: importParsers.currency(row[mapping.indexOf('price')]),\n            reservationCredit: product.isCreditable ? importParsers.currency(row[mapping.indexOf('reservationCredit')]) : undefined,\n            passQty: product.hasPasses ? importParsers.uint(row[mapping.indexOf('passQty')]) : undefined,\n          };\n\n          return productService.savePriceItem(product.id, monthlyItem)\n            .then(() => {\n              if (!$ctrl.monthlyPriceList.products.find(obj => obj.productId === product.id))\n                $ctrl.monthlyPriceList.products.push(monthlyItem);\n            });\n        })\n        .then(() =>  product);\n    }\n\n    /**\n     * Wire Row hook\n     */\n    function wireRow($ctrl, rowObj, rowMeta) {\n      rowMeta.id = ($ctrl.products.find(obj => obj.name === rowObj.name) || {}).id || null;\n      if (rowMeta.id) {\n        const monthlyPriceItem = $ctrl.monthlyPriceList.products.find(obj => obj.productId === rowMeta.id) || {};\n        if(monthlyPriceItem.price != importParsers.currency(rowObj.price) && angular.isUndefined(rowMeta.ignore)) {\n          rowMeta.ignore = false;\n        }\n      }\n\n      return rowMeta.id;\n    }\n  });\n","/**\n * Hooks for Import -> Other Products\n */\nexport default angular.module('deskworks.importHooksOtherProducts', [\n  'deskworks.dwAlerts',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.importParsers',\n  'deskworks.inventory.product.service',\n  'deskworks.inventory.priceList.service',\n  'deskworks.reservationCategory.service',\n  'deskworks.ProductCategory',\n])\n\n  .factory('importHooksOtherProducts', function($q, dwAlerts, helper, state, importParsers, ProductCategory,\n                                                productService, priceListService, reservationCategoryService) {\n    return {\n      init: init,\n      preImport: preImport,\n      importRow: importRow,\n      wireRow: wireRow,\n    };\n\n    /**\n     * Init hook\n     */\n    function init($ctrl) {\n      return $q.all([\n        productService.getProducts()\n          .catch(err => dwAlerts.error(err, 'Failed to get products.'))\n          .then(products => {\n            $ctrl.products = products.filter(product => product.type !== 'membership');\n          }),\n\n        getPriceLists($ctrl),\n\n        reservationCategoryService.query(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to load reservation categories.'))\n          .then(reservationCategories => { $ctrl.reservationCategories = reservationCategories; }),\n\n        ProductCategory.query()\n          .catch(err => dwAlerts.error(err, 'Failed to query product categories.'))\n          .then(categories => { $ctrl.productCategories = angular.copy(categories); }),\n      ]);\n\n      function getPriceLists($ctrl) {\n        const requiredPriceLists = [\n          { name: 'Monthly Plans', visibleForVisitors: true, useFor: 'members' },\n          { name: 'Walkin', visibleForVisitors: true, useFor: 'nonMembers' },\n        ];\n\n        return priceListService.getPricelists(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to get price lists.'))\n          .then(priceLists => {\n            return $q.all(requiredPriceLists.map(plist => {\n              const found = priceLists.find(obj => obj.name === plist.name);\n              return found || priceListService.save(state.getCurrentCenterId(), plist)\n                .catch(err => dwAlerts.error(err, 'Failed to create \"' + plist.name + '\" price list.'))\n                .then(() => plist);\n            }));\n          })\n          .then(priceLists => {\n            return $q.all(priceLists.map((plist, index) =>\n              priceListService.getPricelist(state.getCurrentCenterId(), plist.id)\n                .catch(err => dwAlerts.error(err, 'Failed to get price list ' + plist.name + '.'))\n            ));\n          })\n          .then(priceLists => {\n            $ctrl.monthlyPriceList = priceLists[0];\n            $ctrl.walkinPriceList = priceLists[1];\n          });\n      }\n    }\n\n    /**\n     * Pre-Import hook\n     */\n    function preImport($ctrl, sheet, fields) {\n      const promises = [];\n      sheet.data.forEach((row, ri) => {\n        const rowMeta = sheet.rowsMeta[ri];\n        if (rowMeta.ignore || rowMeta.headRow || rowMeta.empty) return;\n\n        const value = helper.trim(row[sheet.mapping.indexOf('productCategoryCode')]);\n        let productCategory = helper.find($ctrl.productCategories, { code: value });\n        if (!productCategory) {\n          productCategory = {\n            code: value,\n            name: helper.trim(row[sheet.mapping.indexOf('productCategoryName')]),\n          };\n          $ctrl.productCategories.push(productCategory);\n          promises.push(\n            ProductCategory.save(productCategory)\n              .catch(err => dwAlerts.error(err, 'Failed to create product category.'))\n          );\n        }\n      });\n\n      return $q.all(promises);\n    }\n\n    /**\n     * Import Row hook\n     */\n    function importRow($ctrl, row, rowMeta, mapping, fields) {\n      const product = productService.new();\n      product.id = rowMeta.id || undefined;\n      product.name = helper.trim(row[mapping.indexOf('name')]);\n      product.type = importParsers.options(row[mapping.indexOf('type')], fields.find(obj => obj.id === 'type').type.options);\n      product.allowReservationCredits = importParsers.bool(row[mapping.indexOf('allowReservationCredits')]);\n      product.passSize = importParsers.uint(row[mapping.indexOf('passSize')]);\n      product.productCategoryId = helper.find($ctrl.productCategories, { code: helper.trim(row[mapping.indexOf('productCategoryCode')]) }).id;\n      product.productNumber = importParsers.uint(row[mapping.indexOf('productNumber')]);\n      product.description = helper.trim(row[mapping.indexOf('description')]);\n      product.reservationTypeId = (importParsers.options(row[mapping.indexOf('reservationCategory')], $ctrl.reservationCategories) || {}).id;\n\n      return productService.save(product)\n        .then(result => { // sync saved product\n          if (!rowMeta.id && result.id) $ctrl.products.push(product);\n          return result;\n        })\n        .then(() => {\n          const monthlyItem = {\n            id: ($ctrl.monthlyPriceList.products.find(obj => obj.productId === product.id) || {}).id,\n            priceList: $ctrl.monthlyPriceList,\n            priceListId: $ctrl.monthlyPriceList.id,\n            price: importParsers.currency(row[mapping.indexOf('monthlyPrice')]),\n          };\n\n          const walkingItem = {\n            id: ($ctrl.walkinPriceList.products.find(obj => obj.productId === product.id) || {}).id,\n            priceList: $ctrl.walkinPriceList,\n            priceListId: $ctrl.walkinPriceList.id,\n            price: importParsers.currency(row[mapping.indexOf('walkinPrice')]),\n          };\n\n          return $q.all([monthlyItem, walkingItem]\n            .filter(priceItem => priceItem.price || priceItem.price == 0) // jshint ignore:line\n            .map(priceItem => {\n              const priceList = priceItem.priceList; delete priceItem.priceList;\n              return productService.savePriceItem(product.id, priceItem)\n                .then(() => {\n                  if (!priceList.products.find(obj => obj.productId === product.id)) priceList.products.push(priceItem);\n                });\n            })\n          )\n            .then(() => product);\n        });\n    }\n\n    /**\n     * Wire Row hook\n     */\n    function wireRow($ctrl, rowObj, rowMeta) {\n      rowMeta.id = ($ctrl.products.find(obj => obj.name === rowObj.name) || {}).id || null;\n\n      if (rowMeta.id) {\n        const monthlyPriceItem = $ctrl.monthlyPriceList.products.find(obj => obj.productId === rowMeta.id) || {};\n        if (monthlyPriceItem.price != importParsers.currency(rowObj.monthlyPrice) && angular.isUndefined(rowMeta.ignore)) {\n          rowMeta.ignore = false;\n        }\n\n        const walkinPriceItem = $ctrl.monthlyPriceList.products.find(obj => obj.productId === rowMeta.id) || {};\n        if (walkinPriceItem.price != importParsers.currency(rowObj.walkinPrice) && angular.isUndefined(rowMeta.ignore)) {\n          rowMeta.ignore = false;\n        }\n      }\n\n      return rowMeta.id;\n    }\n  });\n","/**\n * Hooks for Import -> Reservation Categories\n */\nexport default angular.module('deskworks.importHooksReservationCategories', [\n  'deskworks.dwAlerts',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.reservationCategory.service',\n])\n\n  .factory('importHooksReservationCategories', function(dwAlerts, helper, state, reservationCategoryService) {\n    return {\n      init: init,\n      importRow: importRow,\n      wireRow: wireRow,\n    };\n\n    /**\n     * Init hook\n     */\n    function init($ctrl) {\n      return reservationCategoryService.query(state.getCurrentCenterId())\n        .catch(err => dwAlerts.error(err, 'Failed to load reservation categories.'))\n        .then(reservationCategories => { $ctrl.reservationCategories = reservationCategories; });\n    }\n\n    /**\n     * Import Row hook\n     */\n    function importRow($ctrl, row, rowMeta, mapping) {\n      const resCategory = {\n        id: rowMeta.id || undefined,\n        name: helper.trim(row[mapping.indexOf('name')]),\n        description: helper.trim(row[mapping.indexOf('description')]),\n      };\n\n      return reservationCategoryService.save(state.getCurrentCenterId(), resCategory)\n        .then(result => { // sync saved reservation\n          if (!rowMeta.id && result.id) $ctrl.reservationCategories.push({ id: result.id, name: resCategory.name });\n          return result;\n        });\n    }\n\n    /**\n     * Wire Row hook\n     */\n    function wireRow($ctrl, rowObj) {\n      return ($ctrl.reservationCategories.find(obj => obj.name === rowObj.name) || {}).id || null;\n    }\n  });\n","import ReservationUnit from 'shared/services/inventory/reservation-unit.service';\n\n/**\n * Hooks for Import -> Reservation Units\n */\nexport default angular.module('deskworks.importHooksReservationUnits', [\n  'deskworks.dwAlerts',\n  'deskworks.helper',\n  'deskworks.state',\n  'deskworks.importParsers',\n  'deskworks.reservationRules.service',\n  'deskworks.reservationCategory.service',\n  'deskworks.inventory.product.service',\n  'deskworks.reservationRules.optsWhoCanReserve',\n  ReservationUnit.name,\n])\n\n  .factory('importHooksReservationUnits', function($q, dwAlerts, helper, state, importParsers, ReservationRules,\n                                                   reservationCategoryService, ReservationUnit, productService,\n                                                   optsWhoCanReserve) {\n    return {\n      init: init,\n      importRow: importRow,\n      wireRow: wireRow,\n    };\n\n    /**\n     * Init hook\n     */\n    function init($ctrl) {\n      return $q.all([\n        reservationCategoryService.query(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to load reservation categories.'))\n          .then(reservationCategories => { $ctrl.reservationCategories = reservationCategories; }),\n        ReservationUnit.query(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to load reservation units.'))\n          .then(reservationUnits => { $ctrl.reservationUnits = reservationUnits; }),\n        productService.getMembershipProducts(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to load membership products.'))\n          .then(products => { $ctrl.productsMembership = products; }),\n      ]);\n    }\n\n    /**\n     * Import Row hook\n     */\n    function importRow($ctrl, row, rowMeta, mapping, fields) {\n      const resUnit = {\n        id: rowMeta.id || undefined,\n        name: helper.trim(row[mapping.indexOf('name')]),\n        reservationTypeId: (importParsers.options(row[mapping.indexOf('reservationCategory')], $ctrl.reservationCategories) || {}).id,\n        fullTimeProductId: (importParsers.options(row[mapping.indexOf('fullTimeProduct')], $ctrl.productsMembership) || {}).id,\n      };\n\n      return ReservationUnit.save(state.getCurrentCenterId(), resUnit)\n        .then(result => { // sync saved reservation unit\n          if (!rowMeta.id && result.id) $ctrl.reservationUnits.push({ id: result.id, name: resUnit.name });\n          return result;\n        })\n        .then(result =>\n          ReservationRules.query({ centerId: state.getCurrentCenterId(), reservationUnitId: resUnit.id })\n            .then(rules => {\n              const rule = rules.find(obj => obj.uid === 'whoCanReserve');\n              rule.value = (importParsers.options(row[mapping.indexOf('whoCanReserve')], optsWhoCanReserve) || {}).id;\n              return ReservationRules.save({ centerId: state.getCurrentCenterId(), reservationUnitId: resUnit.id }, rule);\n            })\n            .then(() => result)\n        )\n    }\n\n    /**\n     * Wire Row hook\n     */\n    function wireRow($ctrl, rowObj) {\n      return ($ctrl.reservationUnits.find(obj => obj.name === rowObj.name) || {}).id || null;\n    }\n  });\n","export default angular.module('deskworks.SetupImportCtrl', [\n  'ngStorage',\n  'deskworks.state',\n  'deskworks.importSteps',\n  'deskworks.importStepInit',\n  'deskworks.importStepImport',\n  'deskworks.importStepComplete',\n  'deskworks.purge.service',\n])\n  .controller('SetupImportCtrl', function($scope, $localStorage, dwAlerts, state, importSteps, purgeService) {\n    const $ctrl = this;\n\n    let importVersion = 1; // increment it when import code gets breaking changes\n\n    /**\n     * Load previous import data from local storage\n     */\n    $localStorage.import = $localStorage.import || {};\n    const importStorage = $localStorage.import;\n\n    Object.keys(importStorage).forEach(key => { // clean up non-versioned and obsolete data\n      const match = key.match(/^v(\\d+)$/i);\n      if (!match || match && +match[1] !== importVersion) delete importStorage[key];\n    });\n\n    const localStorage = importStorage['v' + importVersion] = importStorage['v' + importVersion] || {};\n    const $ls = $scope.$ls = localStorage[state.getCurrentCenterId()] = localStorage[state.getCurrentCenterId()] || {}; // import data is stored per center\n\n    $ls.step = $ls.step || 0; // init default values\n    $ls.sheets = $ls.sheets || [];\n    $ctrl.steps = importSteps;\n\n    $scope.$watch('$ls.step', () => { state.setPageTitle('Import ' + $ctrl.steps[$ls.step].name); });\n\n    $ctrl.purge = () => {\n      if (!window.confirm('It will purge all data. Are you sure?')) return;\n\n      return purgeService.purgeMembers()\n        .catch(err => dwAlerts.error(err, 'Failed to purge members.'))\n        .then(() => purgeService.purgeProducts()\n          .catch(err => dwAlerts.error(err, 'Failed to purge products.'))\n        )\n        .then(() => purgeService.purgePriceLists(state.getCurrentCenterId())\n          .catch(err => dwAlerts.error(err, 'Failed to purge price lists.'))\n        )\n        .then(() => purgeService.purgeMembershipTypes()\n          .catch(err => dwAlerts.error(err, 'Failed to purge membership categories.'))\n        )\n        .then(() => purgeService.purgeReservationCategories()\n          .catch(err => dwAlerts.error(err, 'Failed to purge reservation categories.'))\n        )\n        .then(() => {\n          Object.keys(localStorage).forEach(key => {\n            localStorage[key].step = 0;\n            localStorage[key].sheets.splice(0, localStorage[key].sheets.length);\n          });\n        });\n    };\n  });\n","// Module\nvar code = \"<div id=\\\"setupImport\\\"> <h1 class=\\\"page-title\\\">{{state.getPageTitle()}}</h1> <import-step-init ng-if=\\\"$ctrl.steps[$ls.step].id === 'init'\\\" step=\\\"$ls.step\\\" sheets=\\\"$ls.sheets\\\" purge=\\\"$ctrl.purge\\\"></import-step-init> <import-step-import ng-if=\\\"$ctrl.steps[$ls.step].id !== 'init' && $ctrl.steps[$ls.step].id !== 'complete'\\\" step=\\\"$ls.step\\\" sheets=\\\"$ls.sheets\\\" purge=\\\"$ctrl.purge\\\"></import-step-import> <import-step-complete ng-if=\\\"$ctrl.steps[$ls.step].id === 'complete'\\\" step=\\\"$ls.step\\\" sheets=\\\"$ls.sheets\\\" purge=\\\"$ctrl.purge\\\"></import-step-complete> </div> \";\n// Exports\nmodule.exports = code;","/**\n * Steps for Setup -> Import wizard\n */\nexport default angular.module('deskworks.importSteps', [\n  'deskworks.importFieldsReservationCategories', 'deskworks.importHooksReservationCategories',\n  'deskworks.importFieldsReservationUnits', 'deskworks.importHooksReservationUnits',\n  'deskworks.importFieldsOtherProducts', 'deskworks.importHooksOtherProducts',\n  'deskworks.importFieldsMembershipProducts', 'deskworks.importHooksMembershipProducts',\n  'deskworks.importFieldsMembers', 'deskworks.importHooksMembers',\n])\n\n  .factory('importSteps', function(importFieldsReservationCategories, importHooksReservationCategories,\n                                   importFieldsReservationUnits, importHooksReservationUnits,\n                                   importFieldsOtherProducts, importHooksOtherProducts,\n                                   importFieldsMembershipProducts, importHooksMembershipProducts,\n                                   importFieldsMembers, importHooksMembers) {\n\n    return [\n      {\n        id: 'init',\n        name: 'Wizard',\n      },\n      {\n        id: 'reservationCategories',\n        name: 'Reservation Categories',\n        sheetPattern: /Reservation\\s+Categories/i,\n        fields: importFieldsReservationCategories,\n        hooks: importHooksReservationCategories,\n      },\n      {\n        id: 'otherProducts',\n        name: 'Other Products',\n        sheetPattern: /Products.+Prices$/i,\n        fields: importFieldsOtherProducts,\n        hooks: importHooksOtherProducts,\n      },\n      {\n        id: 'membershipProducts',\n        name: 'Membership Products',\n        sheetPattern: /Membership.+Products.+Prices/i,\n        fields: importFieldsMembershipProducts,\n        hooks: importHooksMembershipProducts,\n      },\n      {\n        id: 'reservationUnits',\n        name: 'Reservation Units',\n        sheetPattern: /Reservation\\s+Units/i,\n        fields: importFieldsReservationUnits,\n        hooks: importHooksReservationUnits,\n      },\n      {\n        id: 'members',\n        name: 'Members',\n        sheetPattern: /Members.+Recurring.+Billing/i,\n        fields: importFieldsMembers,\n        hooks: importHooksMembers,\n      },\n      {\n        id: 'complete',\n        name: 'Complete',\n      },\n    ];\n  });\n","/**\n * Sort keys generator. Based on node-keese v1.1.1: https://github.com/thejoshwolfe/node-keese\n */\nexport default angular.module('keese', [])\n  .factory('keese', function() {\n\n    const alphabet = \"0123456789?@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n    const radix = alphabet.length;\n    const order_specifier = '~'; // bigger than any from the alphabet\n\n    /**\n     * Character to numerical value aka index of the character: \"0\": 0, \"z\": 63, etc.\n     */\n    const values = (function() {\n      const values = {};\n      for (let i = 0; i < alphabet.length; i++) values[alphabet[i]] = i;\n      return values;\n    })();\n\n    return {\n      /**\n       * Main exported function. Generates new sort key.\n       * @param low - previous sort key or null/undefined\n       * @param high - next sort key or null/undefined\n       * @param count - if defined - the result is an Array of size count values\n       * @returns {*} - single key or array of keys, depending on count\n       */\n      generate: function keese(low, high, count) {\n        if (count) {\n          return multi_keese(low, high, count);\n        } else {\n          return single_keese(low, high);\n        }\n      }\n    };\n\n    function single_keese(low, high) {\n      if (!low) {\n        if (!high) {\n          return '1'; // return anything above 0\n        } else {\n          return average('0', high); // go smaller\n        }\n      } else {\n        if (!high) {\n          return increment(low); // go bigger\n        } else {\n          return average(low, high); // go in between\n        }\n      }\n    }\n    function multi_keese(low, high, count) {\n      let result = new Array(count);\n      if (count > 0) {\n        if (!high) {\n          for (let i = 0; i < count; i++) { // just allocate straight forward\n            const value = keese(low, null);\n            result[i] = value;\n            low = value;\n          }\n        } else {\n          recurse(low, high, 0, count); // binary tree descent\n        }\n      }\n      return result;\n      function recurse(low_value, high_value, low_index, high_index) {\n        const mid_index = Math.floor((low_index + high_index) / 2);\n        const mid_value = single_keese(low_value, high_value);\n        result[mid_index] = mid_value;\n        if (low_index < mid_index) recurse(low_value, mid_value, low_index, mid_index);\n        if (mid_index + 1 < high_index) recurse(mid_value, high_value, mid_index + 1, high_index);\n      }\n    }\n\n    function increment(value) {\n      const n = parse(value);\n      n.digits = n.digits.substr(0, n.order_length + 1); // drop the fraction\n      return add(n, parse(\"1\"));\n    }\n\n    function average(low, high) {\n      if (low > high) {\n        throw new Error('assertion failed: ' + JSON.stringify(low) + \" < \" + JSON.stringify(high));\n      }\n      const a = parse(low);\n      const b = parse(high);\n      pad_to_equal_order(a, b);\n      let b_carry = 0;\n      const max_digit_length = Math.max(a.digits.length, b.digits.length);\n      for (let i = 0; i < max_digit_length || b_carry > 0; i++) {\n        const a_value =            values[a.digits[i]] || 0;\n        const b_value = b_carry + (values[b.digits[i]] || 0);\n        if (a_value === b_value) continue;\n        if (a_value === b_value - 1) {\n          b_carry = radix; // we need more digits, but remember that b is ahead\n          continue;\n        }\n        // we have a distance of at least 2 between the values.\n        // half the distance floored is sure to be a positive single digit.\n        let half_distance_value = Math.floor((b_value - a_value) / 2);\n        let half_distance_digits = '';\n        for (let j = 0; j < i; j++)\n          half_distance_digits += '0';\n        half_distance_digits += alphabet[half_distance_value];\n        const half_distance = parse(construct(a.order_length, half_distance_digits));\n        // truncate insignificant digits of a\n        a.digits = a.digits.substr(0, i + 1);\n        return add(a, half_distance);\n      }\n      throw new Error(); // unreachable\n    }\n\n    function add(a, b) {\n      pad_to_equal_order(a, b);\n      let result_digits = \"\";\n      let order_length = a.order_length;\n      let value = 0;\n      for (let i = Math.max(a.digits.length, b.digits.length) - 1; i >= 0; i--) {\n        value += values[a.digits[i]] || 0;\n        value += values[b.digits[i]] || 0;\n        result_digits = alphabet[value % radix] + result_digits;\n        value = Math.floor(value / radix);\n      }\n      // overflow up to moar digits\n      while (value > 0) {\n        result_digits = alphabet[value % radix] + result_digits;\n        value = Math.floor(value / radix);\n        order_length++;\n      }\n      return construct(order_length, result_digits);\n    }\n\n    function parse(value) {\n      const order_length = value.lastIndexOf(order_specifier) + 1;\n      return {\n        order_length: order_length,\n        digits: value.substr(order_length)\n      };\n    }\n    function construct(order_length, digits) {\n      while (order_length > 0 && digits.charAt(0) == '0') { // strip unnecessary leading zeros\n        digits = digits.substr(1);\n        order_length--;\n      }\n      let result = \"\";\n      for (let i = 0; i < order_length; i++)\n        result += order_specifier;\n      return result + digits;\n    }\n\n    function pad_to_equal_order(a, b) {\n      pad_in_place(a, b.order_length);\n      pad_in_place(b, a.order_length);\n    }\n    function pad_in_place(n, order_length) {\n      while (n.order_length < order_length) {\n        n.digits = \"0\" + n.digits;\n        n.order_length++;\n      }\n    }\n  });\n","/* (ignored) */","/* (ignored) */","/* (ignored) */"],"sourceRoot":""}