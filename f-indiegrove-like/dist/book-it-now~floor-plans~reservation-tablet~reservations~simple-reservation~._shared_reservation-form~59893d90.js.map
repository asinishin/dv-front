{"version":3,"sources":["webpack:///./shared/reservation-form/rc-date-selector.component.js","webpack:///./shared/reservation-form/rc-date-selector.scss?22ea","webpack:///./shared/reservation-form/rc-date-selector.tpl.html","webpack:///./shared/reservation-form/res-drag-select.directive.js","webpack:///./shared/reservation-form/res-reservation.component.js","webpack:///./shared/reservation-form/res-reservation.scss?0537","webpack:///./shared/reservation-form/res-reservation.tpl.html","webpack:///./shared/reservation-form/time-selector.directive.js","webpack:///./shared/reservation-form/time-selector.scss?103c","webpack:///./shared/reservation-form/time-selector.tpl.html"],"names":["angular","module","component","template","controller","bindings","mode","date","$scope","$ctrl","$watch","moment","isMoment","weekStart","clone","startOf","weekEnd","endOf","prev","subtract","next","add","directive","restrict","scope","bindToController","start","end","slots","limitMin","scale","$element","$timeout","$rds","scaleDefault","limitMinDefault","$onInit","prevIndex","clickDisabled","touchY","wrapper","addEventListener","onMouseDown","onMouseMove","onSelectStart","onClick","onTouchStart","onTouchEnd","onTouchMove","$onDestroy","removeEventListener","$onChanges","min","Math","max","size","event","action","touches","length","touchTimer","cancel","clientY","resetSelection","buttons","movementY","preventDefault","slotHeight","querySelector","offsetHeight","cls","target","className","indexOf","movementCount","index","indexFromEvent","slot","dir","reserved","available","$apply","direction","reservedLength","buffer","isRangeOk","s","e","i","stopImmediatePropagation","stopPropagation","maxFrames","reset","counter","window","getSelection","empty","removeAllRanges","document","selection","requestAnimationFrame","wrapperY","getBoundingClientRect","top","wrapperScrollY","scrollTop","eventY","floor","niceTimeDirective","name","fdFieldDirective","center","calData","user","reservationPrices","reservationFields","hideReservationCostEstimate","hideRecurringReservations","afterSave","hideCalendarBtn","signOut","stopWizard","backFn","nextFn","hideStaffOnlyUnits","$filter","$interval","$route","$window","session","dwAlerts","helper","rcHelper","state","reservationService","calendarService","ReservationCost","optsRepeatFrequency","navCalendar","role","getParam","some","resType","reservationUnits","resUnit","idx","reservations","id","current","params","reservationId","reservation","setParam","replace","floorDate","from","timeStart","to","timeEnd","reservationTitle","title","reservationNote","repeatFrequency","findByKeyValue","repeatDuration","repeatDurationOptions","emailConfirmation","filterCalData","initReservationUnit","bindParamsToUrl","newVal","oldVal","fetch","timer","$watchGroup","reservationType","reservationCost","calcSync","getCurrentCenterId","reload","pointFirstInvalid","setPath","getPath","onNextClick","totalCost","calcTotalCost","confirmation","customPriceFields","fields","field","type","f","value","extraPriceFields","reduce","cost","$$deserialize","makeReservation","data","centerId","reservationUnitId","reservationUnit","isDefined","res","$$serialize","save","catch","err","error","then","updateReservation","cancelReservation","delete","force","fetching","query","result","finally","back","hasRecurring","isAdmin","val","dateToStr","newDatePart","year","month","set","nv","obj","reservationTypes","isArray","forEach","item","availabilities","whoCanReserve","push","reservationCategoryId","qFields","JSON","parse","resDragSelectDirective","link","addClass","$translate","userRoles","currentUserId","getCurrentUserId","timeStartInitial","timeEndInitial","elem","offsetTop","generateSlots","selectionStart","hours","minutes","selectionEnd","ceil","previousValue","currentValue","isSame","markAvailable","markReservations","markOptional","adjustSelection","selectTime","selecting","time","selectClear","getSlotClass","$index","userId","optional","selected","getSlotTitle","opts","instant","availability","idxFrom","hour","minute","idxTo","availableCount","count","halves","text","diff","fStart","fEnd","makeBuffer","userCompany","userName","freeOutermostSlots","j"],"mappings":"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","file":"book-it-now~floor-plans~reservation-tablet~reservations~simple-reservation~._shared_reservation-form~59893d90.js?_rev=576b208f101975996991","sourcesContent":["import './rc-date-selector.scss';\nimport template from './rc-date-selector.tpl.html';\n\n/**\n * rcDateSelector component - complex date selector for DeskWorks reservation calendar\n */\nexport default angular.module('deskworks.rcDateSelector', [])\n\n  .component('rcDateSelector', {\n    template,\n    controller: 'RcDateSelectorController as $ctrl',\n    bindings: {\n      mode: '<',\n      date: '=',\n    },\n  })\n\n  .controller('RcDateSelectorController', function($scope) { 'use strict';\n    const $ctrl = this;\n\n    /**\n     * Watch for $ctrl.date and recalculate $ctrl.weekStart and $ctrl.weekEnd\n     */\n    $scope.$watch('$ctrl.date', () => {\n      if (!moment.isMoment($ctrl.date)) return;\n      $ctrl.weekStart = $ctrl.date.clone().startOf('week');\n      $ctrl.weekEnd = $ctrl.weekStart.clone().endOf('week');\n    });\n\n    /**\n     * Previous date\n     */\n    $ctrl.prev = function() {\n      if (!moment.isMoment($ctrl.date)) return;\n      $ctrl.date = $ctrl.date.clone().subtract($ctrl.mode === 'week' ? 7 : 1, 'd');\n    };\n\n    /**\n     * Next date\n     */\n    $ctrl.next = function() {\n      if (!moment.isMoment($ctrl.date)) return;\n      $ctrl.date = $ctrl.date.clone().add($ctrl.mode === 'week' ? 7 : 1, 'd');\n    };\n  });\n","// extracted by extract-css-chunks-webpack-plugin","// Module\nvar code = \"<div ng-show=\\\"$ctrl.mode === 'day'\\\" class=\\\"day-mode\\\"> <ff-col class=\\\"day-pictogram\\\" flex=\\\"0 0 auto\\\"> <div class=\\\"rc-pictogram\\\" title=\\\"Click to pick date\\\"> <ff-datepicker-popup tabindex=\\\"0\\\" ff-model=\\\"$ctrl.date\\\"></ff-datepicker-popup> <ff-row> <div class=\\\"serifs\\\"><hr><hr><hr></div> </ff-row> <span ng-bind=\\\"$ctrl.date | date:'dd'\\\"></span> </div> <div class=\\\"weekday\\\"> <span ng-bind=\\\"$ctrl.date | date:'EEE'\\\"></span> <div class=\\\"prev\\\" title=\\\"{{'RESERVATIONS.DATE_SELECTOR.DAY.PREV.HINT' | translate}}\\\" ng-click=\\\"$ctrl.prev()\\\"></div> <div class=\\\"next\\\" title=\\\"{{'RESERVATIONS.DATE_SELECTOR.DAY.NEXT.HINT' | translate}}\\\" ng-click=\\\"$ctrl.next()\\\"></div> </div> </ff-col> <div class=\\\"bar\\\" translate=\\\"RESERVATIONS.DATE_SELECTOR.DAY.EXTRA\\\" translate-values=\\\"{ month: ($ctrl.date | date:'MMMM'), year: ($ctrl.date | date:'yyyy') }\\\">></div> </div> <div ng-show=\\\"$ctrl.mode === 'week'\\\" class=\\\"week-mode\\\"> <div class=\\\"week-pictogram\\\" flex=\\\"0 0 auto\\\"> <div class=\\\"rc-pictogram\\\"> <ff-row> <div class=\\\"serifs\\\"><hr><hr><hr><hr><hr><hr></div> </ff-row> <span ng-bind=\\\"($ctrl.weekStart | date:'dd') + '-' +  ($ctrl.weekEnd | date:'dd')\\\"></span> </div> <div class=\\\"prev\\\" title=\\\"{{'RESERVATIONS.DATE_SELECTOR.WEEK.PREV.HINT' | translate}}\\\" ng-click=\\\"$ctrl.prev()\\\"></div> <div class=\\\"next\\\" title=\\\"{{'RESERVATIONS.DATE_SELECTOR.WEEK.NEXT.HINT' | translate}}\\\" ng-click=\\\"$ctrl.next()\\\"></div> </div> <div class=\\\"bar\\\" translate=\\\"RESERVATIONS.DATE_SELECTOR.WEEK.EXTRA\\\" translate-values=\\\"{ month: ($ctrl.date | date:'MMMM'), year: ($ctrl.date | date:'yyyy') }\\\"></div> </div> \";\n// Exports\nmodule.exports = code;","export default angular.module('deskworks.resDragSelectDirective', [])\n\n  .directive('resDragSelect', () => {\n\n    return {\n      restrict: 'A',\n      scope: true,\n      controller: 'ResDragSelectDirectiveCtrl as $rds',\n      bindToController: {\n        start: '=',\n        end: '=',\n        slots: '<',\n        limitMin: '<',\n        scale: '<',\n      },\n    };\n  })\n\n  .controller('ResDragSelectDirectiveCtrl', function($scope, $element, $timeout) {\n    const $rds = this;\n\n    const scaleDefault = 30; // min\n    const limitMinDefault = 15; // min\n\n    /**\n     * $onInit\n     */\n    $rds.$onInit = () => {\n      $rds.prevIndex = null;\n      $rds.clickDisabled = false;\n      $rds.touchY = null;\n\n      const wrapper = $element[0];\n      wrapper.addEventListener('mousedown', onMouseDown, true);\n      wrapper.addEventListener('mousemove', onMouseMove, true);\n      wrapper.addEventListener('selectstart', onSelectStart, true);\n      // document.addEventListener('selectionchange', onSelectStart);\n      wrapper.addEventListener('click', onClick, true);\n      wrapper.addEventListener('touchstart', onTouchStart, true);\n      wrapper.addEventListener('touchend', onTouchEnd, true);\n      wrapper.addEventListener('touchcancel', onTouchEnd, true);\n      wrapper.addEventListener('touchmove', onTouchMove, true);\n    };\n\n    /**\n     * $onDestroy\n     */\n    $rds.$onDestroy = () => {\n      const wrapper = $element[0];\n      wrapper.removeEventListener('mousedown', onMouseDown, true);\n      wrapper.removeEventListener('mousemove', onMouseMove, true);\n      wrapper.removeEventListener('selectstart', onSelectStart, true);\n      // document.removeEventListener('selectionchange', onSelectStart);\n      wrapper.removeEventListener('click', onClick, true);\n      wrapper.removeEventListener('touchstart', onTouchStart, true);\n      wrapper.removeEventListener('touchend', onTouchEnd, true);\n      wrapper.removeEventListener('touchcancel', onTouchEnd, true);\n      wrapper.removeEventListener('touchmove', onTouchMove, true);\n    };\n\n    $rds.$onChanges = () => {\n      const min = Math.max($rds.limitMin ? $rds.limitMin * 60 : limitMinDefault, $rds.scale || scaleDefault);\n      $rds.size = min / ($rds.scale || scaleDefault);\n    }\n\n    function onTouchStart(event) {\n      $rds.action = null;\n      if (event.touches.length !== 1) { return; }\n      if ($rds.touchTimer) { $timeout.cancel($rds.touchTimer); }\n      $rds.touchTimer = $timeout(() => {\n        $rds.touchTimer = null;\n        $rds.touchY = event.touches[0].clientY;\n        onMouseDown(event);\n        // ripple({ x: event.touches[0].clientX, y: event.touches[0].clientY });\n        resetSelection(100);\n      }, 300);\n      resetSelection();\n    }\n\n    function onTouchEnd(event) {\n      if ($rds.touchTimer) { $timeout.cancel($rds.touchTimer); $rds.touchTimer = null; }\n      $rds.action = null;\n      resetSelection();\n      // if (event.touches.length !== 1) { return; }\n    }\n\n    function onTouchMove(event) {\n      if ($rds.touchTimer) {\n        $timeout.cancel($rds.touchTimer);\n        $rds.touchTimer = null;\n      }\n      if (event.touches.length !== 1) { return; }\n\n      if ($rds.action) {\n        event.buttons = 1;\n        event.clientY = event.touches[0].clientY;\n        event.movementY = event.clientY - $rds.touchY;\n        $rds.touchY = event.clientY;\n\n        event.preventDefault();\n        resetSelection();\n\n        onMouseMove(event);\n      }\n    }\n\n    function onMouseDown(event) {\n      $rds.slotHeight = ($element[0].querySelector('.slot') || {}).offsetHeight || 37;\n      $rds.prevIndex = null;\n      $rds.clickDisabled = false;\n\n      const cls = event.target.className;\n      if (cls.indexOf('selected-from') >= 0) {\n        $rds.action = 'start';\n      } else if (cls.indexOf('selected-to') >= 0) {\n        $rds.action = 'end';\n      } else if (cls.indexOf('selected-outline-inner') >= 0) {\n        $rds.action = 'move';\n      } else {\n        $rds.action = 'direction';\n        $rds.movementY = 0;\n        $rds.movementCount = 0;\n      }\n    }\n\n    function onMouseMove(event) {\n      if (!event.buttons || !$rds.action) { return; } // no mouse button pressed\n\n      $rds.clickDisabled = true;\n\n      const index = indexFromEvent(event);\n      const slot = $rds.slots[index];\n      const dir = $rds.prevIndex !== null ? index - $rds.prevIndex : 0;\n\n      if (slot.reserved || !slot.available) { return; }\n\n      $scope.$apply(() => {\n        switch ($rds.action) {\n          case 'direction': // obtaining drag start direction\n            $rds.movementY += event.movementY;\n            if ($rds.movementCount > 1) {\n              $rds.action = 'reselect';\n              $rds.direction = Math.min(Math.max(-1, $rds.movementY), 1) || 1;\n            }\n            $rds.movementCount++;\n            return;\n          case 'reselect':\n            if ($rds.direction >= 0 && index < $rds.slots.length - 1 && !slot.reservedLength && !slot.buffer && isRangeOk(index, index + $rds.size)) {\n              $rds.start = index;\n              $rds.end = index + $rds.size;\n              $rds.action = 'end';\n            } else if (index > 0 && isRangeOk(index - $rds.size, index)) {\n              $rds.start = index - $rds.size;\n              $rds.end = index;\n              $rds.action = 'start';\n            }\n            $rds.prevIndex = index;\n            return;\n          case 'start':\n            if (index < $rds.end && $rds.end - index >= $rds.size && isRangeOk(index, $rds.end)) {\n              $rds.start = index;\n              $rds.prevIndex = index;\n            }\n            return;\n          case 'end':\n            if (index > $rds.start && index - $rds.start >= $rds.size && isRangeOk($rds.start, index)) {\n              $rds.end = index;\n              $rds.prevIndex = index;\n            }\n            return;\n          case 'move':\n            if ((dir < 0 && $rds.start > 0 || dir > 0 && $rds.end < $rds.slots.length - 1) && isRangeOk($rds.start + dir, $rds.end + dir)\n            ) {\n              $rds.start += dir;\n              $rds.end += dir;\n            }\n            $rds.prevIndex = index;\n            return;\n        }\n      });\n    }\n\n    function isRangeOk(start, end) {\n      const s = Math.min(start, end);\n      const e = Math.max(start, end);\n\n      if (s < 0 || e >= $rds.slots.length) { return false; }\n\n      for (let i = s; i <= e; i++) {\n        const slot = $rds.slots[i];\n        if (slot.reserved || !slot.available) {\n          return false;\n        }\n        if (slot.reservedLength && i !== end) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    function onSelectStart(event) {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      event.stopPropagation();\n      resetSelection();\n    }\n\n    function resetSelection(maxFrames = 10) {\n      reset(0);\n\n      function reset(counter) {\n        if (window.getSelection) {\n          if (window.getSelection().empty) { window.getSelection().empty(); }\n          else if (window.getSelection().removeAllRanges) { window.getSelection().removeAllRanges(); }\n        }\n        else if (document.selection) { document.selection.empty(); }\n\n        if (counter < maxFrames) {\n          window.requestAnimationFrame(() => reset(counter + 1));\n        }\n      }\n    }\n\n    // function ripple({ x, y }) {\n    //   const ripple = angular.element($element[0].querySelector('#ripple'));\n    //   ripple.removeClass('ripple');\n    //   ripple.css('left', `${Math.floor(x - 5)}px`);\n    //   ripple.css('top', `${Math.floor(y - 5)}px`);\n    //   window.requestAnimationFrame(() => { ripple.addClass('ripple'); });\n    //   $timeout(() => ripple.removeClass('ripple'), 300);\n    // }\n\n    function onClick(event) {\n      if ($rds.clickDisabled) {\n        event.stopPropagation();\n      }\n    }\n\n    function indexFromEvent(event) {\n      const wrapperY = $element[0].getBoundingClientRect().top;\n      const wrapperScrollY = $element[0].scrollTop;\n      const eventY = event.clientY;\n      return Math.min(Math.max(Math.floor((eventY - wrapperY + wrapperScrollY) / $rds.slotHeight), 0), $rds.slots.length - 1);\n    }\n  });\n","import './rc-date-selector.component';\nimport './time-selector.directive';\nimport './res-reservation.scss';\nimport template from './res-reservation.tpl.html';\nimport niceTimeDirective from 'shared/nice-date-time/nice-time.directive';\nimport fdFieldDirective from 'shared/form-design/fd-field.directive';\n\n/**\n * resReservation component - reservation create/edit dialog for DeskWorks reservation calendar\n */\nexport default angular.module('deskworks.resReservation', [\n  'deskworks.rcHelper',\n  'deskworks.reservationUnit.optsRepeatFrequency',\n  'deskworks.timeSelector',\n  'deskworks.reservationService',\n  'deskworks.calendarService',\n  'deskworks.rcDateSelector',\n  'deskworks.ReservationCost',\n  niceTimeDirective.name,\n  fdFieldDirective.name,\n])\n\n  .directive('resReservation', function() {\n    return {\n      template,\n      scope: true,\n      controller: 'ResReservationController as $ctrl',\n      bindToController: {\n        center: '<',\n        calData: '<',\n        user: '<',\n        reservationPrices: '<',\n        reservationFields: '<',\n        hideReservationCostEstimate: '<',\n        hideRecurringReservations: '<',\n        afterSave: '<',\n        hideCalendarBtn: '<',\n        signOut: '<',\n        stopWizard: '<',\n        backFn: '&?back',\n        nextFn: '&?next',\n        hideStaffOnlyUnits: '<',\n      },\n    };\n  })\n\n  .controller('ResReservationController', function($scope, $filter, $interval, $route, $window, session,\n                                                   dwAlerts, helper, rcHelper, state, reservationService,\n                                                   calendarService, ReservationCost, optsRepeatFrequency) {\n    const $ctrl = this;\n\n    /**\n     * $onInit\n     */\n    $ctrl.$onInit = function() {\n      $scope.state = state;\n      $ctrl.optsRepeatFrequency = optsRepeatFrequency;\n      $ctrl.afterSave = $ctrl.afterSave || $ctrl.navCalendar;\n      $ctrl.role = state.getParam('role');\n\n      // Find reservation by its id\n      $ctrl.calData.some(resType => {\n        return resType.reservationUnits.some(resUnit => {\n          const idx = resUnit.reservations.findIndex(i => i.id === +$route.current.params.reservationId);\n          if (idx >= 0) {\n            $ctrl.reservation = resUnit.reservations[idx];\n            resUnit.reservations.splice(idx, 1);\n            state.setParam('unit', resUnit.id).replace();\n          }\n          return !!$ctrl.reservation;\n        });\n      });\n\n      /**\n       * $onChanges\n       */\n      $ctrl.$onChanges = function() {\n        $ctrl.afterSave = $ctrl.afterSave || $ctrl.navCalendar;\n      };\n\n      $ctrl.date = $filter('toDate')($route.current.params.date || state.getParam('date'));\n      $ctrl.date = moment.isMoment($ctrl.date) ? $ctrl.date : moment();\n      rcHelper.floorDate($ctrl.date, 30);\n\n      var date = $ctrl.reservation && $ctrl.reservation.from || $filter('toDate')(state.getParam('start'));\n      $ctrl.timeStart = moment.isMoment(date) ? date : null;\n      date = $ctrl.reservation && $ctrl.reservation.to || $filter('toDate')(state.getParam('end'));\n      $ctrl.timeEnd = moment.isMoment(date) && $ctrl.timeStart ? date : null;\n\n      $ctrl.reservationTitle = state.getParam('title') || ($ctrl.reservation ? $ctrl.reservation.title : '');\n      $ctrl.reservationNote = state.getParam('note') || $ctrl.reservation && $ctrl.reservation.reservationNote;\n      $ctrl.repeatFrequency = helper.findByKeyValue($ctrl.optsRepeatFrequency, 'id', state.getParam('freq')) || $ctrl.optsRepeatFrequency[0];\n      $ctrl.repeatDuration = state.getParam('duration') && +state.getParam('duration') || $ctrl.repeatFrequency.repeatDurationOptions && $ctrl.repeatFrequency.repeatDurationOptions[0];\n      $ctrl.emailConfirmation = true; // !!state.getParam('confirm');\n\n      $scope.$watch('$ctrl.calData', () => {\n        filterCalData();\n        initReservationUnit();\n      });\n\n      bindParamsToUrl();\n\n      $scope.$watch('$ctrl.date', (newVal, oldVal) => {\n        if (newVal !== oldVal) { // prevent duplicate fetch on initialization (due to $resolve.calData)\n          $ctrl.fetch(true);\n        } else {\n          $interval.cancel($ctrl.timer);\n          $ctrl.timer = $interval($ctrl.fetch, 1000 * 60);\n        }\n      });\n\n      // Calc reservation price\n      $scope.$watchGroup(['$ctrl.reservationType', '$ctrl.timeStart', '$ctrl.timeEnd'], () => {\n        if (!$ctrl.reservationType || !$ctrl.timeStart || !$ctrl.timeEnd) {\n          $ctrl.reservationCost = null;\n          return;\n        }\n\n        $ctrl.reservationCost = ReservationCost.calcSync($ctrl.timeStart, $ctrl.timeEnd, $ctrl.reservationPrices, $ctrl.reservationType.id);\n      });\n\n      /**\n       * Reload route on center change\n       */\n      $scope.$watch(() => state.getCurrentCenterId(), (newVal, oldVal) => {\n        if (newVal !== oldVal) $route.reload();\n      });\n    };\n\n    /**\n     * Destroy\n     */\n    $ctrl.$onDestroy = function() {\n      $interval.cancel($ctrl.timer);\n    };\n\n    /**\n     * Next button handler (for Simple Reservation flow)\n     */\n    $ctrl.next = function() {\n      if (helper.pointFirstInvalid('.sr-time')) return;\n      return state.setPath(state.getPath() + '/users');\n    };\n\n    /**\n     * On Make/Update Reservation button click\n     */\n    $ctrl.onNextClick = () => {\n      if (helper.pointFirstInvalid('.res-container')) return;\n      if ($ctrl.nextFn) {\n        return $ctrl.nextFn();\n      } else {\n        $ctrl.totalCost = calcTotalCost();\n        $ctrl.confirmation = true;\n      }\n    };\n\n    function calcTotalCost() {\n      const customPriceFields = $ctrl.reservationType.fields\n        .filter(field => field.type === 'customPrice')\n        .filter(f => f.value || f.value === 0);\n\n      const extraPriceFields = $ctrl.reservationType.fields\n        .filter(field => field.type === 'extraPrice')\n        .filter(f => f.value || f.value === 0);\n\n      let totalCost = customPriceFields.reduce((cost, field) => cost + field.$$deserialize(field, field.value), 0);\n\n      if (!customPriceFields.length) {\n        totalCost = $ctrl.reservationCost;\n      }\n\n      totalCost += $ctrl.reservationType.fields\n        .filter(field => field.type === 'extraPrice')\n        .filter(f => f.value || f.value === 0)\n        .reduce((cost, field) => cost + field.$$deserialize(field, field.value), 0);\n\n      return totalCost;\n    }\n\n    /**\n     * Make new reservation\n     */\n    $ctrl.makeReservation = function() {\n      const data = {\n        from: $ctrl.timeStart,\n        to: $ctrl.timeEnd,\n        title: $ctrl.reservationTitle,\n        reservationNote: $ctrl.reservationNote,\n        centerId: $ctrl.center.id,\n        reservationUnitId: $ctrl.reservationUnit.id,\n        emailConfirmation: $ctrl.emailConfirmation,\n        repeatFrequency: $ctrl.repeatFrequency.id,\n        repeatDuration: angular.isDefined($ctrl.repeatFrequency.repeatDurationOptions) ? $ctrl.repeatDuration : '',\n        fields: $ctrl.reservationType.fields\n          .filter(f => f.value || f.value === 0 || f.value === false)\n          .reduce((res, f) => (res[f.id] = f.$$serialize(f, f.value), res), {}),\n      };\n\n      return reservationService.save($ctrl.center.id, $ctrl.user.id, data)\n        .catch(err => dwAlerts.error(err, 'Failed to save reservation.'))\n        .then(() => $ctrl.afterSave());\n    };\n\n    /**\n     * Update reservation\n     */\n    $ctrl.updateReservation = function() {\n      const data = {\n        id: $ctrl.reservation.id,\n        reservationUnitId: $ctrl.reservationUnit.id,\n        from: $ctrl.timeStart,\n        to: $ctrl.timeEnd,\n        title: $ctrl.reservationTitle,\n        reservationNote: $ctrl.reservationNote,\n        emailConfirmation: $ctrl.emailConfirmation,\n        fields: $ctrl.reservationType.fields\n          .filter(f => f.value || f.value === 0 || f.value === false)\n          .reduce((res, f) => (res[f.id] = f.$$serialize(f, f.value), res), {}),\n      };\n\n      return reservationService.save($ctrl.center.id, $ctrl.user.id, data)\n        .catch(err => dwAlerts.error(err, 'Failed to update reservation.'))\n        .then(() => $ctrl.afterSave());\n    };\n\n    /**\n     * Cancel reservation\n     */\n    $ctrl.cancelReservation = function() {\n      return reservationService.delete($ctrl.center.id, $ctrl.user.id, $ctrl.reservation.id, $ctrl.emailConfirmation)\n        .catch(err => dwAlerts.error(err, 'Failed to cancel reservation.'))\n        .then(() => $ctrl.afterSave());\n    };\n\n    /**\n     * Fetches calendar data from server (reservation categories, reservation units, reservations, availability)\n     */\n    $ctrl.fetch = function(force) {\n      $interval.cancel($ctrl.timer);\n\n      if ($ctrl.fetching && !force) return; // skip fetching when called by timer\n\n      $ctrl.fetching = true;\n      return calendarService.query(state.getCurrentCenterId() || $route.current.params.centerId, $ctrl.date, $ctrl.date, $ctrl.role)\n        .catch(err => dwAlerts.error(err, 'Failed to fetch calendar data.'))\n        .then(result => { $ctrl.calData = result; })\n        .finally(() => {\n          $ctrl.fetching = false;\n          $interval.cancel($ctrl.timer);\n          $ctrl.timer = $interval($ctrl.fetch, 1000 * 60);\n        });\n    };\n\n    /**\n     * Navigate to reservation calendar\n     */\n    $ctrl.navCalendar = function() {\n      state.setParam('unit', null);\n      state.setParam('start', null);\n      state.setParam('end', null);\n      state.setParam('confirm', null);\n      state.setParam('freq', null);\n      state.setParam('duration', null);\n      state.setParam('title', null);\n      state.setParam('note', null);\n      state.setParam('fields', null);\n      return state.setPath('/reservation-calendar');\n    };\n\n    /**\n     * Back button handler\n     */\n    $ctrl.back = state.back;\n\n    /**\n     * Whether recurring settings are available\n     */\n    $ctrl.hasRecurring = () => !$ctrl.reservation && (session.isAdmin() || !$ctrl.hideRecurringReservations);\n\n    /**\n     * One-way bind reservation params to URL search params\n     */\n    function bindParamsToUrl() {\n      $scope.$watch('$ctrl.reservationUnit.id', val => { state.setParam('unit', val).replace(); });\n      $scope.$watch('$ctrl.date', val => {\n        state.setParam('date', rcHelper.dateToStr(val)).replace();\n\n        if (moment.isMoment($ctrl.date)) { // update timeStart/timeEnd according to current date\n          const newDatePart = { year: $ctrl.date.year(), month: $ctrl.date.month(), date: $ctrl.date.date() };\n          if (moment.isMoment($ctrl.timeStart)) {\n            $ctrl.timeStart = $ctrl.timeStart.clone().set(newDatePart);\n          }\n          if (moment.isMoment($ctrl.timeEnd)) {\n            $ctrl.timeEnd = $ctrl.timeEnd.clone().set(newDatePart);\n          }\n        }\n      });\n\n      $scope.$watch('$ctrl.timeStart', val => { state.setParam('start', rcHelper.dateToStr(val)).replace(); });\n      $scope.$watch('$ctrl.timeEnd', val => { state.setParam('end', rcHelper.dateToStr(val)).replace(); });\n\n      $scope.$watch('$ctrl.emailConfirmation', val => { state.setParam('confirm', val || null).replace(); });\n      $scope.$watch('$ctrl.repeatFrequency.id', val => { state.setParam('freq', val).replace(); });\n      $scope.$watch('$ctrl.repeatDuration', val => { state.setParam('duration', val).replace(); });\n      $scope.$watch('$ctrl.reservationTitle', val => { state.setParam('title', val).replace(); });\n      $scope.$watch('$ctrl.reservationNote', val => { state.setParam('note', val).replace(); });\n\n      $scope.$watch( // reservation fields\n        () => $ctrl.reservationType.fields.map(f => ({ id: f.id, value: f.value })),\n        nv => {\n          const obj = nv.reduce((res, f) => { if (f.value || f.value === 0 || f.value === false) res[f.id] = f.value; return res; }, {});\n          state.setParam('fields', JSON.stringify(obj));\n        },\n        true\n      );\n    }\n\n    /**\n     * Initialize default reservationUnit passed in URL search\n     */\n    function initReservationUnit() {\n      const val = $route.current.params.reservationUnitId || state.getParam('unit');\n\n      $ctrl.reservationTypes.some(function(resType) {\n        const resUnit = helper.find(resType.reservationUnits, val);\n        if (resUnit) {\n          $ctrl.reservationType = resType;\n          $ctrl.reservationUnit = resUnit;\n          return true;\n        }\n      });\n\n      if (!$ctrl.reservationUnit) {\n        $ctrl.reservationType = $ctrl.reservationTypes[0];\n        $ctrl.reservationUnit = $ctrl.reservationType && $ctrl.reservationType.reservationUnits[0];\n      }\n    }\n\n    /**\n     * Filter raw calendar data\n     */\n    function filterCalData() {\n      $ctrl.reservationTypes = [];\n      if (!angular.isArray($ctrl.calData)) return;\n\n      $ctrl.calData.forEach(resType => {\n        resType.reservationUnits = resType.reservationUnits // replace reservation units with filtered array\n          .filter(item => item.availabilities.length || !$ctrl.hideStaffOnlyUnits && item.whoCanReserve === 'staffOnly');\n\n        // Include non-empty reservation categories only\n        if (resType.reservationUnits.length) {\n          $ctrl.reservationTypes.push(resType); // include reservation category only if it has at least one reservation unit\n          resType.fields = $ctrl.reservationFields // prepare fields\n            .filter(f => f.reservationCategoryId === resType.id || f.reservationCategoryId === 0);\n\n          const qFields = JSON.parse(state.getParam('fields') || \"{}\");\n          resType.fields.forEach(f => f.value = qFields[f.id] || qFields[f.id] === 0 ? qFields[f.id] : (($ctrl.reservation || {}).fields || {})[f.id]);\n        }\n      });\n    }\n  });\n","// extracted by extract-css-chunks-webpack-plugin","// Module\nvar code = \"<form class=\\\"res-container\\\" flex=\\\"1 1 auto\\\" ng-if=\\\"!$ctrl.confirmation && !$ctrl.cancelConfirmation\\\" novalidate ng-style=\\\"{ marginTop: $app.hideHeader ? 0 : null }\\\"> <div class=\\\"res-header\\\"> <h1 class=\\\"page-title\\\" ng-if=\\\"!$ctrl.reservation\\\" translate=\\\"RESERVATIONS.NEW.PAGE_TITLE\\\" translate-values=\\\"{ centerName: $ctrl.center.name }\\\"></h1> <h1 class=\\\"page-title\\\" ng-if=\\\"$ctrl.reservation\\\" translate=\\\"RESERVATIONS.EDIT.PAGE_TITLE\\\" translate-values=\\\"{ centerName: $ctrl.center.name }\\\"></h1> <small translate=\\\"RESERVATIONS.HINT\\\"></small> </div> <ff-row class=\\\"res-body\\\"> <ff-col class=\\\"res-col-opts\\\"> <ff-row flex=\\\"0 0 auto\\\"> <rc-date-selector mode=\\\"'day'\\\" date=\\\"$ctrl.date\\\"></rc-date-selector> </ff-row> <ff-row flex=\\\"0 0 auto\\\"> <ff-select name=\\\"reservationType\\\" ff-model=\\\"$ctrl.reservationType\\\" ff-options=\\\"resType.name for resType in $ctrl.reservationTypes\\\" ff-disabled=\\\"$ctrl.reservation || $ctrl.reservationTypes.length < 2\\\" ff-change=\\\"$ctrl.reservationUnit = $ctrl.reservationType.reservationUnits[0]\\\" aria-label=\\\"{{'RESERVATIONS.CATEGORY' | translate}}\\\"></ff-select> </ff-row> <ff-row flex=\\\"0 0 auto\\\"> <ff-select name=\\\"reservationUnit\\\" ff-model=\\\"$ctrl.reservationUnit\\\" ff-options=\\\"resUnit.name for resUnit in $ctrl.reservationType.reservationUnits\\\" ff-disabled=\\\"$ctrl.reservation || $ctrl.reservationType.reservationUnits.length < 2\\\" aria-label=\\\"{{'RESERVATIONS.SPACE' | translate}}\\\"></ff-select> </ff-row> <ff-row flex=\\\"0 0 auto\\\" ng-if=\\\"!$ctrl.hideReservationCostEstimate && $ctrl.reservationPrices\\\"> <ff-static> <span style=\\\"text-transform:uppercase;max-width:200px\\\"> <strong style=\\\"font-size:.8em\\\"><span translate=\\\"RESERVATIONS.ESTIMATED_COST\\\"></span>:</strong> <strong class=\\\"text-text\\\" ng-bind=\\\"$ctrl.reservationCost | ncurrency | nd\\\"></strong> </span> </ff-static> </ff-row> <ff-row flex=\\\"0 0 auto\\\"> <ff-text name=\\\"reservationTitle\\\" ff-maxlength=\\\"128\\\" ff-model=\\\"$ctrl.reservationTitle\\\" placeholder=\\\"{{('RESERVATIONS.TITLE' | translate)}}\\\" aria-label=\\\"{{('RESERVATIONS.TITLE' | translate)}}\\\"></ff-text> </ff-row> <ff-row flex=\\\"0 1 100px\\\"> <ff-textarea name=\\\"reservationNote\\\" ff-maxlength=\\\"250\\\" ff-model=\\\"$ctrl.reservationNote\\\" placeholder=\\\"{{('RESERVATIONS.NOTES' | translate)}}\\\" aria-label=\\\"{{('RESERVATIONS.NOTES' | translate)}}\\\"></ff-textarea> </ff-row> <div ng-if=\\\"!$ctrl.reservation ? ($ctrl.hideRecurringReservations ? !state.isLoggedMember() && !state.isLoggedNonMember() && !!state.getLoggedUser() : true) : false\\\"> <ff-row flex=\\\"0 0 auto\\\"> <ff-select name=\\\"repeatFrequency\\\" ff-model=\\\"$ctrl.repeatFrequency\\\" ff-options=\\\"opt.name for opt in $ctrl.optsRepeatFrequency\\\" ff-change=\\\"$ctrl.repeatDuration = $ctrl.repeatFrequency.repeatDurationOptions[0]\\\" aria-label=\\\"{{'RESERVATIONS.REPEAT_FREQUENCY' | translate}}\\\"></ff-select> </ff-row> <ff-row flex=\\\"0 0 auto\\\" ng-if=\\\"$ctrl.repeatFrequency.repeatDurationOptions\\\"> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.REPEAT_DURATION\\\"></span></ff-label> <ff-select name=\\\"repeatDuration\\\" flex=\\\"0 1 50px\\\" ff-model=\\\"$ctrl.repeatDuration\\\" ff-options=\\\"opt for opt in $ctrl.repeatFrequency.repeatDurationOptions\\\" aria-label=\\\"{{'RESERVATIONS.REPEAT_DURATION.LABEL' | translate}}\\\"></ff-select> <ff-label>{{$ctrl.repeatFrequency.repeatDurationFilter($ctrl.repeatDuration, true)}}</ff-label> </ff-row> </div> <fd-field field=\\\"field\\\" ng-repeat=\\\"field in $ctrl.reservationType.fields\\\"></fd-field> <ff-btn-group class=\\\"res-buttons\\\" style=\\\"margin-top:.5rem\\\"> <ff-btn sense=\\\"back\\\" ff-click=\\\"$ctrl.backFn()\\\" ng-if=\\\"$ctrl.backFn\\\"> <span translate=\\\"GLOBAL.BTN_BACK\\\"></span> </ff-btn> <ff-btn sense=\\\"save\\\" type=\\\"submit\\\" ff-click=\\\"$ctrl.onNextClick()\\\" ff-disabled=\\\"!$ctrl.timeStart || !$ctrl.timeEnd || !$ctrl.reservationUnit.availabilities.length && $ctrl.reservationUnit.whoCanReserve === 'staffOnly'\\\"> <span translate=\\\"RESERVATIONS.BTN_CREATE\\\" ng-show=\\\"!$ctrl.reservation\\\"></span> <span translate=\\\"RESERVATIONS.BTN_UPDATE\\\" ng-show=\\\"$ctrl.reservation\\\"></span> </ff-btn> <ff-btn sense=\\\"remove\\\" ff-click=\\\"$ctrl.cancelConfirmation = true\\\" ng-if=\\\"$ctrl.reservation\\\"> <span translate=\\\"RESERVATIONS.BTN_DELETE\\\"></span> </ff-btn> <ff-btn sense=\\\"calendar\\\" ff-click=\\\"$ctrl.navCalendar()\\\" ng-if=\\\"!$ctrl.hideCalendarBtn\\\"> <span translate=\\\"RESERVATIONS.BTN_CALENDAR\\\"></span> </ff-btn> <ff-btn sense=\\\"settings\\\" ng-if=\\\"$ctrl.stopWizard\\\" ff-click=\\\"$ctrl.stopWizard()\\\"> <span translate=\\\"GLOBAL.BTN_SETTINGS\\\"></span> </ff-btn> <ff-btn sense=\\\"signOut\\\" ng-if=\\\"$ctrl.signOut\\\" ff-click=\\\"$ctrl.signOut()\\\" ff-countdown=\\\"30\\\"> <span translate=\\\"GLOBAL.BTN_SIGN_OUT\\\"></span> </ff-btn> </ff-btn-group> </ff-col> <ff-col class=\\\"res-col-time\\\"> <div class=\\\"res-current-member\\\" ng-if=\\\"(state.isLoggedAdmin() || state.isMasterProfile()) && ($ctrl.reservation || $ctrl.user)\\\"> <span translate=\\\"RESERVATIONS.USER\\\"></span>: <span ng-bind=\\\"$ctrl.reservation ? $ctrl.reservation.userName : $ctrl.user.fullName\\\"></span> </div> <time-selector date=\\\"$ctrl.date\\\" time-start=\\\"$ctrl.timeStart\\\" time-end=\\\"$ctrl.timeEnd\\\" role=\\\"$ctrl.role\\\" scale=\\\"$ctrl.reservationUnit.scale\\\" buffer=\\\"$ctrl.reservationUnit.buffer\\\" limit-min=\\\"$ctrl.reservationUnit.limitMin\\\" reservations=\\\"$ctrl.reservationUnit.reservations\\\" availabilities=\\\"$ctrl.reservationUnit.availabilities\\\"></time-selector> <ff-info ng-if=\\\"!$ctrl.reservationUnit.availabilities.length && $ctrl.reservationUnit.whoCanReserve === 'staffOnly'\\\" style=\\\"position:absolute;top:0;width:100%;height:100%;padding-top:55px;text-align:center;text-transform:none;font-weight:400;background:rgba(255,255,255,.9);z-index:5\\\" translate=\\\"RESERVATIONS.STAFF_ONLY\\\" translate-values=\\\"{ centerName: $ctrl.center.name, centerPhone: $ctrl.center.phone, centerEmail: $ctrl.center.email }\\\"> </ff-info> </ff-col> </ff-row> </form> <form class=\\\"res-confirm\\\" ng-if=\\\"$ctrl.confirmation || $ctrl.cancelConfirmation\\\" ng-style=\\\"{ marginTop: $app.hideHeader ? 0 : null }\\\"> <div class=\\\"res-header\\\"> <h1 class=\\\"page-title\\\" ng-if=\\\"$ctrl.confirmation\\\" translate=\\\"RESERVATIONS.CONFIRM.PAGE_TITLE\\\"></h1> <h1 class=\\\"page-title\\\" ng-if=\\\"$ctrl.cancelConfirmation\\\" translate=\\\"RESERVATIONS.CANCEL.PAGE_TITLE\\\"></h1> <small translate=\\\"RESERVATIONS.HINT\\\"></small> </div> <ff-col class=\\\"res-confirm-body\\\"> <ff-panel> <ff-row ng-if=\\\"$ctrl.reservation ? $ctrl.reservation.companyName : $ctrl.user.company\\\"> <ff-label flex=\\\"0 1 110px\\\">Company</ff-label> <ff-static ff-bind=\\\"$ctrl.reservation ? $ctrl.reservation.companyName : $ctrl.user.company\\\"></ff-static> </ff-row> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.USER\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.reservation ? $ctrl.reservation.userName : $ctrl.user.firstName + ' ' + $ctrl.user.lastName\\\"></ff-static> </ff-row> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.LOCATION\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.center.name\\\"></ff-static> </ff-row> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.SPACE\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.reservationUnit.name\\\"></ff-static> </ff-row> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.DATE\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.date | date:'mediumDate'\\\"></ff-static> </ff-row> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.TIME\\\"></span></ff-label> <ff-static><span nice-time=\\\"$ctrl.timeStart\\\"></span>&nbsp;-&nbsp;<span nice-time=\\\"$ctrl.timeEnd\\\"></span></ff-static> </ff-row> <div ng-if=\\\"$ctrl.hasRecurring()\\\"> <ff-row> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.REPEAT_FREQUENCY\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.repeatFrequency.name\\\"></ff-static> </ff-row> <ff-row ng-if=\\\"$ctrl.repeatFrequency.repeatDurationOptions\\\"> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.REPEAT_DURATION\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.repeatDuration + ' ' + $ctrl.repeatFrequency.repeatDurationUnit\\\"></ff-static> </ff-row> </div> <ff-row ng-if=\\\"!$ctrl.hideReservationCostEstimate\\\"> <ff-label flex=\\\"0 1 110px\\\"><span translate=\\\"RESERVATIONS.COST\\\"></span></ff-label> <ff-static ff-bind=\\\"$ctrl.totalCost | ncurrency | nd\\\"></ff-static> </ff-row> <label class=\\\"ff-row ff-tmargin\\\" style=\\\"margin-left:.5rem\\\"> <ff-checkbox name=\\\"emailConfirmation\\\" ff-model=\\\"$ctrl.emailConfirmation\\\"> <span translate=\\\"RESERVATIONS.EMAIL_CONFIRMATION\\\"></span> </ff-checkbox> </label> </ff-panel> </ff-col> <ff-btn-group class=\\\"buttons-bottom\\\"> <ff-btn sense=\\\"signOut\\\" ng-if=\\\"$ctrl.signOut\\\" ff-click=\\\"$ctrl.signOut()\\\" ff-countdown=\\\"30\\\"> <span translate=\\\"GLOBAL.BTN_SIGN_OUT\\\"></span> </ff-btn> <ff-btn sense=\\\"cancel\\\" ff-click=\\\"$ctrl.confirmation = $ctrl.cancelConfirmation = false\\\"> <span translate=\\\"GLOBAL.BTN_CANCEL\\\"></span> </ff-btn> <ff-btn sense=\\\"ok\\\" type=\\\"submit\\\" ff-click=\\\"$ctrl.cancelConfirmation ? $ctrl.cancelReservation() : $ctrl.reservation ? $ctrl.updateReservation() : $ctrl.makeReservation()\\\"> <span translate=\\\"GLOBAL.BTN_CONFIRM\\\"></span> </ff-btn> </ff-btn-group> </form> \";\n// Exports\nmodule.exports = code;","import './time-selector.scss';\nimport template from './time-selector.tpl.html';\nimport niceTimeDirective from 'shared/nice-date-time/nice-time.directive';\nimport resDragSelectDirective from './res-drag-select.directive';\n\nexport default angular.module('deskworks.timeSelector', [\n  'deskworks.state',\n  niceTimeDirective.name,\n  resDragSelectDirective.name,\n  'deskworks.userRoles',\n  'session',\n])\n\n  .directive('timeSelector', function() {\n\n    return {\n      template,\n      restrict: 'E',\n      scope: true,\n      controller: 'TimeSelectorDirectiveCtrl as $ctrl',\n      bindToController: {\n        date: '<',\n        reservations: '<',\n        timeStart: '=',\n        timeEnd: '=',\n        availabilities: '<',\n        role: '<?',\n        scale: '<?',\n        buffer: '<?',\n        limitMin: '<?',\n      },\n\n      link: ($scope, $element) => {\n        $element.addClass('time-selector');\n      },\n    };\n  })\n\n  .controller('TimeSelectorDirectiveCtrl', function($scope, $timeout, $filter, $translate, state, userRoles, session) {\n    const $ctrl = this;\n\n    const scaleDefault = 30; // min\n    const limitMinDefault = 15; // min\n\n    /**\n     * $onInit\n     */\n    $ctrl.$onInit = () => {\n      $ctrl.currentUserId = state.getCurrentUserId();\n\n      // store initial times which are passed during instantiating directive\n      $ctrl.timeStartInitial = moment.isMoment($ctrl.timeStart) ? $ctrl.timeStart.clone() : moment();\n      $ctrl.timeEndInitial = moment.isMoment($ctrl.timeEnd) ? $ctrl.timeEnd.clone() : moment();\n\n      $timeout(() => { // scroll to initial date or scroll to 8AM otherwise\n        const wrapper = document.querySelector('.slots-wrapper');\n        const elem = wrapper.querySelector('.slot[time-str=\"' + $filter('date')($ctrl.date, 'HH:mm:00') + '\"]') || wrapper.querySelector('.slot[time-str=\"08:00:00\"]');\n        wrapper.scrollTop = elem.offsetTop;\n      });\n\n      $ctrl.slots = generateSlots();\n\n      $ctrl.selectionStart = $ctrl.timeStart ? Math.floor(($ctrl.timeStart.hours() * 60 + $ctrl.timeStart.minutes()) / ($ctrl.scale || scaleDefault)) : -1;\n      $ctrl.selectionEnd = $ctrl.timeEnd ? Math.ceil($ctrl.selectionStart + (($ctrl.timeEnd - $ctrl.timeStart) / 1000 / 60) / ($ctrl.scale || scaleDefault) - 1)  : -1;\n    };\n\n    /**\n     * $onChanges\n     */\n    $ctrl.$onChanges = params => {\n      if (params.date && moment.isMoment(params.date.previousValue) && !params.date.currentValue.isSame(params.date.previousValue)) {\n        if (!angular.isArray(params.reservations) && !angular.isArray(params.availabilities)) {\n          $ctrl.slots = generateSlots();\n          return;\n        }\n      }\n      $timeout(() => {\n        $ctrl.slots = generateSlots();\n        markAvailable($ctrl.slots);\n        markReservations($ctrl.slots);\n        markOptional($ctrl.slots);\n        adjustSelection();\n      });\n    };\n\n    /**\n     * Select time\n     * @param index\n     */\n    $ctrl.selectTime = (index) => {\n      if ($ctrl.slots[index].reserved || !$ctrl.slots[index].available) return;\n\n      if (!$ctrl.selecting) { // selection starts\n        $ctrl.selecting = true;\n        $ctrl.selectionStart = index;\n        $ctrl.selectionEnd = index;\n      } else { // selection already started\n        if (index > $ctrl.selectionStart) { // selection ends after start, move end\n          $ctrl.selectionEnd = index;\n          $ctrl.selecting = false;\n          for (let i = $ctrl.selectionStart; i <= $ctrl.selectionEnd; i++) { // prevent selecting reserved slots\n            if ($ctrl.slots[i].reserved || $ctrl.slots[i].reservedLength || !$ctrl.slots[i].available) {\n              $ctrl.selectionStart = index;\n              $ctrl.selectionEnd = index;\n              break;\n            }\n          }\n        } else if (index < $ctrl.selectionStart) { // selection ends before start, move start\n          $ctrl.selectionStart = index;\n          $ctrl.selecting = false;\n          for (let i = $ctrl.selectionEnd; i >= $ctrl.selectionStart; i--) { // prevent selecting reserved slots\n            if ($ctrl.slots[i].reserved || $ctrl.slots[i].reservedLength || !$ctrl.slots[i].available) {\n              $ctrl.selectionStart = index;\n              $ctrl.selectionEnd = index;\n              break;\n            }\n          }\n        }\n      }\n      adjustSelection();\n    };\n\n    $scope.$watchGroup(['$ctrl.selectionStart', '$ctrl.selectionEnd'], () => {\n      // adjustSelection();\n\n      if ($ctrl.selectionStart >= 0 && $ctrl.selectionEnd >= 0) { // update timeStart and timeEnd\n        $ctrl.timeStart = $ctrl.slots[$ctrl.selectionStart].time.clone();\n        $ctrl.timeEnd = $ctrl.slots[$ctrl.selectionEnd].time.clone();\n      } else {\n        $ctrl.timeStart = null;\n        $ctrl.timeEnd = null;\n      }\n    });\n\n    function adjustSelection() {\n      const { slots } = $ctrl;\n      const start = $ctrl.selectionStart;\n      const end = $ctrl.selectionEnd;\n      if (start > 0 && end > 0 && (!slots[start].available || slots[start].reserved || !slots[end].available || slots[end].reserved)) {\n        return $ctrl.selectClear();\n      }\n\n      const min = Math.max($ctrl.limitMin ? $ctrl.limitMin * 60 : limitMinDefault, $ctrl.scale || scaleDefault);\n      const size = min / ($ctrl.scale || scaleDefault) + 1;\n\n      if (start < 0 || end < 0 || end - start + 1 >= size) {\n        return;\n      }\n\n      const index = $ctrl.selectionStart;\n      for (let i = index; i < slots.length && i < index + size && slots[i].available && !slots[i].reserved && !(i === index && slots[i].reservedLength); i++) {\n        $ctrl.selectionEnd = i; // forward\n      }\n      for (let i = index - 1; i >= 0 && i > index - size && slots[i].available && !slots[i].reserved && $ctrl.selectionEnd - $ctrl.selectionStart + 1 < size; i--) {\n        $ctrl.selectionStart = i; // backward\n      }\n\n      if ($ctrl.selectionEnd - $ctrl.selectionStart + 1 < size) {\n        $ctrl.selectClear();\n      }\n    }\n\n    /**\n     * Clear selection\n     */\n    $ctrl.selectClear = function() {\n      $ctrl.selectionStart = $ctrl.selectionEnd = -1;\n      $ctrl.timeStart = $ctrl.timeEnd = null;\n      $ctrl.selecting = false;\n    };\n\n    /**\n     * Slot class list generator\n     * @param slot\n     * @param $index\n     * @returns {{reserved: *, \"reserved-own\": (*|boolean), available: boolean, optional: *, selected: (boolean|boolean)}}\n     */\n    $ctrl.getSlotClass = (slot, $index) => ({\n      reserved: slot.reserved,\n      'reserved-own': slot.reserved && $ctrl.currentUserId === slot.userId,\n      available: slot.available,\n      optional: slot.optional,\n      buffer: slot.buffer,\n      selected: ($index === $ctrl.selectionStart && $ctrl.selectionEnd === -1) || ($index >= $ctrl.selectionStart && $index <= $ctrl.selectionEnd),\n    });\n\n    /**\n     * Slot aria-label generator\n     * @param slot\n     * @param index\n     */\n    $ctrl.getSlotTitle = (slot, index) => {\n      let title = slot.available ? 'AVAILABLE' : 'UNAVAILABLE';\n      if (slot.reserved) title = 'RESERVED';\n      if (index === $ctrl.selectionStart && $ctrl.selectionEnd === -1 || index >= $ctrl.selectionStart && index <= $ctrl.selectionEnd) {\n        title = 'SELECTED';\n      }\n      const opts = { from: $filter('date')(slot.time, 'shortTime'), to: $filter('date')(slot.timeEnd, 'shortTime') };\n      return $translate.instant(`RESERVATIONS.TIME_SELECTOR.SLOT.${title}`, opts);\n    };\n\n    /**\n     * Generate slots\n     */\n    function generateSlots() {\n      const slots = [];\n      let date = $ctrl.date.clone().startOf('day');\n      const end = date.clone().add(1, 'd');\n      for (; date <= end; date.add(($ctrl.scale || scaleDefault), 'm')) {\n        slots.push({ reserved: false, time: date.clone(), timeEnd: date.clone().add(($ctrl.scale || scaleDefault), 'm') });\n      }\n\n      return slots;\n    }\n\n    /**\n     * Mark slots as available according to unit.availabilities\n     * @param slots\n     * @returns {*}\n     */\n    function markAvailable(slots) {\n      angular.forEach(slots, slot => { slot.available = false; });\n      angular.forEach($ctrl.availabilities, availability => {\n        const idxFrom = Math.floor((availability.from.hour() * 60 + availability.from.minute()) / ($ctrl.scale || scaleDefault)) + 1;\n        const idxTo = Math.ceil((availability.to.hour() * 60 + availability.to.minute()) / ($ctrl.scale || scaleDefault) || slots.length);\n        for (let i = idxFrom; i < idxTo; i++) {\n          slots[i].available = true;\n        }\n      });\n      return slots;\n    }\n\n    /**\n     * Marks slots as optional. Optional are unavailable from beginning and end of day.\n     * E.g. if available from 10AM - 05PM => optional are 12AM - 10AM and 05PM - 12PM.\n     * If no available slots, it resets optional to prevent displaying empty day.\n     * @param slots - array of slots\n     * @returns {*} - passed array of slots\n     */\n    function markOptional(slots) {\n      const availableCount = slots.reduce((count, slot) => {\n        slot.optional = false; // reset\n        return slot.available ? ++count : count;\n      }, 0);\n\n      if (!availableCount) return slots;\n\n      slots.some(slot => {\n        if (slot.available) return true;\n        slot.optional = true;\n      });\n\n      slots.some((slot, index, halves) => {\n        slot = slots[slots.length - index - 1]; // reverse\n        if (slot.available) return true;\n        slot.optional = true;\n      });\n\n      return slots;\n    }\n\n    /**\n     * Mark slots as reserved according to unit.reservations\n     * @param slots\n     */\n    function markReservations(slots) {\n      if (!moment.isMoment($ctrl.timeStartInitial) || !moment.isMoment($ctrl.timeEndInitial)) $ctrl.selectClear();\n      if (angular.isDefined($ctrl.reservations)) {\n        slots.forEach(slot => { // reset previous reservations\n          slot.reserved = false;\n          slot.buffer = false;\n          delete slot.text;\n          delete slot.userId;\n          delete slot.reservedLength;\n        });\n        $ctrl.reservations.forEach(reservation => {\n          // mark reservation only if it's not equal to our initial reservation (passed on instantiating the directive)\n          // when editing existing reservation, this allows to again select hours that was reserved initially\n          if (moment.isMoment($ctrl.timeStartInitial) && moment.isMoment($ctrl.timeEndInitial)\n            && reservation.from.isSame($ctrl.timeStartInitial) && reservation.to.isSame($ctrl.timeEndInitial)) return;\n\n          const start = reservation.from.diff(reservation.from.clone().startOf('date'), 'minutes') / ($ctrl.scale || scaleDefault);\n          const fStart = Math.floor(start);\n          const end = start + ((reservation.to - reservation.from) / 1000 / 60) / ($ctrl.scale || scaleDefault);\n          let fEnd = Math.ceil(end);\n          fEnd += end !== fEnd ? 1 : 0;\n          makeBuffer({ slots, reservation, index: fStart - 1, direction: -1 }); // pre-buffer\n          for (let i = fStart; i <= fEnd; i++) {\n            slots[i].reserved = true;\n            slots[i].text = reservation.userCompany ? reservation.userCompany + ': ' : '';\n            slots[i].text += '<strong>' + reservation.userName + '</strong>';\n            slots[i].userId = reservation.userId;\n            if (i === fStart) {\n              slots[i].reservedLength = fEnd - fStart + 1;\n            }\n          }\n          makeBuffer({ slots, reservation, index: fEnd }); // post-buffer\n        });\n\n        freeOutermostSlots(slots);\n      }\n\n      function freeOutermostSlots(slots) {\n        // allow clicking outermost slots\n        for (let i = 0, j = slots.length - 1; i < slots.length; i++, j--) {\n          if (slots[i].reserved && slots[i + 1] && !slots[i + 1].reserved && slots[i + 1].available) {\n            slots[i].reserved = false;\n          }\n          if (slots[j].reserved && j > 0 && !slots[j - 1].reserved && slots[j - 1].available) {\n            slots[j].reserved = false;\n          }\n          if (!slots[i].available && slots[i + 1] && slots[i + 1].available && !slots[i + 1].reserved) {\n            slots[i].available = true;\n          }\n          if (!slots[j].available && slots[j - 1] && slots[j - 1].available && !slots[j - 1].reserved) {\n            slots[j].available = true;\n          }\n        }\n      }\n\n      function makeBuffer({ slots, reservation, index, direction = 1 }) {\n        if (!$ctrl.buffer || !slots[index]) return;\n        if ($ctrl.role ? (userRoles[$ctrl.role] || {}).type === 'admin' : session.isAdmin()) return;\n        const size = Math.ceil($ctrl.buffer / ($ctrl.scale || scaleDefault));\n        const end = index + size * direction;\n        for (let i = index; direction > 0 ? i < end : i > end; i += direction) {\n          if (slots[i]) {\n            (slots[i + (direction > 0 ? 1 : 0)] || {}).available = false;\n            if (direction > 0 && i === index && index < slots.length - 1 || direction < 0 && i === end + 1) {\n              slots[i].buffer = size;\n            }\n          }\n        }\n      }\n    }\n\n  });\n","// extracted by extract-css-chunks-webpack-plugin","// Module\nvar code = \"<div class=\\\"hint\\\" translate=\\\"RESERVATIONS.TIME_SELECTOR.HINT\\\"></div> <div class=\\\"slots-wrapper\\\" flex=\\\"1 1 auto\\\" res-drag-select start=\\\"$ctrl.selectionStart\\\" end=\\\"$ctrl.selectionEnd\\\" slots=\\\"$ctrl.slots\\\" limit-min=\\\"$ctrl.limitMin\\\" scale=\\\"$ctrl.scale\\\"> <div class=\\\"slot\\\" ng-repeat=\\\"slot in $ctrl.slots\\\" ng-click=\\\"$ctrl.selectTime($index)\\\" ng-class=\\\"$ctrl.getSlotClass(slot, $index)\\\" index=\\\"{{$index}}\\\" time-str=\\\"{{slot.time | date:'HH:mm:00'}}\\\" aria-label=\\\"{{$ctrl.getSlotTitle(slot, $index)}}\\\"> <div class=\\\"reserved-outline\\\" ng-if=\\\"slot.reservedLength\\\" ng-class=\\\"{ own: $ctrl.currentUserId === slot.userId }\\\"> <div class=\\\"reserved-outline-inner\\\" ng-style=\\\"{ height: 'calc(' + (slot.reservedLength * 100) + '% - 40px)' }\\\"> <span ng-bind-html=\\\"slot.text\\\"></span> </div> </div> <div ng-if=\\\"slot.buffer\\\" class=\\\"buffer-outline\\\"> <div class=\\\"buffer-outline-inner\\\" ng-style=\\\"{ height: 'calc(' + (slot.buffer * 100) + '% - 3px)' }\\\"> <span translate=\\\"RESERVATIONS.RESERVATION_BUFFER\\\"></span> </div> </div> <div class=\\\"time-cell\\\"> <div class=\\\"time\\\" nice-time=\\\"slot.time\\\"></div> </div> </div> <div class=\\\"selected-outline\\\" ng-if=\\\"$ctrl.selectionStart != -1\\\" ng-style=\\\"{ top: $ctrl.selectionStart * 37 + 18.5 + 'px', height: ($ctrl.selectionEnd - $ctrl.selectionStart) * 37 + 'px' }\\\"> <div class=\\\"selected-outline-inner\\\"> <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"diagonal-hatch\\\"> <defs> <pattern id=\\\"diagonalHatch\\\" patternUnits=\\\"userSpaceOnUse\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"105\\\" height=\\\"105\\\"> <g class=\\\"diagonal-hatch-pattern\\\" transform=\\\"translate(105,0) scale(-1,1)\\\"> <path d=\\\"M0 90 l15,15\\\"/> <path d=\\\"M0 75 l30,30\\\"/> <path d=\\\"M0 60 l45,45\\\"/> <path d=\\\"M0 45 l60,60\\\"/> <path d=\\\"M0 30 l75,75\\\"/> <path d=\\\"M0 15 l90,90\\\"/> <path d=\\\"M0 0 l105,105\\\"/> <path d=\\\"M15 0 l90,90\\\"/> <path d=\\\"M30 0 l75,75\\\"/> <path d=\\\"M45 0 l60,60\\\"/> <path d=\\\"M60 0 l45,45\\\"/> <path d=\\\"M75 0 l30,30\\\"/> <path d=\\\"M90 0 l15,15\\\"/> </g> </pattern> </defs> <g> <rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"100%\\\" height=\\\"2000\\\" class=\\\"diagonal-hatch-rect\\\"/> </g> </svg> </div> <div class=\\\"selected-from\\\" ng-show=\\\"$ctrl.selectionStart !== -1\\\" translate=\\\"RESERVATIONS.TIME_SELECTOR.FROM\\\"></div> <div class=\\\"selected-to\\\" ng-show=\\\"$ctrl.selectionEnd !== -1\\\" translate=\\\"RESERVATIONS.TIME_SELECTOR.TO\\\"></div> </div> </div> <div class=\\\"clear-selection\\\"> <button type=\\\"button\\\" class=\\\"btn ff-btn btn-primary\\\" ng-click=\\\"$ctrl.selectClear()\\\" translate=\\\"RESERVATIONS.TIME_SELECTOR.BTN_CLEAR\\\"></button> </div> \";\n// Exports\nmodule.exports = code;"],"sourceRoot":""}