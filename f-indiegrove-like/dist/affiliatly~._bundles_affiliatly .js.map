{"version":3,"sources":["webpack:///./bundles/affiliatly sync \\..+\\/.+\\.js$","webpack:///./bundles/affiliatly/index.js","webpack:///./bundles/affiliatly/services/affiliatly.service.js","webpack:///./bundles/affiliatly/settings/affiliatly-settings.directive.js","webpack:///./bundles/affiliatly/settings/affiliatly-settings.tpl.html"],"names":["index","$injector","importAll","r","js","require","loadNewModules","m","default","name","angular","module","factory","$http","dwAlerts","setupService","url","track","getSettings","then","settings","affiliatlyId","data","mode","id_affiliatly","tracking_parameter","get","aff","hash","document","referer","post","formEncode","withCredentials","headers","params","aid","markPurchase","orderId","total","email","order","price","client_email","getSetupSettings","catch","err","error","key","encodeURIComponent","isObject","toJson","join","directive","template","restrict","scope","controller","bindToController"],"mappings":"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","file":"affiliatly~._bundles_affiliatly .js?_rev=db7ab2510851262149be","sourcesContent":["var map = {\n\t\"./services/affiliatly.service.js\": \"./bundles/affiliatly/services/affiliatly.service.js\",\n\t\"./settings/affiliatly-settings.directive.js\": \"./bundles/affiliatly/settings/affiliatly-settings.directive.js\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"./bundles/affiliatly sync recursive \\\\..+\\\\/.+\\\\.js$\";","const index = ['$injector', function index($injector) {\n  // JS\n  const importAll = r => r.keys().map(r);\n  const js = importAll(require.context('./', true, /\\..+\\/.+\\.js$/));\n  $injector.loadNewModules(js.map(m => m.default.name));\n\n  // // Templates\n  // $injector.invoke(['$templateCache', function($templateCache) {\n  //   const ctx = require.context('./', true, /.*\\.tpl\\.html$/);\n  //   ctx.keys().forEach(key => $templateCache.put(key.replace(/^\\.\\//, ''), ctx(key)));\n  // }]);\n}];\n\nexport default index;\n","export default angular.module('deskworks.Affiliatly', [\n  // 'deskworks.config',\n])\n\n  .factory('Affiliatly', function($http, dwAlerts, setupService) {\n    const url = 'https://www.affiliatly.com/api_request.php';\n\n    return {\n      // track is incomplete\n      track: () => {\n        return getSettings()\n          .then(settings => {\n            const { affiliatlyId } = settings;\n            const data = {\n              mode: 'track-v2',\n              id_affiliatly: affiliatlyId,\n              tracking_parameter: { get: { aff: '1' }, hash: {} },\n            };\n\n            if (document.referer) data.referer = document.referer;\n\n            $http.post(url, formEncode(data), {\n              withCredentials: false,\n              headers : { 'Content-Type': 'application/x-www-form-urlencoded' },\n              params: { aid: affiliatlyId },\n            })\n          // response: user_ip=93.170.114.10&id_user=46&aff_uid=1&duration=7776000&expire_time=1600195899\n          // easy_affiliate: user_ip=93.170.114.10&id_user=25&aff_uid=1&duration=7776000&expire_time=1600187189\n          // SameSite: Lax\n          // POST https://www.affiliatly.com/api_request.php?aid=AF-1032712\n          //  mode: cookie_update\n          // id_affiliatly: AF-1032712\n          // user_ip: 93.170.114.10\n          // id_user: 25\n          // aff_uid: 1\n          // duration: 7776000\n          // expire_time: 1600187189\n          // store_visit: 1\n          });\n      },\n\n      markPurchase: ({ orderId, total, email }) => {\n        return getSettings()\n          .then(settings => {\n            const { affiliatlyId } = settings;\n            if (!affiliatlyId) return;\n\n            const data = {\n              // mode: 'mark_purchase_external',\n              mode: 'mark_shopify',\n              id_affiliatly: affiliatlyId,\n              order: orderId,\n              price: total,\n              client_email: email,\n            };\n\n            $http.post(url, formEncode(data), {\n              withCredentials: false,\n              headers : { 'Content-Type': 'application/x-www-form-urlencoded' },\n              params: { aid: affiliatlyId },\n            })\n          });\n      },\n    };\n\n    function getSettings() {\n      return setupService.getSetupSettings()\n        .catch(err => dwAlerts.error(err, 'Failed to get setup settings.'));\n    }\n\n    function formEncode(data) {\n      return Object.keys(data)\n        .map(key => [encodeURIComponent(key), encodeURIComponent(angular.isObject(data[key]) ? angular.toJson(data[key]) : data[key])].join('='))\n        .join('&');\n    }\n  });\n","import template from './affiliatly-settings.tpl.html';\n\n/**\n * Setup Settings -> Affiliatly settings directive\n */\nexport default angular.module('deskworks.affiliatlySettingsDirective', [])\n\n  .directive('affiliatlySettings', function() {\n    return {\n      template,\n      restrict: 'E',\n      scope: true,\n      controller: 'AffiliatlySettingsCtrl as $ctrl',\n      bindToController: {\n        settings: '<',\n      },\n    };\n  })\n\n  .controller('AffiliatlySettingsCtrl', function() {\n    // const $ctrl = this;\n  });\n","// Module\nvar code = \"<label class=\\\"ff-row\\\"> <ff-label flex=\\\"{xs: '0 1 160px', sm: '0 1 250px'}\\\"> <span> <span translate=\\\"SETUP_SETTINGS.AFFILIATLY_ID\\\"></span> <ff-hint><span translate=\\\"SETUP_SETTINGS.AFFILIATLY_ID.HINT\\\"></span></ff-hint> </span> </ff-label> <ff-text name=\\\"affiliatlyId\\\" ff-model=\\\"$ctrl.settings.affiliatlyId\\\" placeholder=\\\"AF-XXXXXXX\\\" ff-validate-alert=\\\"{{'SETUP_SETTINGS.AFFILIATLY_ID' | translate}}\\\"></ff-text> </label> \";\n// Exports\nmodule.exports = code;"],"sourceRoot":""}