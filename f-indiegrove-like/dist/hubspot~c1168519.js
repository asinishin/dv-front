(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"/o5W":function(t,e,n){"use strict";n.r(e),e.default=angular.module("deskworks.HubSpotProposalItem",["ngResource","deskworks.config"]).factory("HubSpotProposalItem",["$resource","$location","deskworksConfig",function(t,e,n){var r=t(n.getApiAbsUrl("/hubspot/proposals/:proposalId/items/:id"));return{query:function(t){return r.query(t).$promise},save:function(t,e){return r.save(t,e).$promise},delete:function(t){return r.delete(t).$promise}}}])},"2PlZ":function(t,e){t.exports='<h1 class="page-title">{{state.getPageTitle()}}</h1> <ff-panel> <div class="ff-grid"> <ff-spin class="ff-spin-placeholder" ng-if="$ctrl.spin"></ff-spin> <span ng-if="!$ctrl.spin && !$ctrl.proposals.length" translate="GLOBAL.NONE"></span> <ff-header ng-if="$ctrl.proposals.length"> <ff-row> <cell flex="0 0 105px"><span translate="GLOBAL.DATE"></span></cell> <cell flex="1 1 200px"><span translate="PROPOSALS.STAGE"></span></cell> <cell flex="1 1 400px"><span translate="GLOBAL.NAME"></span></cell> <ff-btn sense="edit" size="xs" flex="none" class="buttons-row zero-height" title="{{\'GLOBAL.BTN_EDIT\' | translate }}"></ff-btn> </ff-row> </ff-header> <ff-row ng-repeat="p in $ctrl.proposals"> <ff-static flex="0 0 105px">{{::p.createdAt | date:\'mediumDate\'}}</ff-static> <ff-static flex="1 1 200px">{{::p.stage}}</ff-static> <ff-static flex="1 1 400px">{{::p.name}}</ff-static> <ff-btn sense="edit" size="xs" flex="none" class="buttons-row" title="{{\'GLOBAL.BTN_EDIT\' | translate}}" ff-click="$ctrl.edit(p)"></ff-btn> </ff-row> </div> </ff-panel> '},"7pZ+":function(t,e,n){"use strict";n.r(e),e.default=angular.module("deskworks.ProposalItemCatalog",["ngResource","deskworks.config"]).factory("ProposalItemCatalog",["$resource","$location","deskworksConfig",function(t,e,n){var r=t(n.getApiAbsUrl("/hubspot/item-catalog"));return{query:function(t){return r.query(t).$promise}}}])},E9Xa:function(t,e){t.exports='<h1 class="page-title">{{state.getPageTitle()}}</h1> <ff-panel> <ff-spin class="ff-spin-placeholder" ng-if="$ctrl.spin"></ff-spin> <div class="ff-grid dw-invoice" ng-if="$ctrl.proposal"> <ff-header> <ff-row> <cell flex="0 0 105px"><span translate="GLOBAL.DATE"></span></cell> <cell flex="1 1 100px"><span translate="PROPOSALS.STAGE"></span></cell> <cell flex="5 1 200px"><span translate="GLOBAL.NAME"></span></cell> </ff-row> </ff-header> <ff-row> <ff-static flex="0 0 105px">{{::$ctrl.proposal.createdAt | date:\'mediumDate\'}}</ff-static> <ff-static flex="1 1 100px">{{::$ctrl.proposal.stage}}</ff-static> <ff-static flex="5 1 200px">{{::$ctrl.proposal.name}}</ff-static> </ff-row> <ff-header style="margin-top:.5rem"> <ff-row> <cell flex="4 0 70px" class="invoice-product"><span translate="PURCHASE.INVOICE.PRODUCT"></span></cell> <cell flex="8 1 100px" class="invoice-description show-md"><span translate="PURCHASE.INVOICE.DESCRIPTION"></span></cell> <cell flex="0 0 46px" class="invoice-quantity ff-center show-sm"><span translate="PURCHASE.INVOICE.QUANTITY"></span></cell> <cell flex="0 0 90px" class="invoice-price ff-right show-sm"><span translate="PURCHASE.INVOICE.PRICE"></span></cell> <cell flex="0 0 90px" class="invoice-amount ff-right"><span translate="PURCHASE.INVOICE.AMOUNT"></span></cell> <ff-btn-group flex="0 0 auto" class="buttons-row zero-height"> <ff-btn sense="remove" size="xs"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-static ng-if="!$ctrl.items.length"><span translate="GLOBAL.NONE"></span></ff-static> <ff-row ng-repeat="item in $ctrl.items"> <ff-static flex="4 0 70px" class="invoice-product" ff-bind="::item.name"></ff-static> <ff-static flex="8 1 100px" class="invoice-description show-md" ff-bind="::item.description"></ff-static> <ff-static flex="0 0 46px" class="invoice-quantity ff-center show-sm" ff-bind="::item.quantity | round"></ff-static> <ff-static flex="0 0 90px" class="invoice-price ff-right show-sm" ff-bind="::item.price | ncurrency"></ff-static> <ff-static flex="0 0 90px" class="invoice-amount ff-right" ff-bind="::item.amount | ncurrency"></ff-static> <ff-btn-group flex="0 0 auto" class="buttons-row"> <ff-btn sense="remove" size="xs" title="{{\'GLOBAL.BTN_DELETE\' | translate}}" ff-click="$ctrl.deleteItem(item)"></ff-btn> </ff-btn-group> </ff-row> <ff-row class="invoice-charges" ng-if="$ctrl.items.length"> <ff-label class="ff-right"><span translate="GLOBAL.TOTAL"></span></ff-label> <ff-static flex="0 0 90px" class="ff-right">{{$ctrl.getTotal() | ncurrency}}</ff-static> <ff-btn-group flex="0 0 auto" class="buttons-row zero-height"> <ff-btn sense="remove" size="xs"></ff-btn> </ff-btn-group> </ff-row> </div> </ff-panel> <hubspot-proposal-add-items proposal="$ctrl.proposal" items="$ctrl.items" catalog="$ctrl.catalog"></hubspot-proposal-add-items> <ff-btn-group class="buttons-bottom"> <ff-btn sense="back" ff-click="$ctrl.back()"><span translate="GLOBAL.BTN_BACK"></span></ff-btn> </ff-btn-group> '},HAlh:function(t,e,n){"use strict";n.r(e);n("8cZI");e.default=angular.module("deskworks.HubSpotSettings",["ngResource","deskworks.config"]).factory("HubSpotSettings",["$resource","$location","deskworksConfig",function(t,e,n){var r=t(n.getApiAbsUrl("/hubspot/settings"),{},{update:{method:"PUT"}}),a=t(n.getApiAbsUrl("/hubspot/oauth2"));return{get:function(){return r.get().$promise},save:function(t){return r.update({},t).$promise},getConnectUrl:function(t){return n.getApiAbsUrl(["/hubspot/oauth2?nonce=".concat(t),"redirectUri="+encodeURIComponent(e.absUrl())].join("&"))},disconnect:function(){return a.delete().$promise}}}])},Jou3:function(t,e){t.exports='<ff-panel> <ff-panel-header class="ff-spin-right"> <span translate="INTEGRATIONS_SETUP.HUBSPOT.HEADER"></span> </ff-panel-header> <form name="form" novalidate ff-dim="$ctrl.spin"> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.CONNECTION"></span></ff-label> <ff-static ng-if="!$ctrl.hubspotSettings.connected"> <a href="{{$ctrl.getConnectUrl()}}" target="_self" rel="noopener" ng-if="$ctrl.hubspotSettings"> <ff-btn sense="ok" size="sm"><span translate="INTEGRATIONS_SETUP.CONNECT"></span></ff-btn> </a> </ff-static> <ff-static ng-if="$ctrl.hubspotSettings.connected"> <ff-icon sense="check"></ff-icon>&nbsp;<span translate="INTEGRATIONS_SETUP.CONNECTED"></span> </ff-static> <ff-btn-group flex="none" class="buttons-row" ng-if="$ctrl.hubspotSettings.connected"> <ff-btn sense="delete" size="xs" ff-click="$ctrl.disconnect()" title="{{\'INTEGRATIONS_SETUP.DISCONNECT\' | translate}}"></ff-btn> </ff-btn-group> </label> <div ng-if="$ctrl.hubspotSettings.connected"> <ff-header style="margin-top:.5rem"><span translate="INTEGRATIONS_SETUP.HUBSPOT.GENERAL.HEADER"></span></ff-header> <label class="ff-row"> <ff-label flex="0 1 160px"><req translate="INTEGRATIONS_SETUP.HUBSPOT.GENERAL.LOCATION"></req></ff-label> <ff-select name="location" ff-model="$ctrl.hubspotSettings.mapping.location" ff-change="$ctrl.saveSettings(form)" ff-required="true" ff-validate-alert="{{\'INTEGRATIONS_SETUP.HUBSPOT.GENERAL.LOCATION\' | translate}}"> <option ng-repeat="prop in $ctrl.contactProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><req translate="INTEGRATIONS_SETUP.HUBSPOT.GENERAL.DEAL_STAGE_PROPOSAL"></req></ff-label> <ff-select name="dealStageProposal" ff-model="$ctrl.hubspotSettings.mapping.dealStageProposal" ff-change="$ctrl.saveSettings(form)" ff-required="true" ff-validate-alert="{{\'INTEGRATIONS_SETUP.HUBSPOT.GENERAL.DEAL_STAGE_PROPOSAL\' | translate}}"> <option ng-repeat="prop in $ctrl.dealStages" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><req translate="INTEGRATIONS_SETUP.HUBSPOT.GENERAL.DEAL_STAGE_WON"></req></ff-label> <ff-select name="dealStageWon" ff-model="$ctrl.hubspotSettings.mapping.dealStageWon" ff-change="$ctrl.saveSettings(form)" ff-required="true" ff-validate-alert="{{\'INTEGRATIONS_SETUP.HUBSPOT.GENERAL.DEAL_STAGE_WON\' | translate}}"> <option ng-repeat="prop in $ctrl.dealStages" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <ff-header style="margin-top:.5rem"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.HEADER"></span></ff-header> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.START_DATE"></span></ff-label> <ff-select name="startDate" ff-model="$ctrl.hubspotSettings.mapping.startDate" ff-change="$ctrl.saveSettings(form)"> <option ng-value="null">-</option> <option ng-repeat="prop in $ctrl.dealProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.RENEWAL_DATE"></span></ff-label> <ff-select name="renewalDate" ff-model="$ctrl.hubspotSettings.mapping.renewalDate" ff-change="$ctrl.saveSettings(form)"> <option ng-value="null">-</option> <option ng-repeat="prop in $ctrl.dealProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.RENEWAL_TERM"></span></ff-label> <ff-select name="renewalTerm" ff-model="$ctrl.hubspotSettings.mapping.renewalTerm" ff-change="$ctrl.saveSettings(form)"> <option ng-value="null">-</option> <option ng-repeat="prop in $ctrl.dealProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.NOTICE_PERIOD"></span></ff-label> <ff-select name="noticePeriod" ff-model="$ctrl.hubspotSettings.mapping.noticePeriod" ff-change="$ctrl.saveSettings(form)"> <option ng-value="null">-</option> <option ng-repeat="prop in $ctrl.dealProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 1 160px"><span translate="INTEGRATIONS_SETUP.HUBSPOT.RB.DISCOUNT"></span></ff-label> <ff-select name="discountAmount" ff-model="$ctrl.hubspotSettings.mapping.discountAmount" ff-change="$ctrl.saveSettings(form)"> <option ng-value="null">-</option> <option ng-repeat="prop in $ctrl.dealProps" ng-value="::prop.id">{{::prop.name}}</option> </ff-select> </label> </div> </form> </ff-panel> '},OQxB:function(t,e,n){"use strict";n.r(e);var r=n("03wM"),a=n.n(r),o=n("Ekwr"),s=n.n(o),l=n("hsT8"),f=n.n(l),i=n("lvz6"),p=n.n(i),c=n("yKah"),u=n.n(c),d=n("fzuT"),g=n.n(d),b=(n("3dw1"),n("oWcb"),n("Ztxg")),m=n.n(b),S=n("/o5W");function h(t,e){var n=a()(t);if(s.a){var r=s()(t);e&&(r=f()(r).call(r,(function(e){return p()(t,e).enumerable}))),n.push.apply(n,r)}return n}function E(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){g()(t,e,n[e])})):u.a?Object.defineProperties(t,u()(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,p()(n,e))}))}return t}e.default=angular.module("deskworks.hubspotProposalAddItemsDirective",["ngRoute","deskworks.helper","deskworks.state","deskworks.purchase.service",S.default.name]).directive("hubspotProposalAddItems",(function(){return{restrict:"EAC",scope:!0,template:m.a,controller:"HubsSpotProposalAddItemsCtrl as $ctrl",bindToController:{proposal:"<",items:"<",catalog:"<"}}})).controller("HubsSpotProposalAddItemsCtrl",["$scope","$filter","$route","$translate","dwAlerts","helper","state","HubSpotProposalItem",function(t,e,n,r,a,o,s,l){var f=this;f.collapsed={},f.$onInit=function(){},f.$onChanges=function(){f.catalog&&f.catalog.forEach((function(t){return t.priceListProducts.forEach((function(t){t.quantity=1}))}))},f.add=function(t,e){if(!o.pointFirstInvalid("#plp".concat(e.id))){var n={priceListProductId:e.id,quantity:e.quantity};return l.save({proposalId:f.proposal.id},n).catch((function(t){return a.error(t,"Failed to add proposal item.")})).then((function(t){f.items.push(E(E({},o.pick(e,["name","description","price","quantity"])),o.pick(t,["id","priceListProductId"])))}))}}}])},PBfH:function(t,e,n){var r={"./proposals/hubspot-proposal-add-items.directive.js":"OQxB","./proposals/hubspot-proposal-edit.directive.js":"rOhi","./proposals/hubspot-proposals.directive.js":"gN8W","./services/hubspot-deal-stage.service.js":"Vg9s","./services/hubspot-property.service.js":"SU7K","./services/hubspot-proposal-item.service.js":"/o5W","./services/hubspot-proposal.service.js":"sTyO","./services/hubspot-settings.service.js":"HAlh","./services/proposal-item-catalog.service.js":"7pZ+","./settings/hubspot-settings.directive.js":"zo8+"};function a(t){var e=o(t);return n(e)}function o(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}a.keys=function(){return Object.keys(r)},a.resolve=o,t.exports=a,a.id="PBfH"},SU7K:function(t,e,n){"use strict";n.r(e),e.default=angular.module("deskworks.HubSpotProperty",["ngResource","deskworks.config"]).factory("HubSpotProperty",["$resource","$location","deskworksConfig",function(t,e,n){var r=t(n.getApiAbsUrl("/hubspot/hubspot-properties/:objectType"));return{query:function(t){return r.query({objectType:t}).$promise}}}])},Vg9s:function(t,e,n){"use strict";n.r(e),e.default=angular.module("deskworks.HubSpotDealStage",["ngResource","deskworks.config"]).factory("HubSpotDealStage",["$resource","$location","deskworksConfig",function(t,e,n){var r=t(n.getApiAbsUrl("/hubspot/hubspot-deal-stages"));return{query:function(){return r.query().$promise}}}])},Ztxg:function(t,e){t.exports='<div ng-if="$ctrl.items && $ctrl.catalog"> <div class="em ff-bmargin ff-tmargin" ng-if="!$ctrl.noCollapse"> <span translate="PROPOSALS.ADD_LINE_ITEMS"></span> <span ng-if="$ctrl.userPriceList">, <span translate="PURCHASE.USER_PRICE_LIST"></span>: <span ng-bind="$ctrl.userPriceList.name || \'-\'"></span> </span> </div> <div id="group-{{group.productTypeId}}" ng-repeat="group in $ctrl.catalog"> <ff-btn sense="collapse" ff-click="$ctrl.collapsed[group.productTypeId] = !$ctrl.collapsed[group.productTypeId]" ng-class="{ collapsed: !$ctrl.collapsed[group.productTypeId] }" class="hs-add-items-collapse-btn">{{group.productTypeName}}</ff-btn> <div ng-collapse="!$ctrl.collapsed[group.productTypeId]"> <ff-panel class="ff-bmargin" role="article" aria-label="{{\'PURCHASE.CHARGES.ADD_CHARGES\' | translate: { chargeType: group.productTypeName } }}"> <ff-header> <ff-row> <cell flex="4 0 70px"><span translate="PURCHASE.INVOICE.PRODUCT"></span></cell> <cell flex="0 0 90px" class="ff-right"><span translate="PURCHASE.INVOICE.PRICE"></span></cell> <cell flex="0 0 46px" class="ff-right"><span translate="PURCHASE.INVOICE.QUANTITY"></span></cell> <ff-btn-group flex="0 0 auto" class="buttons-row zero-height"> <ff-btn sense="add" size="sm"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> </ff-btn-group> </ff-row> </ff-header> <form name="formProduct" id="plp{{plp.id}}" ng-repeat="plp in group.priceListProducts"> <div class="ff-row"> <ff-static flex="4 0 70px">{{::plp.name}}</ff-static> <ff-static flex="0 0 90px" class="ff-right">{{::plp.price | currency}}</ff-static> <ff-number flex="0 0 46px" ff-model="plp.quantity" class="ff-right" ff-required="true" ff-gt="0" ff-validate-alert="{{\'PURCHASE.CHARGES.QUANTITY\' | translate}}"></ff-number> <ff-btn-group flex="none" class="buttons-row"> <ff-btn sense="save" size="sm" type="submit" ff-click="$ctrl.add(group, plp)"> <span translate="GLOBAL.BTN_NEW"></span> </ff-btn> </ff-btn-group> </div> </form> </ff-panel> </div> </div> </div> '},gN8W:function(t,e,n){"use strict";n.r(e);var r=n("4BZO"),a=n.n(r),o=n("nbuU"),s=n.n(o),l=(n("JBxO"),n("FdtR"),n("3dw1"),n("2PlZ")),f=n.n(l),i=n("sTyO"),p=n("Vg9s");e.default=angular.module("deskworks.hubspotProposalsDirective",[i.default.name,p.default.name]).directive("hubspotProposals",(function(){return{template:f.a,restrict:"E",scope:!0,controller:"HubSpotProposalCtrl as $ctrl"}})).controller("HubSpotProposalCtrl",["$q","$timeout","$translate","dwAlerts","helper","state","HubSpotProposal","HubSpotDealStage",function(t,e,n,r,o,l,f,i){var p=this;p.$onInit=function(){l.setPageTitle(n.instant("PROPOSALS.PAGE_TITLE")),p.load()},p.load=function(){return p.spin=!0,t.all([f.query({centerId:l.getCurrentCenterId(),userId:l.getCurrentUserId()}).catch((function(t){return r.error(t,"Failed to load proposals.")})),i.query().catch((function(t){return r.error(t,"Failed to load deal stages.")})).catch((function(){return[]}))]).then((function(t){var e=a()(t,2),n=e[0],r=e[1];p.proposals=n,p.stages=r,p.proposals.forEach((function(t){var e;t.stage=(s()(e=p.stages).call(e,(function(e){return e.id===t.stage}))||{}).name||t.stage}))})).finally((function(){p.spin=!1}))},p.edit=function(t){return l.setPath("/proposals/"+t.id)}}])},oWcb:function(t,e,n){},rOhi:function(t,e,n){"use strict";n.r(e);var r=n("4BZO"),a=n.n(r),o=n("nbuU"),s=n.n(o),l=n("0zKI"),f=n.n(l),i=(n("JBxO"),n("FdtR"),n("E9Xa")),p=n.n(i),c=n("sTyO"),u=n("/o5W"),d=n("Vg9s"),g=n("7pZ+"),b=n("OQxB");e.default=angular.module("deskworks.hubspotProposalEditDirective",[c.default.name,u.default.name,d.default.name,b.default.name,g.default.name]).directive("hubspotProposalEdit",(function(){return{template:p.a,restrict:"E",scope:!0,controller:"HubSpotProposalEditCtrl as $ctrl"}})).controller("HubSpotProposalEditCtrl",["$q","$route","$translate","dwAlerts","helper","state","HubSpotProposal","HubSpotProposalItem","HubSpotDealStage","ProposalItemCatalog",function(t,e,n,r,o,l,i,p,c,u){var d=this;d.$onInit=function(){l.setPageTitle(n.instant("PROPOSALS.EDIT.PAGE_TITLE")),d.load()},d.load=function(){return d.spin=!0,t.all([i.get({id:e.current.params.id}).catch((function(t){return r.error(t,"Failed to load proposal.")})),p.query({proposalId:e.current.params.id}).catch((function(t){return r.error(t,"Failed to load proposal items.")})),c.query().catch((function(t){return r.error(t,"Failed to load deal stages.")})).catch((function(){return[]})),u.query({centerId:l.getCurrentCenterId(),userId:l.getCurrentUserId()}).catch((function(t){return r.error(t,"Failed to load item catalog.")})).catch((function(){return[]}))]).then((function(t){var e,n=a()(t,4),r=n[0],o=n[1],l=n[2],f=n[3];d.proposal=r,d.items=o,d.stages=l,d.catalog=f,d.proposal.stage=(s()(e=d.stages).call(e,(function(t){return t.id===d.proposal.stage}))||{}).name||d.proposal.stage})).finally((function(){d.spin=!1}))},d.back=function(){return l.setPath("/proposals")},d.getTotal=function(){var t;return(null===(t=d.items)||void 0===t?void 0:t.reduce((function(t,e){return e.amount=e.price*e.quantity,t+e.amount}),0))||0},d.deleteItem=function(t){return p.delete({proposalId:d.proposal.id,id:t.id}).catch((function(t){return r.error(t,"Failed to delete proposal item.")})).then((function(){var e;f()(e=d.items).call(e,d.items.indexOf(t),1)}))}}])},sTyO:function(t,e,n){"use strict";n.r(e),e.default=angular.module("deskworks.HubSpotProposal",["ngResource","deskworks.config","datesDeserializer"]).factory("HubSpotProposal",["$resource","$location","deskworksConfig","datesDeserializer",function(t,e,n,r){var a=r(["createdAt"]),o=t(n.getApiAbsUrl("/hubspot/proposals/:id"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,a]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,a]}});return{query:function(t){return o.query(t).$promise},get:function(t){return o.get(t).$promise}}}])},tHz0:function(t,e,n){"use strict";n.r(e);var r=n("yCd9"),a=n.n(r),o=n("lRNC"),s=n.n(o),l=["$injector",function(t){var e,r,o=(e=n("PBfH"),a()(r=s()(e).call(e)).call(r,e));t.loadNewModules(a()(o).call(o,(function(t){return t.default.name})))}];e.default=l},"zo8+":function(t,e,n){"use strict";n.r(e);n("JBxO"),n("FdtR");var r=n("Jou3"),a=n.n(r),o=n("HAlh"),s=n("SU7K"),l=n("Vg9s");e.default=angular.module("deskworks.hubspotSettingsDirective",["debounce",o.default.name,s.default.name,l.default.name]).directive("hubspotSettings",(function(){return{template:a.a,restrict:"E",scope:!0,controller:"HubSpotSettingsCtrl as $ctrl"}})).controller("HubSpotSettingsCtrl",["$q","dwAlerts","debounce","helper","HubSpotSettings","HubSpotProperty","HubSpotDealStage",function(t,e,n,r,a,o,s){var l=this;l.$onInit=function(){l.load()},l.getConnectUrl=function(){return a.getConnectUrl(l.hubspotSettings?l.hubspotSettings.nonce:"")},l.disconnect=function(){return a.disconnect().catch((function(t){return e.error(t,"Failed to disconnect from HubSpot.")})).then((function(){l.hubspotSettings.connected=!1}))},l.load=function(){return l.spin=!0,a.get().catch((function(t){return e.error(t,"Failed to load HubSpot settings.")})).then((function(n){if(l.hubspotSettings=n,l.hubspotSettings.connected)return t.all([o.query("deal").catch((function(t){return e.error(t,"Failed to load HubSpot deal properties.")})).then((function(t){l.dealProps=t})),o.query("contact").catch((function(t){return e.error(t,"Failed to load HubSpot contact properties.")})).then((function(t){l.contactProps=t})),s.query().catch((function(t){return e.error(t,"Failed to load HubSpot deal stages.")})).then((function(t){l.dealStages=t}))])})).finally((function(){l.spin=!1}))},l.saveSettings=n((function(t){if(t&&t.$invalid)return;return l.spin=!0,a.save(l.hubspotSettings).catch((function(t){return e.error(t,"Failed to save HubSpot settings.")})).finally((function(){l.spin=!1}))}),1e3)}])}}]);