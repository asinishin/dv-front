(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{"1xfW":function(e,a,r){"use strict";r.r(a);r("Muwe"),r("y89P");var t=r("lRNC"),n=r.n(t),s=r("WSeP"),f=r.n(s),l=r("Tfwl"),c=r.n(l),d=r("XAgg"),o=r.n(d),i=r("yKah"),u=r.n(i),p=r("lvz6"),m=r.n(p),g=r("Ekwr"),I=r.n(g),E=r("03wM"),v=r.n(E),h=r("YtL8"),b=r.n(h),N=r("yCd9"),x=r.n(N),D=r("fzuT"),$=r.n(D),C=r("nbuU"),w=r.n(C),A=r("hsT8"),T=r.n(A),y=r("bfRn"),k=r("WgSX"),O=r("G6E5"),S=r("LTMe"),V=angular.module("deskworks.Invoice",["ngResource","datesDeserializer","deskworks.config"]).factory("Invoice",["$resource","$q","datesDeserializer","deskworksConfig",function(e,a,r,t){var n=r(["items.date","date","dueDate"]),s=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/generate-invoices"),{centerId:"@centerId",userId:"@userId",orderId:"@orderId"},{get:{method:"GET",transformResponse:[angular.fromJson,n]}});return{get:function(e){return s.get({centerId:e.centerId,userId:e.userId,orderId:e.orderId}).$promise.then((function(e){var a;return f()(a=e.items).call(a,(function(e){e.include=!0})),e}))}}}]),M=(r("JBxO"),r("FdtR"),angular.module("deskworks.invoiceLoadModule",[]).factory("invoiceLoadModule",["$injector",function(e){var a={standard:function(){return r.e(24).then(r.bind(null,"vj9N"))},alternate:function(){return r.e(23).then(r.bind(null,"uAdW"))}};return function(r){return(a[r]||a.standard)().then((function(a){return e.invoke(a.default)}))}}]));function _(e,a){var r=v()(e);if(I.a){var t=I()(e);a&&(t=T()(t).call(t,(function(a){return m()(e,a).enumerable}))),r.push.apply(r,t)}return r}function L(e){for(var a=1;a<arguments.length;a++){var r,t=null!=arguments[a]?arguments[a]:{};if(a%2)f()(r=_(Object(t),!0)).call(r,(function(a){$()(e,a,t[a])}));else if(u.a)o()(e,u()(t));else{var n;f()(n=_(Object(t))).call(n,(function(a){c()(e,a,m()(t,a))}))}}return e}var R=angular.module("deskworks.invoice",["debounce","deskworks.state","deskworks.userProfile.service","deskworks.setup.service",O.a.name,S.a.name,k.a.name,y.a.name,V.name,M.name]).controller("InvoiceCtrl",["$rootScope","$scope","$route","$filter","$timeout","$q","$translate","dwAlerts","debounce","reportHelper","state","helper","orderId","userProfileService","Invoice","setupService","invoiceLoadModule",function(e,a,r,t,n,s,f,l,c,d,o,i,u,p,m,g,I){var E=this,v=(d.paramsChanged,d.loadResources);function h(){var e=p.get(o.getCurrentCenterId(),o.getCurrentUserId()).catch((function(e){return l.error(e,"Failed to get user profile.")})),a=g.getSetupSettings().catch((function(e){return l.error(e,"Failed to get setup settings.")})),r=a.then((function(e){return I(e.invoiceTemplate)}));return{user:e,settings:a,module:r}}E.config={footer:function(){return null}},E.params={centerId:o.getCurrentCenterId(),paperLayout:"p",date:moment(),dueDate:moment(),showDates:!0},E.resources=null,E.data=null,o.setPageTitle(f.instant(f.instant(u?"INVOICE.INVOICE_NAME":"INVOICE.PAGE_TITLE",{orderId:u}))),a.$watch("$ctrl.params",c((function(e,a){E.pdf=null,i.pointFirstInvalid("#invoice")||s.all({resources:E.resources||v(h),data:E.data||m.get({centerId:E.params.centerId,userId:o.getCurrentUserId(),orderId:u}).catch((function(e){return l.error(e,"Failed to get invoice.")}))}).then((function(e){E.resources=e.resources,E.data=e.data,E.config.styles=angular.copy(E.resources.module.styles),E.config.header=E.resources.module.header,E.config.body=E.resources.module.body,E.columns=angular.copy(E.resources.module.columns)})).then((function(){var e,a,r;if(E.data.date&&!E.data.date.isSame(E.params.date)||E.data.dueDate&&!E.data.dueDate.isSame(E.params.dueDate)||!E.params.address&&E.resources.user.addresses[0])return E.params.date=E.data.date||E.params.date,E.params.dueDate=E.data.dueDate||E.params.dueDate,void(E.params.address=E.params.address||E.resources.user.addresses[0]);E.payments=T()(e=E.data.items).call(e,(function(e){return"payment"===e.type||"refund"===e.type})),E.charges=T()(a=E.data.items).call(a,(function(e){return"payment"!==e.type&&"refund"!==e.type}));var t=w()(r=E.resources.centers).call(r,(function(e){return e.id===E.params.centerId}));E.config.orderId=E.data.invoiceNumber,E.config.reportName=f.instant(t.taxId?"INVOICE.TAX_INVOICE_NAME":"INVOICE.INVOICE_NAME",{orderId:E.config.orderId}),E.config.userName=E.resources.user.fullName,E.config.userCompany=E.resources.user.company,t.street2&&(E.config.styles.startY+=12),t.taxId&&(E.config.styles.startY+=12);var n=E.config.body({config:E.config,params:E.params,data:E.data,columns:E.columns,resources:E.resources}),s=d.buildPdf({config:L(L({},E.config),E.params),report:n,resources:E.resources});E.pdf=s.output("blob")}))}),100),!0),a.$watchCollection((function(){var e;return E.data&&E.data.items&&x()(e=E.data.items).call(e,(function(e){return e.include}))}),(function(){var e,a;E.data&&E.data.items&&(E.params.items=b()(e=T()(a=E.data.items).call(a,(function(e){return e.include}))).call(e,(function(e,a){return e[a.id]=!0,e}),{}))})),E.selectAddress=function(e){E.params.address=e},E.downloadPdf=function(){if(E.pdf){var e=d.getReportFileName({extension:"pdf",config:L(L({},E.config),E.params),resources:E.resources});d.download({blob:E.pdf,fileName:e})}};var N=e.$on("CHANGE-CENTER",$),D=e.$on("CHANGE-USER",$);function $(){if(a.$resolve.back)return a.$resolve.back();r.reload()}a.$on("$destroy",(function(e){N(),D()}))}]),P=["$injector",function(e){e.loadNewModules([R.name]),e.invoke(["$templateCache",function(e){var a,t=r("Xycc");f()(a=n()(t).call(t)).call(a,(function(a){return e.put(a.replace(/^\.\//,""),t(a))}))}])}];a.default=P},Xycc:function(e,a,r){var t={"./invoice.tpl.html":"kFxu"};function n(e){var a=s(e);return r(a)}function s(e){if(!r.o(t,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return t[e]}n.keys=function(){return Object.keys(t)},n.resolve=s,e.exports=n,n.id="Xycc"},kFxu:function(e,a){e.exports='<form name=formGenerateInvoice class=gutter-v id=invoice> <h1 class=page-title>{{state.getPageTitle()}}</h1> <div> <div class="ff-grid gutter-v gutter-h" ng-hide=$resolve.orderId> <ff-panel flex="{lg: \'0 0 50%\', md: \'0 0 100%\'}" ng-if=!$ctrl.resources.user> <div><ff-spin class=ff-spin-placeholder></ff-spin></div> </ff-panel> <ff-panel flex="{lg: \'0 0 50%\', md: \'0 0 100%\'}" ng-repeat="address in $ctrl.resources.user.addresses"> <ff-panel-header> <ff-row class=gutter-h-half> <span translate=INVOICE.ADDRESS.HEADER></span> <div flex="0 0 auto" style="align-items:center;margin:-.5rem 0"> <ff-btn sense=favorite size=sm ng-if="address === $ctrl.params.address" title="{{\'INVOICE.ADDRESS.BTN_SELECTED.HINT\' | translate}}"> <span translate=INVOICE.ADDRESS.BTN_SELECTED></span> </ff-btn> <ff-btn sense=makeFavorite size=sm ng-if="address !== $ctrl.params.address" ff-click=$ctrl.selectAddress(address) title="{{\'INVOICE.ADDRESS.BTN_SELECT.HINT\' | translate}}"> <span translate=INVOICE.ADDRESS.BTN_SELECT></span> </ff-btn> </div> </ff-row> </ff-panel-header> <fieldset dw-address=address ng-disabled="address !== $ctrl.params.address"></fieldset> </ff-panel> </div> </div> <div class="ff-grid gutter-h" ng-hide=$resolve.orderId> <ff-panel flex="{lg: \'0 0 50%\', md: \'0 0 100%\'}"> <ff-panel-header><span translate=INVOICE.DATES.HEADER></span></ff-panel-header> <label class=ff-row> <ff-label flex="0 0 116px"><req translate=INVOICE.DATES.END_DATE></req></ff-label> <ff-date ff-model=$ctrl.params.date ff-required=true ff-validate-alert="{{\'INVOICE.DATES.END_DATE\' | translate}}"></ff-date> </label> <label class=ff-row> <ff-label flex="0 0 116px"><req translate=INVOICE.DATES.DUE_DATE></req></ff-label> <ff-date ff-model=$ctrl.params.dueDate ff-required=true ff-validate-alert="{{\'INVOICE.DATES.DUE_DATE\' | translate}}"></ff-date> </label> <label> <ff-checkbox ff-model=$ctrl.params.showDates ff-click="$ctrl.columns[0].include = $ctrl.params.showDates" ff-label="{{\'INVOICE.DATES.ADD_DATE_TO_ALL_ITEMS\' | translate}}"></ff-checkbox> </label> </ff-panel> </div> <div> <div class="ff-grid gutter-v gutter-h" ng-hide=$resolve.orderId> <ff-panel flex="{lg: \'0 0 50%\', md: \'0 0 100%\'}"> <ff-panel-header><span translate=INVOICE.ITEMS.HEADER></span></ff-panel-header> <ff-row> <label flex="0 0 auto"> <ff-include-all flex="0 0 32px" items=$ctrl.charges default=true></ff-include-all> </label> </ff-row> <ff-header> <ff-row> <cell flex="0 0 32px" class=ff-center><ff-icon sense=check></ff-icon></cell> <cell flex="1 1 100px" ng-if=$ctrl.params.showDates><span translate=INVOICE.ITEMS.DATE></span></cell> <cell flex="2 1 100px"><span translate=INVOICE.ITEMS.NAME></span></cell> <cell flex="0 0 80px" class=ff-right><span translate=INVOICE.ITEMS.AMOUNT></span></cell> </ff-row> </ff-header> <div ng-if=!$ctrl.charges><ff-spin class=ff-spin-placeholder></ff-spin></div> <ff-static ng-if="$ctrl.charges && !$ctrl.charges.length" class=ff-no-frame> <span translate=GLOBAL.NONE></span> </ff-static> <label ng-repeat="charge in $ctrl.charges" class=ff-row> <ff-static flex="0 0 32px" class=ff-center> <ff-checkbox ff-model=charge.include></ff-checkbox> </ff-static> <ff-static flex="1 1 100px" ng-if=$ctrl.params.showDates>{{charge.date | date:\'mediumDate\'}}</ff-static> <ff-static flex="2 1 100px" ff-bind=charge.name></ff-static> <ff-static flex="0 0 80px" ff-bind="charge.amount | ncurrency" class=ff-right></ff-static> </label> </ff-panel> <ff-panel flex="{lg: \'0 0 50%\', md: \'0 0 100%\'}"> <ff-panel-header><span translate=INVOICE.PAYMENTS.HEADER></span></ff-panel-header> <ff-row> <label flex="0 0 auto"> <ff-include-all flex="0 0 32px" items=$ctrl.payments default=true></ff-include-all> </label> </ff-row> <ff-header> <ff-row> <cell flex="0 0 32px" class=ff-center><ff-icon sense=check></ff-icon></cell> <cell><span translate=INVOICE.PAYMENTS.DATE></span></cell> <cell flex="0 0 80px" class=ff-right><span translate=INVOICE.PAYMENTS.AMOUNT></span></cell> </ff-row> </ff-header> <div ng-if=!$ctrl.payments><ff-spin class=ff-spin-placeholder></ff-spin></div> <ff-static ng-if="$ctrl.payments && !$ctrl.payments.length" class=ff-no-frame> <span translate=GLOBAL.NONE></span> </ff-static> <label ng-repeat="payment in $ctrl.payments" class=ff-row> <ff-static flex="0 0 32px" class=ff-center> <ff-checkbox ff-model=payment.include></ff-checkbox> </ff-static> <ff-static ff-bind="payment.date | date:\'mediumDate\'"></ff-static> <ff-static flex="0 0 80px" ff-bind="payment.amount | ncurrency" class=ff-right></ff-static> </label> </ff-panel> </div> </div> <div class="ff-grid gutter-v"> <ff-btn-group flex="0 0 auto" class=buttons-bottom style=margin-top:0> <ff-btn sense=download ff-click=$ctrl.downloadPdf() ff-disabled=!$ctrl.pdf> <span translate=INVOICE.BTN_PDF></span> </ff-btn> <ff-btn sense=back ff-click=$resolve.back() ng-if=$resolve.back> <span translate=GLOBAL.BTN_BACK></span> </ff-btn> </ff-btn-group> <div flex="{lg: \'0 0 33%\', md: \'0 0 100%\'}" style=margin-bottom:0> <report-options model=$ctrl.params no-centers=true></report-options> </div> </div> <ff-panel> <ff-panel-header><span translate=INVOICE.PREVIEW.HEADER></span></ff-panel-header> <div pdf-preview=$ctrl.pdf></div> </ff-panel> </form> '}}]);