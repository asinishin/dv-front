(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{DQFS:function(e,t,r){},W87a:function(e,t,r){"use strict";r("DQFS");var n=r("nOZT"),a=r.n(n);t.a=angular.module("deskworks.rcDateSelector",[]).component("rcDateSelector",{template:a.a,controller:"RcDateSelectorController as $ctrl",bindings:{mode:"<",date:"="}}).controller("RcDateSelectorController",["$scope",function(e){var t=this;e.$watch("$ctrl.date",(function(){moment.isMoment(t.date)&&(t.weekStart=t.date.clone().startOf("week"),t.weekEnd=t.weekStart.clone().endOf("week"))})),t.prev=function(){moment.isMoment(t.date)&&(t.date=t.date.clone().subtract("week"===t.mode?7:1,"d"))},t.next=function(){moment.isMoment(t.date)&&(t.date=t.date.clone().add("week"===t.mode?7:1,"d"))}}])},bOPx:function(e,t,r){"use strict";r("Muwe"),r("aZFp"),r("y89P"),r("JBxO"),r("FdtR"),r("3dw1");var n=r("yCd9"),a=r.n(n),i=r("NOor"),s=r.n(i),l=r("0zKI"),o=r.n(l),c=r("hsT8"),f=r.n(c),d=r("nbuU"),u=r.n(d),v=r("gQJ2"),m=r.n(v),p=(r("W87a"),r("cRes"),r("l3lf")),E=r.n(p),S=r("+l1P"),$=(angular.module("deskworks.timeSelector",["deskworks.state",S.a.name,"deskworks.userRoles","session"]).directive("timeSelector",(function(){return{template:E.a,restrict:"E",scope:!0,controller:"TimeSelectorDirectiveCtrl as $ctrl",bindToController:{date:"<",reservations:"<",timeStart:"=",timeEnd:"=",availabilities:"<",role:"<?",scale:"<?",buffer:"<?"},link:function(e,t){t.addClass("time-selector")}}})).controller("TimeSelectorDirectiveCtrl",["$scope","$timeout","$filter","$translate","state","userRoles","session",function(e,t,r,n,a,i,s){var l=this;function o(){for(var e=[],t=l.date.clone().startOf("day"),r=t.clone().add(1,"d");t<r;t.add(l.scale||30,"m"))e.push({reserved:!1,time:t.clone(),timeEnd:t.clone().add(l.scale||30,"m")});return e}l.$onInit=function(){l.currentUserId=a.getCurrentUserId(),l.timeStartInitial=moment.isMoment(l.timeStart)?l.timeStart.clone():moment(),l.timeEndInitial=moment.isMoment(l.timeEnd)?l.timeEnd.clone():moment(),t((function(){var e=document.querySelector(".slots-wrapper"),t=e.querySelector('.slot[time-str="'+r("date")(l.date,"HH:mm:00")+'"]')||e.querySelector('.slot[time-str="08:00:00"]');e.scrollTop=t.offsetTop})),l.slots=o(),l.selectionStart=l.timeStart?Math.floor((60*l.timeStart.hours()+l.timeStart.minutes())/(l.scale||30)):-1,l.selectionEnd=l.timeEnd?Math.ceil(l.selectionStart+(l.timeEnd-l.timeStart)/1e3/60/(l.scale||30)-1):-1},l.$onChanges=function(e){!e.date||!moment.isMoment(e.date.previousValue)||e.date.currentValue.isSame(e.date.previousValue)||(l.selectClear(),angular.isArray(e.reservations)||angular.isArray(e.availabilities))?t((function(){var e;l.slots=o(),e=l.slots,angular.forEach(e,(function(e){e.available=!1})),angular.forEach(l.availabilities,(function(t){for(var r=Math.floor((60*t.from.hour()+t.from.minute())/(l.scale||30)),n=Math.ceil((60*t.to.hour()+t.to.minute())/(l.scale||30)||e.length),a=r;a<n;a++)e[a].available=!0})),function(e){e.reduce((function(e,t){return t.optional=!1,t.available?++e:e}),0)&&(e.some((function(e){if(e.available)return!0;e.optional=!0})),e.some((function(t,r,n){if((t=e[e.length-r-1]).available)return!0;t.optional=!0})))}(l.slots),function(e){moment.isMoment(l.timeStartInitial)&&moment.isMoment(l.timeEndInitial)||l.selectClear();angular.isDefined(l.reservations)&&(e.forEach((function(e){e.reserved=!1,e.buffer=!1,delete e.text,delete e.userId,delete e.reservedLength})),l.reservations.forEach((function(r){if(!(moment.isMoment(l.timeStartInitial)&&moment.isMoment(l.timeEndInitial)&&r.from.isSame(l.timeStartInitial)&&r.to.isSame(l.timeEndInitial))){var n=r.from.diff(r.from.clone().startOf("date"),"minutes")/(l.scale||30),a=Math.floor(n),i=n+(r.to-r.from)/1e3/60/(l.scale||30),s=Math.ceil(i);s+=i!==s?1:0,t({slots:e,reservation:r,index:a-1,direction:-1});for(var o=a;o<s;o++)e[o].reserved=!0,e[o].text=r.userCompany?r.userCompany+": ":"",e[o].text+="<strong>"+r.userName+"</strong>",e[o].userId=r.userId,o===a&&(e[o].reservedLength=s-a);t({slots:e,reservation:r,index:s})}})));function t(e){var t=e.slots,r=(e.reservation,e.index),n=e.direction,a=void 0===n?1:n;if(l.buffer&&t[r]&&!(l.role?"admin"===(i[l.role]||{}).type:s.isAdmin()))for(var o=r+Math.ceil(l.buffer/(l.scale||30))*a,c=r;a>0?c<o:c>o;c+=a)t[c]&&!t[c].reserved&&(t[c].available=!1,t[c].buffer=!0)}}(l.slots)})):l.slots=o()},l.selectTime=function(e){if(!l.slots[e].reserved&&l.slots[e].available){if(-1===l.selectionStart)l.selectionStart=e,l.selectionEnd=e;else if(l.selectionEnd===l.selectionStart){if(e>l.selectionStart){l.selectionEnd=e;for(var t=l.selectionStart;t<=l.selectionEnd;t++)if(l.slots[t].reserved||!l.slots[t].available){l.selectionStart=e,l.selectionEnd=e;break}}else if(e<l.selectionStart){l.selectionEnd=l.selectionStart,l.selectionStart=e;for(var r=l.selectionEnd;r>=l.selectionStart;r--)if(l.slots[r].reserved||!l.slots[r].available){l.selectionStart=e,l.selectionEnd=e;break}}}else l.selectionStart=e,l.selectionEnd=e;l.selectionStart>=0&&l.selectionEnd>=0?(l.timeStart=l.slots[l.selectionStart].time.clone(),l.timeEnd=l.slots[l.selectionEnd>=0?l.selectionEnd:l.selectionStart].timeEnd.clone()):(l.timeStart=null,l.timeEnd=null)}},l.selectClear=function(){l.selectionStart=l.selectionEnd=-1,l.timeStart=l.timeEnd=null},l.getSlotClass=function(e,t){return{reserved:e.reserved,"reserved-own":e.reserved&&l.currentUserId===e.userId,available:e.available,optional:e.optional,buffer:e.buffer,selected:t===l.selectionStart&&-1===l.selectionEnd||t>=l.selectionStart&&t<=l.selectionEnd}},l.getSlotTitle=function(e,t){var a=e.available?"AVAILABLE":"UNAVAILABLE";e.reserved&&(a="RESERVED"),(t===l.selectionStart&&-1===l.selectionEnd||t>=l.selectionStart&&t<=l.selectionEnd)&&(a="SELECTED");var i={from:r("date")(e.time,"shortTime"),to:r("date")(e.timeEnd,"shortTime")};return n.instant("RESERVATIONS.TIME_SELECTOR.SLOT.".concat(a),i)}}]),r("qNmJ"),r("q9Tw")),T=r.n($),g=r("GJsN");t.a=angular.module("deskworks.resReservation",["deskworks.rcHelper","deskworks.reservationUnit.optsRepeatFrequency","deskworks.timeSelector","deskworks.reservationService","deskworks.calendarService","deskworks.rcDateSelector","deskworks.ReservationCost",S.a.name,g.a.name]).directive("resReservation",(function(){return{template:T.a,scope:!0,controller:"ResReservationController as $ctrl",bindToController:{center:"<",calData:"<",user:"<",reservationPrices:"<",reservationFields:"<",hideReservationCostEstimate:"<",hideRecurringReservations:"<",afterSave:"<",hideCalendarBtn:"<",signOut:"<",stopWizard:"<",backFn:"&?back",nextFn:"&?next",hideStaffOnlyUnits:"<"}}})).controller("ResReservationController",["$scope","$filter","$interval","$route","$window","$translate","$q","session","dwAlerts","helper","rcHelper","state","reservationService","calendarService","ReservationCost","optsRepeatFrequency",function(e,t,r,n,i,l,c,d,v,p,E,S,$,T,g,h){var R=this;R.$onInit=function(){var i;(e.state=S,R.optsRepeatFrequency=h,R.afterSave=R.afterSave||R.navCalendar,R.role=S.getParam("role"),n.current.params.reservationIds)?(R.reservation={},R.reservationIds=a()(i=n.current.params.reservationIds.split(",")).call(i,(function(e){return+e}))):R.calData.some((function(e){return e.reservationUnits.some((function(e){var t,r,a=s()(t=e.reservations).call(t,(function(e){return e.id===+n.current.params.reservationId}));a>=0&&(R.reservation=e.reservations[a],o()(r=e.reservations).call(r,a,1),S.setParam("unit",e.id).replace());return!!R.reservation}))}));R.$onChanges=function(){R.afterSave=R.afterSave||R.navCalendar},R.date=t("toDate")(n.current.params.date||S.getParam("date")),R.date=moment.isMoment(R.date)?R.date:moment(),E.floorDate(R.date,30);var l=R.reservation&&R.reservation.from||t("toDate")(S.getParam("start"));R.timeStart=moment.isMoment(l)?l:null,l=R.reservation&&R.reservation.to||t("toDate")(S.getParam("end")),R.timeEnd=moment.isMoment(l)&&R.timeStart?l:null,R.reservationTitle=S.getParam("title")||(R.reservation?R.reservation.title:""),R.reservationNote=S.getParam("note")||R.reservation&&R.reservation.reservationNote,R.repeatFrequency=p.findByKeyValue(R.optsRepeatFrequency,"id",S.getParam("freq"))||R.optsRepeatFrequency[0],R.repeatDuration=S.getParam("duration")&&+S.getParam("duration")||R.repeatFrequency.repeatDurationOptions&&R.repeatFrequency.repeatDurationOptions[0],R.emailConfirmation=!0,e.$watch("$ctrl.calData",(function(){var e;!function(){if(R.reservationTypes=[],!angular.isArray(R.calData))return;R.calData.forEach((function(e){var t;if(e.reservationUnits=f()(t=e.reservationUnits).call(t,(function(e){return e.availabilities.length||!R.hideStaffOnlyUnits&&"staffOnly"===e.whoCanReserve})),e.reservationUnits.length){var r;R.reservationTypes.push(e),e.fields=f()(r=R.reservationFields).call(r,(function(t){return t.reservationCategoryId===e.id||0===t.reservationCategoryId}));var n=JSON.parse(S.getParam("fields")||"{}");e.fields.forEach((function(e){return e.value=n[e.id]||0===n[e.id]?n[e.id]:((R.reservation||{}).fields||{})[e.id]}))}}))}(),e=n.current.params.reservationUnitId||S.getParam("unit"),R.reservationTypes.some((function(t){var r=u()(p).call(p,t.reservationUnits,e);if(r)return R.reservationType=t,R.reservationUnit=r,!0})),R.reservationUnit||(R.reservationType=R.reservationTypes[0],R.reservationUnit=R.reservationType&&R.reservationType.reservationUnits[0])})),e.$watch("$ctrl.reservationUnit.id",(function(e){S.setParam("unit",e).replace()})),e.$watch("$ctrl.date",(function(e){S.setParam("date",E.dateToStr(e)).replace()})),e.$watch("$ctrl.timeStart",(function(e){S.setParam("start",E.dateToStr(e)).replace()})),e.$watch("$ctrl.timeEnd",(function(e){S.setParam("end",E.dateToStr(e)).replace()})),e.$watch("$ctrl.emailConfirmation",(function(e){S.setParam("confirm",e||null).replace()})),e.$watch("$ctrl.repeatFrequency.id",(function(e){S.setParam("freq",e).replace()})),e.$watch("$ctrl.repeatDuration",(function(e){S.setParam("duration",e).replace()})),e.$watch("$ctrl.reservationTitle",(function(e){S.setParam("title",e).replace()})),e.$watch("$ctrl.reservationNote",(function(e){S.setParam("note",e).replace()})),e.$watch((function(){var e;return a()(e=R.reservationType.fields).call(e,(function(e){return{id:e.id,value:e.value}}))}),(function(e){var t=e.reduce((function(e,t){return(t.value||0===t.value||!1===t.value)&&(e[t.id]=t.value),e}),{});S.setParam("fields",m()(t))}),!0),e.$watch("$ctrl.date",(function(e,t){e!==t?R.fetch(!0):(r.cancel(R.timer),R.timer=r(R.fetch,6e4))})),e.$watchGroup(["$ctrl.reservationType","$ctrl.timeStart","$ctrl.timeEnd"],(function(){R.reservationType&&R.timeStart&&R.timeEnd?R.reservationCost=g.calcSync(R.timeStart,R.timeEnd,R.reservationPrices,R.reservationType.id):R.reservationCost=null})),e.$watch((function(){return S.getCurrentCenterId()}),(function(e,t){e!==t&&n.reload()}))},R.$onDestroy=function(){r.cancel(R.timer)},R.next=function(){if(!p.pointFirstInvalid(".sr-time"))return S.setPath(S.getPath()+"/users")},R.onNextClick=function(){if(!p.pointFirstInvalid(".res-container"))return R.nextFn?R.nextFn():(R.totalCost=function(){var e,t,r,n,a,i,s=f()(e=f()(t=R.reservationType.fields).call(t,(function(e){return"customPrice"===e.type}))).call(e,(function(e){return e.value||0===e.value})),l=(f()(r=f()(n=R.reservationType.fields).call(n,(function(e){return"extraPrice"===e.type}))).call(r,(function(e){return e.value||0===e.value})),s.reduce((function(e,t){return e+t.$$deserialize(t,t.value)}),0));s.length||(l=R.reservationCost);return l+=f()(a=f()(i=R.reservationType.fields).call(i,(function(e){return"extraPrice"===e.type}))).call(a,(function(e){return e.value||0===e.value})).reduce((function(e,t){return e+t.$$deserialize(t,t.value)}),0)}(),void(R.confirmation=!0))},R.makeReservation=function(){var e,t={from:R.timeStart,to:R.timeEnd,title:R.reservationTitle,reservationNote:R.reservationNote,centerId:R.center.id,reservationUnitId:R.reservationUnit.id,emailConfirmation:R.emailConfirmation,repeatFrequency:R.repeatFrequency.id,repeatDuration:angular.isDefined(R.repeatFrequency.repeatDurationOptions)?R.repeatDuration:"",fields:f()(e=R.reservationType.fields).call(e,(function(e){return e.value||0===e.value||!1===e.value})).reduce((function(e,t){return e[t.id]=t.$$serialize(t,t.value),e}),{})};return $.save(R.center.id,R.user.id,t).catch((function(e){return v.error(e,"Failed to save reservation.")})).then((function(){return R.afterSave()}))},R.updateReservation=function(){var e,t={id:R.reservation.id,reservationUnitId:R.reservationUnit.id,from:R.timeStart,to:R.timeEnd,title:R.reservationTitle,reservationNote:R.reservationNote,emailConfirmation:R.emailConfirmation,fields:f()(e=R.reservationType.fields).call(e,(function(e){return e.value||0===e.value||!1===e.value})).reduce((function(e,t){return e[t.id]=t.$$serialize(t,t.value),e}),{})};return $.save(R.center.id,R.user.id,t).catch((function(e){return v.error(e,"Failed to update reservation.")})).then((function(){return R.afterSave()}))},R.bulkUpdateReservations=function(){if(i.confirm(l.instant("RESERVATIONS.BULK_EDIT.CONFIRM",{count:R.reservationIds.length})))return $.query({centerId:S.getCurrentCenterId(),userId:S.getCurrentUserId(),offset:0,limit:999999}).catch((function(e){return v.error(e,"Failed to query reservations.")})).then((function(e){var t;return c.all(a()(t=R.reservationIds).call(t,(function(t){var r=u()(e).call(e,(function(e){return e.id===t})),n={id:t,reservationUnitId:R.reservationUnitBulk?R.reservationUnitBulk.id:r.reservationUnitId,from:r.from,to:r.to,title:R.reservationTitle||r.title,reservationNote:R.reservationNote||r.reservationNote};return R.timeStart&&R.timeEnd&&(n.from.set({hour:R.timeStart.hour(),minute:R.timeStart.minute(),second:R.timeStart.second()}),n.to.set({hour:R.timeEnd.hour(),minute:R.timeEnd.minute(),second:R.timeEnd.second()})),$.save(S.getCurrentCenterId(),S.getCurrentUserId(),n).catch((function(e){return v.error(e,"Failed to update reservation.")}))})))})).then((function(){return S.resetParams().setPath("/reservations")}))},R.reservationTypeBulkChange=function(){R.reservationTypeBulk?(R.reservationUnitBulk=R.reservationTypeBulk.reservationUnits[0],R.reservationUnit=R.reservationUnitBulk):(R.reservationUnitBulk=null,R.reservationTypes.some((function(e){var t=u()(p).call(p,e.reservationUnits,S.getParam("unit-orig"));if(t)return R.reservationType=e,R.reservationUnit=t,!0})))},R.reservationUnitBulkChange=function(){R.reservationUnitBulk?R.reservationUnit=R.reservationUnitBulk:(R.reservationTypeBulk=null,R.reservationTypes.some((function(e){var t=u()(p).call(p,e.reservationUnits,S.getParam("unit-orig"));if(t)return R.reservationType=e,R.reservationUnit=t,!0})))},R.cancelReservation=function(){return $.delete(R.center.id,R.user.id,R.reservation.id,R.emailConfirmation).catch((function(e){return v.error(e,"Failed to cancel reservation.")})).then((function(){return R.afterSave()}))},R.fetch=function(e){if(r.cancel(R.timer),!R.fetching||e)return R.fetching=!0,T.query(S.getCurrentCenterId()||n.current.params.centerId,R.date,R.date,R.role).catch((function(e){return v.error(e,"Failed to fetch calendar data.")})).then((function(e){R.calData=e})).finally((function(){R.fetching=!1,r.cancel(R.timer),R.timer=r(R.fetch,6e4)}))},R.navCalendar=function(){return S.setParam("unit",null),S.setParam("start",null),S.setParam("end",null),S.setParam("confirm",null),S.setParam("freq",null),S.setParam("duration",null),S.setParam("title",null),S.setParam("note",null),S.setParam("fields",null),S.setPath("/reservation-calendar")},R.back=S.back,R.hasRecurring=function(){return!R.reservation&&(d.isAdmin()||!R.hideRecurringReservations)}}])},cRes:function(e,t,r){},l3lf:function(e,t){e.exports='<div class="hint" translate="RESERVATIONS.TIME_SELECTOR.HINT.START" ng-if="$ctrl.selectionStart === -1 || $ctrl.selectionStart !== $ctrl.selectionEnd"></div> <div class="hint" translate="RESERVATIONS.TIME_SELECTOR.HINT.END" ng-if="$ctrl.selectionStart !== -1 && $ctrl.selectionStart === $ctrl.selectionEnd"></div> <div class="slots-wrapper" flex="1 1 auto"> <div class="slot" ng-repeat="slot in $ctrl.slots" ng-click="$ctrl.selectTime($index)" ng-class="$ctrl.getSlotClass(slot, $index)" time-str="{{slot.time | date:\'HH:mm:00\'}}" aria-label="{{$ctrl.getSlotTitle(slot, $index)}}"> <div class="reserved-outline" ng-if="slot.reservedLength"> <div class="reserved-outline-inner" ng-style="{ height: \'calc(\' + (slot.reservedLength * 100) + \'% - 20px)\' }"> <span ng-bind-html="slot.text"></span> </div> </div> <div class="selected-outline" ng-if="$index === $ctrl.selectionStart"> <div class="selected-outline-inner" ng-style="{ height: \'calc(\' + (($ctrl.selectionEnd != -1 ? $ctrl.selectionEnd - $ctrl.selectionStart + 1 : 1) * 100) + \'% - 20px)\' }"> <div class="selected-from" ng-show="$ctrl.selectionStart !== -1" translate="RESERVATIONS.TIME_SELECTOR.FROM"></div> <div class="selected-to" ng-show="$ctrl.selectionEnd !== -1" translate="RESERVATIONS.TIME_SELECTOR.TO"></div> <svg xmlns="http://www.w3.org/2000/svg" class="diagonal-hatch"> <defs> <pattern id="diagonalHatch" patternUnits="userSpaceOnUse" x="0" y="0" width="105" height="105"> <g class="diagonal-hatch-pattern" transform="translate(105,0) scale(-1,1)"> <path d="M0 90 l15,15"/> <path d="M0 75 l30,30"/> <path d="M0 60 l45,45"/> <path d="M0 45 l60,60"/> <path d="M0 30 l75,75"/> <path d="M0 15 l90,90"/> <path d="M0 0 l105,105"/> <path d="M15 0 l90,90"/> <path d="M30 0 l75,75"/> <path d="M45 0 l60,60"/> <path d="M60 0 l45,45"/> <path d="M75 0 l30,30"/> <path d="M90 0 l15,15"/> </g> </pattern> </defs> <g> <rect x="0" y="0" width="100%" height="2000" class="diagonal-hatch-rect"/> </g> </svg> </div> </div> <div ng-if="slot.buffer" class="buffer-label" translate="RESERVATIONS.RESERVATION_BUFFER"></div> <div class="time-cell"> <div class="time" nice-time="slot.time"></div> </div> <div class="time-cell time-cell-right"> <div class="time" nice-time="slot.timeEnd"></div> </div> </div> </div> <div class="clear-selection"> <button type="button" class="btn ff-btn btn-primary" ng-click="$ctrl.selectClear()" translate="RESERVATIONS.TIME_SELECTOR.BTN_CLEAR"></button> </div> '},nOZT:function(e,t){e.exports='<div ng-show="$ctrl.mode === \'day\'" class="day-mode"> <ff-col class="day-pictogram" flex="0 0 auto"> <div class="rc-pictogram" title="Click to pick date"> <ff-datepicker-popup tabindex="0" ff-model="$ctrl.date"></ff-datepicker-popup> <ff-row> <div class="serifs"><hr><hr><hr></div> </ff-row> <span ng-bind="$ctrl.date | date:\'dd\'"></span> </div> <div class="weekday"> <span ng-bind="$ctrl.date | date:\'EEE\'"></span> <div class="prev" title="{{\'RESERVATIONS.DATE_SELECTOR.DAY.PREV.HINT\' | translate}}" ng-click="$ctrl.prev()"></div> <div class="next" title="{{\'RESERVATIONS.DATE_SELECTOR.DAY.NEXT.HINT\' | translate}}" ng-click="$ctrl.next()"></div> </div> </ff-col> <div class="bar" translate="RESERVATIONS.DATE_SELECTOR.DAY.EXTRA" translate-values="{ month: ($ctrl.date | date:\'MMMM\'), year: ($ctrl.date | date:\'yyyy\') }">></div> </div> <div ng-show="$ctrl.mode === \'week\'" class="week-mode"> <div class="week-pictogram" flex="0 0 auto"> <div class="rc-pictogram"> <ff-row> <div class="serifs"><hr><hr><hr><hr><hr><hr></div> </ff-row> <span ng-bind="($ctrl.weekStart | date:\'dd\') + \'-\' +  ($ctrl.weekEnd | date:\'dd\')"></span> </div> <div class="prev" title="{{\'RESERVATIONS.DATE_SELECTOR.WEEK.PREV.HINT\' | translate}}" ng-click="$ctrl.prev()"></div> <div class="next" title="{{\'RESERVATIONS.DATE_SELECTOR.WEEK.NEXT.HINT\' | translate}}" ng-click="$ctrl.next()"></div> </div> <div class="bar" translate="RESERVATIONS.DATE_SELECTOR.WEEK.EXTRA" translate-values="{ month: ($ctrl.date | date:\'MMMM\'), year: ($ctrl.date | date:\'yyyy\') }"></div> </div> '},q9Tw:function(e,t){e.exports='<form class="res-container" flex="1 1 auto" ng-if="!$ctrl.confirmation && !$ctrl.cancelConfirmation" novalidate ng-style="{ marginTop: $app.hideHeader ? 0 : null }"> <div class="res-header"> <h1 class="page-title" ng-if="!$ctrl.reservation" translate="RESERVATIONS.NEW.PAGE_TITLE" translate-values="{ centerName: $ctrl.center.name }"></h1> <h1 class="page-title" ng-if="$ctrl.reservation.id" translate="RESERVATIONS.EDIT.PAGE_TITLE" translate-values="{ centerName: $ctrl.center.name }"></h1> <h1 class="page-title" ng-if="$ctrl.reservationIds" translate="RESERVATIONS.BULK_EDIT.PAGE_TITLE" translate-values="{ centerName: $ctrl.center.name }"></h1> <small translate="RESERVATIONS.HINT"></small> </div> <ff-row class="res-body"> <ff-col class="res-col-opts"> <ff-row flex="0 0 auto" ng-if="!$ctrl.reservationIds"> <rc-date-selector mode="\'day\'" date="$ctrl.date"></rc-date-selector> </ff-row> <ff-row flex="0 0 auto" ng-if="!$ctrl.reservationIds"> <ff-select name="reservationType" ff-model="$ctrl.reservationType" ff-options="resType.name for resType in $ctrl.reservationTypes" ff-disabled="$ctrl.reservation || $ctrl.reservationTypes.length < 2" ff-change="$ctrl.reservationUnit = $ctrl.reservationType.reservationUnits[0]" aria-label="{{\'RESERVATIONS.CATEGORY\' | translate}}"></ff-select> </ff-row> <ff-row flex="0 0 auto" ng-if="!$ctrl.reservationIds"> <ff-select name="reservationUnit" ff-model="$ctrl.reservationUnit" ff-options="resUnit.name for resUnit in $ctrl.reservationType.reservationUnits" ff-disabled="$ctrl.reservation || $ctrl.reservationType.reservationUnits.length < 2" aria-label="{{\'RESERVATIONS.SPACE\' | translate}}"></ff-select> </ff-row> <ff-row flex="0 0 auto" ng-if="$ctrl.reservationIds"> <ff-select name="reservationType" ff-model="$ctrl.reservationTypeBulk" ff-options="resType.name for resType in $ctrl.reservationTypes" ff-change="$ctrl.reservationTypeBulkChange()" aria-label="{{\'RESERVATIONS.CATEGORY\' | translate}}"> <option value="">[Keep Reservation Category]</option> </ff-select> </ff-row> <ff-row flex="0 0 auto" ng-if="$ctrl.reservationIds"> <ff-select name="reservationUnit" ff-model="$ctrl.reservationUnitBulk" ff-options="resUnit.name for resUnit in $ctrl.reservationTypeBulk.reservationUnits" ff-disabled="!$ctrl.reservationTypeBulk" ff-change="$ctrl.reservationUnitBulkChange()" aria-label="{{\'RESERVATIONS.SPACE\' | translate}}"> <option value="">[Keep Reservation Unit]</option> </ff-select> </ff-row> <ff-row flex="0 0 auto" ng-if="!$ctrl.hideReservationCostEstimate && $ctrl.reservationPrices"> <ff-static> <span style="text-transform:uppercase;max-width:200px"> <strong style="font-size:.8em"><span translate="RESERVATIONS.ESTIMATED_COST"></span>:</strong> <strong class="text-text" ng-bind="$ctrl.reservationCost | ncurrency | nd"></strong> </span> </ff-static> </ff-row> <ff-row flex="0 0 auto"> <ff-text name="reservationTitle" ff-maxlength="128" ff-model="$ctrl.reservationTitle" placeholder="{{(\'RESERVATIONS.TITLE\' | translate)}}" aria-label="{{(\'RESERVATIONS.TITLE\' | translate)}}"></ff-text> </ff-row> <ff-row flex="1 0 30px"> <ff-textarea name="reservationNote" ff-maxlength="250" ff-model="$ctrl.reservationNote" placeholder="{{(\'RESERVATIONS.NOTES\' | translate)}}" aria-label="{{(\'RESERVATIONS.NOTES\' | translate)}}"></ff-textarea> </ff-row> <div ng-if="!$ctrl.reservation ? ($ctrl.hideRecurringReservations ? !state.isLoggedMember() && !state.isLoggedNonMember() && !!state.getLoggedUser() : true) : false"> <ff-row flex="0 0 auto"> <ff-select name="repeatFrequency" ff-model="$ctrl.repeatFrequency" ff-options="opt.name for opt in $ctrl.optsRepeatFrequency" ff-change="$ctrl.repeatDuration = $ctrl.repeatFrequency.repeatDurationOptions[0]" aria-label="{{\'RESERVATIONS.REPEAT_FREQUENCY\' | translate}}"></ff-select> </ff-row> <ff-row flex="0 0 auto" ng-if="$ctrl.repeatFrequency.repeatDurationOptions"> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.REPEAT_DURATION"></span></ff-label> <ff-select name="repeatDuration" flex="0 1 50px" ff-model="$ctrl.repeatDuration" ff-options="opt for opt in $ctrl.repeatFrequency.repeatDurationOptions" aria-label="{{\'RESERVATIONS.REPEAT_DURATION.LABEL\' | translate}}"></ff-select> <ff-label>{{$ctrl.repeatFrequency.repeatDurationFilter($ctrl.repeatDuration, true)}}</ff-label> </ff-row> </div> <fd-field field="field" ng-repeat="field in $ctrl.reservationType.fields" ng-if="!$ctrl.reservationIds"></fd-field> <ff-btn-group class="res-buttons" style="margin-top:.5rem"> <ff-btn sense="save" type="submit" ff-click="$ctrl.bulkUpdateReservations()" ng-if="$ctrl.reservationIds" ff-disabled="!$ctrl.timeStart && !$ctrl.timeEnd && !$ctrl.reservationTitle && !$ctrl.reservationNote && !$ctrl.reservationUnitBulk"> <span translate="RESERVATIONS.BTN_UPDATE"></span> </ff-btn> <ff-btn sense="back" ff-click="$ctrl.backFn()" ng-if="$ctrl.backFn"> <span translate="GLOBAL.BTN_BACK"></span> </ff-btn> <ff-btn sense="save" type="submit" ff-click="$ctrl.onNextClick()" ng-if="!$ctrl.reservationIds" ff-disabled="!$ctrl.timeStart || !$ctrl.timeEnd || !$ctrl.reservationUnit.availabilities.length && $ctrl.reservationUnit.whoCanReserve === \'staffOnly\'"> <span translate="RESERVATIONS.BTN_CREATE" ng-show="!$ctrl.reservation"></span> <span translate="RESERVATIONS.BTN_UPDATE" ng-show="$ctrl.reservation"></span> </ff-btn> <ff-btn sense="remove" ff-click="$ctrl.cancelConfirmation = true" ng-if="$ctrl.reservation.id"> <span translate="RESERVATIONS.BTN_DELETE"></span> </ff-btn> <ff-btn sense="calendar" ff-click="$ctrl.navCalendar()" ng-if="!$ctrl.hideCalendarBtn"> <span translate="RESERVATIONS.BTN_CALENDAR"></span> </ff-btn> <ff-btn sense="settings" ng-if="$ctrl.stopWizard" ff-click="$ctrl.stopWizard()"> <span translate="GLOBAL.BTN_SETTINGS"></span> </ff-btn> <ff-btn sense="signOut" ng-if="$ctrl.signOut" ff-click="$ctrl.signOut()" ff-countdown="30"> <span translate="GLOBAL.BTN_SIGN_OUT"></span> </ff-btn> </ff-btn-group> </ff-col> <ff-col class="res-col-time"> <div class="res-current-member" ng-if="(state.isLoggedAdmin() || state.isMasterProfile()) && ($ctrl.reservation || $ctrl.user)"> <span translate="RESERVATIONS.USER"></span>: <span ng-bind="$ctrl.reservation && $ctrl.reservation.userName ? $ctrl.reservation.userName : $ctrl.user.fullName"></span> </div> <time-selector date="$ctrl.date" time-start="$ctrl.timeStart" time-end="$ctrl.timeEnd" role="$ctrl.role" scale="$ctrl.reservationUnit.scale" buffer="$ctrl.reservationUnit.buffer" reservations="$ctrl.reservationUnit.reservations" availabilities="$ctrl.reservationUnit.availabilities"></time-selector> <ff-info ng-if="!$ctrl.reservationUnit.availabilities.length && $ctrl.reservationUnit.whoCanReserve === \'staffOnly\'" style="position:absolute;top:0;width:100%;height:100%;padding-top:55px;text-align:center;text-transform:none;font-weight:400;background:rgba(255,255,255,.9);z-index:5" translate="RESERVATIONS.STAFF_ONLY" translate-values="{ centerName: $ctrl.center.name, centerPhone: $ctrl.center.phone, centerEmail: $ctrl.center.email }"> </ff-info> </ff-col> </ff-row> </form> <form class="res-confirm" ng-if="$ctrl.confirmation || $ctrl.cancelConfirmation" ng-style="{ marginTop: $app.hideHeader ? 0 : null }"> <div class="res-header"> <h1 class="page-title" ng-if="$ctrl.confirmation" translate="RESERVATIONS.CONFIRM.PAGE_TITLE"></h1> <h1 class="page-title" ng-if="$ctrl.cancelConfirmation" translate="RESERVATIONS.CANCEL.PAGE_TITLE"></h1> <small translate="RESERVATIONS.HINT"></small> </div> <ff-col class="res-confirm-body"> <ff-panel> <ff-row ng-if="$ctrl.reservation ? $ctrl.reservation.companyName : $ctrl.user.company"> <ff-label flex="0 1 110px">Company</ff-label> <ff-static ff-bind="$ctrl.reservation ? $ctrl.reservation.companyName : $ctrl.user.company"></ff-static> </ff-row> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.USER"></span></ff-label> <ff-static ff-bind="$ctrl.reservation ? $ctrl.reservation.userName : $ctrl.user.firstName + \' \' + $ctrl.user.lastName"></ff-static> </ff-row> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.LOCATION"></span></ff-label> <ff-static ff-bind="$ctrl.center.name"></ff-static> </ff-row> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.SPACE"></span></ff-label> <ff-static ff-bind="$ctrl.reservationUnit.name"></ff-static> </ff-row> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.DATE"></span></ff-label> <ff-static ff-bind="$ctrl.date | date:\'mediumDate\'"></ff-static> </ff-row> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.TIME"></span></ff-label> <ff-static><span nice-time="$ctrl.timeStart"></span>&nbsp;-&nbsp;<span nice-time="$ctrl.timeEnd"></span></ff-static> </ff-row> <div ng-if="$ctrl.hasRecurring()"> <ff-row> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.REPEAT_FREQUENCY"></span></ff-label> <ff-static ff-bind="$ctrl.repeatFrequency.name"></ff-static> </ff-row> <ff-row ng-if="$ctrl.repeatFrequency.repeatDurationOptions"> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.REPEAT_DURATION"></span></ff-label> <ff-static ff-bind="$ctrl.repeatDuration + \' \' + $ctrl.repeatFrequency.repeatDurationUnit"></ff-static> </ff-row> </div> <ff-row ng-if="!$ctrl.hideReservationCostEstimate"> <ff-label flex="0 1 110px"><span translate="RESERVATIONS.COST"></span></ff-label> <ff-static ff-bind="$ctrl.totalCost | ncurrency | nd"></ff-static> </ff-row> <label class="ff-row ff-tmargin" style="margin-left:.5rem"> <ff-checkbox name="emailConfirmation" ff-model="$ctrl.emailConfirmation"> <span translate="RESERVATIONS.EMAIL_CONFIRMATION"></span> </ff-checkbox> </label> </ff-panel> </ff-col> <ff-btn-group class="buttons-bottom"> <ff-btn sense="signOut" ng-if="$ctrl.signOut" ff-click="$ctrl.signOut()" ff-countdown="30"> <span translate="GLOBAL.BTN_SIGN_OUT"></span> </ff-btn> <ff-btn sense="cancel" ff-click="$ctrl.confirmation = $ctrl.cancelConfirmation = false"> <span translate="GLOBAL.BTN_CANCEL"></span> </ff-btn> <ff-btn sense="ok" type="submit" ff-click="$ctrl.cancelConfirmation ? $ctrl.cancelReservation() : $ctrl.reservation ? $ctrl.updateReservation() : $ctrl.makeReservation()"> <span translate="GLOBAL.BTN_CONFIRM"></span> </ff-btn> </ff-btn-group> </form> '},qNmJ:function(e,t,r){}}]);