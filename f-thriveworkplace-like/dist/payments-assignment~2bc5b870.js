(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{Mwqb:function(e,t){e.exports="<div class=dw-modal> <div class=dw-modal-fade style=background-color:#fff></div> <div style=overflow:auto;width:100%;height:100%;z-index:1;padding:1rem> <payments-assignment purchase-id=$ctrl.purchaseId back=$ctrl.back></payments-assignment> </div> </div> "},"ee+B":function(e,t,a){"use strict";t.a=angular.module("autofocusDirective",[]).directive("autofocus",["$timeout",function(e){return{restrict:"A",link:function(t,a,n){if("false"!==n.autofocus){var s=a[0].parentNode.querySelector("input")||a[0].parentNode.querySelector("select")||a[0].parentNode.querySelector("button");s&&e((function(){return s.focus()}))}}}}])},"ff+D":function(e,t,a){"use strict";a.r(t);var n=a("Mwqb"),s=a.n(n),f=a("iAzO"),r=(a("JBxO"),a("FdtR"),a("yCd9")),c=a.n(r),l=a("YtL8"),i=a.n(l),o=a("n556"),p=a.n(o),u=a("WSeP"),m=a.n(u),h=angular.module("deskworks.PaymentsAssignment",["ngResource","datesDeserializer","deskworks.config"]).factory("PaymentsAssignment",["$resource","$timeout","deskworksConfig","datesDeserializer",function(e,t,a,n){var s=n(["payments.billedAt","charges.billedAt"]),f=e(a.getApiAbsUrl("/payments-assignment/:purchaseId"),{},{get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,s]},update:{method:"PUT"}});return{get:function(e){return f.get(e).$promise.then((function(e){return function(e){var t,a;return m()(t=e.payments).call(t,(function(e){e.total=e.amount-e.refund})),m()(a=e.charges).call(a,(function(e){e.total=e.amount-e.discount+e.tax})),r({payments:e.payments,charges:e.charges}),e}(e)}))},save:function(e,t){return f.update(e,t).$promise},calcBalances:r};function r(e){var t=e.payments,a=e.charges;m()(a).call(a,(function(e){e.balance=e.total})),m()(t).call(t,(function(e){e.balance=e.total,m()(a).call(a,(function(t){var a=angular.isNumber(t.payments[e.id])?+t.payments[e.id]:0;t.balance-=a,e.balance-=a}))}))}}]),d=a("ee+B"),g=angular.module("deskworks.paymentsAssignmentDirective",["deskworks.helper",h.name,d.a.name]).directive("paymentsAssignment",(function(){return{template:p.a,restrict:"E",scope:!0,controller:"PaymentsAssignmentCtrl as $ctrl",bindToController:{purchaseId:"<",back:"<"}}})).controller("PaymentsAssignmentCtrl",["$scope","state","dwAlerts","helper","PaymentsAssignment",function(e,t,a,n,s){var f=this;f.$onInit=function(){f.charges=[],f.payments=[];e.$watch((function(){var e;return i()(e=f.charges).call(e,(function(e,t){var a;return e[t.id]=i()(a=f.payments).call(a,(function(e,a){return e+t.payments[a.id]||0}),0),e}),{})}),(function(){return s.calcBalances({charges:f.charges,payments:f.payments})}),!0)},f.$onChanges=function(){f.purchaseId&&f.fetch()},f.fetch=function(){if(f.fetching)return f.fetching;f.fetching=s.get({purchaseId:f.purchaseId}).catch((function(e){return a.error(e,"Failed to get payments assignment.")})).finally((function(){f.fetching=null})).then((function(e){f.charges=e.charges,f.payments=e.payments}))},f.save=function(){var e;if(!n.pointFirstInvalid("payments-assignment")){var t={charges:c()(e=f.charges).call(e,(function(e){return{id:e.id,payments:e.payments}}))};return s.save({purchaseId:f.purchaseId},t).catch((function(e){return a.error(e,"Failed to save payments assignment.")})).then((function(){return f.back()}))}}}]),y=angular.module("deskworks.paymentsAssignmentDialog",[f.a.name,g.name]).factory("paymentsAssignmentDialog",["dwModal",function(e){return{open:function(t){var a=t.scope,n=t.purchaseId;return e.show({scope:a,template:s.a,controller:"PaymentsAssignmentModalCtrl as $ctrl",inputs:{purchaseId:n}})}}}]).controller("PaymentsAssignmentModalCtrl",["$scope","purchaseId","close",function(e,t,a){this.purchaseId=t,e.close=a,this.back=function(){return a()}}]),x=["$injector",function(e){e.loadNewModules([y.name])}];t.default=x},n556:function(e,t){e.exports='<form name=$ctrl.form class=gutter-v> <ff-panel> <ff-panel-header><span translate=PAYMENTS_ASSIGNMENT.PAYMENTS></span></ff-panel-header> <div ff-dim=$ctrl.fetching> <ff-header> <ff-row> <cell flex="0 1 100px" class="ff-right show-sm"><span translate=GLOBAL.DATE></span></cell> <cell><span translate=GLOBAL.NAME></span></cell> <cell flex="0 1 90px" class="ff-right show-md"><span translate=GLOBAL.AMOUNT></span></cell> <cell flex="0 1 90px" class="ff-right show-md"><span translate=GLOBAL.REFUND></span></cell> <cell flex="0 1 90px" class=ff-right><span translate=GLOBAL.TOTAL></span></cell> <cell flex="0 1 90px" class=ff-right><span translate=GLOBAL.BALANCE></span></cell> </ff-row> </ff-header> <ff-static class=ff-no-frame ng-if=!$ctrl.payments.length><span translate=GLOBAL.NONE></span></ff-static> <ff-row ng-repeat="payment in $ctrl.payments"> <ff-static flex="0 1 100px" class="ff-right show-sm">{{payment.billedAt | date}}</ff-static> <ff-static>{{payment.name}}</ff-static> <ff-static flex="0 1 90px" class="ff-right show-md">{{payment.amount | ncurrency}}</ff-static> <ff-static flex="0 1 90px" class="ff-right show-md">{{payment.refund | ncurrency}}</ff-static> <ff-static flex="0 1 90px" class=ff-right>{{payment.total | ncurrency}}</ff-static> <ff-static flex="0 1 90px" class=ff-right>{{payment.balance | ncurrency}}</ff-static> </ff-row> </div> </ff-panel> <ff-panel> <ff-panel-header><span translate=PAYMENTS_ASSIGNMENT.HEADER></span></ff-panel-header> <div ff-dim=$ctrl.fetching> <ff-header> <ff-row> <cell flex="1 0 80px"><span translate=GLOBAL.PRODUCT></span></cell> <cell flex="0 0 90px" class="ff-right show-lg"><span translate=GLOBAL.AMOUNT></span></cell> <cell flex="0 0 90px" class="ff-right show-lg"><span translate=GLOBAL.DISCOUNT></span></cell> <cell flex="0 0 90px" class="ff-right show-md"><span translate=GLOBAL.TAX></span></cell> <cell flex="0 0 90px" class="ff-right show-sm"><span translate=GLOBAL.TOTAL></span></cell> <cell flex="0 1 250px"><span translate=PAYMENTS_ASSIGNMENT.PAYMENTS></span></cell> <cell flex="0 0 90px" class=ff-right><span translate=GLOBAL.BALANCE></span></cell> </ff-row> </ff-header> <ff-static class=ff-no-frame ng-if=!$ctrl.charges.length><span translate=GLOBAL.NONE></span></ff-static> <ff-row ng-repeat="charge in $ctrl.charges"> <ff-static flex="1 0 80px">{{charge.name}}</ff-static> <ff-static flex="0 0 90px" class="ff-right show-lg">{{charge.amount | ncurrency}}</ff-static> <ff-static flex="0 0 90px" class="ff-right show-lg">{{charge.discount | ncurrency}}</ff-static> <ff-static flex="0 0 90px" class="ff-right show-md">{{charge.tax | ncurrency}}</ff-static> <ff-static flex="0 0 90px" class="ff-right show-sm">{{charge.total | ncurrency}}</ff-static> <ff-static flex="0 1 250px"> <ff-col ng-init="chargeIndex = $index"> <label ng-repeat="payment in $ctrl.payments" class=ff-row ng-class="{ \'ff-no-frame\': $index === $ctrl.payments.length - 1 }"> <ff-label>{{payment.name}}</ff-label> <ff-number flex="0 0 65px" ff-model=charge.payments[payment.id] class=ff-right autofocus="{{!$index && !chargeIndex}}" ff-validate-alert="{{\'GLOBAL.AMOUNT\' | translate}}" placeholder=0></ff-number> </label> </ff-col> </ff-static> <ff-static flex="0 0 90px" class=ff-right>{{charge.balance | ncurrency}}</ff-static> </ff-row> </div> </ff-panel> <ff-btn-group> <ff-btn sense=back ff-click=$ctrl.back()><span translate=GLOBAL.BTN_BACK></span></ff-btn> <ff-btn sense=save type=submit ff-click=$ctrl.save() ff-disabled=$ctrl.form.$pristine> <span translate=GLOBAL.BTN_SAVE></span> </ff-btn> </ff-btn-group> </form> '}}]);