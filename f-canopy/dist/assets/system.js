angular.module("deskworks.system.AccessCardEditCtrl",["deskworks.accessCard.service"]).controller("AccessCardEditCtrl",["$scope","$translate","dwAlerts","state","helper","user","accessCard","AccessCard",function(e,r,t,s,n,i,a,o){"use strict";var d=this;d.accessCard=a||{},s.setPageTitle(r.instant(d.accessCard.id?"ACCESS_CARDS.EDIT.PAGE_TITLE":"ACCESS_CARDS.NEW.PAGE_TITLE",{userName:d.accessCard.id?d.accessCard.userName:i.firstName+" "+i.lastName})),d.save=function(){if(!n.pointFirstInvalid("#accessCard")){var e={number:d.accessCard.number,notes:d.accessCard.notes};return d.accessCard.id||(e.userId=s.getCurrentUserId()),(d.accessCard.id?o.update({centerId:s.getCurrentCenterId(),accessCardId:d.accessCard.id},e).$promise:o.save({centerId:s.getCurrentCenterId()},e).$promise).catch(function(e){return t.error(e,"Failed to save access card.")}).then(function(e){return d.accessCard.id?(d.form.$setPristine(),e):s.setPath("/access-cards/"+e.id)})}},d.delete=function(e){if(confirm(r.instant("ACCESS_CARDS.CONFIRM_DELETE")))return o.delete({centerId:s.getCurrentCenterId(),accessCardId:d.accessCard.id}).$promise.catch(function(e){return t.error(e,"Failed to delete access card.")}).then(function(){return s.setPath("/access-cards")})},d.back=function(){return s.setPath("/access-cards")},e.$watch("state.getCurrentCenterId()",function(e,r){e!==r&&d.back()})}]),angular.module("deskworks.AccessCardListCtrl",["deskworks.system.service","deskworks.accessCard.service"]).controller("AccessCardListCtrl",["$scope","$route","$timeout","$translate","dwAlerts","state","helper","accessCards","AccessCard",function(e,r,t,s,n,i,a,o,d){"use strict";var c=this;i.setPageTitle(s.instant("ACCESS_CARDS.PAGE_TITLE")),c.accessCards=o,c.edit=function(e){return i.setPath("/access-cards/"+e.id)},c.new=function(){return i.setPath("/access-cards/new")},c.delete=function(e){if(confirm(s.instant("ACCESS_CARDS.CONFIRM_DELETE")))return d.delete({centerId:i.getCurrentCenterId(),accessCardId:e.id}).$promise.catch(function(e){return n.error(e,"Failed to delete access card.")}).then(function(){return r.reload(),t(6e3)})}}]),angular.module("deskworks.adminRolesMatrix",[]).factory("adminRolesMatrix",function(){"use strict";return{accountant:[],coordinator:[],admin:["accountant","coordinator","admin"],management:["accountant","coordinator","admin"],master:["accountant","coordinator","admin","management","master"]}}),angular.module("deskworks.AdminEditCtrl",["deskworks.Admin","deskworks.center.service","deskworks.helper","deskworks.members.userProfile.sections.photo","deskworks.optsAdminPermission","deskworks.adminRolesMatrix"]).controller("AdminEditCtrl",["$scope","$window","$translate","$rootScope","$route","state","helper","dwAlerts","admin","userProfile","adminRolesMatrix","Admin","upPrinterCodeService","upPhotoService","optsAdminPermission",function(e,r,t,s,n,i,a,o,d,c,u,l,C,m,f){"use strict";var p=this;i.setPageTitle(t.instant(d.id?"ADMINISTRATORS.EDIT.PAGE_TITLE":"ADMINISTRATORS.NEW.PAGE_TITLE")),p.isNew="new"===n.current.params.adminId,p.admin=d,p.roles=d.options.roles.filter(function(e){return u[i.getLoggedUser().role].indexOf(e.id)>=0||p.admin.role.id===e.id}),p.admin.printerCode=angular.copy(c.printerCodes&&c.printerCodes[0]||{id:a.uid(),code:""}),p.userProfile=c,p.schema={photo:!0},p.userProfile.isNew=function(){return!p.admin.id},p.optsPermission=f,p.save=function(){if(!a.pointFirstInvalid("#administrator"))return l.save(p.admin).then(function(e){return p.userProfile.id=e.id,p.admin.printerCode.code!==(p.userProfile.printerCodes&&p.userProfile.printerCodes[0]||{code:""}).code?p.admin.printerCode.code?C.save(i.getCurrentCenterId(),p.userProfile.id,p.admin.printerCode).then(function(){return p.userProfile.printerCodes=[p.admin.printerCode],e}):C.delete(i.getCurrentCenterId(),p.userProfile.id,p.admin.printerCode).then(function(){return p.userProfile.printerCodes=[],e}):e}).then(function(e){return p.isNew?m.save(i.getCurrentCenterId(),p.userProfile).catch(function(e){return o.error(e,"Failed to save photo.")}).then(function(){return e}):e}).then(function(e){return s.$emit("CENTERS:REFRESH"),p.isNew?i.setPath("/administrators/"+e.id):p.form.$setPristine()}).catch(function(e){return o.error(e,"Failed to save administrator.")})},p.remove=function(){if(r.confirm(t.instant("ADMINISTRATORS.CONFIRM_DELETE")))return l.delete(p.admin.id).catch(function(e){return o.error(e,"Failed to delete administrator.")}).then(function(){return i.setPath("/administrators")})},p.back=function(){return i.setPath("/administrators")},p.toTasks=function(e){return e.preventDefault(),i.setPath("/tasks")}}]),angular.module("deskworks.AdministratorListCtrl",[]).controller("AdministratorListCtrl",["$scope","$translate","state","helper","admins",function(e,r,t,s,n){"use strict";t.setPageTitle(r.instant("ADMINISTRATORS.PAGE_TITLE")),this.admins=n,this.edit=function(e){return t.setPath("/administrators/"+e.id)},this.new=function(){return t.setPath("/administrators/new")}}]),angular.module("deskworks.LeadSourceListCtrl",["deskworks.system.service","deskworks.routeHelper"]).controller("LeadSourceListCtrl",["$scope","$translate","dwAlerts","state","helper","leadSources","systemService",function(e,r,t,s,n,i,a){"use strict";var o=this;s.setPageTitle(r.instant("LEAD_SOURCES.PAGE_TITLE")),o.leadSources=i,o.update=function(e,r,s){if(!n.pointFirstInvalid("#leadSource"+s)){var i={position:e.position,name:e.name};return(e.id?a.updateLeadSource(e.id,i):a.createLeadSource(i)).catch(function(e){return t.error(e,"Failed to save lead source.")}).then(function(t){r.$setPristine(),e.id=t.id,o.leadSources.sort(function(e,r){return e.position>r.position?1:e.position<r.position?-1:0})})}},o.new=function(){o.leadSources.push({})},o.delete=function(e,r){if(e.id)return a.removeLeadSource(e.id).catch(function(e){t.error(e,"Failed to save lead source.")}).then(function(){o.leadSources.splice(r,1)});o.leadSources.splice(r,1)}}]);