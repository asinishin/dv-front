angular.module("deskworks.ApiSettingsCtrl",["debounce","deskworks.allowedHost.service"]).controller("ApiSettingsCtrl",["$scope","$translate","dwAlerts","state","helper","debounce","allowedHosts","allowedHostService",function(e,t,n,s,i,r,o,a){"use strict";var c=this;s.setPageTitle(t.instant("API_SETTINGS.PAGE_TITLE")),c.allowedHosts=o,c.save=r(function(e,t,s){if(t.$invalid)return;return e.$$spin=!0,a.save(e).catch(function(e){return n.error(e,"Failed to save allowed host.")}).finally(function(){e.$$spin=!1})},1e3),c.new=function(){c.allowedHosts.push({isActive:!0})},c.delete=function(e,t){if(e.id)return e.$$spin=!0,a.delete(e.id).catch(function(e){n.error(e,"Failed to delete allowed host.")}).then(function(){c.allowedHosts.splice(t,1)}).finally(function(){e.$$spin=!1});c.allowedHosts.splice(t,1)}}]),angular.module("deskworks.SetupBankEditCtrl",["deskworks.bank.service","deskworks.routeHelper","deskworks.optsTimezone"]).controller("SetupBankEditCtrl",["$scope","$window","$translate","dwAlerts","state","helper","bank","bankService","optsTimezone",function(e,t,n,s,i,r,o,a,c){"use strict";var l=this;i.setPageTitle(n.instant("new"===o.id?"BANKS.NEW.PAGE_TITLE":"BANKS.EDIT.PAGE_TITLE")),l.bank=o,l.optsTimezone=c,l.save=function(){if(!r.pointFirstInvalid("#bankEdit"))return a.save(l.bank).catch(function(e){return s.error(e,"Failed to save bank")}).then(function(){return i.setPath("/banks")})},l.delete=function(){if(t.confirm(n.instant("BANKS.CONFIRM_DELETE")))return a.delete(l.bank.id).catch(function(e){return s.error(e,"Failed to delete bank")}).then(function(){return i.setPath("/banks")})},l.back=i.back}]),angular.module("deskworks.SetupBanksCtrl",["deskworks.SetupBankEditCtrl","deskworks.bank.service","deskworks.routeHelper","deskworks.optsTimezone"]).controller("SetupBanksCtrl",["$scope","$translate","state","helper","banks","optsTimezone",function(e,t,n,s,i,r){"use strict";var o=this;n.setPageTitle(t.instant("BANKS.PAGE_TITLE")),o.banks=i,o.banks.forEach(function(e){e.timezone=(s.findByKeyValue(r,"id",e.timezone)||{}).name||e.timezone}),o.edit=function(e){return n.setPath("/banks/"+e.id)},o.new=function(){return n.setPath("/banks/new")}}]),angular.module("deskworks.BarUploadSettingsCtrl",["deskworks.state","deskworks.setup.service"]).controller("BarUploadSettingsCtrl",["$scope","$translate","dwAlerts","state","helper","setupService","settings",function(e,t,n,s,i,r,o){"use strict";var a=this;s.setPageTitle(t.instant("BAR_UPLOAD_SETTINGS.PAGE_TITLE")),a.settings=o,a.settings.centerId=s.getCurrentCenterId(),a.save=function(){if(!i.pointFirstInvalid("#setupBarUploadSettings"))return r.updateBarUploadSettings(a.settings).then(function(e){a.form.$setPristine()}).catch(function(e){return n.error(e,"Failed to save bar upload settings.")})}}]),angular.module("deskworks.CenterEditCtrl",["deskworks.center.service","deskworks.dwAddress","deskworks.reservationRules","deskworks.optsTimezone","deskworks.Owner","deskworks.Region","deskworks.NetCheckInSettings","deskworks.setup.optsFreeAccessLength"]).controller("CenterEditCtrl",["$scope","$translate","dwAlerts","state","helper","center","settings","Owner","Region","centerService","optsTimezone","optsFreeAccessLength","NetCheckInSettings",function(e,t,n,s,i,r,o,a,c,l,u,d,f){"use strict";var p=this;s.setPageTitle(t.instant(r.id?"CENTERS.EDIT.PAGE_TITLE":"CENTERS.NEW.PAGE_TITLE")),p.center=r,p.banks=r.options.banks,p.optsTimezone=u,p.optsFreeAccessLength=d;var m=!p.center.id||"new"===p.center.id;o.isFranchise&&(p.ownerRegionReadOnly="master"!==s.getLoggedUser().role,a.query().catch(function(e){return n.error(e,"Failed to query owners.")}).then(function(e){p.owners=e,p.owners.unshift({id:null,name:t.instant("GLOBAL.NONE")})}),c.query().catch(function(e){return n.error(e,"Failed to query regions.")}).then(function(e){p.regions=e,p.regions.unshift({id:null,name:t.instant("GLOBAL.NONE")})})),m?p.netCheckInSettings={freeAccessLength:120}:f.get(p.center.id).catch(function(e){return n.error(e,"Failed to get net check-in settings.")}).then(function(e){p.netCheckInSettings=e}),p.save=function(){if(!i.pointFirstInvalid("#centerEdit"))return l.save(p.center).catch(function(e){return n.error(e,"Failed to save center.")}).then(function(e){return f.save(p.center.id,p.netCheckInSettings).catch(function(e){n.error(e,"Failed to save net check-in settings.")}).then(function(){return e})}).then(function(t){return e.$emit("CENTERS:REFRESH"),m?s.setPath("/centers/"+t.id):l.get(p.center.id).catch(function(e){return n.error(e,"Failed to get center.")}).then(function(e){p.center=e,p.form.$setPristine()})})},p.remove=function(){if(confirm(t.instant("CENTERS.CONFIRM_DELETE")))return l.deleteCenter(p.center.id).catch(function(e){return n.error(e,"Failed to delete center.")}).then(function(t){return e.$emit("CENTERS:REFRESH"),s.setPath("/centers")})},p.back=function(){return s.setPath("/centers")},p.uploadPhoto=function(s,i){return i&&i.length>0?n.error(t.instant("GLOBAL.PHOTO.INVALID_FORMAT")):s&&s.length>0?(p.spinUpload=!0,l.uploadThumbnail(p.center.id,s[0]).catch(function(e){return p.spinUpload=!1,n.error(e,"Failed to upload center thumbnail.")}).then(function(t){return p.spinUpload=!1,p.center.thumbnail=t.data.photo,e.$emit("CENTERS:REFRESH"),t.data})):void 0},p.addTax=function(){var e={};p.center.taxRates.length||(e.name=t.instant("CENTERS.TAX.NAME.DEFAULT")),p.center.taxRates.push(e),p.form.$setDirty()},p.deleteTax=function(e){p.center.taxRates.splice(p.center.taxRates.indexOf(e),1),p.form.$setDirty()}}]),angular.module("deskworks.CenterListCtrl",[]).controller("CenterListCtrl",["$scope","$translate","state","helper","centers","admin",function(e,t,n,s,i,r){"use strict";n.setPageTitle(t.instant("CENTERS.PAGE_TITLE")),this.centers=i.filter(function(e){return!r||!!(s.findByKeyValue(r.centers,"id",e.id)||{}).permission}),this.edit=function(e){return n.setPath("/centers/"+e.id)},this.new=function(){return n.setPath("/centers/new")}}]),angular.module("deskworks.IntegrationsSetupCtrl",[]).controller("IntegrationsSetupCtrl",["$scope","$translate","$injector","dwAlerts","state","helper",function(e,t,n,s,i,r){"use strict";var o=this;i.setPageTitle(t.instant("INTEGRATIONS_SETUP.PAGE_TITLE")),o.appointmentPlus=n.has("appointmentPlusSettingsDirective"),o.quickBooks=n.has("quickBooksSettingsDirective")}]),angular.module("deskworks.OwnersRegionsCtrl",["debounce","deskworks.Owner","deskworks.Region"]).controller("OwnersRegionsCtrl",["$scope","$translate","dwAlerts","state","helper","debounce","owners","regions","Owner","Region",function(e,t,n,s,i,r,o,a,c,l){"use strict";var u=this;s.setPageTitle(t.instant("OWNERS_REGIONS.PAGE_TITLE")),u.owners=o,u.regions=a,u.saveOwner=r(function(e,t,s){if(t.$invalid)return;return e.$$spin=!0,c.save(e).catch(function(e){return n.error(e,"Failed to save owner.")}).finally(function(){e.$$spin=!1})},1e3),u.saveRegion=r(function(e,t,s){if(t.$invalid)return;return e.$$spin=!0,l.save(e).catch(function(e){return n.error(e,"Failed to save region.")}).finally(function(){e.$$spin=!1})},1e3),u.newOwner=function(){u.owners.push({})},u.newRegion=function(){u.regions.push({})},u.deleteOwner=function(e,t){if(e.id)return e.$$spin=!0,c.delete(e.id).catch(function(e){n.error(e,"Failed to delete owner.")}).then(function(){u.owners.splice(t,1)}).finally(function(){e.$$spin=!1});u.owners.splice(t,1)},u.deleteRegion=function(e,t){if(e.id)return e.$$spin=!0,l.delete(e.id).catch(function(e){n.error(e,"Failed to delete region.")}).then(function(){u.regions.splice(t,1)}).finally(function(){e.$$spin=!1});u.regions.splice(t,1)}}]),angular.module("deskworks.setup.printerUsageSettings",["deskworks.state","deskworks.setup.service","deskworks.printerUsageTypeNames"]).controller("PrinterUsageSettingsCtrl",["$scope","$translate","dwAlerts","state","helper","settings","setupService","printerUsageTypeNames",function(e,t,n,s,i,r,o,a){"use strict";var c=this;s.setPageTitle(t.instant("PRINTER_USAGE_SETTINGS.PAGE_TITLE")),c.settings=r,c.typeNames=a,c.save=function(){if(!i.pointFirstInvalid("#printerUsageSettings"))return o.updatePrinterUsageSettings(s.getCurrentCenterId(),c.settings).catch(function(e){return n.error(e,"Failed to save printer usage settings.")}).then(function(){c.form.$setPristine()})},c.addProductMapping=function(e){var t=e.productMappings;t.push({from:t.length?null:1,to:null}),c.form.$setDirty()},c.deleteProductMapping=function(e,t){var n=e.productMappings;n.splice(t,1),n.length&&(n[n.length-1].to=null),n.length&&(n[0].from=1),c.form.$setDirty()}}]),angular.module("deskworks.SetupSettingsCtrl",["deskworks.state","deskworks.setup.service","deskworks.userProfile.service","deskworks.whitelabel","setLocale","setTranslations","deskworks.setup.optsProrateAtStart","deskworks.setup.optsProrateAtTermination","deskworks.setup.optsMinPassFractionUnit","deskworks.optsDashboardIncome","deskworks.setup.optsRecurringPeriodBase"]).controller("SetupSettingsCtrl",["$scope","$window","$timeout","$route","$translate","$q","dwAlerts","state","helper","setupService","settings","whitelabel","userProfileService","optsInvoiceDate","optsProrateAtStart","optsProrateAtTermination","optsDashboardIncome","optsReservationCreditsUnit","optsMinPassFractionUnit","optsRecurringPeriodBase",function(e,t,n,s,i,r,o,a,c,l,u,d,f,p,m,k,E,h,g,T){"use strict";var w=this;a.setPageTitle(i.instant("SETUP_SETTINGS.PAGE_TITLE")),w.settings=u,w.advanceInvoicingDays=[{id:1,name:"1 day"}];for(var S=2;S<31;S++)w.advanceInvoicingDays.push({id:S,name:S+" days"});w.settings.advanceInvoicingDays=c.findByKeyValue(w.advanceInvoicingDays,"id",w.settings.advanceInvoicingDays),w.settings.advanceInvoicingDays||(w.settings.advanceInvoicingDays=w.advanceInvoicingDays[0]),w.optsInvoiceDate=p,w.optsProrateAtStart=m,w.optsProrateAtTermination=k,w.optsReservationCreditsUnit=h,w.optsMinPassFractionUnit=g,w.optsDashboardIncome=E,w.optsRecurringPeriodBase=T,w.settings.calendarOwners.forEach(function(e){f.get(a.getCurrentCenterId(),e.owner).then(function(t){e.owner={id:t.id,fullName:t.firstName+" "+t.lastName,company:t.company,email:t.email}})}),w.save=function(){if(!c.pointFirstInvalid("#setupSettings"))return l.updateSetupSettings(w.settings).catch(function(e){return o.error(e,"Failed to save setup settings.")}).then(function(){s.reload()})},w.uploadTermsOfService=function(e,t){return t&&t.length>0?o.error(i.instant("SETUP_SETTINGS.INVALID_FORMAT_PDF")):e&&e.length>0?(w.spinTOS=!0,l.uploadTermsOfService(e[0]).catch(function(e){return o.error(e,"Failed to upload terms of service.")}).then(function(e){return w.settings.tosLinkUrl=e.data.termsOfService,e.data}).finally(function(){w.spinTOS=!1})):void 0},w.addCalendarOwner=function(){w.settings.calendarOwners.push({}),w.form.$setDirty()},w.deleteCalendarOwner=function(e){var t=w.settings.calendarOwners.indexOf(e);t>=0&&w.settings.calendarOwners.splice(t,1),w.form.$setDirty()},w.disconnectCalendar=function(){if(window.confirm(i.instant("CALENDAR.CONFIRM_DISCONNECT")))return l.updateSetupSettingsRaw({calendarConnected:!1}).catch(function(e){return o.error(e,"Failed to disconnect calendar.")}).then(function(){w.settings.calendarConnected=!1})},w.ccTypeRequired=function(){return w.settings.creditCardTypes.every(function(e){return!e.enable})}}]),angular.module("deskworks.SystemEmailEditCtrl",["deskworks.system.service"]).controller("SystemEmailEditCtrl",["$scope","$translate","dwAlerts","state","helper","systemEmail","systemService","optsSystemEmailFunction",function(e,t,n,s,i,r,o,a){"use strict";var c=this;s.setPageTitle(t.instant(r.id?"SYSTEM_EMAILS.EDIT.PAGE_TITLE":"SYSTEM_EMAILS.NEW.PAGE_TITLE")),c.systemEmail=r,c.functions=a,c.systemEmail.function=i.findByKeyValue(c.functions,"id",c.systemEmail.function)||c.functions[0],c.save=function(){if(!i.pointFirstInvalid("#systemEmailEdit")){var e={function:c.systemEmail.function.id,email:c.systemEmail.email};return(c.systemEmail.id?o.updateSystemEmail(c.systemEmail.id,e):o.createSystemEmail(e)).catch(function(e){return n.error(e,"Failed to save system email.")}).then(function(e){if(!c.systemEmail.id)return s.setPath("/system-emails/"+e.id);c.form.$setPristine()})}},c.remove=function(){if(confirm(t.instant("SYSTEM_EMAILS.CONFIRM_DELETE")))return o.removeSystemEmail(c.systemEmail.id).catch(function(e){n.error(e,"Failed to remove system email.")}).then(function(){return s.setPath("/system-emails")})},c.back=function(){return s.setPath("/system-emails")}}]),angular.module("deskworks.SystemEmailListCtrl",["deskworks.system.service","deskworks.optsSystemEmailFunction"]).controller("SystemEmailListCtrl",["$scope","$translate","state","helper","systemEmails","optsSystemEmailFunction",function(e,t,n,s,i,r){"use strict";var o=this;n.setPageTitle(t.instant("SYSTEM_EMAILS.PAGE_TITLE")),o.systemEmails=i,o.functions=r,o.systemEmails.forEach(function(e){e.function=s.findByKeyValue(o.functions,"id",e.function)}),o.edit=function(e){return n.setPath("/system-emails/"+e.id)},o.new=function(){return n.setPath("/system-emails/new")}}]),angular.module("deskworks.TaskEditCtrl",["deskworks.Task","deskworks.optsTaskPermission"]).controller("TaskEditCtrl",["$scope","$translate","dwAlerts","state","helper","task","Task","optsTaskPermission",function(e,t,n,s,i,r,o,a){"use strict";var c=this;s.setPageTitle(t.instant(r.id?"TASKS.EDIT.PAGE_TITLE":"TASKS.NEW.PAGE_TITLE")),r.permissions=r.permissions||{},c.task=r,c.roles=r.options.roles,c.optsTaskPermission=a,c.task.id||c.roles.forEach(function(e){c.task.permissions[e.id]="view","nonMember"!==e.id&&"member"!==e.id||(c.task.permissions[e.id]=null),"admin"!==e.id&&"master"!==e.id||(c.task.permissions[e.id]="edit")}),c.save=function(){if(!i.pointFirstInvalid("#taskEdit")){var t=!c.task.id;return o.save(c.task).catch(function(e){return n.error(e,"Failed to save task.")}).then(function(n){if(e.$emit("SIDEBAR:REFRESH"),t)return s.setPath("/tasks/"+n.id);c.form.$setPristine()})}},c.remove=function(){if(confirm(t.instant("TASKS.CONFIRM_DELETE")))return o.delete(c.task.id).catch(function(e){return n.error(e,"Failed to delete task.")}).then(function(){return e.$emit("SIDEBAR:REFRESH"),s.setPath("/tasks")})},c.back=function(){return s.setPath("/tasks")},c.onChangeIsGroup=function(){c.task.isGroup&&c.roles.forEach(function(e){c.task.permissions[e.id]&&(c.task.permissions[e.id]="view")})}}]),angular.module("deskworks.TaskListCtrl",[]).controller("TaskListCtrl",["$scope","$translate","state","helper","tasks",function(e,t,n,s,i){"use strict";var r=this;n.setPageTitle(t.instant("TASKS.PAGE_TITLE")),r.tasks=[],r.tasksHidden=[],r.tasksHiddenCollapse=!0,r.roles=i.options.roles,i.tasks.forEach(function(e){(e.position?r.tasks:r.tasksHidden).push(e);var t=[],n=[];r.roles.forEach(function(s){return"edit"===e.permissions[s.id]?n.push(s.name):"view"===e.permissions[s.id]?t.push(s.name):void 0}),e.viewRoles=t.join(", "),e.editRoles=n.join(", "),e.viewRoles&&e.editRoles&&!e.isGroup&&(e.viewRoles+=",")}),r.edit=function(e){return n.setPath("/tasks/"+e.id)},r.new=function(){return n.setPath("/tasks/new")}}]),angular.module("deskworks.UserFieldsCtrl",["debounce","dnd","deskworks.UserField","deskworks.fdToolbar","deskworks.fdFieldTypes"]).controller("UserFieldsCtrl",["$scope","$translate","$window","dwAlerts","state","helper","debounce","dnd","UserField","userFields","fdFieldTypes",function(e,t,n,s,i,r,o,a,c,l,u){"use strict";function d(e,t){if(!t.$invalid)return e.$$spin=!0,c.save(e).catch(function(e){return s.error(e,"Failed to save user field.")}).finally(function(){e.$$spin=!1}).catch(angular.noop)}i.setPageTitle(t.instant("USER_FIELDS.PAGE_TITLE")),this.types=u,this.sections={customFields:l.filter(function(e){return"customFields"===e.section}),shareable:l.filter(function(e){return"shareable"===e.section})},this.onDrop=function(e,i,r,o,l,u){var f=e[i];if(!r&&f.id&&!n.confirm(t.instant("USER_FIELDS.TRASH.CONFIRM")))return!1;if((f=a.move(e,i,r,o))&&(f.section=u),r){if(l.$invalid)return!0;d(f,l)}else{if(!f.id)return!0;!function(e){if(!e.id)return;e.$$spin=!0,c.delete(e.id).catch(function(e){s.error(e,"Failed to delete field.")}).finally(function(){e.$$spin=!1}).catch(angular.noop)}(f)}return!0},this.saveField=o(d,1e3)}]),angular.module("deskworks.fdFieldTypes",[]).factory("fdFieldTypes",["$rootScope","$translate",function(e,t){"use strict";var n=[{id:"text",icon:"fa fa-text-width",_name:"USER_FIELDS.TYPE.TEXT"},{id:"textarea",icon:"fa fa-text-height",_name:"USER_FIELDS.TYPE.TEXTAREA"},{id:"date",icon:"fa fa-calendar",_name:"USER_FIELDS.TYPE.DATE"},{id:"url",icon:"fa fa-chain",_name:"USER_FIELDS.TYPE.URL"},{id:"email",icon:"fa fa-at",_name:"USER_FIELDS.TYPE.EMAIL"},{id:"phone",icon:"fa fa-phone",_name:"USER_FIELDS.TYPE.PHONE"},{id:"number",icon:"fa fa-hashtag",_name:"USER_FIELDS.TYPE.NUMBER"}];function s(){n.forEach(function(e){e.name=t.instant(e._name)})}return n.forEach(function(e){n[e.id]=e}),s(),e.$on("$setTranslationsSuccess",s),n}]),angular.module("deskworks.fdToolbar",["dnd","deskworks.fdFieldTypes"]).directive("fdToolbar",function(){return{scope:!0,templateUrl:"user-fields/fd/fd-toolbar.tpl.html",controller:"FdToolbarCtrl as $ctrl"}}).controller("FdToolbarCtrl",["$scope","$element","$window","dnd","helper","fdFieldTypes",function(e,t,n,s,i,r){"use strict";var o,a=this;function c(e){var n=t[0].parentNode.getBoundingClientRect();t.css("top",-Math.min(n.top-5,0)+"px")}a.$onInit=function(){a.types=r,(o=document.querySelector(".snap-content-scroller")).addEventListener("scroll",c),c()},a.onDrop=function(e,t,n,i){return s.move([{type:n.id,name:"",section:i}],0,e,t),!0},a.$onDestroy=function(){o.removeEventListener("scroll",c)}}]);