!function(e,r,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define("bowser",t):e.bowser=t()}(this,0,function(){var e=!0;function r(r){function t(e){var t=r.match(e);return t&&t.length>1&&t[1]||""}function n(e){var t=r.match(e);return t&&t.length>1&&t[2]||""}var i,o=t(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(r)&&/android/i.test(r),l=/nexus\s*[0-6]\s*/i.test(r),c=!l&&/nexus\s*[0-9]+/i.test(r),u=/CrOS/.test(r),d=/silk/i.test(r),f=/sailfish/i.test(r),p=/tizen/i.test(r),m=/(web|hpw)(o|0)s/i.test(r),h=/windows phone/i.test(r),g=(/SamsungBrowser/i.test(r),!h&&/windows/i.test(r)),v=!o&&!d&&/macintosh/i.test(r),C=!a&&!f&&!p&&!m&&/linux/i.test(r),k=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),w=t(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(r)&&!/tablet pc/i.test(r),I=!y&&/[^-]mobi/i.test(r),b=/xbox/i.test(r);/opera/i.test(r)?i={name:"Opera",opera:e,version:w||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(r)?i={name:"Opera",opera:e,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||w}:/SamsungBrowser/i.test(r)?i={name:"Samsung Internet for Android",samsungBrowser:e,version:w||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(r)?i={name:"NAVER Whale browser",whale:e,version:t(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(r)?i={name:"MZ Browser",mzbrowser:e,version:t(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(r)?i={name:"Opera Coast",coast:e,version:w||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(r)?i={name:"Focus",focus:e,version:t(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(r)?i={name:"Yandex Browser",yandexbrowser:e,version:w||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(r)?i={name:"UC Browser",ucbrowser:e,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(r)?i={name:"Maxthon",maxthon:e,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(r)?i={name:"Epiphany",epiphany:e,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(r)?i={name:"Puffin",puffin:e,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(r)?i={name:"Sleipnir",sleipnir:e,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(r)?i={name:"K-Meleon",kMeleon:e,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(i={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},k?(i.msedge=e,i.version=k):(i.msie=e,i.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(r)?i={name:"Internet Explorer",msie:e,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?i={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(r)?i={name:"Microsoft Edge",msedge:e,version:k}:/vivaldi/i.test(r)?i={name:"Vivaldi",vivaldi:e,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||w}:f?i={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(r)?i={name:"SeaMonkey",seamonkey:e,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(r)?(i={name:"Firefox",firefox:e,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(r)&&(i.firefoxos=e,i.osname="Firefox OS")):d?i={name:"Amazon Silk",silk:e,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(r)?i={name:"PhantomJS",phantom:e,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(r)?i={name:"SlimerJS",slimer:e,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(r)||/rim\stablet/i.test(r)?i={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:w||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:m?(i={name:"WebOS",osname:"WebOS",webos:e,version:w||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(r)&&(i.touchpad=e)):/bada/i.test(r)?i={name:"Bada",osname:"Bada",bada:e,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:p?i={name:"Tizen",osname:"Tizen",tizen:e,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||w}:/qupzilla/i.test(r)?i={name:"QupZilla",qupzilla:e,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||w}:/chromium/i.test(r)?i={name:"Chromium",chromium:e,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||w}:/chrome|crios|crmo/i.test(r)?i={name:"Chrome",chrome:e,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?i={name:"Android",version:w}:/safari|applewebkit/i.test(r)?(i={name:"Safari",safari:e},w&&(i.version=w)):o?(i={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},w&&(i.version=w)):i=/googlebot/i.test(r)?{name:"Googlebot",googlebot:e,version:t(/googlebot\/(\d+(\.\d+))/i)||w}:{name:t(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(r)?(/(apple)?webkit\/537\.36/i.test(r)?(i.name=i.name||"Blink",i.blink=e):(i.name=i.name||"Webkit",i.webkit=e),!i.version&&w&&(i.version=w)):!i.opera&&/gecko\//i.test(r)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||t(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||!a&&!i.silk?!i.windowsphone&&o?(i[o]=e,i.ios=e,i.osname="iOS"):v?(i.mac=e,i.osname="macOS"):b?(i.xbox=e,i.osname="Xbox"):g?(i.windows=e,i.osname="Windows"):C&&(i.linux=e,i.osname="Linux"):(i.android=e,i.osname="Android");var S="";i.windows?S=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):i.windowsphone?S=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.mac?S=(S=t(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?S=(S=t(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?S=t(/android[ \/-](\d+(\.\d+)*)/i):i.webos?S=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?S=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?S=t(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(S=t(/tizen[\/\s](\d+(\.\d+)*)/i)),S&&(i.osversion=S);var $=!i.windows&&S.split(".")[0];return y||c||"ipad"==o||a&&(3==$||$>=4&&!I)||i.silk?i.tablet=e:(I||"iphone"==o||"ipod"==o||a||l||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.whale&&1===s([i.version,"1.0"])||i.mzbrowser&&1===s([i.version,"6.0"])||i.focus&&1===s([i.version,"1.0"])||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=e:i.x=e,i}var t=r("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function i(e,r){var t,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,r);for(t=0;t<e.length;t++)n.push(r(e[t]));return n}function s(e){for(var r=Math.max(n(e[0]),n(e[1])),t=i(e,function(e){var t=r-n(e);return i((e+=new Array(t+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--r>=0;){if(t[0][r]>t[1][r])return 1;if(t[0][r]!==t[1][r])return-1;if(0===r)return 0}}function o(e,n,i){var o=t;"string"==typeof n&&(i=n,n=void 0),void 0===n&&(n=!1),i&&(o=r(i));var a=""+o.version;for(var l in e)if(e.hasOwnProperty(l)&&o[l]){if("string"!=typeof e[l])throw new Error("Browser version in the minVersion map should be a string: "+l+": "+String(e));return s([a,e[l]])<0}return n}return t.test=function(e){for(var r=0;r<e.length;++r){var n=e[r];if("string"==typeof n&&n in t)return!0}return!1},t.isUnsupportedBrowser=o,t.compareVersions=s,t.check=function(e,r,t){return!o(e,r,t)},t._detect=r,t.detect=r,t}),angular.module("deskworks",["ngRoute","ngAnimate","ngTouch","ngStorage","oc.lazyLoad","pascalprecht.translate","snap","session","deskworks.config","deskworks.globalConfig","deskworks.templates","deskworks.state","deskworks.helper","deskworks.routeHelper","deskworks.simpleReservation","deskworks.bundleReservation","deskworks.memberSignUp","deskworks.buyPass","deskworks.sidebar","deskworks.whitelabel","deskworks.reservations","deskworks.members","deskworks.inventory","deskworks.communications","deskworks.notifications","deskworks.accounting","deskworks.billing","deskworks.reports","deskworks.system","deskworks.setup","deskworks.components","deskworks.signIn","deskworks.checkIn","deskworks.dashboard","deskworks.import","deskworks.reservationCalendar","deskworks.isMultiSite"]).config(["snapRemoteProvider",function(e){"use strict";e.globalOptions.disable="right",e.globalOptions.maxPosition=220}]).controller("AppCtrl",["$scope","$rootScope","$route","$window","$document","whitelabel","state","routeHelper","isMultiSite",function(e,r,t,n,i,s,o,a,l){"use strict";e.hideSidebar=!0,r.state=o,e.getHeaderTemplate=s.getHeaderTemplate,e.getFooterTemplate=s.getFooterTemplate,e.pageTitlePostfix=s.getPageTitlePostfix();var c=angular.element(i[0].body);c.removeClass("ff-spin ff-big-spin");var u=angular.element(c[0].querySelector("snap-content"));u.addClass("ff-spin ff-spin-big"),e.$on("$routeChangeStart",function(e,r,t){"logout"===r.params.landing&&o.setPath("/sign-out"),"login"===r.params.landing&&a.auth()}),e.$on("$routeChangeSuccess",function(r,s,a){e.hideSidebar=!s.$$route||s.$$route.hideSidebar,e.landing=s.$$route&&s.$$route.landing,e.hideFooter=s.$$route&&s.$$route.hideFooter,u.removeClass("ff-spin ff-spin-big"),i[0].querySelector(".snap-content-scroller").scrollTop=0,n.ga("send","pageview",{page:o.getPath(),title:t.current.label})}),e.$on("$routeChangeError",function(e,r,t,n){n&&console.error(n)})}]),angular.module("deskworks.members.billingProfile.edit",["ngRoute","deskworks.routeHelper","deskworks.userProfile.service","deskworks.purchase.service","deskworks.setup.service"]).config(["$routeProvider",function(e){"use strict";e.when("/billing-profiles",{templateUrl:"billing/billing-profile/billing-profile-edit.tpl.html",controller:"BillingProfileEditCtrl",controllerAs:"vm",label:"Billing Profile",routeBranch:"billing-profiles",translations:["billing-profile","user-profile"],resolve:{reg:function(){},userProfile:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to load billing profile.")})})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to load setup settings.")})}]}}).when("/new-user/:userId/membership/billing-profile",{templateUrl:"billing/billing-profile/billing-profile-edit.tpl.html",controller:"BillingProfileEditCtrl",controllerAs:"vm",label:"Billing Profile",routeBranch:"new-user",translations:["billing-profile","user-profile"],resolve:{reg:function(){return{member:!1,selfRegistration:!1,step:2,stepCount:2}},userProfile:["dwAlerts","$route","state","userProfileService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return n.get(t.getCurrentCenterId(),r.current.params.userId).catch(function(r){return e.error(r,"Failed to load billing profile.")})})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to load setup settings.")})}]}}).when("/new-member/:userId/membership/billing-profile",{templateUrl:"billing/billing-profile/billing-profile-edit.tpl.html",controller:"BillingProfileEditCtrl",controllerAs:"vm",label:"Billing Profile",routeBranch:"new-member",translations:["billing-profile","user-profile"],resolve:{reg:function(){return{member:!0,selfRegistration:!1,step:2,stepCount:3}},userProfile:["dwAlerts","$route","state","userProfileService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return n.get(t.getCurrentCenterId(),r.current.params.userId).catch(function(r){return e.error(r,"Failed to load billing profile.")})})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to load setup settings.")})}]}})}]).controller("BillingProfileEditCtrl",["$scope","$translate","dwAlerts","state","helper","reg","userProfile","settings","userProfileService","purchaseService",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;if(u.reg=s,u.userProfile=o,u.settings=a,a.creditCardTypes=a.creditCardTypes.filter(function(e){return e.enable}),u.userProfile.creditCards.forEach(function(e){e.type=i.findByKeyValue(a.creditCardTypes,"id",e.type)||e.type||{}}),u.userProfile.creditCards=u.userProfile.creditCards||[],s&&0===u.userProfile.creditCards.length){var d=l.creditCard.new(u.userProfile);d.type=a.creditCardTypes[0],u.userProfile.creditCards.push(d)}n.setPageTitle(r.instant("BILLING_PROFILE.PAGE_TITLE",{userName:o.firstName+" "+o.lastName})),u.next=function(){if(!i.pointFirstInvalid("#billingProfile"))return l.saveBillingProfile(n.getCurrentCenterId(),u.userProfile).then(function(){if(!u.reg||u.reg.member)return c.createPurchase(n.getCurrentCenterId(),u.userProfile.id,!0,+n.getParam("productId"),n.getParam("attachedReservationUnitId"),n.getParam("membershipStartDate")).catch(function(e){return t.error(e,"Failed to create purchase.")}).then(function(e){return n.setPath(n.getPath()+"/purchase/"+e.id)});u.complete=!0})},u.back=n.back,l.bindTestBillingGenerator(e,u.userProfile,u.reg)}]),angular.module("deskworks.dwAddCharges",["ngRoute","deskworks.helper","deskworks.state","deskworks.purchase.service"]).directive("dwAddCharges",function(){"use strict";return{restrict:"EAC",scope:!0,templateUrl:"billing/purchase/dw-add-charges.tpl.html",controller:"dwAddChargesCtrl as $ctrl",bindToController:{purchase:"<",updateInvoice:"&"}}}).controller("dwAddChargesCtrl",["$scope","$filter","$route","$translate","dwAlerts","helper","state","purchaseService",function(e,r,t,n,i,s,o,a){"use strict";var l=this;l.collapsed={},l.$onInit=function(){},l.$onChanges=function(){l.purchase&&l.purchase.options&&o.isLoggedAdmin()&&l.purchase.options.chargeTypes.push({id:"custom",name:n.instant("PURCHASE.CHARGES.CUSTOM"),packages:[{name:n.instant("PURCHASE.CHARGES.CUSTOM"),price:"0.0"}]}),l.purchase&&l.purchase.options&&l.purchase.options.chargeTypes.forEach(function(e){e.packages.forEach(function(e){e.chargedAt=moment(),e.quantity=1,e.notes=""})})},l.createCharge=function(e,n){if(!s.pointFirstInvalid("#product"+n.id)){var c={chargedAt:r("date")(n.chargedAt,"yyyy-MM-dd"),notes:n.notes,quantity:n.quantity};return"custom"===e.id?(c.packageName=n.name,c.price=n.price,c.isTaxable=n.isTaxable):c.packageId=n.id,a.createCharge(o.getCurrentCenterId(),o.getCurrentUserId(),l.purchase.id,c,"custom"===e.id,!!t.current.params.productId,t.current.params.productId).catch(function(e){return i.error(e,"Failed to add charge.")}).then(function(){return l.updateInvoice()})}}}]),angular.module("deskworks.billing.purchase.edit",["ngRoute","deskworks.center.service","deskworks.purchase.service","deskworks.reservationUnit.service","deskworks.userProfile.service","deskworks.inventory.priceList.service","deskworks.routeHelper","deskworks.helper","deskworks.billing.optsPaymentMethod","deskworks.billing.optsRefundMethod"]).config(["$routeProvider",function(e){"use strict";e.when("/purchases/:purchaseId/edit",{templateUrl:"billing/purchase/purchase-edit.tpl.html",controller:"PurchaseEditCtrl as vm",label:"Edit",routeBranch:"purchases",translations:["purchase"],resolve:{reg:function(){},purchase:["$route","dwAlerts","state","purchaseService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId(),e.current.params.purchaseId).catch(function(e){return r.error(e,"Failed to get purchase.")})})})}],user:["dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n){return r.auth().then(function(){return r.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],center:["dwAlerts","centerService","state",function(e,r,t){return r.get(t.getCurrentCenterId(t.getCurrentCenterId())).catch(function(r){return e.error(r,"Failed to get center.")})}]}}),e.when("/new-member/:userId/membership/billing-profile/purchase/:purchaseId",{templateUrl:"billing/purchase/purchase-edit.tpl.html",controller:"PurchaseEditCtrl as vm",label:"Purchase",routeBranch:"new-member",translations:["purchase"],resolve:{reg:function(){return{member:!0,selfRegistration:!1,step:3,stepCount:3}},purchase:["$route","dwAlerts","state","purchaseService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return n.get(t.getCurrentCenterId(),e.current.params.userId,e.current.params.purchaseId).catch(function(e){return r.error(e,"Failed to get purchase.")})})})}],user:["dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n){return r.auth().then(function(){return r.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],center:["dwAlerts","centerService","state",function(e,r,t){return r.get(t.getCurrentCenterId(t.getCurrentCenterId())).catch(function(r){return e.error(r,"Failed to get center.")})}]}})}]).controller("PurchaseEditCtrl",["$scope","$filter","$translate","dwAlerts","state","center","purchase","helper","reg","user","purchaseService","priceListService","optsPaymentMethod","optsRefundMethod",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p){"use strict";var m=this;e.backPath="/purchases",e.$watch("state.getCurrentCenterId()",function(r,t){r!==t&&i.setPath(e.backPath)}),m.paymentMethods=f,m.refundMethods=p,m.center=s,m.reg=l,m.userId=i.getCurrentUserId(),m.purchaseId=o.id,m.purchase=o,m.postDate=moment(),m.payment={receivedAt:moment(),amount:m.purchase.balance,notes:"",method:m.paymentMethods[0]},m.deposit={receivedAt:moment(),notes:"",method:m.paymentMethods[0]},m.discount={receivedAt:moment(),amount:"0.00"},m.refund={amount:"0.00",method:m.refundMethods[0]},angular.isDefined(i.getParam("redirect"))&&(m.redirect=i.getParam("redirect")),i.setPageTitle(t.instant("PURCHASE.PAGE_TITLE",{userName:c.firstName+" "+c.lastName,centerName:s.name})),c.membershipPriceListId&&d.getPricelist(i.getCurrentCenterId(),c.membershipPriceListId).then(function(e){m.userPriceList=e}),m.reg||u.getPurchases(i.getCurrentCenterId(),m.userId).then(function(e){var r;m.consolidatePurchases=[],e.open.forEach(function(e){e.id==m.purchaseId?r="open":m.consolidatePurchases.push({id:+e.id,name:e.id})}),"open"!==r&&e.credit.forEach(function(e){e.id==m.purchaseId?r="credit":m.consolidatePurchases.push({id:+e.id,name:e.id})}),r||(m.consolidatePurchases=[]),m.consolidatePurchases.length>0&&(m.purchaseToConsolidate=m.consolidatePurchases[0])}),m.backToPurchases=function(){return i.setPath("/purchases")},m.createPayment=function(){var e={receivedAt:r("date")(m.payment.receivedAt,"yyyy-MM-dd"),amount:m.payment.amount,notes:m.payment.notes,method:m.payment.method.id};return u.createPayment(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId,e).catch(function(e){return n.error(e,"Failed to make payment.")}).then(function(){return m.updateInvoice()})},m.createDeposit=function(){var e={receivedAt:r("date")(m.deposit.receivedAt,"yyyy-MM-dd"),amount:m.deposit.amount,notes:m.deposit.notes,method:m.deposit.method.id};return u.createDeposit(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId,e).catch(function(e){return n.error(e,"Failed to make deposit.")}).then(function(){return m.updateInvoice()})},m.createDiscount=function(){var e={amount:m.discount.amount,notes:m.discount.notes,receivedAt:m.discount.receivedAt};return u.createDiscount(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId,e).catch(function(e){return n.error(e,"Failed to add discount.")}).then(function(){return m.updateInvoice()})},m.createRefund=function(){var e={amount:m.refund.amount,method:m.refund.method.id,notes:m.refund.notes};return u.createRefund(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId,e).catch(function(e){return n.error(e,"Failed to add refund.")}).then(function(){return m.updateInvoice()})},m.consolidatePurchase=function(e){return u.consolidate(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId,e).catch(function(e){return n.error(e,"Failed to consolidate order with purchase.")}).then(function(){return m.consolidatePurchases.splice(a.findIndexByKeyValue(m.consolidatePurchases,"id",e.id),1),m.purchaseToConsolidate=m.consolidatePurchases[0],m.updateInvoice()})},m.updateInvoice=function(){return u.get(i.getCurrentCenterId(),i.getCurrentUserId(),m.purchaseId).catch(function(e){return n.error(e,"Failed to update invoice.")}).then(function(e){m.purchase=e,m.payment.amount=e.balance})}}]),angular.module("deskworks.billing.purchase.list",["deskworks.center.service","deskworks.purchase.service","deskworks.routeHelper"]).config(["$routeProvider",function(e){"use strict";e.when("/purchases",{templateUrl:"billing/purchase/purchase-list.tpl.html",controller:"PurchaseListCtrl as vm",label:"Purchases",routeBranch:"purchases",translations:["purchase"],resolve:{purchases:["dwAlerts","purchaseService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.query(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to query purchases.")})})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],center:["dwAlerts","centerService","state",function(e,r,t){return r.get(t.getCurrentCenterId(t.getCurrentCenterId())).catch(function(r){return e.error(r,"Failed to get center.")})}]}})}]).controller("PurchaseListCtrl",["$scope","$translate","dwAlerts","center","purchases","state","helper","user","purchaseService",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;c.center=n,c.purchases=i,c.types=[{id:"deposit",name:"PURCHASE.LIST.DEPOSIT.HEADER"},{id:"credit",name:"PURCHASE.LIST.CREDIT.HEADER"},{id:"open",name:"PURCHASE.LIST.OPEN.HEADER"},{id:"paid",name:"PURCHASE.LIST.PAID.HEADER"}],s.setPageTitle(r.instant("PURCHASE.LIST.PAGE_TITLE",{userName:a.firstName+" "+a.lastName,centerName:n.name})),c.editPurchase=function(e){return s.setPath("/purchases/"+e.id+"/edit")},c.viewPurchase=function(e){return s.setPath("/purchases/"+e.id+"/view")},c.createPurchase=function(){return l.createPurchase(s.getCurrentCenterId(),s.getCurrentUserId()).catch(function(e){return t.error(e,"Failed to create purchase")}).then(function(e){return s.setPath("/purchases/"+e.id+"/edit")})}}]),angular.module("deskworks.recurringChargeAudit",["deskworks.helper","deskworks.RecurringChargeAudit"]).directive("recurringChargeAudit",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"billing/recurring-billing/recurring-charge-audit.tpl.html",controller:"RecurringChargeAuditCtrl as $ctrl",bindToController:{priceListProducts:"<",reservationUnits:"<",recurringChargeId:"<"}}}).controller("RecurringChargeAuditCtrl",["state","dwAlerts","RecurringChargeAudit",function(e,r,t){var n=this;n.$onInit=function(){n.props=t.getProps(),n.centerId=e.getCurrentCenterId(),n.userId=e.getCurrentUserId(),n.offset=0,n.limit=20,n.entries=[],n.fetch()},n.fetch=function(){if(n.eof||n.fetching)return n.fetching;n.fetching=t.query(n.centerId,n.userId,n.recurringChargeId,n.offset,n.limit).catch(function(e){return r.error(e,"Failed to query audit log.")}).finally(function(){n.fetching=null}).then(function(e){var r;n.entries=n.entries.concat(((r=e).forEach(function(e){e.props||(e.props=n.props.filter(function(r){return e[r.id]}).map(function(r){return{name:r.name,old:r.filter?r.filter(e[r.id].old,n):e[r.id].old,new:r.filter?r.filter(e[r.id].new,n):e[r.id].new}}))}),r)),n.offset+=e.length,n.eof=e.length<n.limit})}}]),angular.module("deskworks.RecurringChargeAudit",["ngResource","datesDeserializer","deskworks.config","deskworks.billing.optsBillingFrequency","deskworks.billing.optsRecurringChargeStatus","deskworks.billing.optsNoticePeriod","deskworks.billing.optsDiscountType","deskworks.userProfile.optsMonthsOfDiscount","deskworks.billing.optsRecurringChargeTerminate","deskworks.billing.optsRenewalTerm","deskworks.billing.optsRenewalNoticePeriod"]).factory("RecurringChargeAudit",["$resource","$q","$timeout","$filter","$rootScope","$translate","deskworksConfig","helper","datesDeserializer","optsBillingFrequency","optsRecurringChargeStatus","optsNoticePeriod","optsDiscountType","optsMonthsOfDiscount","optsRecurringChargeTerminate","optsRenewalTerm","optsRenewalNoticePeriod",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m,h,g){"use strict";var v=function(e){return n("date")(e,"mediumDate")},C=function(e,r){return r=r||"name",angular.isString(e)?function(t,n){return(a.find(n[e],t)||{})[r]||"-"}:function(t,n){return(a.find(e,t)||{})[r]||"-"}},k=[{id:"priceListProductId",_name:"RECURRING_BILLING.GENERAL.PRODUCT",filter:C("priceListProducts","productName")},{id:"description",_name:"RECURRING_BILLING.GENERAL.DESCRIPTION"},{id:"quantity",_name:"RECURRING_BILLING.GENERAL.QUANTITY"},{id:"attachedReservationUnitId",_name:"RECURRING_BILLING.GENERAL.ATTACHED_RES_UNIT",filter:C("reservationUnits")},{id:"passBalance",_name:"RECURRING_BILLING.GENERAL.PASS_BALANCE"},{id:"invoiceSent",_name:"RECURRING_BILLING.GENERAL.INVOICE_SENT",filter:function(e){return n("yesno")(e)}},{id:"lastBillDate",_name:"RECURRING_BILLING.DATES.LAST_BILL_DATE",filter:v},{id:"nextBillDate",_name:"RECURRING_BILLING.DATES.NEXT_BILL_DATE",filter:v},{id:"startDate",_name:"RECURRING_BILLING.DATES.START_DATE",filter:v},{id:"noticeDate",_name:"RECURRING_BILLING.DATES.NOTICE_DATE",filter:v},{id:"noticePeriod",_name:"RECURRING_BILLING.DATES.NOTICE_PERIOD",filter:C(d)},{id:"terminate",_name:"RECURRING_BILLING.DATES.TERMINATE",filter:function(e,r){return(a.find(m,e)||{}).name||v(e)||"-"}},{id:"renewalDate",_name:"RECURRING_BILLING.RENEWAL_DATE",filter:v},{id:"renewalTerm",_name:"RECURRING_BILLING.RENEWAL_TERM",filter:C(h)},{id:"renewalNoticePeriod",_name:"RECURRING_BILLING.RENEWAL_NOTICE_PERIOD",filter:C(g)},{id:"discountTypeId",_name:"RECURRING_BILLING.DISCOUNT.TYPE",filter:C(f)},{id:"discountValue",_name:"RECURRING_BILLING.DISCOUNT.VALUE"},{id:"discountTrialOccurrences",_name:"RECURRING_BILLING.DISCOUNT.MONTHS",filter:C(p)},{id:"discountStartDate",_name:"RECURRING_BILLING.DISCOUNT.START_DATE",filter:v},{id:"status",_name:"RECURRING_BILLING.STATUS_NOTES.STATUS",filter:C(u)},{id:"notes",_name:"RECURRING_BILLING.STATUS_NOTES.NOTES"}];function w(){k.forEach(function(e){e.name=s.instant(e._name)})}w(),i.$on("$setTranslationsSuccess",w);var y=l(["createdAt","lastBillDate.old","lastBillDate.new","nextBillDate.old","nextBillDate.new","startDate.old","startDate.new","noticeDate.old","noticeDate.new","renewalDate.old","renewalDate.new","discountStartDate.old","discountStartDate.new","terminate.old","terminate.new"]),I=e(o.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/recurring-charges/:recurringId/audit"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,y]}});return{query:function(e,r,t,n,i){return I.query({centerId:e,userId:r,recurringId:t,offset:n,limit:i}).$promise},getProps:function(){return k}}}]),angular.module("deskworks.billing.recurringCharge.edit",["deskworks.recurringCharge.service","deskworks.userProfile.service","deskworks.recurringCharge.service","deskworks.reservationUnit.service","deskworks.routeHelper","deskworks.recurringChargeAudit"]).config(["$routeProvider",function(e){"use strict";e.when("/recurring-charges/:recurringId/edit",{templateUrl:"billing/recurring-billing/recurring-edit.tpl.html",controller:"RecurringChargeEditCtrl as $ctrl",label:"Edit",routeBranch:"recurring-charges",translations:["recurring-billing"],resolve:{charge:["dwAlerts","$route","RecurringCharge","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return t.get(n.getCurrentCenterId(),n.getCurrentUserId(),r.current.params.recurringId).catch(function(r){return e.error(r,"Failed to get recurring charge.")})})})}],settings:["dwAlerts","setupService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getSetupSettings(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get setup settings.")})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to query recurring charges.")})})})}],resUnits:["dwAlerts","state","reservationUnitService",function(e,r,t){return t.getReservationUnits(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation units")})}]}})}]).controller("RecurringChargeEditCtrl",["$scope","$route","$translate","dwAlerts","RecurringCharge","userProfileService","reservationUnitService","charge","settings","user","state","helper","optsBillingFrequency","optsRecurringChargeStatus","optsNoticePeriod","optsDiscountType","optsMonthsOfDiscount","optsRecurringChargeTerminate","resUnits","optsRenewalTerm","optsRenewalNoticePeriod",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m,h,g,v,C,k,w){"use strict";var y=this;e.backPath="/recurring-charges",e.$watch("state.getCurrentCenterId()",function(r,t){r!==t&&u.setPath(e.backPath)}),u.setPageTitle(t.instant("RECURRING_BILLING.PAGE_TITLE",{userName:c.fullName})),y.charge=a,y.initialStatus=y.charge.status,y.charge.startDate=y.charge.startDate||y.charge.entryDate,y.billingFrequencyProducts={},y.billingFrequencies=f,y.noticePeriods=m,y.discountTypes=h,y.discountTrialOccurrences=g,y.optsTerminate=v,y.optsRenewalTerm=k,y.optsRenewalNoticePeriod=w,y.charge.renewalNoticePeriod=y.charge.renewalNoticePeriod||null,y.chargeStatuses=p,"new"===r.current.params.recurringId&&(y.chargeStatuses=p.slice(0,1)),l.enableRecurringPerCoMembers&&(y.attachedCoMembersIds=y.charge.attachedCoMembersIds.reduce(function(e,r){return e[r]=!0,e},{})),a.options.priceListProducts.forEach(function(e){var r=d.findByKeyValue(y.billingFrequencies,"id",e.billingFrequency);r&&(y.billingFrequencyProducts[r.id]=y.billingFrequencyProducts[r.id]||[],y.billingFrequencyProducts[r.id].push(e))}),y.reservationUnits=C.filter(function(e){return!e.attachedUserId||e.id==y.charge.attachedReservationUnitId}),y.billingFrequencyChange=function(){y.charge.billingFrequency&&y.billingFrequencyProducts[y.charge.billingFrequency.id]&&(y.charge.priceListProduct=d.findByKeyValue(y.billingFrequencyProducts[y.charge.billingFrequency.id],"id",y.charge.priceListProductId)),y.charge.terminate="asNeeded"===y.charge.billingFrequency.id?v[0]:"",y.charge.billingFrequency.months&&moment.isMoment(y.charge.lastBillDate)&&(y.charge.nextBillDate=y.charge.lastBillDate.clone().add(y.charge.billingFrequency.months,"M"),l.prorateAtStart&&"monthly"===y.charge.billingFrequency.id&&y.charge.nextBillDate.date(1))},y.charge.id||y.billingFrequencyChange(),y.calcTerminationDate=function(){"asNeeded"!==y.charge.billingFrequency.id&&y.charge.noticeDate&&y.charge.noticePeriod&&(y.charge.terminate=y.charge.noticeDate.clone().add(y.charge.noticePeriod.id,"d"))},y.backToList=function(){return u.setPath("/recurring-charges")},y.saveCharge=function(e){if(!d.pointFirstInvalid("#recurringCharge"))return y.charge.refill=e,l.enableRecurringPerCoMembers&&(y.charge.attachedCoMembersIds=Object.keys(y.attachedCoMembersIds).reduce(function(e,r){return y.attachedCoMembersIds[r]&&e.push(parseInt(r)),e},[])),i.save(u.getCurrentCenterId(),u.getCurrentUserId(),y.charge).then(function(){if(!e)return u.setPath("/recurring-charges");r.reload()}).catch(function(e){return n.error(e,"Failed to save recurring charge.")})}}]),angular.module("deskworks.billing.recurringCharge.list",["deskworks.recurringCharge.service"]).config(["$routeProvider",function(e){"use strict";e.when("/recurring-charges",{templateUrl:"billing/recurring-billing/recurring-list.tpl.html",controller:"RecurringChargeListCtrl as $ctrl",label:"Recurring Billing",routeBranch:"recurring-charges",translations:["recurring-billing"],resolve:{charges:["dwAlerts","RecurringCharge","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.query(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to query recurring charges.")})})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}]}})}]).controller("RecurringChargeListCtrl",["$scope","$translate","dwAlerts","RecurringCharge","user","charges","state","helper",function(e,r,t,n,i,s,o,a){"use strict";var l=this;l.charges=s,o.setPageTitle(r.instant("RECURRING_BILLING.LIST.PAGE_TITLE",{userName:i.firstName+" "+i.lastName})),l.new=function(){return o.setPath("/recurring-charges/new/edit")},l.edit=function(e){return o.setPath("/recurring-charges/"+e.id+"/edit")},l.saveUseForCheckInBilling=function(e){l.charges.forEach(function(r){r.useForCheckInBilling&&r!==e&&(r.useForCheckInBilling=!1)}),e.$spin=!0,n.setUseForCheckInBilling(o.getCurrentCenterId(),o.getCurrentUserId(),e.id).catch(function(e){return t.error(e,'Failed to set "Use for Check-In Billing".')}).finally(function(){e.$spin=!1})}}]),angular.module("autoCacheFactory",[]).provider("autoCacheFactory",function(){"use strict";var e=this;return e.disableCache=!1,e.$get=function(){var r={};function t(t,n){var i=0,s={},o={id:t,expiryTime:n||0};return t in r||(r[t]={put:function(r,t){if(!angular.isUndefined(t)&&!e.disableCache&&o.expiryTime)return r in s||i++,s[r]={value:t,time:Date.now()},t},get:function(e){if(e in s&&Date.now()-s[e].time>1e3*o.expiryTime&&this.remove(e),e in s)return s[e].value},remove:function(e){e in s&&i--,delete s[e]},removeAll:function(){s={},i=0},destroy:function(){s=null,o=null,delete r[t]},info:function(){return angular.extend({},o,{size:i})}}),r[t]}return t.info=function(){var e={};return angular.forEach(r,function(r,t){e[t]=r.info()}),e},t.get=function(e){return r[e]},t.emptyAll=function(){angular.forEach(r,function(e){e.removeAll()})},t},e}),angular.module("deskworks.centerSelector",["deskworks.state"]).directive("centerSelector",["$rootScope","state",function(e,r){"use strict";return{link:function(e,t,n){e.state=r},template:'<div class="center-selector" ng-if="state.getLoggedUserId()" ng-show="state.getUserCenters().length > 1"><label>Current Center<select class="form-control" ng-model="state.currentCenterId" ng-model-options="{getterSetter: true}" ng-options="center.id as center.name for center in state.getUserCenters()"></select></label></div>',restrict:"E"}}]),angular.module("dnd",["dndLists","keese"]).factory("dnd",["keese",function(e){"use strict";return{move:function(r,t,n,i){var s=r[t];n&&n.splice(i,0,s);r===n&&i<=t&&t++;if(r.splice(t,1),n){var o=n.indexOf(s);s.order=e.generate(n[o-1]&&n[o-1].order,n[o+1]&&n[o+1].order)}return s}}}]),angular.module("keese",[]).factory("keese",function(){"use strict";var e="0123456789?@ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=e.length,t="~",n=function(){for(var r={},t=0;t<e.length;t++)r[e[t]]=t;return r}();return{generate:function(e,r,t){return t?function(e,r,t){var n=new Array(t);if(t>0)if(r)!function e(r,t,s,o){var a=Math.floor((s+o)/2);var l=i(r,t);n[a]=l;s<a&&e(r,l,s,a);a+1<o&&e(l,t,a+1,o)}(e,r,0,t);else for(var s=0;s<t;s++){var o=keese(e,null);n[s]=o,e=o}return n}(e,r,t):i(e,r)}};function i(e,r){return e?r?s(e,r):((t=a(e)).digits=t.digits.substr(0,t.order_length+1),o(t,a("1"))):r?s("0",r):"1";var t}function s(t,i){if(t>i)throw new Error("assertion failed: "+JSON.stringify(t)+" < "+JSON.stringify(i));var s=a(t),u=a(i);c(s,u);for(var d=0,f=Math.max(s.digits.length,u.digits.length),p=0;p<f||d>0;p++){var m=n[s.digits[p]]||0,h=d+(n[u.digits[p]]||0);if(m!==h){if(m!==h-1){for(var g=Math.floor((h-m)/2),v="",C=0;C<p;C++)v+="0";v+=e[g];var k=a(l(s.order_length,v));return s.digits=s.digits.substr(0,p+1),o(s,k)}d=r}}throw new Error}function o(t,i){c(t,i);for(var s="",o=t.order_length,a=0,u=Math.max(t.digits.length,i.digits.length)-1;u>=0;u--)a+=n[t.digits[u]]||0,a+=n[i.digits[u]]||0,s=e[a%r]+s,a=Math.floor(a/r);for(;a>0;)s=e[a%r]+s,a=Math.floor(a/r),o++;return l(o,s)}function a(e){var r=e.lastIndexOf(t)+1;return{order_length:r,digits:e.substr(r)}}function l(e,r){for(;e>0&&"0"==r.charAt(0);)r=r.substr(1),e--;for(var n="",i=0;i<e;i++)n+=t;return n+r}function c(e,r){u(e,r.order_length),u(r,e.order_length)}function u(e,r){for(;e.order_length<r;)e.digits="0"+e.digits,e.order_length++}}),angular.module("deskworks.dwAddress",["flexForms","deskworks.helper"]).directive("dwAddress",["$compile","$templateCache","$timeout","$translate","helper","optsAddressType","optsCountry","optsState",function(e,r,t,n,i,s,o,a){"use strict";return{restrict:"A",scope:!0,templateUrl:"components/dw-address/dw-address.tpl.html",controllerAs:"dwAddress",bindToController:{secondStreet:"<",notRequired:"<"},controller:["$scope","$element","$attrs",function(e,r,l){var c=this;c.types=s.map(function(e){return angular.extend(e,{name:n.instant(e.name)})}),c.countries=o,c.states=a,c.address=e.$eval(l.dwAddress),c.hasType=e.$eval(l.dwAddressType),c.onChangeCountry=function(){t(function(){"US"===c.address.country.id?c.address.state=i.findByKeyValue(a.US,"id","CA"):angular.isObject(c.address.state)&&delete c.address.state})}}]}}]),angular.module("deskworks.dwAlerts",["ngAnimate","ui.bootstrap.alert","deskworks.dwAlerts.service"]).component("dwAlerts",{template:'<uib-alert ng-repeat="alert in $ctrl.alerts" type="{{alert.type}}" class="dw-alert" close="$ctrl.close(alert)"><span ng-bind-html="alert.message"></span><span class="dw-alert-progress" ng-if="alert.timeout" ng-class="{ start: alert.start }"'+" ng-style=\"{ transition: 'all ' + alert.timeout / 1000 + 's linear', '-webkit-transition': 'all ' + alert.timeout / 1000 + 's linear' }\"></span></uib-alert>",controller:"dwAlertsController"}).controller("dwAlertsController",["$scope","$timeout","dwAlerts",function(e,r,t){"use strict";var n=this;n.alerts=t.$alerts,n.close=function(e){t.close(e)},e.$watchCollection("$ctrl.alerts",function(){n.alerts.forEach(function(e){e.timeout&&!e.start&&r(function(){e.start=!0})})})}]),angular.module("deskworks.dwAlerts.service",[]).factory("dwAlerts",["$rootScope","$timeout","$q",function(e,r,t){"use strict";var n={$alerts:[],error:function(e,r){r||(r=e,e=null),e&&e.data&&(e.data.error||e.data.message)&&(r=e.data.error||e.data.message),e&&!e.xhrStatus&&console.error(e);var n={id:Date.now(),type:"danger",message:r||"Sorry, error occurred. Please try again a bit later.",timeout:1e4};return this.showAlert(n),t.reject(e||r)},info:function(e){var r={id:Date.now(),type:"info",message:e,timeout:6e3};this.showAlert(r)},close:function(e){var r=this.$alerts.indexOf(e);r>=0&&this.$alerts.splice(r,1)},showAlert:function(e){var t=this;t.$alerts.unshift(e),e.timeout&&r(function(){t.close(e)},e.timeout)}};return e.showError=function(e,r){return n.error(e,r)},e.closeError=function(e){n.$alerts.splice(e,1)},e.closeAllErrors=function(){n.$alerts.splice(0,n.$alerts.length)},n}]),angular.module("deskworks.dwCheckInWidget",["flexForms","deskworks.helper","deskworks.checkInLog.service"]).directive("dwCheckInWidget",function(){"use strict";return{restrict:"E",scope:!0,controller:"dwCheckInWidgetCtrl as $ctrl",template:'<span>Check In / Out</span><ff-btn-group><ff-btn sense="checkIn" size="sm" ng-hide="$ctrl.log.checkInTime" ff-click="$ctrl.checkInOut(\'checkIn\')">Check In</ff-btn><ff-btn sense="checkOut" size="sm" ng-show="$ctrl.log.checkInTime" ff-click="$ctrl.checkInOut(\'checkOut\')">Check Out</ff-btn></ff-btn-group>',compile:function(e,r){return e.addClass("sidebar-item keep-sm-btn-size").css("display","none"),function(e,r,t,n){}}}}).controller("dwCheckInWidgetCtrl",["$scope","$element","$interval","state","dwAlerts","checkInLogService",function(e,r,t,n,i,s){"use strict";var o=this;o.checkInOut=function(e){return t.cancel(o.updateTimer),s.checkInOut(n.getCurrentCenterId(),n.getCurrentUserId(),e).then(function(){o.log.checkInTime="checkIn"===e?moment():void 0,t.cancel(o.updateTimer),o.updateTimer=t(o.updateMemberLog,6e3),ga("send","event","merged",e)}).catch(function(r){return i.error(r,"Failed to "+e)})},o.updateMemberLog=function(){if(t.cancel(o.updateTimer),(!n.isLoggedAdmin()||n.isUserSelected())&&n.getCurrentCenterId())return s.getLog(n.getCurrentCenterId(),n.getCurrentUserId(),0,0).then(function(e){r.css("display",e.allowCheckIn?null:"none"),o.log=e,e.allowCheckIn&&(t.cancel(o.updateTimer),o.updateTimer=t(o.updateMemberLog,6e4))}).catch(function(e){return i.error(e,"Failed to update check-in widget")});r.css("display","none")},e.$watchGroup([n.getCurrentUserId,n.getCurrentCenterId],o.updateMemberLog)}]),angular.module("deskworks.dwManualCheckInWidget",["flexForms","deskworks.helper","deskworks.ManualCheckIn"]).directive("dwManualCheckInWidget",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"components/dw-check-in-widget/dw-manual-check-in-widget.tpl.html",controller:"dwManualCheckInWidgetCtrl as $ctrl",compile:function(e,r){return e.addClass("sidebar-item keep-sm-btn-size").css("display","none"),function(e,r,t,n){}}}}).controller("dwManualCheckInWidgetCtrl",["$scope","$element","state","dwAlerts","ManualCheckIn",function(e,r,t,n,i){"use strict";var s=this;s.check=function(e,r,s){r=+r,s&&(s.preventDefault(),s.stopPropagation());var o=r>0?"checkIn":"checkOut";return i.save(t.getCurrentCenterId(),t.getCurrentUserId(),e.id,{checkInCount:e.checkInCount+r}).catch(function(e){return n.error(e,"Failed to "+o)}).then(function(){e.checkInCount+=r,ga("send","event","merged",o)})},s.fetchData=function(){if((!t.isLoggedAdmin()||t.isUserSelected())&&t.getCurrentCenterId())return i.query(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(e){return n.error(e,"Failed to update manual check-in widget")}).then(function(e){r.css("display",e.length?null:"none"),s.rbs=e});r.css("display","none")},e.$watchGroup([t.getCurrentUserId,t.getCurrentCenterId],s.fetchData)}]),angular.module("deskworks.dwControls",[]),angular.module("deskworks.dwControls").directive("dwEmail",["$compile",function(e){"use strict";return{restrict:"AC",priority:30,terminal:!0,compile:function(r,t){var n=this;return t.$set("maxlength",t.maxlength||256),t.$set("ffPattern",t.ffPattern||/^[\w\.%\+\-]+@(?:[A-Z0-9\-]+\.)+(?:[A-Z]+)$/i),t.$set("ffValidateAlert",t.ffValidateAlert||"{field: 'Email', pattern: 'Email should be valid'}"),t.$set("placeholder",t.placeholder||"example@mail.com"),function(r,t,i){e(t,null,n.priority)(r)}}}}]),angular.module("deskworks.dwControls").directive("dwLastName",["$compile","$translate",function(e,r){"use strict";return{restrict:"AC",priority:30,terminal:!0,compile:function(t,n){var i=this;n.$set("maxlength",n.maxlength||256),n.$set("ffPattern",n.ffPattern||/^[^\\<>\/&]*$/),n.$set("placeholder",n.placeholder||"Doe");var s=r.instant("USER_PROFILE.PERSONAL_INFO.LAST_NAME"),o=r.instant("USER_PROFILE.PERSONAL_INFO.LAST_NAME_INVALID_CHARS");return n.$set("ffValidateAlert",n.ffValidateAlert||"{ field: '"+s+"', pattern: '"+o+"' }"),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("deskworks.dwControls").directive("dwLogin",["$compile","$translate",function(e,r){"use strict";return{restrict:"AC",priority:30,terminal:!0,compile:function(t,n){var i=this;n.$set("minlength",n.minlength||4),n.$set("maxlength",n.maxlength||256),n.$set("ffPattern",n.ffPattern||/^\w[\w\.\-_@]+$/),n.$set("placeholder",n.placeholder||"jdoe");var s=r.instant("GLOBAL.LOGIN"),o=r.instant("GLOBAL.LOGIN.INVALID_CHARS");return n.$set("ffValidateAlert",n.ffValidateAlert||"{ field: '"+s+"', pattern: '"+o+"' }"),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("deskworks.dwControls").directive("dwPassword",["$compile","$translate",function(e,r){"use strict";return{restrict:"AC",priority:30,terminal:!0,compile:function(t,n){var i,s=this;n.$set("minlength",n.minlength||n.ffMinlength||8),n.$set("maxlength",n.maxlength||n.ffMaxlength||20),n.$set("ffPattern",n.ffPattern||/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)\S{8,}$/),n.$set("placeholder","password");var o=r.instant("GLOBAL.PASSWORD.INVALID_CHARS");try{i=angular.fromJson(n.ffValidateAlert)}catch(e){i={}}return i=angular.extend({field:r.instant("GLOBAL.PASSWORD"),pattern:o,minlength:o},i),n.$set("ffValidateAlert",angular.toJson(i)),function(r,t,n){e(t,null,s.priority)(r)}}}}]),angular.module("deskworks.dwControls").directive("dwPhone",["$compile","$translate",function(e,r){"use strict";return{restrict:"AC",priority:30,terminal:!0,compile:function(t,n){var i=this;n.$set("maxlength",n.maxlength||64),n.$set("ffPattern",n.ffPattern||/^(?:\+\d[-. ]?)?(?:\(?\d\)?[-. ]?){5,13}\d$/),n.$set("placeholder",n.placeholder||"888-379-2865");var s=r.instant("USER_PROFILE.PHONES.NUMBER"),o=r.instant("GLOBAL.VALIDATION.PHONE");return n.$set("ffValidateAlert",n.ffValidateAlert||"{ field: '"+s+"', pattern: '"+o+"' }"),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("deskworks.dwControls").directive("dwSearchUser",["$compile","$q","$filter","ffHelper","state","userProfileService",function(e,r,t,n,i,s){"use strict";return{restrict:"A",priority:30,terminal:!0,template:'<ff-search-options><h6><span ng-bind-html="$search.highlighted.fullName"></span>{{$search.highlighted.company ? \',\' : \'\'}} <span ng-bind-html="$search.highlighted.company"></span> &lt;<span ng-bind-html="$search.highlighted.email"></span>&gt;</h6><div><span ng-repeat="match in $search.matches" class="match">{{match.name}}: <span ng-bind-html="(match.value || \'-\') + ($last ? \'\' : \', \')"></span></span></div></ff-search-options><ff-search-match ng-if="dwSearchUser.options !== \'activeNameOnly\'"><h6><span ng-bind="ffSearch.ngModel.$modelValue.fullName"></span>{{ffSearch.ngModel.$modelValue.company ? \',\' : \'\'}} <span ng-bind="ffSearch.ngModel.$modelValue.company"></span> &lt;<span ng-bind="ffSearch.ngModel.$modelValue.email"></span>&gt;</h6></ff-search-match><ff-search-match ng-if="dwSearchUser.options === \'activeNameOnly\'"><h6><span ng-bind="ffSearch.ngModel.$modelValue.fullName"></span></h6></ff-search-match>',controllerAs:"dwSearchUser",bindToController:{options:"@dwSearchUser"},controller:function(){this.filterUsers=function(e,r){return(e=e||[]).forEach(function(e){for(var n in e.weight=0,e.matches=[{name:"login",value:t("highlight")(e.login,r)}],e.highlighted={fullName:t("highlight")(e.fullName,r),company:t("highlight")(e.company,r),email:t("highlight")(e.email,r)},e){if(e.hasOwnProperty(n)&&angular.isString(e[n])&&0!==n.indexOf("$$"))if(e[n].toLowerCase().indexOf(r.toLowerCase())>=0&&(e.weight++,"fullName"!==n&&"company"!==n&&"email"!==n&&"login"!==n)){var i=n.split(/(?=[A-Z])/).join(" ").toLowerCase();e.matches.push({name:i,value:t("highlight")(e[n],r)})}}}),e.filter(function(e){return e.weight>0}).sort(function(e,r){return e.weight<r.weight?1:e.weight>r.weight?-1:0})},this.searchUser=function(e){return s.quickSearch(i.getCurrentCenterId(),e).catch(function(e){return $scope.showError(e,"Failed to quick search users.")})}},compile:function(r,t){var n=this;return t.$set("ffSearch","dwSearchUser.searchUser($search)"),t.$set("ffSearchFilter","dwSearchUser.filterUsers($results, $search)"),t.$set("placeholder","start typing to search users"),function(r,t,i){e(t,null,n.priority)(r)}}}}]),angular.module("deskworks.dwCreditCard",["flexForms","deskworks.helper","deskworks.userProfile.optsCCExpiryMonth","deskworks.userProfile.optsCCExpiryYear"]).directive("dwCreditCard",function(){"use strict";return{restrict:"A",scope:!0,templateUrl:"components/dw-credit-card/dw-credit-card.tpl.html",controller:"dwCreditCardCtrl as $ctrl",bindToController:{cc:"<dwCreditCard",ccTypes:"<dwCreditCardTypes"}}}).controller("dwCreditCardCtrl",["$scope","optsCCExpiryMonth","optsCCExpiryYear",function(e,r,t){"use strict";var n=this;n.optsCCExpiryMonth=r,n.optsCCExpiryYear=t,e.$watch("$ctrl.ccType",function(){n.cc.type=n.ccType||n.cc.type})}]),angular.module("deskworks.dwDateTime",["flexForms"]).directive("dwDateTime",function(){"use strict";return{restrict:"E",scope:!0,compile:function(e,r){var t=r.ngDisabled?' ng-disabled="'+r.ngDisabled+'"':"",n=r.ngDisabled?' ff-disabled="'+r.ngDisabled+'"':"",i=r.ffRequired?' ff-required="'+r.ffRequired+'"':"",s=r.ffDateOrder?' ff-date-order="'+r.ffDateOrder+'"':"",o=r.ffDateDiff?' ff-date-diff="'+r.ffDateDiff+'"':"",a=r.ffValidateAlert?' ff-validate-alert="'+r.ffValidateAlert+'"':"",l=r.labelClass?' class="'+r.labelClass+'"':"",c='<ff-row><label flex="1 1 auto"><ff-label flex="'+r.labelFlex+'"'+i+t+l+">"+r.ffLabel+"</ff-label><ff-date name=\"{{'"+(r.name||r.ffModel)+'date\'}}" ff-model="inner.date"'+i+n+s+o+a+"></ff-date></label><ff-time name=\"{{'"+(r.name||r.ffModel)+'time\'}}" flex="'+(e.hasClass("ff-small")?"0 0 90px":"0 0 106px")+'" ff-model="inner.time"'+i+n+s+o+a+"></ff-time></ff-row>";return e.append(c),this.link},link:function(e,r,t){e.inner={};var n=e.$eval(t.ffModel);function i(r,t){!moment.isMoment(r)||moment.isMoment(t)&&r.isSame(t)||(e.inner.date=r.clone().second(0).millisecond(0),e.inner.time=r.clone().second(0).millisecond(0))}n instanceof moment&&i(n),e.$watch(t.ffModel,i),e.$watch("inner.date",function(r,n){var i=e.$eval(t.ffModel);moment.isMoment(r)&&moment.isMoment(i)&&(moment.isMoment(n)&&r.isSame(n)||(e.newDate=r.clone().hour(i.hour()).minute(i.minute()),e.$eval(t.ffModel+" = newDate")))}),e.$watch("inner.time",function(r,n){var i=e.$eval(t.ffModel);moment.isMoment(r)&&moment.isMoment(i)&&(moment.isMoment(n)&&r.isSame(n)||(e.newDate=i.clone().hour(r.hour()).minute(r.minute()),e.$eval(t.ffModel+" = newDate")))})}}}),angular.module("deskworks.dwECheck",["flexForms","deskworks.helper"]).directive("dwECheck",["$compile","$templateCache","$timeout","helper","optsBankAccountHolderType","optsBankAccountType",function(e,r,t,n,i,s){"use strict";return{restrict:"A",scope:!0,templateUrl:"components/dw-e-check/dw-e-check.tpl.html",controllerAs:"dwEC",controller:["$scope","$element","$attrs",function(e,r,t){this.optsBankAccountHolderType=i,this.optsBankAccountType=s,this.check=e.$eval(t.dwECheck)}],compile:function(e,r){return function(e,r,t,n,i){}}}}]),angular.module("deskworks.dwInvoice.small",["deskworks.state","flexForms","deskworks.helper"]).directive("dwInvoiceSmall",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"components/dw-invoice/dw-invoice-small.tpl.html",controller:"dwInvoiceSmallCtrl as dwInvoice",bindToController:{invoice:"=*"},compile:function(e,r){return e.addClass("dw-invoice"),function(e,r,t,n,i){}}}}).controller("dwInvoiceSmallCtrl",function(){"use strict"}),angular.module("deskworks.dwInvoice",["flexForms","deskworks.state","deskworks.helper","deskworks.dwInvoice.small"]).directive("dwInvoice",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"components/dw-invoice/dw-invoice.tpl.html",controller:"dwInvoiceCtrl as dwInvoice",bindToController:{center:"=*?",invoice:"=*",allowRemove:"@",updateInvoice:"&"},compile:function(e,r){return e.addClass("dw-invoice"),function(e,r,t,n,i){}}}}).controller("dwInvoiceCtrl",["$scope","$element","$attrs","dwAlerts","state","purchaseService",function(e,r,t,n,i,s){"use strict";var o=this;o.removeItem=function(e){return s.deletePurchaseItem(i.getCurrentCenterId(),i.getCurrentUserId(),o.invoice.id,e.id).catch(function(e){return n.error(e,"Failed to remove purchase item.")}).then(function(e){return o.updateInvoice()})}}]),angular.module("dwModal",["angularModalService"]).factory("dwModal",["ModalService",function(e){"use strict";return{show:function(r){var t={bodyClass:"dw-modal-open",appendElement:angular.element(document.querySelector(".snap-content"))};return e.showModal(angular.extend({},t,r)).then(function(e){var r=e.element[0].querySelector(".dw-modal-cross");return r&&r.focus(),e})}}}]),angular.module("deskworks.dwSelectCenter",["deskworks.state","flexForms","deskworks.helper","deskworks.center.service","deskworks.Admin"]).directive("dwSelectCenter",["$q","$rootScope","$timeout","$compile","dwAlerts","ffHelper","state","helper","centerService","Admin",function(e,r,t,n,i,s,o,a,l,c){"use strict";return{restrict:"E",scope:!0,controller:function(){},controllerAs:"dwSelectCenter",compile:function(t,n){var s=angular.element('<ff-select name="center"></ff-select>'),u=angular.element('<option ng-repeat="center in dwSelectCenter.centers" ng-value="center.id" label="{{center.name}}">{{center.name}}</option>');return u.attr("ng-style","center.color ? { color: center.color } : {}"),s.attr("ff-style","dwSelectCenter.curCenter.color ? {color: dwSelectCenter.curCenter.color} : {}"),s.attr("ff-model",n.ffModel||"dwSelectCenter.curCenterId"),s.attr("ff-change","dwSelectCenter.onCenterChange()"),s.append(u),t.append(s),function(t,s,u,d){function f(){var r={centers:l.getCenters().catch(function(e){return i.error(e,"dwSelectCenter: failed to query centers.")})};return o.isLoggedAdmin()&&(r.admin=c.get(o.getLoggedUserId()).catch(function(e){return i.error(e,"dwSelectCenter: failed to get admin.")})),e.all(r).then(function(e){if(d.centers=e.centers.filter(function(r){return!e.admin||!!(a.findByKeyValue(e.admin.centers,"id",r.id)||{}).permission}),u.ffOptionAll&&"false"!==u.ffOptionAll&&d.centers.length>1&&d.centers.unshift({id:0,name:"All Centers"}),n.ffModel){var r=t.$eval(n.ffModel);angular.isUndefined(r)?(d.curCenterId=d.centers[0].id,t.$eval(n.ffModel+" = dwSelectCenter.curCenterId")):d.curCenterId=r}else d.curCenterId=o.getCurrentCenterId()||d.centers[0]&&d.centers[0].id;d.curCenter=a.findByKeyValue(d.centers,"id",d.curCenterId)})}n.ffModel||t.$watch(function(){return o.getCurrentCenterId()},function(e){d.curCenterId=e,d.curCenter=a.findByKeyValue(d.centers,"id",d.curCenterId)}),d.onCenterChange=function(){d.curCenter=a.findByKeyValue(d.centers,"id",d.curCenterId),n.ffModel?d.curCenter=a.findByKeyValue(d.centers,"id",t.$eval(n.ffModel)):(d.curCenter=a.findByKeyValue(d.centers,"id",d.curCenterId),o.setCurrentCenterId(d.curCenterId))},r.$on("CENTERS:REFRESH",function(){f()}),f()}}}}]),angular.module("deskworks.dwSelectProfileWidget",["ngRoute","deskworks.state","flexForms","deskworks.helper","deskworks.userProfile.service"]).directive("dwSelectProfileWidget",["$route","state","helper","userProfileService",function(e,r,t,n){"use strict";return{restrict:"E",scope:!0,template:'<label>Current Profile<ff-select name="currentProfile" ff-model="currentProfile" ff-options="profile.name for profile in profiles" ff-change="selectProfile(currentProfile)"></ff-select></label>',compile:function(i,s){return i.addClass("dw-widget"),i.css("display","none"),function(i,s,o){i.profiles=[],i.$watch(function(){return r.getLoggedUserId()},function(e){r.isLoggedAdmin()?s.css("display","none"):e?n.get(r.getCurrentCenterId(),r.getLoggedUserId()).then(function(n){i.profiles=[{id:n.id,name:n.firstName+" "+n.lastName}],n.masterMembers.forEach(function(t){t.id!==e&&(i.profiles.push({id:t.id,name:t.company||t.fullName}),r.setCurrentUserId(t.id))}),i.currentProfile=t.findByKeyValue(i.profiles,"id",r.getCurrentUserId())||i.profiles[0],i.profiles.length>1&&s.css("display","")}):(i.profiles=[],i.currentProfile=null,s.css("display","none"))}),i.$watch(function(){return r.getCurrentUserId()},function(e){i.currentProfile=t.findByKeyValue(i.profiles,"id",e)||i.profiles[0]}),i.selectProfile=function(t){r.setCurrentUserId(t.id===r.getLoggedUserId()?null:t.id),e.current&&e.current.$$route&&!e.current.$$route.reloadOnSearch&&e.reload()}}}}}]),angular.module("deskworks.dwSelectUser",["deskworks.state","flexForms","deskworks.helper"]).directive("dwSelectUser",["$route","state","helper",function(e,r,t){return{restrict:"E",scope:!0,compile:function(e,r){var t=angular.element('<ff-static snap-close ng-click="searchUser()" ng-class="{ ava: state.isUserSelected() && state.getCurrentUser().photo.indexOf(\'missing.png\') < 0 }"></ff-static>'),n=angular.element('<span class="placeholder" ng-hide="state.isUserSelected()" translate="SIDEBAR.CURRENT_USER.LABEL"></span>'),i=angular.element('<span class="company" ng-show="state.isUserSelected() && state.getCurrentUser().company" ng-bind="state.getCurrentUser().company"></span>'),s=angular.element('<span class="member" ng-show="state.isUserSelected()" ng-bind="state.getCurrentUser().firstName + \' \' + state.getCurrentUser().lastName"></span>'),o=angular.element('<img class="avatar" ng-src="{{state.getCurrentUser().photo}}" ng-if="state.isUserSelected() && state.getCurrentUser().photo.indexOf(\'missing.png\') < 0">');return t.append(n).append(i).append(s).append(o),e.append(t).append(o),this.link},link:function(n,i,s,o,a){n.state=r,n.helper=t,n.searchUser=function(){r.setParam("redirect",e.current&&e.current.scope&&e.current.scope.backPath?e.current.scope.backPath:r.getPath()),r.setPath("/user-search")}}}}]),angular.module("forbidStaff",[]).directive("forbidStaff",["$compile","$templateCache","session","state",function(e,r,t,n){"use strict";return{restrict:"EA",scope:!0,controller:"forbidStaffCtrl as $forbidStaff",link:function(i,s){var o=s.children().css({display:"none"});t.wait().finally(function(){if(!n.isLoggedAdmin())return o.css({display:""});var t=r.get("components/forbid-staff/forbid-staff.tpl.html");s.append(e(t)(i))})}}}]).controller("forbidStaffCtrl",["$scope","$route","$timeout","state",function(e,r,t,n){"use strict";this.signOut=function(){return n.logout({skipResetParams:!0}).finally(function(){return r.reload(),t(2e3)})},this.home=function(){return n.resetParams(),n.setPath("/")}}]),angular.module("deskworks.formDesign.fdFieldTemplates",[]).factory("fdFieldTemplates",function(){"use strict";var e='ff-attr-id="fd-{{field.id}}" name="fd-{{field.id}}" ff-model="field.value"',r='<label class="ff-row"><ff-label class="ff-small-padding" flex="0 1 160px">{{field.name}}</ff-label>',t="</label>";return{text:r+"<ff-text "+e+' ff-validate-alert="{{field.name}}"></ff-text>'+t,textarea:r+"<ff-textarea "+e+' rowspan="2"></ff-textarea>'+t,date:r+"<ff-date "+e+' ff-validate-alert="{{field.name}}"></ff-date>'+t,url:r+"<ff-url "+e+' ff-validate-alert="{{field.name}}"></ff-url>'+t,email:r+"<ff-text "+e+" dw-email></ff-text>"+t,phone:r+"<ff-text "+e+" dw-phone></ff-text>"+t,number:r+"<ff-number "+e+' ff-validate-alert="{{field.name}}"></ff-number>'+t}}),angular.module("deskworks.formDesign.fdField",["deskworks.formDesign.fdFieldTemplates"]).directive("fdField",["$compile","fdFieldTemplates",function(e,r){"use strict";return{scope:!0,require:"^^?form",link:function(t,n,i,s){t.field=t.$eval(i.field);var o=angular.element(r[t.field.type]);n.append(o),e(o)(t)}}}]),angular.module("deskworks.membershipFilter",["flexForms","deskworks.state","deskworks.helper","deskworks.optsMembershipFilter"]).directive("membershipFilter",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"components/membership-filter/membership-filter.tpl.html",controller:"MembershipFilterCtrl as $ctrl",bindToController:{ffModel:"=?",filterData:"=?",layout:"@?"}}}).controller("MembershipFilterCtrl",["$scope","$element","$attrs","state","helper","optsMembershipFilter",function(e,r,t,n,i,s){"use strict";var o=this;function a(){o.ffModel=o.filterData.filter(function(e){return"all"!==e.id}).reduce(function(e,r){return r.value&&(e[r.id]=r.value),e},{})}o.$onInit=function(){o.filterData=o.filterData||angular.copy(s),a()},o.onChange=function(e){if("all"===e.id){var r=i.findByKeyValue(o.filterData,"id","all").value;o.filterData.forEach(function(e){"all"!==e.id&&(e.value=r)}),r||(i.findByKeyValue(o.filterData,"id","activeMembers").value=!0)}else i.findByKeyValue(o.filterData,"id","all").value=o.filterData.filter(function(e){return"all"!==e.id}).every(function(e){return e.value});a()}}]),angular.module("deskworks.optsMembershipFilter",[]).factory("optsMembershipFilter",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"all",_name:"USER_SEARCH.FILTERS.ALL",value:!1,type:"all"},{id:"activeMembers",_name:"USER_SEARCH.FILTERS.ACTIVE_MEMBERS",value:!0,type:"role"},{id:"inactiveMembers",_name:"USER_SEARCH.FILTERS.INACTIVE_MEMBERS",value:!1,type:"role"},{id:"activeCoMembers",_name:"USER_SEARCH.FILTERS.ACTIVE_CO_MEMBERS",value:!1,type:"role"},{id:"inactiveCoMembers",_name:"USER_SEARCH.FILTERS.INACTIVE_CO_MEMBERS",value:!1,type:"role"},{id:"nonMembers",_name:"USER_SEARCH.FILTERS.NON_MEMBERS",value:!1,type:"role"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.niceTime",[]).directive("niceTime",["$compile","$locale",function(e,r){"use strict";return{restrict:"A",compile:function(t,n){return function(t,i,s){var o;o=24===r.timeFormat?'<span ng-bind="'+n.niceTime+" | date: 'HH:mm'\"></span>":'<span ng-bind="'+n.niceTime+" | date: 'hh:mm'\"></span><sup ng-bind=\""+n.niceTime+" | date: 'a'\"></sup>",i.empty().append(e(o)(t))}}}}]),angular.module("deskworks.resClock",["deskworks.rcHelper"]).component("resClock",{template:'<svg class="res-clock" viewBox="-102 -102 204 204"><circle cx="0" cy="0" r="100"></circle><path ng-repeat="path in $ctrl.availabilities track by $index" svg-d="path" class="available"></path><path ng-repeat="path in $ctrl.reservations track by $index" svg-d="path" class="reserved"></path><path ng-repeat="path in $ctrl.hours track by $index" svg-d="path" class="hour"></path><path ng-repeat="path in $ctrl.quarters track by $index" svg-d="path" class="quarter"></path><text text-anchor="middle" alignment-baseline="middle" ng-bind="$ctrl.am ? $ctrl.AMPMS[0] : $ctrl.AMPMS[1]"></text></svg>',controller:"ResClockCtrl",bindings:{resUnit:"<",am:"<"}}).controller("ResClockCtrl",["$locale","$filter","rcHelper",function(e,r,t){"use strict";var n=this,i=100,s=10,o=25;function a(e){var r=4*Math.PI/1440,s=[];return e.forEach(function(e){var o=e.from.clone().hour(n.am?0:12).minute(0).second(0),a=e.from.clone().hour(n.am?12:24).minute(0).second(0);if(t.checkIntersection(e.from,e.to,o,a)){var u=e.from<o?o:e.from,d=e.to>a?a:e.to;s.push(function(e,r){if(r-e>=2*Math.PI)return r-=.001,"M "+c(i,e)+","+l(i,e)+"  A100,100 1 "+(r-e>Math.PI?"1":"0")+",1 "+c(i,r)+","+l(i,r)+" z";return"M0,0 L"+c(i,e)+","+l(i,e)+"  A100,100 1 "+(r-e>Math.PI?"1":"0")+",1 "+c(i,r)+","+l(i,r)+" z"}(Math.PI+(60*u.hour()+u.minute())*r,Math.PI+(60*u.hour()+u.minute()+(d-u)/6e4)*r))}}),s}function l(e,r){return+(e*Math.cos(-r)).toFixed(3)}function c(e,r){return+(e*Math.sin(-r)).toFixed(3)}n.$onInit=function(){!function(){var e,r,t;for(n.hours=[],n.quarters=[],e=0;e<12;e++)r=e*(Math.PI/6),t="M"+c(i-s,r)+","+l(i-s,r)+"  L"+c(i,r)+","+l(i,r)+"  z",n.hours.push(t);for(e=0;e<4;e++)r=e*(Math.PI/2),t="M"+c(i-o,r)+","+l(i-o,r)+"  L"+c(i,r)+","+l(i,r)+"  z",n.quarters.push(t)}(),n.AMPMS=e.DATETIME_FORMATS.AMPMS},n.$onChanges=function(){n.availabilities=a(n.resUnit.availabilities),n.reservations=a(n.resUnit.reservations)}}]).directive("svgD",function(){"use strict";return{restrict:"A",scope:!0,link:function(e,r,t){e.$watch(t.svgD,function(e){r.attr("d",e)})}}}),angular.module("deskworks.reservationRules",["deskworks.reservationRules.service","deskworks.inventory.product.service","deskworks.reservationRules.rrRule","deskworks.reservationRules.rrLimit","deskworks.reservationRules.rrWeekdayLimit","deskworks.reservationRules.rrDateLimit","deskworks.reservationRules.rrStatic","deskworks.reservationRules.optsWhoCanReserve","deskworks.reservationRules.optsReservationLimitMin","deskworks.reservationRules.optsReservationLimitMax","deskworks.reservationRules.optsDaysInAdvance"]).directive("reservationRules",function(){return{scope:!0,templateUrl:"components/reservation-rules/reservation-rules.tpl.html",controller:"ReservationRulesCtrl as $ctrl",bindToController:{centerId:"<",reservationUnitId:"<"}}}).controller("ReservationRulesCtrl",["$scope","$q","$filter","$timeout","$translate","helper","dwAlerts","ReservationRules","productService","reservationUnitService","optsWhoCanReserve","optsReservationLimitMin","optsReservationLimitMax","optsDaysInAdvance",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p){"use strict";var m=this;m.conf={whoCanReserve:{name:i.instant("RESERVATION_RULES.WHO_CAN_RESERVE"),opts:u},fullTimeProduct:{name:i.instant("RESERVATION_RULES.FULL_TIME_PRODUCT")},attachedUser:{name:i.instant("RESERVATION_RULES.ATTACHED_USER")},limitMin:{name:i.instant("RESERVATION_RULES.MIN_LIMIT"),opts:d},limitMax:{name:i.instant("RESERVATION_RULES.MAX_LIMIT"),opts:f},daysInAdvance:{name:i.instant("RESERVATION_RULES.DAYS_IN_ADVANCE"),opts:p}},m.$onInit=function(){m.form=e.formReservationRules},m.$onChanges=function(){a.query({centerId:m.centerId,reservationUnitId:m.reservationUnitId}).catch(function(e){return o.error(e,"Failed to load reservation rules.")}).then(function(e){m.rules=e,m.whoCanReserve=s.findByKeyValue(m.rules,"uid","whoCanReserve")}),m.reservationUnitId&&(c.getReservationUnitExt(m.centerId,m.reservationUnitId).catch(function(e){return o.error(e,"Reservation Rules failed to get reservation unit.")}).then(function(e){m.fullTimeProduct={uid:"fullTimeProduct",type:"value",value:e.fullTimeProductId},m.attachedUser={uid:"attachedUser",type:"static",value:e.attachedUserName}}),l.getMembershipProducts(m.centerId).catch(function(e){return o.error(e,"Reservation Rules failed to query membership products.")}).then(function(e){angular.forEach(e,function(e){e.name+=" ("+t("ncurrency")(e.price)+")"}),m.conf.fullTimeProduct.opts=e,m.conf.fullTimeProduct.opts.unshift({id:null,name:i.instant("GLOBAL.NONE")})}))},e.$watch("$ctrl.whoCanReserve.value",function(e){e&&(a.roles.forEach(function(r){r.$visible=r.$isVisible(e)}),m.hideRules="staffOnly"===e||"notAvailable"===e)}),m.addDate=function(){m.rules.push({type:"date",member:{available:!1,intervals:[]},nonMember:{available:!1,intervals:[]}})},m.resetRules=function(){return a.query({centerId:m.centerId}).catch(function(e){return o.error(e,"Failed to load reservation rules defaults from center.")}).then(function(e){return m.copyRules(e)})},m.copyRules=function(e){return r.all(e.filter(function(e){return"value"===e.type||"roles"===e.type||"weekday"===e.type}).map(function(e){var r=s.findByKeyValue(m.rules,"uid",e.uid);if(r){switch(e.type){case"value":r.value=e.value;break;case"roles":a.roles.forEach(function(t){r[t.id]=e[t.id]});break;case"weekday":a.roles.forEach(function(t){r[t.id].available=e[t.id].available,r[t.id].intervals=e[t.id].intervals.map(function(e){return{from:e.from,to:e.to}})})}return n(function(){r.$as()},100)}}))},m.saveFullTimeProduct=function(){return c.updateReservationUnit(m.centerId,m.reservationUnitId,{fullTimeProductId:m.fullTimeProduct.value&&+m.fullTimeProduct.value||null}).catch(function(e){return o.error(e,"Failed to save full time product.")})}}]),angular.module("deskworks.reservationRules.rrDateLimit",["deskworks.reservationRules.service"]).directive("rrDateLimit",function(){return{scope:!0,require:["rrDateLimit","^^reservationRules"],templateUrl:"components/reservation-rules/rr-date-limit.tpl.html",controller:"RrDateLimitCtrl as $ctrl",bindToController:{rule:"<",role:"<"},link:function(e,r,t,n){n[0].rrCtrl=n[1]}}}).controller("RrDateLimitCtrl",["$scope","$element","$timeout","$translate","helper","ReservationRules",function(e,r,t,n,i,s){"use strict";var o=this;o.options=[{id:!0,name:n.instant("RESERVATION_RULES.AVAILABLE")},{id:!1,name:n.instant("RESERVATION_RULES.NOT_AVAILABLE")}],o.$onInit=function(){r.addClass("ff-col ff-relative"),e.$watch("$ctrl.rrCtrl.rules",o.updateGhosts)},o.addInterval=function(){o.rule.$autoSaving||(o.rule[o.role].$ghosts&&o.rule[o.role].$ghosts.pop(),t(function(){o.rule[o.role].intervals.push({from:null,to:null}),o.updateGhosts()}))},o.deleteInterval=function(e){if(!o.rule.$autoSaving)return o.rule[o.role].intervals.splice(o.rule[o.role].intervals.indexOf(e),1),t(o.updateGhosts),o.rule.$as()},o.updateGhosts=function(){if(o.rrCtrl){var e=o.rrCtrl.rules.filter(function(e){return"date"===e.type});s.roles.forEach(function(r){var t=e.reduce(function(e,t){return t[r.id].available&&t[r.id].intervals.length>e?t[r.id].intervals.length:e},0);e.forEach(function(e){e[r.id].$ghosts=new Array(t-(e[r.id].available?e[r.id].intervals.length:0))})})}}}]),angular.module("deskworks.reservationRules.rrLimit",[]).directive("rrLimit",function(){return{scope:!0,templateUrl:"components/reservation-rules/rr-limit.tpl.html",controller:"RrLimitCtrl as $ctrl",bindToController:{rule:"<",role:"<",options:"<"}}}).controller("RrLimitCtrl",["$scope","$element",function(e,r){"use strict";this.$onInit=function(){r.addClass("ff-col ff-relative")}}]),angular.module("deskworks.reservationRules.rrRule",["autoSave","deskworks.reservationRules.service"]).directive("rrRule",function(){return{scope:!0,require:{rrCtrl:"^^reservationRules"},transclude:!0,templateUrl:"components/reservation-rules/rr-rule.tpl.html",controller:"RrRuleCtrl as $ctrl",bindToController:{rule:"<",options:"<",ruleSave:"&?"}}}).controller("RrRuleCtrl",["$scope","$element","$timeout","helper","dwAlerts","ReservationRules","autoSave",function(e,r,t,n,i,s,o){"use strict";var a=this;a.$onInit=function(){r.addClass("ff-col"),a.roles=s.roles},a.$onChanges=function(){a.rule&&t(function(){var r=a.ruleSave||function(){return s.save({centerId:a.rrCtrl.centerId,reservationUnitId:a.rrCtrl.reservationUnitId},this).catch(function(e){return i.error(e,"Failed to save rule.")})};a.rule.$as=o.wrap(r,e.rrForm)})},a.deleteRule=function(){return(a.rule.id?s.delete({centerId:a.rrCtrl.centerId,ruleId:a.rule.id}):t()).then(function(){a.rrCtrl.rules.splice(a.rrCtrl.rules.indexOf(a.rule),1)}).catch(function(e){return i.error(e,"Failed to delete rule")})}}]),angular.module("deskworks.reservationRules.rrStatic",[]).directive("rrStatic",function(){return{scope:!0,require:["rrWeekdayLimit","^^reservationRules"],templateUrl:"components/reservation-rules/rr-static.tpl.html",controller:"RrStaticCtrl as $ctrl",bindToController:{rule:"<"}}}).controller("RrStaticCtrl",["$scope","$element","helper",function(e,r,t){"use strict";this.$onInit=function(){r.addClass("ff-col ff-relative")}}]),angular.module("deskworks.reservationRules.rrWeekdayLimit",["deskworks.reservationRules.service"]).directive("rrWeekdayLimit",function(){return{scope:!0,require:["rrWeekdayLimit","^^reservationRules"],templateUrl:"components/reservation-rules/rr-weekday-limit.tpl.html",controller:"RrWeekdayLimitCtrl as $ctrl",bindToController:{rule:"<",role:"<"},link:function(e,r,t,n){n[0].rrCtrl=n[1],n[0].onInit()}}}).controller("RrWeekdayLimitCtrl",["$scope","$element","$timeout","$translate","$locale","helper","ReservationRules",function(e,r,t,n,i,s,o){"use strict";var a=this;a.weekdayIds=["sun","mon","tue","wed","thu","fri","sat"],a.options=[{id:!0,name:n.instant("RESERVATION_RULES.AVAILABLE")},{id:!1,name:n.instant("RESERVATION_RULES.NOT_AVAILABLE")}],a.onChangeAvailable=function(){if(angular.isString(a.rule[a.role].available)){var e=s.findByKeyValue(a.rrCtrl.rules,"uid",a.rule[a.role].available);a.rule[a.role].intervals=e[a.role].intervals.map(function(e){return{from:e.from.clone(),to:e.to.clone()}}),a.rule[a.role].available=e[a.role].available}a.updateGhosts(),a.rule.$as()},a.onInit=function(){r.addClass("ff-col ff-relative"),a.weekdayIds.forEach(function(e){e!==a.rule.uid&&a.options.push({id:e,name:n.instant("RESERVATION_RULES.COPY_FROM",{weekday:s.findByKeyValue(a.rrCtrl.rules,"uid",e).name.toUpperCase()})})}),e.$watchCollection("$ctrl.rule[$ctrl.role].intervals",function(){a.updateGhosts()})},a.addInterval=function(){a.rule.$autoSaving||(a.rule[a.role].$ghosts.pop(),t(function(){a.rule[a.role].intervals.push({from:null,to:null})}))},a.deleteInterval=function(e){if(!a.rule.$autoSaving)return a.rule[a.role].intervals.splice(a.rule[a.role].intervals.indexOf(e),1),a.rule.$as()},a.updateGhosts=function(){var e=a.rrCtrl.rules.filter(function(e){return"weekday"===e.type});o.roles.forEach(function(r){var t=e.reduce(function(e,t){return t[r.id].available&&t[r.id].intervals.length>e?t[r.id].intervals.length:e},0);e.forEach(function(e){e[r.id].$ghosts=new Array(t-(e[r.id].available?e[r.id].intervals.length:0))})})}}]),angular.module("scrollbarSize",[]).factory("scrollbarSize",function(){"use strict";var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="100px",e.style.height="100px",e.style.overflow="scroll",document.body.appendChild(e);var r=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),r});var Swiper=function(e,r){"use strict";if(!document.body.outerHTML&&document.body.__defineGetter__&&HTMLElement){var t=HTMLElement.prototype;t.__defineGetter__&&t.__defineGetter__("outerHTML",function(){return(new XMLSerializer).serializeToString(this)})}if(window.getComputedStyle||(window.getComputedStyle=function(e,r){return this.el=e,this.getPropertyValue=function(r){var t=/(\-([a-z]){1})/g;return"float"===r&&(r="styleFloat"),t.test(r)&&(r=r.replace(t,function(){return arguments[2].toUpperCase()})),e.currentStyle[r]?e.currentStyle[r]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,r){for(var t=r||0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1}),(document.querySelectorAll||window.jQuery)&&void 0!==e&&(e.nodeType||0!==R(e).length)){var n,i,s,o,a,l,c=this;c.touches={start:0,startX:0,startY:0,current:0,currentX:0,currentY:0,diff:0,abs:0},c.positions={start:0,abs:0,diff:0,current:0},c.times={start:0,end:0},c.id=(new Date).getTime(),c.container=e.nodeType?e:R(e)[0],c.isTouched=!1,c.isMoved=!1,c.activeIndex=0,c.centerIndex=0,c.activeLoaderIndex=0,c.activeLoopIndex=0,c.previousIndex=null,c.velocity=0,c.snapGrid=[],c.slidesGrid=[],c.imagesToLoad=[],c.imagesLoaded=0,c.wrapperLeft=0,c.wrapperRight=0,c.wrapperTop=0,c.wrapperBottom=0,c.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>=0;var u={eventTarget:"wrapper",mode:"horizontal",touchRatio:1,speed:300,freeMode:!1,freeModeFluid:!1,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,slidesPerView:1,slidesPerGroup:1,slidesPerViewFit:!0,simulateTouch:!0,followFinger:!0,shortSwipes:!0,longSwipesRatio:.5,moveStartThreshold:!1,onlyExternal:!1,createPagination:!0,pagination:!1,paginationElement:"span",paginationClickable:!1,paginationAsRange:!0,resistance:!0,scrollContainer:!1,preventLinks:!0,preventLinksPropagation:!1,noSwiping:!1,noSwipingClass:"swiper-no-swiping",initialSlide:0,keyboardControl:!1,mousewheelControl:!1,mousewheelControlForceToAxis:!1,useCSS3Transforms:!0,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,loop:!1,loopAdditionalSlides:0,roundLengths:!1,calculateHeight:!1,cssWidthAndHeight:!1,updateOnImagesReady:!0,releaseFormElements:!0,watchActiveIndex:!1,visibilityFullFit:!1,offsetPxBefore:0,offsetPxAfter:0,offsetSlidesBefore:0,offsetSlidesAfter:0,centeredSlides:!1,queueStartCallbacks:!1,queueEndCallbacks:!1,autoResize:!0,resizeReInit:!1,DOMAnimation:!0,loader:{slides:[],slidesHTMLType:"inner",surroundGroups:1,logic:"reload",loadAllSlides:!1},swipeToPrev:!0,swipeToNext:!0,slideElement:"div",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",wrapperClass:"swiper-wrapper",paginationElementClass:"swiper-pagination-switch",paginationActiveClass:"swiper-active-switch",paginationVisibleClass:"swiper-visible-switch"};for(var d in r=r||{},u)if(d in r&&"object"==typeof r[d])for(var f in u[d])f in r[d]||(r[d][f]=u[d][f]);else d in r||(r[d]=u[d]);c.params=r,r.scrollContainer&&(r.freeMode=!0,r.freeModeFluid=!0),r.loop&&(r.resistance="100%");var p="horizontal"===r.mode,m=["mousedown","mousemove","mouseup"];c.browser.ie10&&(m=["MSPointerDown","MSPointerMove","MSPointerUp"]),c.browser.ie11&&(m=["pointerdown","pointermove","pointerup"]),c.touchEvents={touchStart:c.support.touch||!r.simulateTouch?"touchstart":m[0],touchMove:c.support.touch||!r.simulateTouch?"touchmove":m[1],touchEnd:c.support.touch||!r.simulateTouch?"touchend":m[2]};for(var h=c.container.childNodes.length-1;h>=0;h--)if(c.container.childNodes[h].className)for(var g=c.container.childNodes[h].className.split(/\s+/),v=0;v<g.length;v++)g[v]===r.wrapperClass&&(n=c.container.childNodes[h]);c.wrapper=n,c._extendSwiperSlide=function(e){return e.append=function(){return r.loop?e.insertAfter(c.slides.length-c.loopedSlides):(c.wrapper.appendChild(e),c.reInit()),e},e.prepend=function(){return r.loop?(c.wrapper.insertBefore(e,c.slides[c.loopedSlides]),c.removeLoopedSlides(),c.calcSlides(),c.createLoop()):c.wrapper.insertBefore(e,c.wrapper.firstChild),c.reInit(),e},e.insertAfter=function(t){return void 0!==t&&(r.loop?((n=c.slides[t+1+c.loopedSlides])?c.wrapper.insertBefore(e,n):c.wrapper.appendChild(e),c.removeLoopedSlides(),c.calcSlides(),c.createLoop()):(n=c.slides[t+1],c.wrapper.insertBefore(e,n)),c.reInit(),e);var n},e.clone=function(){return c._extendSwiperSlide(e.cloneNode(!0))},e.remove=function(){c.wrapper.removeChild(e),c.reInit()},e.html=function(r){return void 0===r?e.innerHTML:(e.innerHTML=r,e)},e.index=function(){for(var r,t=c.slides.length-1;t>=0;t--)e===c.slides[t]&&(r=t);return r},e.isActive=function(){return e.index()===c.activeIndex},e.swiperSlideDataStorage||(e.swiperSlideDataStorage={}),e.getData=function(r){return e.swiperSlideDataStorage[r]},e.setData=function(r,t){return e.swiperSlideDataStorage[r]=t,e},e.data=function(r,t){return void 0===t?e.getAttribute("data-"+r):(e.setAttribute("data-"+r,t),e)},e.getWidth=function(r,t){return c.h.getWidth(e,r,t)},e.getHeight=function(r,t){return c.h.getHeight(e,r,t)},e.getOffset=function(){return c.h.getOffset(e)},e},c.calcSlides=function(e){var t=!!c.slides&&c.slides.length;c.slides=[],c.displaySlides=[];for(var n=0;n<c.wrapper.childNodes.length;n++)if(c.wrapper.childNodes[n].className)for(var i=c.wrapper.childNodes[n].className.split(/\s+/),s=0;s<i.length;s++)i[s]===r.slideClass&&c.slides.push(c.wrapper.childNodes[n]);for(n=c.slides.length-1;n>=0;n--)c._extendSwiperSlide(c.slides[n]);!1!==t&&(t!==c.slides.length||e)&&(M(),L(),c.updateActiveSlide(),c.params.pagination&&c.createPagination(),c.callPlugins("numberOfSlidesChanged"))},c.createSlide=function(e,t,n){t=t||c.params.slideClass,n=n||r.slideElement;var i=document.createElement(n);return i.innerHTML=e||"",i.className=t,c._extendSwiperSlide(i)},c.appendSlide=function(e,r,t){if(e)return e.nodeType?c._extendSwiperSlide(e).append():c.createSlide(e,r,t).append()},c.prependSlide=function(e,r,t){if(e)return e.nodeType?c._extendSwiperSlide(e).prepend():c.createSlide(e,r,t).prepend()},c.insertSlideAfter=function(e,r,t,n){return void 0!==e&&(r.nodeType?c._extendSwiperSlide(r).insertAfter(e):c.createSlide(r,t,n).insertAfter(e))},c.removeSlide=function(e){if(c.slides[e]){if(r.loop){if(!c.slides[e+c.loopedSlides])return!1;c.slides[e+c.loopedSlides].remove(),c.removeLoopedSlides(),c.calcSlides(),c.createLoop()}else c.slides[e].remove();return!0}return!1},c.removeLastSlide=function(){return c.slides.length>0&&(r.loop?(c.slides[c.slides.length-1-c.loopedSlides].remove(),c.removeLoopedSlides(),c.calcSlides(),c.createLoop()):c.slides[c.slides.length-1].remove(),!0)},c.removeAllSlides=function(){for(var e=c.slides.length-1;e>=0;e--)c.slides[e].remove()},c.getSlide=function(e){return c.slides[e]},c.getLastSlide=function(){return c.slides[c.slides.length-1]},c.getFirstSlide=function(){return c.slides[0]},c.activeSlide=function(){return c.slides[c.activeIndex]},c.fireCallback=function(){var e=arguments[0];if("[object Array]"===Object.prototype.toString.call(e))for(var t=0;t<e.length;t++)"function"==typeof e[t]&&e[t](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);else"[object String]"===Object.prototype.toString.call(e)?r["on"+e]&&c.fireCallback(r["on"+e],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):e(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},c.addCallback=function(e,r){var t,n;return this.params["on"+e]?(n=this.params["on"+e],"[object Array]"===Object.prototype.toString.apply(n)?this.params["on"+e].push(r):"function"==typeof this.params["on"+e]?(t=this.params["on"+e],this.params["on"+e]=[],this.params["on"+e].push(t),this.params["on"+e].push(r)):void 0):(this.params["on"+e]=[],this.params["on"+e].push(r))},c.removeCallbacks=function(e){c.params["on"+e]&&(c.params["on"+e]=null)};var C=[];for(var k in c.plugins)if(r[k]){var w=c.plugins[k](c,r[k]);w&&C.push(w)}c.callPlugins=function(e,r){r||(r={});for(var t=0;t<C.length;t++)e in C[t]&&C[t][e](r)},!c.browser.ie10&&!c.browser.ie11||r.onlyExternal||c.wrapper.classList.add("swiper-wp8-"+(p?"horizontal":"vertical")),r.freeMode&&(c.container.className+=" swiper-free-mode"),c.initialized=!1,c.init=function(e,t){var n=c.h.getWidth(c.container,!1,r.roundLengths),o=c.h.getHeight(c.container,!1,r.roundLengths);if(n!==c.width||o!==c.height||e){var a,u,d,f,m,h,g;c.width=n,c.height=o,l=p?n:o;var v=c.wrapper;if(e&&c.calcSlides(t),"auto"===r.slidesPerView){var C=0,k=0;r.slidesOffset>0&&(v.style.paddingLeft="",v.style.paddingRight="",v.style.paddingTop="",v.style.paddingBottom=""),v.style.width="",v.style.height="",r.offsetPxBefore>0&&(p?c.wrapperLeft=r.offsetPxBefore:c.wrapperTop=r.offsetPxBefore),r.offsetPxAfter>0&&(p?c.wrapperRight=r.offsetPxAfter:c.wrapperBottom=r.offsetPxAfter),r.centeredSlides&&(p?(c.wrapperLeft=(l-this.slides[0].getWidth(!0,r.roundLengths))/2,c.wrapperRight=(l-c.slides[c.slides.length-1].getWidth(!0,r.roundLengths))/2):(c.wrapperTop=(l-c.slides[0].getHeight(!0,r.roundLengths))/2,c.wrapperBottom=(l-c.slides[c.slides.length-1].getHeight(!0,r.roundLengths))/2)),p?(c.wrapperLeft>=0&&(v.style.paddingLeft=c.wrapperLeft+"px"),c.wrapperRight>=0&&(v.style.paddingRight=c.wrapperRight+"px")):(c.wrapperTop>=0&&(v.style.paddingTop=c.wrapperTop+"px"),c.wrapperBottom>=0&&(v.style.paddingBottom=c.wrapperBottom+"px")),h=0;var w=0;for(c.snapGrid=[],c.slidesGrid=[],d=0,g=0;g<c.slides.length;g++){a=c.slides[g].getWidth(!0,r.roundLengths),u=c.slides[g].getHeight(!0,r.roundLengths),r.calculateHeight&&(d=Math.max(d,u));var y=p?a:u;if(r.centeredSlides){var I=g===c.slides.length-1?0:c.slides[g+1].getWidth(!0,r.roundLengths),b=g===c.slides.length-1?0:c.slides[g+1].getHeight(!0,r.roundLengths),S=p?I:b;if(y>l){if(r.slidesPerViewFit)c.snapGrid.push(h+c.wrapperLeft),c.snapGrid.push(h+y-l+c.wrapperLeft);else for(var $=0;$<=Math.floor(y/(l+c.wrapperLeft));$++)0===$?c.snapGrid.push(h+c.wrapperLeft):c.snapGrid.push(h+c.wrapperLeft+l*$);c.slidesGrid.push(h+c.wrapperLeft)}else c.snapGrid.push(w),c.slidesGrid.push(w);w+=y/2+S/2}else{if(y>l)if(r.slidesPerViewFit)c.snapGrid.push(h),c.snapGrid.push(h+y-l);else if(0!==l)for(var E=0;E<=Math.floor(y/l);E++)c.snapGrid.push(h+l*E);else c.snapGrid.push(h);else c.snapGrid.push(h);c.slidesGrid.push(h)}h+=y,C+=a,k+=u}r.calculateHeight&&(c.height=d),p?(s=C+c.wrapperRight+c.wrapperLeft,v.style.width=C+"px",v.style.height=c.height+"px"):(s=k+c.wrapperTop+c.wrapperBottom,v.style.width=c.width+"px",v.style.height=k+"px")}else if(r.scrollContainer)v.style.width="",v.style.height="",f=c.slides[0].getWidth(!0,r.roundLengths),m=c.slides[0].getHeight(!0,r.roundLengths),s=p?f:m,v.style.width=f+"px",v.style.height=m+"px",i=p?f:m;else{if(r.calculateHeight){for(d=0,m=0,p||(c.container.style.height=""),v.style.height="",g=0;g<c.slides.length;g++)c.slides[g].style.height="",d=Math.max(c.slides[g].getHeight(!0),d),p||(m+=c.slides[g].getHeight(!0));u=d,c.height=u,p?m=u:(l=u,c.container.style.height=l+"px")}else u=p?c.height:c.height/r.slidesPerView,r.roundLengths&&(u=Math.ceil(u)),m=p?c.height:c.slides.length*u;for(a=p?c.width/r.slidesPerView:c.width,r.roundLengths&&(a=Math.ceil(a)),f=p?c.slides.length*a:c.width,i=p?a:u,r.offsetSlidesBefore>0&&(p?c.wrapperLeft=i*r.offsetSlidesBefore:c.wrapperTop=i*r.offsetSlidesBefore),r.offsetSlidesAfter>0&&(p?c.wrapperRight=i*r.offsetSlidesAfter:c.wrapperBottom=i*r.offsetSlidesAfter),r.offsetPxBefore>0&&(p?c.wrapperLeft=r.offsetPxBefore:c.wrapperTop=r.offsetPxBefore),r.offsetPxAfter>0&&(p?c.wrapperRight=r.offsetPxAfter:c.wrapperBottom=r.offsetPxAfter),r.centeredSlides&&(p?(c.wrapperLeft=(l-i)/2,c.wrapperRight=(l-i)/2):(c.wrapperTop=(l-i)/2,c.wrapperBottom=(l-i)/2)),p?(c.wrapperLeft>0&&(v.style.paddingLeft=c.wrapperLeft+"px"),c.wrapperRight>0&&(v.style.paddingRight=c.wrapperRight+"px")):(c.wrapperTop>0&&(v.style.paddingTop=c.wrapperTop+"px"),c.wrapperBottom>0&&(v.style.paddingBottom=c.wrapperBottom+"px")),s=p?f+c.wrapperRight+c.wrapperLeft:m+c.wrapperTop+c.wrapperBottom,parseFloat(f)>0&&(!r.cssWidthAndHeight||"height"===r.cssWidthAndHeight)&&(v.style.width=f+"px"),parseFloat(m)>0&&(!r.cssWidthAndHeight||"width"===r.cssWidthAndHeight)&&(v.style.height=m+"px"),h=0,c.snapGrid=[],c.slidesGrid=[],g=0;g<c.slides.length;g++)c.snapGrid.push(h),c.slidesGrid.push(h),h+=i,parseFloat(a)>0&&(!r.cssWidthAndHeight||"height"===r.cssWidthAndHeight)&&(c.slides[g].style.width=a+"px"),parseFloat(u)>0&&(!r.cssWidthAndHeight||"width"===r.cssWidthAndHeight)&&(c.slides[g].style.height=u+"px")}c.initialized?(c.callPlugins("onInit"),r.onInit&&c.fireCallback(r.onInit,c)):(c.callPlugins("onFirstInit"),r.onFirstInit&&c.fireCallback(r.onFirstInit,c)),c.initialized=!0}},c.reInit=function(e){c.init(!0,e)},c.resizeFix=function(e){c.callPlugins("beforeResizeFix"),c.init(r.resizeReInit||e),r.freeMode?c.getWrapperTranslate()<-U()&&(c.setWrapperTransition(0),c.setWrapperTranslate(-U())):(c.swipeTo(r.loop?c.activeLoopIndex:c.activeIndex,0,!1),r.autoplay&&(c.support.transitions&&void 0!==E?void 0!==E&&(clearTimeout(E),E=void 0,c.startAutoplay()):void 0!==P&&(clearInterval(P),P=void 0,c.startAutoplay()))),c.callPlugins("afterResizeFix")},c.destroy=function(){var e=c.h.removeEventListener,t="wrapper"===r.eventTarget?c.wrapper:c.container;c.browser.ie10||c.browser.ie11?(e(t,c.touchEvents.touchStart,H),e(document,c.touchEvents.touchMove,q),e(document,c.touchEvents.touchEnd,G)):(c.support.touch&&(e(t,"touchstart",H),e(t,"touchmove",q),e(t,"touchend",G)),r.simulateTouch&&(e(t,"mousedown",H),e(document,"mousemove",q),e(document,"mouseup",G))),r.autoResize&&e(window,"resize",c.resizeFix),M(),r.paginationClickable&&W(),r.mousewheelControl&&c._wheelEvent&&e(c.container,c._wheelEvent,B),r.keyboardControl&&e(document,"keydown",N),r.autoplay&&c.stopAutoplay(),c.callPlugins("onDestroy"),c=null},c.disableKeyboardControl=function(){r.keyboardControl=!1,c.h.removeEventListener(document,"keydown",N)},c.enableKeyboardControl=function(){r.keyboardControl=!0,c.h.addEventListener(document,"keydown",N)};var y=(new Date).getTime();if(c.disableMousewheelControl=function(){return!!c._wheelEvent&&(r.mousewheelControl=!1,c.h.removeEventListener(c.container,c._wheelEvent,B),!0)},c.enableMousewheelControl=function(){return!!c._wheelEvent&&(r.mousewheelControl=!0,c.h.addEventListener(c.container,c._wheelEvent,B),!0)},r.grabCursor){var I=c.container.style;I.cursor="move",I.cursor="grab",I.cursor="-moz-grab",I.cursor="-webkit-grab"}c.allowSlideClick=!0,c.allowLinks=!0;var b,S,$,E,P,A=!1,T=!0;c.swipeNext=function(e){!e&&r.loop&&c.fixLoop(),!e&&r.autoplay&&c.stopAutoplay(!0),c.callPlugins("onSwipeNext");var t=c.getWrapperTranslate(),n=t;if("auto"===r.slidesPerView){for(var s=0;s<c.snapGrid.length;s++)if(-t>=c.snapGrid[s]&&-t<c.snapGrid[s+1]){n=-c.snapGrid[s+1];break}}else{var o=i*r.slidesPerGroup;n=-(Math.floor(Math.abs(t)/Math.floor(o))*o+o)}return n<-U()&&(n=-U()),n!==t&&(z(n,"next"),!0)},c.swipePrev=function(e){!e&&r.loop&&c.fixLoop(),!e&&r.autoplay&&c.stopAutoplay(!0),c.callPlugins("onSwipePrev");var t,n=Math.ceil(c.getWrapperTranslate());if("auto"===r.slidesPerView){t=0;for(var s=1;s<c.snapGrid.length;s++){if(-n===c.snapGrid[s]){t=-c.snapGrid[s-1];break}if(-n>c.snapGrid[s]&&-n<c.snapGrid[s+1]){t=-c.snapGrid[s];break}}}else{var o=i*r.slidesPerGroup;t=-(Math.ceil(-n/o)-1)*o}return t>0&&(t=0),t!==n&&(z(t,"prev"),!0)},c.swipeReset=function(){c.callPlugins("onSwipeReset");var e,t=c.getWrapperTranslate(),n=i*r.slidesPerGroup;U();if("auto"===r.slidesPerView){e=0;for(var s=0;s<c.snapGrid.length;s++){if(-t===c.snapGrid[s])return;if(-t>=c.snapGrid[s]&&-t<c.snapGrid[s+1]){e=c.positions.diff>0?-c.snapGrid[s+1]:-c.snapGrid[s];break}}-t>=c.snapGrid[c.snapGrid.length-1]&&(e=-c.snapGrid[c.snapGrid.length-1]),t<=-U()&&(e=-U())}else e=t<0?Math.round(t/n)*n:0,t<=-U()&&(e=-U());return r.scrollContainer&&(e=t<0?t:0),e<-U()&&(e=-U()),r.scrollContainer&&l>i&&(e=0),e!==t&&(z(e,"reset"),!0)},c.swipeTo=function(e,t,n){e=parseInt(e,10),c.callPlugins("onSwipeTo",{index:e,speed:t}),r.loop&&(e+=c.loopedSlides);var s,o=c.getWrapperTranslate();if(!(e>c.slides.length-1||e<0))return(s="auto"===r.slidesPerView?-c.slidesGrid[e]:-e*i)<-U()&&(s=-U()),s!==o&&(z(s,"to",{index:e,speed:t,runCallbacks:n=!1!==n}),!0)},c._queueStartCallbacks=!1,c._queueEndCallbacks=!1,c.updateActiveSlide=function(e){if(c.initialized&&0!==c.slides.length){var t;if(c.previousIndex=c.activeIndex,void 0===e&&(e=c.getWrapperTranslate()),e>0&&(e=0),"auto"===r.slidesPerView){if(c.activeIndex=c.slidesGrid.indexOf(-e),c.activeIndex<0){for(t=0;t<c.slidesGrid.length-1&&!(-e>c.slidesGrid[t]&&-e<c.slidesGrid[t+1]);t++);var n=Math.abs(c.slidesGrid[t]+e),s=Math.abs(c.slidesGrid[t+1]+e);c.activeIndex=n<=s?t:t+1}}else c.activeIndex=Math[r.visibilityFullFit?"ceil":"round"](-e/i);if(c.activeIndex===c.slides.length&&(c.activeIndex=c.slides.length-1),c.activeIndex<0&&(c.activeIndex=0),c.slides[c.activeIndex]){if(c.calcVisibleSlides(e),c.support.classList){var o;for(t=0;t<c.slides.length;t++)(o=c.slides[t]).classList.remove(r.slideActiveClass),c.visibleSlides.indexOf(o)>=0?o.classList.add(r.slideVisibleClass):o.classList.remove(r.slideVisibleClass);c.slides[c.activeIndex].classList.add(r.slideActiveClass)}else{var a=new RegExp("\\s*"+r.slideActiveClass),l=new RegExp("\\s*"+r.slideVisibleClass);for(t=0;t<c.slides.length;t++)c.slides[t].className=c.slides[t].className.replace(a,"").replace(l,""),c.visibleSlides.indexOf(c.slides[t])>=0&&(c.slides[t].className+=" "+r.slideVisibleClass);c.slides[c.activeIndex].className+=" "+r.slideActiveClass}if(r.loop){var u=c.loopedSlides;c.activeLoopIndex=c.activeIndex-u,c.activeLoopIndex>=c.slides.length-2*u&&(c.activeLoopIndex=c.slides.length-2*u-c.activeLoopIndex),c.activeLoopIndex<0&&(c.activeLoopIndex=c.slides.length-2*u+c.activeLoopIndex),c.activeLoopIndex<0&&(c.activeLoopIndex=0)}else c.activeLoopIndex=c.activeIndex;r.pagination&&c.updatePagination(e)}}},c.createPagination=function(e){if(r.paginationClickable&&c.paginationButtons&&W(),c.paginationContainer=r.pagination.nodeType?r.pagination:R(r.pagination)[0],r.createPagination){var t="",n=c.slides.length;r.loop&&(n-=2*c.loopedSlides);for(var i=0;i<n;i++)t+="<"+r.paginationElement+' class="'+r.paginationElementClass+'"></'+r.paginationElement+">";c.paginationContainer.innerHTML=t}c.paginationButtons=R("."+r.paginationElementClass,c.paginationContainer),e||c.updatePagination(),c.callPlugins("onCreatePagination"),r.paginationClickable&&function(){var e=c.paginationButtons;if(e)for(var r=0;r<e.length;r++)c.h.addEventListener(e[r],"click",K)}()},c.updatePagination=function(e){if(r.pagination&&(!(c.slides.length<1)&&R("."+r.paginationActiveClass,c.paginationContainer))){var t=c.paginationButtons;if(0!==t.length){for(var n=0;n<t.length;n++)t[n].className=r.paginationElementClass;var i=r.loop?c.loopedSlides:0;if(r.paginationAsRange){c.visibleSlides||c.calcVisibleSlides(e);var s,o=[];for(s=0;s<c.visibleSlides.length;s++){var a=c.slides.indexOf(c.visibleSlides[s])-i;r.loop&&a<0&&(a=c.slides.length-2*c.loopedSlides+a),r.loop&&a>=c.slides.length-2*c.loopedSlides&&(a=c.slides.length-2*c.loopedSlides-a,a=Math.abs(a)),o.push(a)}for(s=0;s<o.length;s++)t[o[s]]&&(t[o[s]].className+=" "+r.paginationVisibleClass);r.loop?void 0!==t[c.activeLoopIndex]&&(t[c.activeLoopIndex].className+=" "+r.paginationActiveClass):t[c.activeIndex].className+=" "+r.paginationActiveClass}else r.loop?t[c.activeLoopIndex]&&(t[c.activeLoopIndex].className+=" "+r.paginationActiveClass+" "+r.paginationVisibleClass):t[c.activeIndex].className+=" "+r.paginationActiveClass+" "+r.paginationVisibleClass}}},c.calcVisibleSlides=function(e){var t=[],n=0,s=0,o=0;p&&c.wrapperLeft>0&&(e+=c.wrapperLeft),!p&&c.wrapperTop>0&&(e+=c.wrapperTop);for(var a=0;a<c.slides.length;a++){o=(n+=s)+(s="auto"===r.slidesPerView?p?c.h.getWidth(c.slides[a],!0,r.roundLengths):c.h.getHeight(c.slides[a],!0,r.roundLengths):i);var u=!1;r.visibilityFullFit?(n>=-e&&o<=-e+l&&(u=!0),n<=-e&&o>=-e+l&&(u=!0)):(o>-e&&o<=-e+l&&(u=!0),n>=-e&&n<-e+l&&(u=!0),n<-e&&o>-e+l&&(u=!0)),u&&t.push(c.slides[a])}0===t.length&&(t=[c.slides[c.activeIndex]]),c.visibleSlides=t},c.startAutoplay=function(){if(c.support.transitions){if(void 0!==E)return!1;if(!r.autoplay)return;c.callPlugins("onAutoplayStart"),r.onAutoplayStart&&c.fireCallback(r.onAutoplayStart,c),Y()}else{if(void 0!==P)return!1;if(!r.autoplay)return;c.callPlugins("onAutoplayStart"),r.onAutoplayStart&&c.fireCallback(r.onAutoplayStart,c),P=setInterval(function(){r.loop?(c.fixLoop(),c.swipeNext(!0)):c.swipeNext(!0)||(r.autoplayStopOnLast?(clearInterval(P),P=void 0):c.swipeTo(0))},r.autoplay)}},c.stopAutoplay=function(e){if(c.support.transitions){if(!E)return;E&&clearTimeout(E),E=void 0,e&&!r.autoplayDisableOnInteraction&&c.wrapperTransitionEnd(function(){Y()}),c.callPlugins("onAutoplayStop"),r.onAutoplayStop&&c.fireCallback(r.onAutoplayStop,c)}else P&&clearInterval(P),P=void 0,c.callPlugins("onAutoplayStop"),r.onAutoplayStop&&c.fireCallback(r.onAutoplayStop,c)},c.loopCreated=!1,c.removeLoopedSlides=function(){if(c.loopCreated)for(var e=0;e<c.slides.length;e++)!0===c.slides[e].getData("looped")&&c.wrapper.removeChild(c.slides[e])},c.createLoop=function(){if(0!==c.slides.length){"auto"===r.slidesPerView?c.loopedSlides=r.loopedSlides||1:c.loopedSlides=r.slidesPerView+r.loopAdditionalSlides,c.loopedSlides>c.slides.length&&(c.loopedSlides=c.slides.length);var e,t="",i="",s="",o=c.slides.length,a=Math.floor(c.loopedSlides/o),l=c.loopedSlides%o;for(e=0;e<a*o;e++){var u=e;if(e>=o)u=e-o*Math.floor(e/o);s+=c.slides[u].outerHTML}for(e=0;e<l;e++)i+=V(r.slideDuplicateClass,c.slides[e].outerHTML);for(e=o-l;e<o;e++)t+=V(r.slideDuplicateClass,c.slides[e].outerHTML);var d=t+s+n.innerHTML+s+i;for(n.innerHTML=d,c.loopCreated=!0,c.calcSlides(),e=0;e<c.slides.length;e++)(e<c.loopedSlides||e>=c.slides.length-c.loopedSlides)&&c.slides[e].setData("looped",!0);c.callPlugins("onCreateLoop")}},c.fixLoop=function(){var e;c.activeIndex<c.loopedSlides?(e=c.slides.length-3*c.loopedSlides+c.activeIndex,c.swipeTo(e,0,!1)):("auto"===r.slidesPerView&&c.activeIndex>=2*c.loopedSlides||c.activeIndex>c.slides.length-2*r.slidesPerView)&&(e=-c.slides.length+c.activeIndex+c.loopedSlides,c.swipeTo(e,0,!1))},c.loadSlides=function(){var e="";c.activeLoaderIndex=0;for(var t=r.loader.slides,n=r.loader.loadAllSlides?t.length:r.slidesPerView*(1+r.loader.surroundGroups),i=0;i<n;i++)"outer"===r.loader.slidesHTMLType?e+=t[i]:e+="<"+r.slideElement+' class="'+r.slideClass+'" data-swiperindex="'+i+'">'+t[i]+"</"+r.slideElement+">";c.wrapper.innerHTML=e,c.calcSlides(!0),r.loader.loadAllSlides||c.wrapperTransitionEnd(c.reloadSlides,!0)},c.reloadSlides=function(){var e=r.loader.slides,t=parseInt(c.activeSlide().data("swiperindex"),10);if(!(t<0||t>e.length-1)){c.activeLoaderIndex=t;var n,s=Math.max(0,t-r.slidesPerView*r.loader.surroundGroups),o=Math.min(t+r.slidesPerView*(1+r.loader.surroundGroups)-1,e.length-1);if(t>0){var a=-i*(t-s);c.setWrapperTranslate(a),c.setWrapperTransition(0)}if("reload"===r.loader.logic){c.wrapper.innerHTML="";var l="";for(n=s;n<=o;n++)l+="outer"===r.loader.slidesHTMLType?e[n]:"<"+r.slideElement+' class="'+r.slideClass+'" data-swiperindex="'+n+'">'+e[n]+"</"+r.slideElement+">";c.wrapper.innerHTML=l}else{var u=1e3,d=0;for(n=0;n<c.slides.length;n++){var f=c.slides[n].data("swiperindex");f<s||f>o?c.wrapper.removeChild(c.slides[n]):(u=Math.min(f,u),d=Math.max(f,d))}for(n=s;n<=o;n++){var p;n<u&&((p=document.createElement(r.slideElement)).className=r.slideClass,p.setAttribute("data-swiperindex",n),p.innerHTML=e[n],c.wrapper.insertBefore(p,c.wrapper.firstChild)),n>d&&((p=document.createElement(r.slideElement)).className=r.slideClass,p.setAttribute("data-swiperindex",n),p.innerHTML=e[n],c.wrapper.appendChild(p))}}c.reInit(!0)}},c.calcSlides(),r.loader.slides.length>0&&0===c.slides.length&&c.loadSlides(),r.loop&&c.createLoop(),c.init(),function(){var e,t,n=c.h.addEventListener,i="wrapper"===r.eventTarget?c.wrapper:c.container;if(c.browser.ie10||c.browser.ie11?(n(i,c.touchEvents.touchStart,H),n(document,c.touchEvents.touchMove,q),n(document,c.touchEvents.touchEnd,G)):(c.support.touch&&(n(i,"touchstart",H),n(i,"touchmove",q),n(i,"touchend",G)),r.simulateTouch&&(n(i,"mousedown",H),n(document,"mousemove",q),n(document,"mouseup",G))),r.autoResize&&n(window,"resize",c.resizeFix),L(),c._wheelEvent=!1,r.mousewheelControl){if(void 0!==document.onmousewheel&&(c._wheelEvent="mousewheel"),!c._wheelEvent)try{new WheelEvent("wheel"),c._wheelEvent="wheel"}catch(e){}c._wheelEvent||(c._wheelEvent="DOMMouseScroll"),c._wheelEvent&&n(c.container,c._wheelEvent,B)}if(r.keyboardControl&&n(document,"keydown",N),r.updateOnImagesReady){c.imagesToLoad=R("img",c.container);for(var s=0;s<c.imagesToLoad.length;s++)e=c.imagesToLoad[s].getAttribute("src"),t=void 0,(t=new Image).onload=function(){void 0!==c&&null!==c&&(void 0!==c.imagesLoaded&&c.imagesLoaded++,c.imagesLoaded===c.imagesToLoad.length&&(c.reInit(),r.onImagesReady&&c.fireCallback(r.onImagesReady,c)))},t.src=e}}(),r.pagination&&c.createPagination(!0),r.loop||r.initialSlide>0?c.swipeTo(r.initialSlide,0,!1):c.updateActiveSlide(0),r.autoplay&&c.startAutoplay(),c.centerIndex=c.activeIndex,r.onSwiperCreated&&c.fireCallback(r.onSwiperCreated,c),c.callPlugins("onSwiperCreated")}function R(e,r){return document.querySelectorAll?(r||document).querySelectorAll(e):jQuery(e,r)}function U(){var e=s-l;return r.freeMode&&(e=s-l),r.slidesPerView>c.slides.length&&!r.centeredSlides&&(e=0),e<0&&(e=0),e}function L(){var e,t=c.h.addEventListener;if(r.preventLinks){var n=R("a",c.container);for(e=0;e<n.length;e++)t(n[e],"click",x)}if(r.releaseFormElements){var i=R("input, textarea, select",c.container);for(e=0;e<i.length;e++)t(i[e],c.touchEvents.touchStart,_,!0)}if(r.onSlideClick)for(e=0;e<c.slides.length;e++)t(c.slides[e],"click",F);if(r.onSlideTouch)for(e=0;e<c.slides.length;e++)t(c.slides[e],c.touchEvents.touchStart,O)}function M(){var e,t=c.h.removeEventListener;if(r.onSlideClick)for(e=0;e<c.slides.length;e++)t(c.slides[e],"click",F);if(r.onSlideTouch)for(e=0;e<c.slides.length;e++)t(c.slides[e],c.touchEvents.touchStart,O);if(r.releaseFormElements){var n=R("input, textarea, select",c.container);for(e=0;e<n.length;e++)t(n[e],c.touchEvents.touchStart,_,!0)}if(r.preventLinks){var i=R("a",c.container);for(e=0;e<i.length;e++)t(i[e],"click",x)}}function N(e){var r=e.keyCode||e.charCode;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)){if(37===r||39===r||38===r||40===r){for(var t=!1,n=c.h.getOffset(c.container),i=c.h.windowScroll().left,s=c.h.windowScroll().top,o=c.h.windowWidth(),a=c.h.windowHeight(),l=[[n.left,n.top],[n.left+c.width,n.top],[n.left,n.top+c.height],[n.left+c.width,n.top+c.height]],u=0;u<l.length;u++){var d=l[u];d[0]>=i&&d[0]<=i+o&&d[1]>=s&&d[1]<=s+a&&(t=!0)}if(!t)return}p?(37!==r&&39!==r||(e.preventDefault?e.preventDefault():e.returnValue=!1),39===r&&c.swipeNext(),37===r&&c.swipePrev()):(38!==r&&40!==r||(e.preventDefault?e.preventDefault():e.returnValue=!1),40===r&&c.swipeNext(),38===r&&c.swipePrev())}}function B(e){var t=c._wheelEvent,n=0;if(e.detail)n=-e.detail;else if("mousewheel"===t)if(r.mousewheelControlForceToAxis)if(p){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;n=e.wheelDeltaX}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;n=e.wheelDeltaY}else n=e.wheelDelta;else if("DOMMouseScroll"===t)n=-e.detail;else if("wheel"===t)if(r.mousewheelControlForceToAxis)if(p){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;n=-e.deltaX}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;n=-e.deltaY}else n=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(r.freeMode){var i=c.getWrapperTranslate()+n;if(i>0&&(i=0),i<-U()&&(i=-U()),c.setWrapperTransition(0),c.setWrapperTranslate(i),c.updateActiveSlide(i),0===i||i===-U())return}else(new Date).getTime()-y>60&&(n<0?c.swipeNext():c.swipePrev()),y=(new Date).getTime();return r.autoplay&&c.stopAutoplay(!0),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function F(e){c.allowSlideClick&&(D(e),c.fireCallback(r.onSlideClick,c,e))}function O(e){D(e),c.fireCallback(r.onSlideTouch,c,e)}function D(e){if(e.currentTarget)c.clickedSlide=e.currentTarget;else{var t=e.srcElement;do{if(t.className.indexOf(r.slideClass)>-1)break;t=t.parentNode}while(t);c.clickedSlide=t}c.clickedSlideIndex=c.slides.indexOf(c.clickedSlide),c.clickedSlideLoopIndex=c.clickedSlideIndex-(c.loopedSlides||0)}function x(e){if(!c.allowLinks)return e.preventDefault?e.preventDefault():e.returnValue=!1,r.preventLinksPropagation&&"stopPropagation"in e&&e.stopPropagation(),!1}function _(e){return e.stopPropagation?e.stopPropagation():e.returnValue=!1,!1}function H(e){if(r.preventLinks&&(c.allowLinks=!0),c.isTouched||r.onlyExternal)return!1;var t=e.target||e.srcElement;document.activeElement&&document.activeElement!==t&&document.activeElement.blur();var n="input select textarea".split(" ");if(r.noSwiping&&t&&function(e){var t=!1;do{e.className.indexOf(r.noSwipingClass)>-1&&(t=!0),e=e.parentElement}while(!t&&e.parentElement&&-1===e.className.indexOf(r.wrapperClass));!t&&e.className.indexOf(r.wrapperClass)>-1&&e.className.indexOf(r.noSwipingClass)>-1&&(t=!0);return t}(t))return!1;if(T=!1,c.isTouched=!0,!(A="touchstart"===e.type)&&"which"in e&&3===e.which)return!1;if(!A||1===e.targetTouches.length){c.callPlugins("onTouchStartBegin"),!A&&!c.isAndroid&&n.indexOf(t.tagName.toLowerCase())<0&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var i=A?e.targetTouches[0].pageX:e.pageX||e.clientX,s=A?e.targetTouches[0].pageY:e.pageY||e.clientY;c.touches.startX=c.touches.currentX=i,c.touches.startY=c.touches.currentY=s,c.touches.start=c.touches.current=p?i:s,c.setWrapperTransition(0),c.positions.start=c.positions.current=c.getWrapperTranslate(),c.setWrapperTranslate(c.positions.start),c.times.start=(new Date).getTime(),a=void 0,r.moveStartThreshold>0&&(b=!1),r.onTouchStart&&c.fireCallback(r.onTouchStart,c,e),c.callPlugins("onTouchStartEnd")}}function q(e){if(c.isTouched&&!r.onlyExternal&&(!A||"mousemove"!==e.type)){var t=A?e.targetTouches[0].pageX:e.pageX||e.clientX,n=A?e.targetTouches[0].pageY:e.pageY||e.clientY;if(void 0===a&&p&&(a=!!(a||Math.abs(n-c.touches.startY)>Math.abs(t-c.touches.startX))),void 0!==a||p||(a=!!(a||Math.abs(n-c.touches.startY)<Math.abs(t-c.touches.startX))),a)c.isTouched=!1;else{if(p){if(!r.swipeToNext&&t<c.touches.startX||!r.swipeToPrev&&t>c.touches.startX)return}else if(!r.swipeToNext&&n<c.touches.startY||!r.swipeToPrev&&n>c.touches.startY)return;if(e.assignedToSwiper)c.isTouched=!1;else if(e.assignedToSwiper=!0,r.preventLinks&&(c.allowLinks=!1),r.onSlideClick&&(c.allowSlideClick=!1),r.autoplay&&c.stopAutoplay(!0),!A||1===e.touches.length){var i;if(c.isMoved||(c.callPlugins("onTouchMoveStart"),r.loop&&(c.fixLoop(),c.positions.start=c.getWrapperTranslate()),r.onTouchMoveStart&&c.fireCallback(r.onTouchMoveStart,c)),c.isMoved=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,c.touches.current=p?t:n,c.positions.current=(c.touches.current-c.touches.start)*r.touchRatio+c.positions.start,c.positions.current>0&&r.onResistanceBefore&&c.fireCallback(r.onResistanceBefore,c,c.positions.current),c.positions.current<-U()&&r.onResistanceAfter&&c.fireCallback(r.onResistanceAfter,c,Math.abs(c.positions.current+U())),r.resistance&&"100%"!==r.resistance)if(c.positions.current>0&&(i=1-c.positions.current/l/2,c.positions.current=i<.5?l/2:c.positions.current*i),c.positions.current<-U()){var s=(c.touches.current-c.touches.start)*r.touchRatio+(U()+c.positions.start);i=(l+s)/l;var o=c.positions.current-s*(1-i)/2,u=-U()-l/2;c.positions.current=o<u||i<=0?u:o}if(r.resistance&&"100%"===r.resistance&&(c.positions.current>0&&(!r.freeMode||r.freeModeFluid)&&(c.positions.current=0),c.positions.current<-U()&&(!r.freeMode||r.freeModeFluid)&&(c.positions.current=-U())),!r.followFinger)return;if(r.moveStartThreshold)if(Math.abs(c.touches.current-c.touches.start)>r.moveStartThreshold||b){if(!b)return b=!0,void(c.touches.start=c.touches.current);c.setWrapperTranslate(c.positions.current)}else c.positions.current=c.positions.start;else c.setWrapperTranslate(c.positions.current);return(r.freeMode||r.watchActiveIndex)&&c.updateActiveSlide(c.positions.current),r.grabCursor&&(c.container.style.cursor="move",c.container.style.cursor="grabbing",c.container.style.cursor="-moz-grabbin",c.container.style.cursor="-webkit-grabbing"),S||(S=c.touches.current),$||($=(new Date).getTime()),c.velocity=(c.touches.current-S)/((new Date).getTime()-$)/2,Math.abs(c.touches.current-S)<2&&(c.velocity=0),S=c.touches.current,$=(new Date).getTime(),c.callPlugins("onTouchMoveEnd"),r.onTouchMove&&c.fireCallback(r.onTouchMove,c,e),!1}}}}function G(e){if(a&&c.swipeReset(),!r.onlyExternal&&c.isTouched){c.isTouched=!1,r.grabCursor&&(c.container.style.cursor="move",c.container.style.cursor="grab",c.container.style.cursor="-moz-grab",c.container.style.cursor="-webkit-grab"),c.positions.current||0===c.positions.current||(c.positions.current=c.positions.start),r.followFinger&&c.setWrapperTranslate(c.positions.current),c.times.end=(new Date).getTime(),c.touches.diff=c.touches.current-c.touches.start,c.touches.abs=Math.abs(c.touches.diff),c.positions.diff=c.positions.current-c.positions.start,c.positions.abs=Math.abs(c.positions.diff);var t=c.positions.diff,n=c.positions.abs,s=c.times.end-c.times.start;n<5&&s<300&&!1===c.allowLinks&&(r.freeMode||0===n||c.swipeReset(),r.preventLinks&&(c.allowLinks=!0),r.onSlideClick&&(c.allowSlideClick=!0)),setTimeout(function(){void 0!==c&&null!==c&&(r.preventLinks&&(c.allowLinks=!0),r.onSlideClick&&(c.allowSlideClick=!0))},100);var u=U();if(!c.isMoved&&r.freeMode)return c.isMoved=!1,r.onTouchEnd&&c.fireCallback(r.onTouchEnd,c,e),void c.callPlugins("onTouchEnd");if(!c.isMoved||c.positions.current>0||c.positions.current<-u)return c.swipeReset(),r.onTouchEnd&&c.fireCallback(r.onTouchEnd,c,e),void c.callPlugins("onTouchEnd");if(c.isMoved=!1,r.freeMode){if(r.freeModeFluid){var d,f=1e3*r.momentumRatio,m=c.velocity*f,h=c.positions.current+m,g=!1,v=20*Math.abs(c.velocity)*r.momentumBounceRatio;h<-u&&(r.momentumBounce&&c.support.transitions?(h+u<-v&&(h=-u-v),d=-u,g=!0,T=!0):h=-u),h>0&&(r.momentumBounce&&c.support.transitions?(h>v&&(h=v),d=0,g=!0,T=!0):h=0),0!==c.velocity&&(f=Math.abs((h-c.positions.current)/c.velocity)),c.setWrapperTranslate(h),c.setWrapperTransition(f),r.momentumBounce&&g&&c.wrapperTransitionEnd(function(){T&&(r.onMomentumBounce&&c.fireCallback(r.onMomentumBounce,c),c.callPlugins("onMomentumBounce"),c.setWrapperTranslate(d),c.setWrapperTransition(300))}),c.updateActiveSlide(h)}return(!r.freeModeFluid||s>=300)&&c.updateActiveSlide(c.positions.current),r.onTouchEnd&&c.fireCallback(r.onTouchEnd,c,e),void c.callPlugins("onTouchEnd")}"toNext"===(o=t<0?"toNext":"toPrev")&&s<=300&&(n<30||!r.shortSwipes?c.swipeReset():c.swipeNext(!0)),"toPrev"===o&&s<=300&&(n<30||!r.shortSwipes?c.swipeReset():c.swipePrev(!0));var C=0;if("auto"===r.slidesPerView){for(var k,w=Math.abs(c.getWrapperTranslate()),y=0,I=0;I<c.slides.length;I++)if((y+=k=p?c.slides[I].getWidth(!0,r.roundLengths):c.slides[I].getHeight(!0,r.roundLengths))>w){C=k;break}C>l&&(C=l)}else C=i*r.slidesPerView;"toNext"===o&&s>300&&(n>=C*r.longSwipesRatio?c.swipeNext(!0):c.swipeReset()),"toPrev"===o&&s>300&&(n>=C*r.longSwipesRatio?c.swipePrev(!0):c.swipeReset()),r.onTouchEnd&&c.fireCallback(r.onTouchEnd,c,e),c.callPlugins("onTouchEnd")}}function V(e,r){var t,n=document.createElement("div");return n.innerHTML=r,(t=n.firstChild).className+=" "+e,t.outerHTML}function z(e,t,n){var i="to"===t&&n.speed>=0?n.speed:r.speed,s=+new Date;if(c.support.transitions||!r.DOMAnimation)c.setWrapperTranslate(e),c.setWrapperTransition(i);else{var o=c.getWrapperTranslate(),a=Math.ceil((e-o)/i*(1e3/60)),l=o>e?"toNext":"toPrev";if(c._DOMAnimating)return;!function i(){var u=+new Date;o+=a*(u-s)/(1e3/60),("toNext"===l?o>e:o<e)?(c.setWrapperTranslate(Math.ceil(o)),c._DOMAnimating=!0,window.setTimeout(function(){i()},1e3/60)):(r.onSlideChangeEnd&&("to"===t?!0===n.runCallbacks&&c.fireCallback(r.onSlideChangeEnd,c,l):c.fireCallback(r.onSlideChangeEnd,c,l)),c.setWrapperTranslate(e),c._DOMAnimating=!1)}()}c.updateActiveSlide(e),r.onSlideNext&&"next"===t&&c.fireCallback(r.onSlideNext,c,e),r.onSlidePrev&&"prev"===t&&c.fireCallback(r.onSlidePrev,c,e),r.onSlideReset&&"reset"===t&&c.fireCallback(r.onSlideReset,c,e),("next"===t||"prev"===t||"to"===t&&!0===n.runCallbacks)&&function(e){if(c.callPlugins("onSlideChangeStart"),r.onSlideChangeStart)if(r.queueStartCallbacks&&c.support.transitions){if(c._queueStartCallbacks)return;c._queueStartCallbacks=!0,c.fireCallback(r.onSlideChangeStart,c,e),c.wrapperTransitionEnd(function(){c._queueStartCallbacks=!1})}else c.fireCallback(r.onSlideChangeStart,c,e);if(r.onSlideChangeEnd)if(c.support.transitions)if(r.queueEndCallbacks){if(c._queueEndCallbacks)return;c._queueEndCallbacks=!0,c.wrapperTransitionEnd(function(t){c.fireCallback(r.onSlideChangeEnd,t,e)})}else c.wrapperTransitionEnd(function(t){c.fireCallback(r.onSlideChangeEnd,t,e)});else r.DOMAnimation||setTimeout(function(){c.fireCallback(r.onSlideChangeEnd,c,e)},10)}(t)}function W(){var e=c.paginationButtons;if(e)for(var r=0;r<e.length;r++)c.h.removeEventListener(e[r],"click",K)}function K(e){for(var t,n=e.target||e.srcElement,i=c.paginationButtons,s=0;s<i.length;s++)n===i[s]&&(t=s);r.autoplay&&c.stopAutoplay(!0),c.swipeTo(t)}function Y(){E=setTimeout(function(){r.loop?(c.fixLoop(),c.swipeNext(!0)):c.swipeNext(!0)||(r.autoplayStopOnLast?(clearTimeout(E),E=void 0):c.swipeTo(0)),c.wrapperTransitionEnd(function(){void 0!==E&&Y()})},r.autoplay)}};Swiper.prototype={plugins:{},wrapperTransitionEnd:function(e,r){"use strict";var t,n=this,i=n.wrapper,s=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"];function o(a){if(a.target===i&&(e(n),n.params.queueEndCallbacks&&(n._queueEndCallbacks=!1),!r))for(t=0;t<s.length;t++)n.h.removeEventListener(i,s[t],o)}if(e)for(t=0;t<s.length;t++)n.h.addEventListener(i,s[t],o)},getWrapperTranslate:function(e){"use strict";var r,t,n,i,s=this.wrapper;return void 0===e&&(e="horizontal"===this.params.mode?"x":"y"),this.support.transforms&&this.params.useCSS3Transforms?(n=window.getComputedStyle(s,null),window.WebKitCSSMatrix?i=new WebKitCSSMatrix("none"===n.webkitTransform?"":n.webkitTransform):r=(i=n.MozTransform||n.OTransform||n.MsTransform||n.msTransform||n.transform||n.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,")).toString().split(","),"x"===e&&(t=window.WebKitCSSMatrix?i.m41:16===r.length?parseFloat(r[12]):parseFloat(r[4])),"y"===e&&(t=window.WebKitCSSMatrix?i.m42:16===r.length?parseFloat(r[13]):parseFloat(r[5]))):("x"===e&&(t=parseFloat(s.style.left,10)||0),"y"===e&&(t=parseFloat(s.style.top,10)||0)),t||0},setWrapperTranslate:function(e,r,t){"use strict";var n,i=this.wrapper.style,s={x:0,y:0,z:0};3===arguments.length?(s.x=e,s.y=r,s.z=t):(void 0===r&&(r="horizontal"===this.params.mode?"x":"y"),s[r]=e),this.support.transforms&&this.params.useCSS3Transforms?(n=this.support.transforms3d?"translate3d("+s.x+"px, "+s.y+"px, "+s.z+"px)":"translate("+s.x+"px, "+s.y+"px)",i.webkitTransform=i.MsTransform=i.msTransform=i.MozTransform=i.OTransform=i.transform=n):(i.left=s.x+"px",i.top=s.y+"px"),this.callPlugins("onSetWrapperTransform",s),this.params.onSetWrapperTransform&&this.fireCallback(this.params.onSetWrapperTransform,this,s)},setWrapperTransition:function(e){"use strict";var r=this.wrapper.style;r.webkitTransitionDuration=r.MsTransitionDuration=r.msTransitionDuration=r.MozTransitionDuration=r.OTransitionDuration=r.transitionDuration=e/1e3+"s",this.callPlugins("onSetWrapperTransition",{duration:e}),this.params.onSetWrapperTransition&&this.fireCallback(this.params.onSetWrapperTransition,this,e)},h:{getWidth:function(e,r,t){"use strict";var n=window.getComputedStyle(e,null).getPropertyValue("width"),i=parseFloat(n);return(isNaN(i)||n.indexOf("%")>0||i<0)&&(i=e.offsetWidth-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))),r&&(i+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))),t?Math.ceil(i):i},getHeight:function(e,r,t){"use strict";if(r)return e.offsetHeight;var n=window.getComputedStyle(e,null).getPropertyValue("height"),i=parseFloat(n);return(isNaN(i)||n.indexOf("%")>0||i<0)&&(i=e.offsetHeight-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))),r&&(i+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))),t?Math.ceil(i):i},getOffset:function(e){"use strict";var r=e.getBoundingClientRect(),t=document.body,n=e.clientTop||t.clientTop||0,i=e.clientLeft||t.clientLeft||0,s=window.pageYOffset||e.scrollTop,o=window.pageXOffset||e.scrollLeft;return document.documentElement&&!window.pageYOffset&&(s=document.documentElement.scrollTop,o=document.documentElement.scrollLeft),{top:r.top+s-n,left:r.left+o-i}},windowWidth:function(){"use strict";return window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:void 0},windowHeight:function(){"use strict";return window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:void 0},windowScroll:function(){"use strict";return"undefined"!=typeof pageYOffset?{left:window.pageXOffset,top:window.pageYOffset}:document.documentElement?{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}:void 0},addEventListener:function(e,r,t,n){"use strict";void 0===n&&(n=!1),e.addEventListener?e.addEventListener(r,t,n):e.attachEvent&&e.attachEvent("on"+r,t)},removeEventListener:function(e,r,t,n){"use strict";void 0===n&&(n=!1),e.removeEventListener?e.removeEventListener(r,t,n):e.detachEvent&&e.detachEvent("on"+r,t)}},setTransform:function(e,r){"use strict";var t=e.style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=r},setTranslate:function(e,r){"use strict";var t=e.style,n=r.x||0,i=r.y||0,s=r.z||0,o=this.support.transforms3d?"translate3d("+n+"px,"+i+"px,"+s+"px)":"translate("+n+"px,"+i+"px)";t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=o,this.support.transforms||(t.left=n+"px",t.top=i+"px")},setTransition:function(e,r){"use strict";var t=e.style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=r+"ms"},support:{touch:window.Modernizr&&!0===Modernizr.touch||function(){"use strict";return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&!0===Modernizr.csstransforms3d||function(){"use strict";var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),transforms:window.Modernizr&&!0===Modernizr.csstransforms||function(){"use strict";var e=document.createElement("div").style;return"transform"in e||"WebkitTransform"in e||"MozTransform"in e||"msTransform"in e||"MsTransform"in e||"OTransform"in e}(),transitions:window.Modernizr&&!0===Modernizr.csstransitions||function(){"use strict";var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"MsTransition"in e||"OTransition"in e}(),classList:function(){"use strict";return"classList"in document.createElement("div")}()},browser:{ie8:function(){"use strict";var e=-1;if("Microsoft Internet Explorer"===navigator.appName){var r=navigator.userAgent;null!==new RegExp(/MSIE ([0-9]{1,}[\.0-9]{0,})/).exec(r)&&(e=parseFloat(RegExp.$1))}return-1!==e&&e<9}(),ie10:window.navigator.msPointerEnabled,ie11:window.navigator.pointerEnabled}},(window.jQuery||window.Zepto)&&function(e){"use strict";e.fn.swiper=function(r){var t;return this.each(function(n){var i=e(this);if(!i.data("swiper")){var s=new Swiper(i[0],r);n||(t=s),i.data("swiper",s)}}),t}}(window.jQuery||window.Zepto),"undefined"!=typeof module&&(module.exports=Swiper),"function"==typeof define&&define.amd&&define([],function(){"use strict";return Swiper}),angular.module("swiper",[]).value("swiperCount",0).directive("swiper",["$timeout","swiperCount",function(e,r){return{link:function(t,n,i){var s;t.$watch("images",function(){angular.isDefined(t.images)&&angular.isUndefined(s)&&(t.swiperContainer="swiper-"+r++,e(function(){s=new Swiper("#"+t.swiperContainer,{calculateHeight:!0,resizeReInit:!0,pagination:".swiper-pagination",paginationClickable:!0});var e=document.getElementById(t.swiperContainer).getElementsByTagName("img");if(e.length>0){var r=new Image;r.onload=function(){angular.element(document.getElementById(t.swiperContainer)).css("opacity",1)},r.src=e[0].src}},0,!1))}),t.prev=function(){s.swipePrev()},t.next=function(){s.swipeNext()}},template:'<div class="swiper-container" id="{{swiperContainer}}"><div class="swiper-wrapper"><div class="swiper-slide" ng-repeat="image in images"><img ng-src="{{image}}"></div></div><div class="swiper-pagination" ng-show="images.length > 1"></div><div class="swiper-prev" ng-show="images.length > 1" ng-click="prev()"><span class="fa fa-chevron-left"></span></div><div class="swiper-next" ng-show="images.length > 1" ng-click="next()"><span class="fa fa-chevron-right"></span></div></div>',restrict:"E",scope:{images:"="}}}]),angular.module("ui.bootstrap.alert",[]).controller("UibAlertController",["$scope","$attrs","$interpolate","$timeout",function(e,r,t,n){e.closeable=!!r.close;var i=angular.isDefined(r.dismissOnTimeout)?t(r.dismissOnTimeout)(e.$parent):null;i&&n(function(){e.close()},parseInt(i,10))}]).directive("uibAlert",function(){return{controller:"UibAlertController",controllerAs:"alert",template:'<div class="alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissible\' : null]" role="alert"><button ng-show="closeable" type="button" class="close" ng-click="close({$event: $event})"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><div ng-transclude></div></div>',transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}),angular.module("ui.bootstrap.tabs",[]).controller("UibTabsetController",["$scope",function(e){var r,t,n=this;function i(e){for(var r=0;r<n.tabs.length;r++)if(n.tabs[r].index===e)return r}n.tabs=[],n.select=function(e,s){if(!t){var o=i(r),a=n.tabs[o];if(a){if(a.tab.onDeselect({$event:s,$selectedIndex:e}),s&&s.isDefaultPrevented())return;a.tab.active=!1}var l=n.tabs[e];l?(l.tab.onSelect({$event:s}),l.tab.active=!0,n.active=l.index,r=l.index):!l&&angular.isDefined(r)&&(n.active=null,r=null)}},n.addTab=function(e){if(n.tabs.push({tab:e,index:e.index}),n.tabs.sort(function(e,r){return e.index>r.index?1:e.index<r.index?-1:0}),e.index===n.active||!angular.isDefined(n.active)&&1===n.tabs.length){var r=i(e.index);n.select(r)}},n.removeTab=function(e){for(var r,t=0;t<n.tabs.length;t++)if(n.tabs[t].tab===e){r=t;break}if(n.tabs[r].index===n.active){var i=r===n.tabs.length-1?r-1:r+1%n.tabs.length;n.select(i)}n.tabs.splice(r,1)},e.$watch("tabset.active",function(e){angular.isDefined(e)&&e!==r&&n.select(i(e))}),e.$on("$destroy",function(){t=!0})}]).directive("uibTabset",function(){return{transclude:!0,replace:!0,scope:{},bindToController:{active:"=?",type:"@"},controller:"UibTabsetController",controllerAs:"tabset",template:'<div><ul class="nav nav-{{tabset.type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul><div class="tab-content"><div class="tab-pane" ng-repeat="tab in tabset.tabs" ng-class="{active: tabset.active === tab.index}" uib-tab-content-transclude="tab"></div></div></div>',link:function(e,r,t){e.vertical=!!angular.isDefined(t.vertical)&&e.$parent.$eval(t.vertical),e.justified=!!angular.isDefined(t.justified)&&e.$parent.$eval(t.justified)}}}).directive("uibTab",["$parse",function(e){return{require:"^uibTabset",replace:!0,template:'<li ng-class="[{active: active, disabled: disabled}, classes]" class="uib-tab nav-item"><a href ng-click="select($event)" class="nav-link" uib-tab-heading-transclude>{{heading}}</a></li>',transclude:!0,scope:{heading:"@",index:"=?",classes:"@?",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},controllerAs:"tab",link:function(r,t,n,i,s){r.disabled=!1,n.disable&&r.$parent.$watch(e(n.disable),function(e){r.disabled=!!e}),angular.isUndefined(n.index)&&(i.tabs&&i.tabs.length?r.index=Math.max.apply(null,i.tabs.map(function(e){return e.index}))+1:r.index=0),angular.isUndefined(n.classes)&&(r.classes=""),r.select=function(e){if(!r.disabled){for(var t,n=0;n<i.tabs.length;n++)if(i.tabs[n].tab===r){t=n;break}i.select(t,e)}},i.addTab(r),r.$on("$destroy",function(){i.removeTab(r)}),r.$transcludeFn=s}}}]).directive("uibTabHeadingTransclude",function(){return{restrict:"A",require:"^uibTab",link:function(e,r){e.$watch("headingElement",function(e){e&&(r.html(""),r.append(e))})}}}).directive("uibTabContentTransclude",function(){return{restrict:"A",require:"^uibTabset",link:function(e,r,t){var n=e.$eval(t.uibTabContentTransclude).tab;n.$transcludeFn(n.$parent,function(e){angular.forEach(e,function(e){var t;(t=e).tagName&&(t.hasAttribute("uib-tab-heading")||t.hasAttribute("data-uib-tab-heading")||t.hasAttribute("x-uib-tab-heading")||"uib-tab-heading"===t.tagName.toLowerCase()||"data-uib-tab-heading"===t.tagName.toLowerCase()||"x-uib-tab-heading"===t.tagName.toLowerCase()||"uib:tab-heading"===t.tagName.toLowerCase())?n.headingElement=e:r.append(e)})})}}}),angular.module("deskworks.dashboard.dashWidgetBody",[]).directive("dashWidgetBody",function(){"use strict";return{restrict:"EAC",scope:!1,compile:function(e,r){return e.addClass("dash-widget-body"),function(e,r,t){}}}}),angular.module("deskworks.dashboard.dashWidgetHeader",[]).directive("dashWidgetHeader",function(){"use strict";return{restrict:"EAC",scope:!1,compile:function(e,r){return e.addClass("dash-widget-header"),function(e,r,t){}}}}),angular.module("deskworks.dashboard.dashWidget",["deskworks.dashboard.dashWidgetHeader","deskworks.dashboard.dashWidgetBody"]).directive("dashWidget",function(){"use strict";return{restrict:"E",scope:!0,compile:function(e,r){var t=angular.element('<div class="dash-widget-inner"></div>').append(e.html());return e.empty().append(t),e.addClass("dash-widget"),t.append('<ff-row ff-dim="true" class="dash-widget-spin"><ff-static></ff-static></ff-row>'),function(r,t){angular.element(e[0].querySelector(".dash-widget-body")).css("display","none"),r.$on("dwWidget:SpinStop",function(){angular.element(t[0].querySelector(".dash-widget-spin")).css("display","none"),angular.element(t[0].querySelector(".dash-widget-body")).css("display","block")})}}}}),angular.module("deskworks.dashboard.dashAdminAccessCode",[]).directive("dashAdminAccessCode",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-access-code.tpl.html",controller:"DashAdminAccessCodeCtrl as $ctrl",bindToController:{stats:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminAccessCodeCtrl",["state",function(e){"use strict";this.toAccessCode=function(){return e.setPath("/access-code-of-the-day")}}]),angular.module("deskworks.dashboard.dashAdminBilling",[]).directive("dashAdminBilling",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-billing.tpl.html",controller:"DashAdminBillingCtrl as $ctrl",bindToController:{stats:"<",settings:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminBillingCtrl",["$scope","state","helper",function(e,r,t){"use strict";var n=this;e.helper=t,n.toBillingProfile=function(e){return r.setCurrentUserId(e.userId),r.setPath("/billing-profiles")},n.toIncomeReport=function(){return r.setPath(n.settings&&"accrual"===n.settings.dashboardIncome?"/income-by-item-report":"/income-report")},n.toAccountsReceivableReport=function(){return r.setPath("/accounts-receivable-report")}}]),angular.module("deskworks.dashboard.dashAdminReservationConflicts",["deskworks.dashboard.service"]).directive("dashAdminReservationConflicts",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-reservation-conflicts.tpl.html",controller:"DashAdminReservationConflictsCtrl as $ctrl",bindToController:{reservations:"<",label:"@"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminReservationConflictsCtrl",["$scope","$filter","state","helper","dwAlerts","dashboardService",function(e,r,t,n,i,s){"use strict";var o=this;e.helper=n,o.navigate=function(e){return t.setParam("date",r("date")(e.startTime,"yyyy-MM-dd")),t.setPath("/reservation-calendar")},o.reset=function(e){return s.resetReservationConflict(e.id).catch(function(e){return i.error(e,"Failed to reset reservation conflict.")}).then(function(){o.reservations.splice(o.reservations.indexOf(e),1)})}}]),angular.module("deskworks.dashboard.dashAdminReservations",[]).directive("dashAdminReservations",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-reservations.tpl.html",controller:"DashAdminReservationsCtrl as $ctrl",bindToController:{reservations:"<",label:"@",settings:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminReservationsCtrl",["$scope","$filter","state","helper",function(e,r,t,n){"use strict";e.helper=n,this.navigate=function(e){return t.setParam("date",r("date")(e.startTime,"yyyy-MM-ddTHH:mm:ss")),t.setPath("/reservation-calendar")}}]),angular.module("deskworks.dashboard.dashAdminSelfRegistrations",[]).directive("dashAdminSelfRegistrations",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-self-registrations.tpl.html",controller:"DashAdminSelfRegistrationsCtrl as $ctrl",bindToController:{users:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminSelfRegistrationsCtrl",["$scope","state","helper",function(e,r,t){"use strict";e.helper=t,this.navigate=function(e){return r.setCurrentUserId(e.id),r.setPath("/profile")}}]),angular.module("deskworks.dashboard.dashAdminUsersCheckedIn",["deskworks.userRoles","deskworks.CheckedInUsers"]).directive("dashAdminUsersCheckedIn",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-admin/dash-admin-users-checked-in.tpl.html",controller:"DashAdminUsersCheckedInCtrl as $ctrl",bindToController:{nats:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashAdminUsersCheckedInCtrl",["$scope","$timeout","dwAlerts","state","helper","userRoles","CheckedInUsers",function(e,r,t,n,i,s,o){"use strict";var a=this;e.helper=i,e.userRoles=s;var l=[];function c(e){if(a.users){var r=i.findIndex(a.users,e.id);return e.devices<=0&&r>=0?a.users.splice(r,1):e.devices>0&&r>=0?angular.extend(a.users[r],e):e.devices>0&&r<0?a.users.push(e):void 0}}a.$onInit=function(){o.query(n.getCurrentCenterId()).catch(function(e){return t.error(e,"Failed to query checked-in users.")}).then(function(t){a.users=t,l.push(a.nats.subscribe("API.:siteId.centers.:centerId.checked-in-users.*",c)),r(function(){e.$broadcast("dwWidget:SpinStop")})})},a.$onDestroy=function(){l.forEach(function(e){a.nats.unsubscribe(e)})},a.toUserProfile=function(e){return n.setCurrentUserId(e.id),n.setPath("/profile")}}]),angular.module("deskworks.dashboard.dashGeneral",["deskworks.memberUsageService","deskworks.setup.service"]).directive("dashGeneral",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-general.tpl.html",controller:"DashGeneralCtrl as $ctrl",bindToController:{settings:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashGeneralCtrl",["$scope","$q","$filter","state","helper","dwAlerts","productService","userProfileService","memberUsageService",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;c.$onInit=function(){var u=a.get(n.getCurrentCenterId(),n.getCurrentUserId()).then(function(e){c.user=e,angular.forEach(c.user.creditCards,function(e){if(e.defaultPaymentMethod){c.defaultPaymentMethod=e;var r=t("toDate")(c.defaultPaymentMethod.expiry);r-moment()<2592e6&&(r-moment()>=0?c.showExpireWarning=!0:c.showExpiredWarning=!0,e.expiry=t("date")(r,"mediumDate"))}})}).catch(function(e){return s.error(e,"Failed to load user profile.")}),d=l.query(n.getCurrentCenterId(),n.getCurrentUserId(),1,1).catch(function(e){return s.error(e,"Failed to query member usages.")}),f=o.getProducts().catch(function(e){return s.error(e,"Failed to query products.")});r.all([d,f]).then(function(e){c.closingBalance=e[0].days.length&&e[0].days[0].closingBalance||[],c.closingBalance.forEach(function(r){r.productName=(i.findByKeyValue(e[1],"id",r.productId)||{}).name,r.amount=t("hours")(r.hours)||t("ncurrency")(r.amount)})}),r.all([u,d,f]).finally(function(){e.$broadcast("dwWidget:SpinStop")})}}]),angular.module("deskworks.dashboard.dashMembersCheckedIn",["dwModal","deskworks.CheckedInMembers","deskworks.OurMemberModalCtrl"]).directive("dashMembersCheckedIn",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-members-checked-in.tpl.html",controller:"DashMembersCheckedInCtrl as $ctrl",bindToController:{nats:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashMembersCheckedInCtrl",["$scope","$timeout","state","helper","dwAlerts","dwModal","CheckedInMembers",function(e,r,t,n,i,s,o){"use strict";var a=this;e.helper=n;var l=[];function c(e){if(a.users){var r=n.find(a.users,e.id);if(r)return angular.extend(r,e);a.users.push(e)}}function u(e){if(a.users){var r=n.findIndex(a.users,e.id);r>=0&&a.users.splice(r,1)}}a.$onInit=function(){o.query(t.getCurrentCenterId()).finally(function(){e.$broadcast("dwWidget:SpinStop")}).catch(function(e){return i.error(e,"Failed to query checked-in members.")}).then(function(e){a.users=e,l.push(a.nats.subscribe("API.:siteId.centers.:centerId.checked-in-members.create",c)),l.push(a.nats.subscribe("API.:siteId.centers.:centerId.checked-in-members.delete",u))})},a.$onDestroy=function(){l.forEach(function(e){a.nats.unsubscribe(e)})},a.view=function(r){s.show({scope:e,templateUrl:"members/our-members/our-member-modal.tpl.html",controller:"OurMemberModalCtrl",inputs:{member:r}})}}]),angular.module("deskworks.dashboard.dashMessageBoard",["deskworks.MessageBoard"]).directive("dashMessageBoard",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-message-board.tpl.html",controller:"DashMessageBoardCtrl as $ctrl",bindToController:{nats:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashMessageBoardCtrl",["$scope","$timeout","dwAlerts","state","helper","MessageBoard",function(e,r,t,n,i,s){"use strict";var o=this,a=[],l=10,c=140;function u(e){return e.text.length>c&&(e.text=e.text.substr(0,c),e.crop=!0),e}function d(e){u(e=s.deserialize(e));var r=i.find(o.messages,e.id);if(r)return angular.extend(r,e);o.messages.unshift(e),o.messages.length>l&&o.messages.splice(l,o.messages.length-l)}function f(e){u(e);var r=i.find(o.messages,e.id);if(r)return angular.extend(r,e)}function p(e){var r=i.findIndex(o.messages,e.id);r>=0&&o.messages.splice(r,1)}o.$onInit=function(){s.query({centerId:n.getCurrentCenterId(),limit:10}).finally(function(){e.$broadcast("dwWidget:SpinStop")}).catch(function(e){return t.error(e,"Failed to query messages.")}).then(function(e){o.messages=e.map(u),a.length||(a.push(o.nats.subscribe("API.:siteId.centers.:centerId.message-board.messages.create",d)),a.push(o.nats.subscribe("API.:siteId.centers.:centerId.message-board.messages.update",f)),a.push(o.nats.subscribe("API.:siteId.centers.:centerId.message-board.messages.delete",p)))})},o.toMsg=function(e){return n.setPath("/message-board")}}]),angular.module("deskworks.dashboard.dashMobileApp",[]).directive("dashMobileApp",["$window","helper",function(e,r){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-mobile-app.tpl.html",controller:"DashMobileAppCtrl as $ctrl",link:function(t,n,i,s,o){var a=this,l=e.bowser;s.text="DASHBOARD.USER.WEB_APP.BODY",l.ios&&l.safari&&l.version?(s.text="DASHBOARD.USER.WEB_APP.BODY.IOS",s.icon='<svg class="ios-share" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.5 26"><defs><style>.cls-1{fill:#147aff;}</style></defs><polygon class="cls-1" points="11.68 7.5 11.68 8.48 17.52 8.48 17.52 25.03 0.97 25.03 0.97 8.48 6.82 8.48 6.82 7.5 0 7.5 0 8.48 0 25.03 0 26 0.97 26 17.52 26 18.01 26 18.5 26 18.5 8.48 18.5 7.5 11.68 7.5"/><polygon class="cls-1" points="8.76 1.86 8.76 16.75 9.73 16.75 9.73 1.86 13.29 5.41 13.97 4.72 9.25 0 4.52 4.72 5.21 5.41 8.76 1.86"/></svg>'):l.android&&l.firefox?s.icon='<svg class="home-plus" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 67.04 64.59"><path d="M58,32.15c0,7.25.11,14.5,0,21.75,0,4.44-.28,5.74-3.13,8.33-2.31,2.1-4.75,2.61-9,2.61-7.28,0-14.19,0-21.69,0s-9.26-.62-12-3a9.24,9.24,0,0,1-3.13-7.24C9.16,48.34,9,39.75,9,32.94c-1.25,1.25-2.53,2.53-3.35,3.21a3.89,3.89,0,0,1-4.46-.07,3.74,3.74,0,0,1-.43-4.83c0.44-.69,19.59-19.67,28.78-28.84,2.88-2.88,5-2.89,7.87-.06,9.31,9.28,28.27,28.53,29,29.41a2.93,2.93,0,0,1-.39,4.09,3.4,3.4,0,0,1-4.68-.06c-1.11-1-2.28-2.58-3.37-3.64h0ZM18.42,23.4c-1.92,1.89-2.19,2.44-2.19,5.19,0,7.31-.06,24.58.06,25.39,0.41,2.82,1.9,4.11,4.8,4.12q13,0,25.92,0a4,4,0,0,0,4.24-4.17c0-8.81,0-17.62.07-26.42a4.25,4.25,0,0,0-1.52-3.39c-5.32-5.26-10.59-10.56-16-16C28.75,13.13,23.27,18.61,18.42,23.4Zm5,12a2.38,2.38,0,0,0-2.26,2.45,2.29,2.29,0,0,0,2,2.46c1.33,0,6.08.07,8,.07,0,2,0,6.61,0,7.83,0,1.39,1,2.19,2.62,2.19a2.26,2.26,0,0,0,2.37-2.52c0-2.45,0-4.9,0-7.5,1.49,0,6.1.05,7.26,0,1.86-.1,2.81-1,2.74-2.62s-1.13-2.32-3-2.36c-2.29,0-4.57,0-7,0,0-2.81,0-5.29,0-7.76a2.61,2.61,0,0,0-2.69-2.31,2.33,2.33,0,0,0-2.29,2.32c0,1,0,5.41,0,7.75C28.35,35.34,25.88,35.3,23.4,35.36Z"/></svg>':l.android&&(l.chrome||l.opera||l.samsungBrowser||l.yandexbrowser)&&(s.icon='<svg class="three-dots" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 234.3 980"><path d="M117.2,372.8A117.2,117.2,0,1,0,234.3,490,117.24,117.24,0,0,0,117.2,372.8Zm0-138.5A117.15,117.15,0,1,0,0,117.2,117.15,117.15,0,0,0,117.2,234.3Zm0,511.4A117.15,117.15,0,1,0,234.3,862.8,117.24,117.24,0,0,0,117.2,745.7Z"/></svg>'),e.navigator.standalone&&(s.icon=null),e.matchMedia("(display-mode: standalone)").matches&&(s.icon=null),o(function(){r.transcludeElement(t,n,i,a.templateUrl,a.bindToController)})}}}]).controller("DashMobileAppCtrl",["$localStorage","dwAlerts","state","helper",function(e,r,t,n){"use strict";var i=this,s=e.$default({users:{}});s.users[t.getLoggedUserId()]||(s.users[t.getLoggedUserId()]={}),s=s.users[t.getLoggedUserId()],i.$onInit=function(){i.dismissMobileApp=s.dismissMobileApp},i.dismiss=function(){s.dismissMobileApp=!0,i.dismissMobileApp=!0}}]),angular.module("deskworks.dashboard.dashOutstandingCharges",["deskworks.purchase.service"]).directive("dashOutstandingCharges",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-outstanding-charges.tpl.html",controller:"DashOutstandingChargesCtrl as $ctrl",link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashOutstandingChargesCtrl",["$scope","$q","$timeout","dwAlerts","state","helper","purchaseService",function(e,r,t,n,i,s,o){"use strict";var a=this;a.$onInit=function(){o.getPurchases(i.getCurrentCenterId(),i.getCurrentUserId()).finally(function(){e.$broadcast("dwWidget:SpinStop")}).catch(function(e){return n.error(e,"Failed to query non-recurring charges.")}).then(function(e){return r.all(e.open.concat(e.credit).map(function(e){return o.get(i.getCurrentCenterId(),i.getCurrentUserId(),e.id).catch(function(r){return n.error(r,"Failed to get purchase for order #"+e.id+".")}).then(function(e){a.charges=(a.charges||[]).concat(e.items)})}))})}}]),angular.module("deskworks.dashboard.recurringCharges",["deskworks.recurringCharge.service"]).directive("dashRecurringCharges",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-recurring-charges.tpl.html",controller:"DashRecurringChargesCtrl as $ctrl",link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashRecurringChargesCtrl",["$scope","dwAlerts","state","helper","RecurringCharge",function(e,r,t,n,i){"use strict";var s=this;s.$onInit=function(){i.query(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(e){return r.error(e,"Failed to query recurring charges.")}).then(function(e){s.charges=e.filter(function(e){return"active"===e.status.id&&"As Needed"!==e.nextBilled})}).finally(function(){e.$broadcast("dwWidget:SpinStop")})}}]),angular.module("deskworks.dashboard.upcomingReservations",["deskworks.reservationService"]).directive("dashUpcomingReservations",["helper",function(e){"use strict";return{restrict:"EAC",scope:!0,transclude:"element",templateUrl:"dashboard/widgets-user/dash-upcoming-reservations.tpl.html",controller:"DashUpcomingReservationsCtrl as $ctrl",bindToController:{settings:"<"},link:function(r,t,n,i,s){var o=this;s(function(){e.transcludeElement(r,t,n,o.templateUrl,o.bindToController)})}}}]).controller("DashUpcomingReservationsCtrl",["$scope","dwAlerts","state","helper","reservationService",function(e,r,t,n,i){"use strict";var s=this;s.$onInit=function(){var n={centerId:t.getCurrentCenterId(),userId:t.getCurrentUserId(),from:moment()};i.query(n).finally(function(){e.$broadcast("dwWidget:SpinStop")}).catch(function(e){return r.error(e,"Failed to query reservations.")}).then(function(e){s.reservations=e})}}]),angular.module("flexForms.ffBtnGroup",[]).directive("ffBtnGroup",["$timeout","$rootScope",function(e,r){return{restrict:"E",scope:!0,compile:function(e,r){return e.addClass("input-btn-group"),e.addClass("ff-btn-group"),e.html("<fieldset"+(e.attr("ff-disabled")?' ng-disabled="'+e.attr("ff-disabled")+'"':"")+">"+e.html()+"</fieldset>"),function(e,r,t){var n=r[0].querySelector("fieldset");e.$on("ffBtn::spinStart",function(e){e.stopPropagation(),n.disabled=!0}),e.$on("ffBtn::spinStop",function(e){e.stopPropagation(),n.disabled=!1})}}}}]),angular.module("flexForms.ffBtn",[]).directive("ffBtn",["$rootScope","$q","$compile","ffHelper",function(e,r,t,n){"use strict";var i={xs:"btn-xs",sm:"btn-xs",lg:""},s={edit:{color:"btn-primary",icon:"fa-pencil"},add:{color:"btn-success",icon:"fa-plus"},"add-alt":{color:"btn-primary",icon:"fa-plus"},new:{color:"btn-success",icon:"fa-plus"},view:{color:"btn-success",icon:"fa-eye"},clone:{color:"btn-success",icon:"fa-copy"},back:{color:"btn-warning",icon:"fa-chevron-left"},import:{color:"btn-success",icon:"fa-upload"},remove:{color:"btn-danger",icon:"fa-remove"},delete:{color:"btn-danger",icon:"fa-remove"},save:{color:"btn-success",icon:"fa-check"},next:{color:"btn-success",icon:"fa-chevron-right"},search:{color:"btn-primary",icon:"fa-search"},userSelect:{color:"btn-success",icon:"fa-user"},reserve:{color:"btn-success",icon:"fa-check"},ok:{color:"btn-success",icon:"fa-check"},cancel:{color:"btn-warning",icon:"fa-ban"},upload:{color:"btn-success",icon:"fa-upload"},download:{color:"btn-primary",icon:"fa-download"},favorite:{color:"btn-warning",icon:"fa-star"},makeFavorite:{color:"btn-success",icon:"fa-star-o"},collapse:{color:"btn-primary",icon:"fa-angle-down"},collapseBtn:{color:"btn-success",icon:"fa-angle-down"},collapseBtnPriv:{color:"btn-success",icon:"fa-angle-down"},signup:{color:"btn-primary"},link:{color:"btn-link"},checkIn:{color:"btn-success",icon:"fa-check"},checkOut:{color:"btn-warning",icon:"fa-check"},home:{color:"btn-warning",icon:"fa-home"},charge:{color:"btn-primary",icon:"fa-dollar"},merge:{color:"btn-success",icon:"fa-copy"},help:{color:"btn-primary",icon:"fa-question"},reset:{color:"btn-warning",icon:"fa-undo"},calendar:{color:"btn-warning",icon:"fa-calendar"},close:{color:"btn-link",icon:"fa-close"},signOut:{color:"btn-primary",icon:"fa-sign-out"},plus:{color:"btn-primary",icon:"fa-plus"},minus:{color:"btn-primary",icon:"fa-minus"},expand:{color:"btn-primary",icon:"fa-expand"}};return{restrict:"E",scope:!0,terminal:!0,controllerAs:"ffBtn",controller:["$scope",function(e){var t=this;t.click=function(e){return t.spin=!0,r.when(e).finally(function(){t.spin=!1})},e.$on("ffCountdown::expiry",function(r){r.stopPropagation(),e.$eval(t.clickExp)})}],link:function(e,r,o,a){var l=o.ffClick;a.clickExp=o.ffClick,o.ffSpin||(a.clickExp="ffBtn.click("+o.ffClick+")",o.$set("ffClick",a.clickExp),o.$set("ffSpin","ffBtn.spin")),t(r,null,0)(e);var c=angular.element('<button class="ff-btn btn"></button>');n.copyInnerAttrs(r,o,c),c.attr("type",o.type||"button"),c.addClass(i[o.size]||"btn-sm"),"xs"!=o.size&&c.append("<span>"+r.html()+"&nbsp;</span>"),r.empty().append(t(c)(e)),r.attr("ff-click",l),o.$observe("sense",function(e){if(c.removeClass("btn-default btn-primary btn-success btn-warning btn-danger"),c.addClass(angular.isDefined(s[e])?s[e].color:"btn-default"),!s[e]||s[e].icon){var r=c[0].querySelector(".fa");r&&r.remove(),c.append(angular.element('<span class="fa"></span>').addClass(s[e]?s[e].icon:"fa-check"))}c.attr("tabindex","favorite"===e?-1:0)}),e.$watch(o.ffSpin,function(r){e.$emit(r?"ffBtn::spinStart":"ffBtn::spinStop")})}}}]),angular.module("flexForms.ffCcNumber",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore","ccValidator"]).directive("ffCcNumber",["$compile","$templateCache","ffHelper","ccValidator","helper",function(e,r,t,n,i){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffCcNumber"},controller:"ffControlController as ffControl",bindToController:{ccType:"=",ccTypes:"<"},link:function(s,o,a,l){var c=l.ffControl,u=angular.element(r.get("ffText")),d=e(r.get("ffTextStatic"))(s);t.copyInnerAttrs(o,a,u),o.empty().append(u),e(u)(s),c.init({renderEdit:function(){d.detach(),o.append(u)},renderView:function(){u.detach(),o.append(d)},modelToStatic:function(e){return e}});var f=u.controller("ngModel"),p=u.controller("ngValidateAlert");f.$parsers.push(function(e){if(!e)return f.$setValidity("ccnumber",!0),f.$setValidity("cctype",!0),e;var r=n(e);return c.ccType=i.findByKeyValue(c.ccTypes,"id",r.card&&r.card.type),f.$setValidity("cctype",!r.card||!!c.ccType),f.$setValidity("ccnumber",r.isValid),p.ccTypeName=r.card&&r.card.niceType,p.ccTypesSupported=c.ccTypes.map(function(e){return e.name}).join(", "),e})}}}]),angular.module("flexForms.ffCheckbox",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffCheckbox",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffCheckbox"},controller:"ffControlController as ffControl",bindToController:{},compile:function(n,i){var s=n.html();return n.empty(),function(n,i,o,a){var l=a.ffControl,c=angular.element(r.get("ffCheckbox")),u=e(r.get("ffCheckboxStatic"))(n),d=o.ffLabel||s;d&&(d=angular.element('<span class="text-left"></span>').append(d)),t.copyInnerAttrs(i,o,c),i.empty().append(c),e(c)(n),d&&(i.append(d),e(d)(n)),l.init({renderEdit:function(){u.detach(),i.prepend(c)},renderView:function(){c.detach(),i.prepend(u)},modelToStatic:function(e){return!(!angular.isDefined(o.ffTrueValue)||e!=o.ffTrueValue)||(!angular.isDefined(o.ffFalseValue)||e!=o.ffFalseValue)&&!!e}})}}}}]),angular.module("deskworks.ffControlController",[]).controller("ffControlController",["$scope","$element","$attrs","$timeout","ffControlCompileTemplates",function(e,r,t,n,i){"use strict";var s,o,a,l,c=this;function u(){return!(c.ffBulkReadOnly&&!c.ffBulkReadOnly.editMode)&&(!c.ffBlock||c.ffBlock.editMode)}c.init=function(n){if(t.ffModel&&!c.ffReadOnlyIgnore){if(o=n.renderEdit,a=n.renderView,l=n.modelToStatic,!o||!a||!l)return console.error("ffControl.init: renderEdit/renderView/modelToStatic is not defined");s=e.$eval(t.ffModel),e.$on("ffControl::EditCancel",function(){u()&&e.$eval(t.ffModel+" = initialValue",{initialValue:s})}),e.$watch(u,function(n){angular.isUndefined(n)||(r.toggleClass("ff-read-only",!n),n?(s=e.$eval(t.ffModel),o()):a())}),e.$watch(t.ffModel,function(e){c.staticValue=l(e)})}},c.updateStatic=function(){c.staticValue=l(e.$eval(t.ffModel))}}]).factory("ffControlCompileTemplates",["$compile","$templateCache",function(e,r){"use strict";return r.get("ffTextStatic")||e(r.get("flex-forms/controls/ff-control.tpl.html")),{}}]),angular.module("flexForms.ffCountdown",[]).directive("ffCountdown",["$compile",function(e){"use strict";return{restrict:"A",scope:!0,controller:"ffCountdownCtrl",controllerAs:"ffCd",bindToController:{counter:"=ffCountdown"},compile:function(r,t){return r.addClass("ff-countdown"),function(r,t,n,i){angular.element(t[0].querySelector(".ff-countdown-time")).remove(),t.append(e('<span class="ff-countdown-time">[{{ffCd.counter}}]</span>')(r))}}}}]).controller("ffCountdownCtrl",["$scope","$timeout",function(e,r){"use strict";var t,n=this;e.$watch("ffCd.counter",function(){r.cancel(t),n.counter&&(t=r(function(){--n.counter||e.$emit("ffCountdown::expiry")},1e3))})}]),angular.module("flexForms.ffDate",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffDate",["$compile","$templateCache","$locale","$filter","$window","$timeout","ffHelper",function(e,r,t,n,i,s,o){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffDate"},controller:"ffControlController as ffControl",bindToController:{},link:function(a,l,c,u){var d=a.$eval(c.monthly),f=angular.element(r.get("ffDate")),p=angular.element(f[0].querySelector("input")),m=e(r.get("ffTextStatic"))(a);c.ffDisabled&&angular.element(f[0].querySelector("button")).attr("ng-disabled",c.ffDisabled),o.copyInnerAttrs(l,c,p),l.empty().append(f),e(f)(a),u.ffControl.init({renderEdit:function(){m.detach(),l.append(f)},renderView:function(){f.detach(),l.append(m)},modelToStatic:function(e){return d?n("date")(e,"MMM yyyy"):n("date")(e,"mediumDate")}}),a.$attrs=c;var h,g=p.controller("ngModel");function v(){a.$apply("closeDP()")}g.$formatters.push(function(e){return h?(h=!1,g.$viewValue):d?n("date")(e,"MMM yyyy"):n("date")(e,"mediumDate")}),g.$parsers.push(function(e){if(!e)return e;var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],n=t.DATETIME_FORMATS.SHORTMONTH.concat(t.DATETIME_FORMATS.MONTH).concat(r),i=n.join("|").replace(/\./g,"\\.?"),s=function(e){var t=new RegExp("^\\s*("+i+")(?:\\s|-|\\.|\\/)+\\d{1,2}(?:\\s|-|\\.|\\/|,)+\\d{4}\\s*$","i"),s=e.match(t);if(s&&s[1]){for(var o=-1,a=0;a<n.length;a++)if(n[a].toLowerCase().replace(".","")===s[1].toLowerCase().replace(".","")){o=a%12;break}return{format:"MMM DD YYYY",value:e=(e=e.replace(new RegExp(s[1].replace(/\./g,"\\.?"),"i"),r[o])).replace(/\s|-|\.|\/|,/g," ").replace(/\s+/g," ")}}}(e)||function(e){var t=new RegExp("^\\s*\\d{1,2}(?:\\s|-|\\.|\\/)+("+i+")(?:\\s|-|\\.|\\/)+\\d{4}\\s*$","i"),s=e.match(t);if(s&&s[1]){for(var o=-1,a=0;a<n.length;a++)if(n[a].toLowerCase().replace(".","")===s[1].toLowerCase().replace(".","")){o=a%12;break}return{format:"DD MMM YYYY",value:e=(e=e.replace(new RegExp(s[1].replace(/\./g,"\\.?"),"i"),r[o])).replace(/\s|-|\.|\//g," ").replace(/\s+/g," ")}}}(e)||function(e){if(e.match(/^\s*\d{1,2}(?:\s|-|\.|\/)+\d{1,2}(?:\s|-|\.|\/)+\d{4}\s*$/i))return{format:"MM/DD/YYYY",value:e.replace(/\s|-|\./g,"/").replace(/\/+/g,"/")}}(e)||function(e){if(e.match(/^\s*\d{4}(?:\s|-|\.|\/)+\d{1,2}(?:\s|-|\.|\/)+\d{1,2}\s*$/i))return{format:"YYYY-MM-DD",value:e.replace(/\s|-|\.|\//g,"-").replace(/-+/g,"-")}}(e);if(d&&(s=s||function(e){var t=new RegExp("^\\s*("+i+")(?:\\s|-|\\.|\\/|,)+\\d{4}\\s*$","i"),s=e.match(t);if(s&&s[1]){for(var o=-1,a=0;a<n.length;a++)if(n[a].toLowerCase().replace(".","")===s[1].toLowerCase().replace(".","")){o=a%12;break}return{format:"MMM YYYY",value:e=(e=e.replace(new RegExp(s[1].replace(/\./g,"\\.?"),"i"),r[o])).replace(/\s|-|\.|\/|,/g," ").replace(/\s+/g," ")}}}(e)||function(e){if(e.match(/^\s*\d{1,2}(?:\s|-|\.|\/)+\d{4}\s*$/i))return{format:"MM/YYYY",value:e.replace(/\s|-|\./g,"/").replace(/\/+/g,"/")}}(e)||function(e){if(e.match(/^\s*\d{4}(?:\s|-|\.|\/)+\d{1,2}\s*$/i))return{format:"YYYY-MM",value:e.replace(/\s|-|\.|\//g,"-").replace(/-+/g,"-")}}(e)),s){var o=moment(s.value,s.format);if(o.isValid())return g.$setValidity("date",!0),h=!0,d&&o.date(1),o;g.$setValidity("date",!1)}}),a.closeDP=function(){var e=angular.element(document.getElementById("ff-dp-popup"));e.remove(e),i.removeEventListener("click",v),angular.element(document.querySelector("main")).css("padding-bottom","")},a.openDP=function(r){r.preventDefault(),r.stopPropagation(),a.closeDP(),i.addEventListener("click",v);var t=angular.element('<ff-datepicker id="ff-dp-popup" tabindex="0" ng-click="stopPropagation($event)"></ff-datepicker>');t.attr("ff-model",c.ffModel),t.attr("date-min",c.dateMin),t.attr("date-max",c.dateMax),t.attr("date-disabled",c.dateDisabled),t.attr("monthly",c.monthly),t=e(t)(a),l.append(t),t[0].focus(),s(function(){t[0].querySelector(".ff-dp-cal-body").addEventListener("click",function(){for(var e in a.closeDP(),s(function(){l[0].querySelector("input").focus()}),a.ffDateForm)a.ffDateForm.hasOwnProperty(e)&&e.indexOf("$")<0&&angular.isString(a.ffDateForm[e].$name)&&(a.ffDateForm[e].$setDirty(),angular.forEach(a.ffDateForm[e].$viewChangeListeners,function(e){e()}))});var e=document.querySelector("main"),r=parseInt(i.getComputedStyle(e).paddingBottom);angular.element(e).css("padding-bottom",r+e.scrollHeight-e.clientHeight+50+"px")})},a.stopPropagation=function(e){e.preventDefault(),e.stopPropagation()},a.$on("$destroy",function(){a.closeDP()})}}}]),angular.module("flexForms.ffEmail",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffEmail",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffEmail"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffEmail")),c=e(r.get("ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}})}}}]),angular.module("flexForms.ffIcon",[]).directive("ffIcon",function(){"use strict";var e={checkInStatus:"fa-check",checkOutStatus:"fa-check",checkMark:"fa-check",check:"fa-check",plus:"fa-plus",refresh:"fa-refresh",increase:"fa-caret-up",decrease:"fa-caret-down",info:"fa-info-circle",breadcrumb:"fa-arrow-circle-right",error:"fa-exclamation-triangle",warning:"fa-exclamation-triangle",ignore:"fa-minus-circle",header:"fa-header",membership:"fa-users",reservation:"fa-calendar-check-o",billing:"fa-usd",user:"fa-user",navigate:"fa-arrow-circle-right",accessCode:"fa-tag",message:"fa-comment",center:"fa-home"};return{restrict:"E",scope:!1,link:function(r,t,n){var i=r.$eval(n.sense)||n.sense;t.addClass("ff-icon fa"),t.addClass("sense-"+i),t.addClass(e[i]||"fa-bug")}}}),angular.module("flexForms.ffImg",[]).directive("ffImg",["$compile","ffHelper",function(e,r){"use strict";return{restrict:"E",link:function(t,n,i){var s=angular.element("<img>");r.copyInnerAttrs(n,i,s),n.empty().append(s),e(s)(t),i.$observe("ffSrc",function(e){n.toggleClass("ff-img-placeholder",!e)})}}}]),angular.module("flexForms.ffInfo",[]).directive("ffInfo",function(){"use strict";return{restrict:"E"}}),angular.module("flexForms.ffLabel",[]).directive("ffLabel",["ffHelper",function(e){return{restrict:"E",compile:function(e,r){return angular.isDefined(r.ffTransclude)?(e.html('<span class="ff-label" ng-transclude="'+r.ffTransclude+'"></span>'),r.$set("ffTransclude",null)):r.ffBindHtml?e.html('<span class="ff-label" ng-bind-html="'+r.ffBindHtml+'"></span>'):e.html('<span class="ff-label">'+e.html()+"</span>"),function(e,r,t){t.$observe("ffRequired",function(e){r.toggleClass("ff-required","true"==e)})}}}}]),angular.module("flexForms.ffLogin",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffLogin",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffLogin"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffLogin")),c=e(r.get("ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}})}}}]),angular.module("flexForms.ffNumber",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffNumber",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffNumber"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffText")),c=e(r.get("ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}});var u=l.controller("ngModel");u.$parsers.push(function(e){if(e){var r=e.match(/^\s*-?(\d*)([,\.]?)\d+\s*$/i);if(r){var t=r[1],n=r[2];if(u.$setValidity("number",!0),n)return""===t?e.replace(n,"0."):"."===n?e:e.replace(n,".")}else u.$setValidity("number",!1)}return e})}}}]),angular.module("flexForms.ffPassword",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffPassword",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffPassword"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffPassword")),c=e(r.get("ffPasswordStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return null}})}}}]),angular.module("flexForms.ffPrice",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffPrice",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffPrice"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffText")),c=e(r.get("ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}});var u=l.controller("ngModel");u.$parsers.push(function(e){if(e){var r=e.match(/^\s*-?(\d*)([,\.]?)\d+\s*$/i);if(r){var t=r[1],n=r[2];if(u.$setValidity("price",!0),n)return""===t?e.replace(n,"0."):"."===n?e:e.replace(n,".")}else u.$setValidity("price",!1)}return e})}}}]),angular.module("flexForms.ffRadio",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffRadio",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffRadio"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffRadio")),c=e(r.get("ffRadioStatic"))(n),u=s.ffLabel||i.html();u&&(u=angular.element('<span class="text-left"></span>').append(u)),t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),u&&(i.append(u),e(u)(n)),a.init({renderEdit:function(){c.detach(),i.prepend(l)},renderView:function(){l.detach(),i.prepend(c)},modelToStatic:function(e){return n.$eval(s.ffValue)===e}})}}}]),angular.module("deskworks.ffReadOnlyIgnore",[]).directive("ffReadOnlyIgnore",function(){"use strict";return{restrict:"C",controller:function(){}}}),angular.module("flexForms.ffRichtext",["textAngular"]).directive("ffRichtext",["ffHelper",function(e){return{restrict:"E",scope:!0,compile:function(r,t){var n=angular.element("<text-angular></text-angular>");return e.copyInnerAttrs(r,t,n),r.append(n),this.link},link:function(e,r,t){var n=angular.element(r[0].querySelector("[contenteditable]"));e.$watch("ffBlock.editMode",function(e){angular.isUndefined(e)||(r.toggleClass("ff-read-only",!e),n.attr("contenteditable",e))})}}}]),angular.module("flexForms.ffSearch",[]).directive("ffSearch",["$compile","$timeout","ffHelper",function(e,r,t){return{restrict:"E",scope:!0,priority:20,terminal:!0,controllerAs:"ffSearch",controller:["$scope","$element","$attrs",function(e,t,n){var i=this,s=n.ffSearch,o=n.ffSearchFilter,a=n.ffChange;i.search=function(r){i.curIdx=0,i.resultsFiltered=o?e.$eval(o,{$results:i.results,$search:i.val}):i.results,i.matchActive=!1,r&&s&&(i.spin=!0,e.$eval(s,{$search:r}).then(function(r){i.results=r,i.resultsFiltered=o?e.$eval(o,{$results:i.results,$search:i.val}):i.results,i.open=!0}).finally(function(){i.spin=!1}))},i.select=function(t){i.ngModel.$setViewValue(t),i.ngModel.$setTouched(),a&&e.$eval(a,{}),r(function(){i.open=!1,i.matchActive=!0,delete i.val},310)},i.onBlur=function(){r(function(){i.matchActive=!1,i.open=!1,delete i.val},300)},i.onKeydown=function(r){27===r.keyCode?i.open=!1:38===r.keyCode&&i.curIdx>0?(i.curIdx--,e.$broadcast("ffSearch:changeOption")):40===r.keyCode&&i.curIdx+1<i.resultsFiltered.length?(i.curIdx++,e.$broadcast("ffSearch:changeOption")):13===r.keyCode&&i.open&&(r.preventDefault(),r.stopPropagation(),i.select(i.resultsFiltered[i.curIdx]))}}],compile:function(r,t){var n=this;t.$set("ffSpin","ffSearch.spin");var i=angular.element('<input type="text" ng-blur="ffSearch.onBlur()" ng-model="ffSearch.val" class="form-control ff-control ff-text">');return i.attr("ng-change","ffSearch.search(ffSearch.val)"),i.attr("ng-keydown","ffSearch.onKeydown($event)"),i.attr("placeholder",t.placeholder),t.$set("placeholder",null),r.prepend(i),function(r,t,i,s){e(t,null,n.priority)(r),s.ngModel=t.controller("ngModel")}}}}]).directive("ffSearchOptions",["$compile","$window","ffHelper",function(e,r,t){return{restrict:"E",require:"^ffSearch",priority:20,terminal:!0,compile:function(t,n){var i=this;n.$set("ngShow","ffSearch.open");var s=angular.element('<div class="ff-search-option" ng-repeat="$search in ffSearch.resultsFiltered" ng-click="ffSearch.select($search)"></div>');return s.attr("ng-class","{active: ffSearch.curIdx === $index}"),s.append(t.html()),t.empty().append(s),t.append('<ff-info class="ff-search-option" ng-hide="ffSearch.resultsFiltered.length">search result is empty</ff-info>'),function(t,n,s,o){e(n,null,i.priority)(t),t.$watch("ffSearch.open",function(e){if(e){var t=n[0].getBoundingClientRect();n.toggleClass("ffso-above",t.bottom>r.innerHeight&&t.top-t.height-30>0)}}),t.$watchCollection("ffSearch.resultsFiltered",function(e){n[0].scrollTop=0}),t.$on("ffSearch:changeOption",function(){var e=n[0].querySelectorAll(".ff-search-option")[o.curIdx],r=e.offsetTop+e.offsetHeight,t=n[0].scrollTop+n[0].clientHeight;r>t?n[0].scrollTop+=r-t:e.offsetTop<n[0].scrollTop&&(n[0].scrollTop-=n[0].scrollTop-e.offsetTop)})}}}}]).directive("ffSearchMatch",["$compile","ffHelper",function(e,r){return{restrict:"E",require:"^ffSearch",priority:20,terminal:!0,compile:function(r,t){var n=this;return t.$set("ngShow","ffSearch.ngModel.$modelValue"),t.$set("ngClass","{active: ffSearch.matchActive}"),function(r,t,i){e(t,null,n.priority)(r)}}}}]),angular.module("flexForms.ffSelect",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffSelect",["$compile","$templateCache","$timeout","ffHelper","helper",function(e,r,t,n,i){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffSelect"},controller:"ffControlController as ffControl",bindToController:{},compile:function(t,s){var o=t.html();return t.empty(),function(t,s,a,l){var c=angular.element(r.get("ffSelect")),u=e(r.get("ffTextStatic"))(t);c.append(o),n.copyInnerAttrs(s,a,c),s.empty().append(c),e(c)(t);var d=l.ffControl;if(d.init({renderEdit:function(){u.detach(),s.append(c)},renderView:function(){c.detach(),s.append(u)},modelToStatic:function(e){if(a.ffOptions){var r=a.ffOptions.match(/\S+(?=\s+as\s+)/i),n=a.ffOptions.match(/\S+(?=\s+for\s+)/i),s=a.ffOptions.match(/in\s+(\S+)/i);if(r&&r.length&&(r=(r=r[0].split("."))[r.length-1]),n&&n.length&&(n=(n=n[0].split("."))[n.length-1]),s&&s.length&&(s=s[1]),n&&s){r=r||"id",n=n||"id",s=t.$eval(s)||[];var o=i.findByKeyValue(s,r,angular.isObject(e)?e[r]:e);if(o)return o[n]}}var l=Array.prototype.slice.call(c[0].querySelectorAll("option"));if(l.length){var u=e;(angular.isUndefined(e)||null===e)&&(u=""),"boolean"==typeof e&&(u=""+u);var d=i.findByKeyValue(l,"value",u);if(d)return d.innerHTML}return e}}),a.ffOptions||d.ffReadOnlyIgnore||t.$watchCollection(function(){return Array.prototype.slice.call(c[0].querySelectorAll("option")).map(function(e){return e.value})},d.updateStatic),a.ffOptions&&!d.ffReadOnlyIgnore){var f=a.ffOptions.match(/in\s+(\S+)/i);f&&f.length&&(f=f[1]),t.$watchCollection(f,d.updateStatic)}}}}}]),angular.module("flexForms.ffStatic",["deskworks.ffControlController"]).directive("ffStatic",["$compile","$templateCache","ffHelper","ffControlCompileTemplates",function(e,r,t,n){"use strict";return{restrict:"E",compile:function(n,i){var s=n.html();return n.empty(),function(n,i,o,a){var l=angular.element(r.get("ffStatic"));l.append(s),t.copyInnerAttrs(i,o,l),i.empty().append(l),e(l)(n)}}}}]),angular.module("flexForms.ffText",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffText",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffText"},controller:"ffControlController as ffControl",bindToController:{staticUrl:"<?ffStaticUrl"},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffText")),c=e(r.get(angular.isDefined(a.staticUrl)?"ffTextStaticUrl":"ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}})}}}]),angular.module("flexForms.ffTextarea",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffTextarea",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffTextarea"},controller:"ffControlController as ffControl",bindToController:{},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffTextarea")),c=e(r.get("ffTextStatic"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n);var u=n.$eval(s.rowspan);u&&i.css("min-height",30*u-u+1+"px"),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}})}}}]),angular.module("flexForms.ffTime",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffTime",["$compile","$templateCache","$locale","$filter","ffHelper",function(e,r,t,n,i){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffTime"},controller:"ffControlController as ffControl",bindToController:{},link:function(s,o,a,l){var c=angular.element(r.get("ffTime")),u=e(r.get("ffTimeStatic"))(s);i.copyInnerAttrs(o,a,c),o.empty().append(c),e(c)(s),l.ffControl.init({renderEdit:function(){u.detach(),o.append(c)},renderView:function(){c.detach(),o.append(u)},modelToStatic:function(e){return e}}),s.onFocus=function(){return c[0].select?c[0].select():c[0].setSelectionRange?c[0].setSelectionRange(0,999):void 0};var d=c.controller("ngModel");d.$formatters.push(function(e){return n("date")(e,"shortTime")}),d.$parsers.unshift(function(e){if(!e)return e;var r,n,i,s=t.DATETIME_FORMATS.AMPMS;return(r=e.match(new RegExp("^\\s*([01]?\\d):([0-5]\\d)\\s+(am|pm|"+s.join("|").replace(/\./g,"\\.")+")\\s*$","i")))?(n=parseInt(r[1]),i=parseInt(r[2]),r[3]=r[3].toLowerCase(),(n>12||0===n)&&(n=void 0),("pm"===r[3]||r[3]===s[1].toLowerCase())&&n<12&&(n+=12),"am"!==r[3]&&r[3]!==s[0].toLowerCase()||12!==n||(n-=12)):(r=e.match(/^\s*([012]?\d):([0-5]\d)\s*$/i))&&(n=parseInt(r[1]),i=parseInt(r[2]),(n>24||24===n&&0!==i)&&(n=void 0)),i>59&&(i=void 0),angular.isDefined(n)&&angular.isDefined(i)?moment({hour:n,minute:i}):void 0})}}}]),angular.module("flexForms.ffUrl",["deskworks.ffControlController","deskworks.ffReadOnlyIgnore"]).directive("ffUrl",["$compile","$templateCache","ffHelper",function(e,r,t){"use strict";return{restrict:"E",scope:!0,require:{ffBulkReadOnly:"^?ffBulkReadOnly",ffReadOnlyIgnore:"^?ffReadOnlyIgnore",ffBlock:"^^?ffBlock",ffControl:"ffUrl"},controller:"ffControlController as ffControl",bindToController:{staticUrl:"<ffModel"},link:function(n,i,s,o){var a=o.ffControl,l=angular.element(r.get("ffText")),c=e(r.get("ffTextStaticUrl"))(n);t.copyInnerAttrs(i,s,l),i.empty().append(l),e(l)(n),a.init({renderEdit:function(){c.detach(),i.append(l)},renderView:function(){l.detach(),i.append(c)},modelToStatic:function(e){return e}}),l.controller("ngModel").$validators.url=function(e,r){return!r||/^http(s)?:\/\/\w+/.test(r)}}}}]),angular.module("flexForms.ffDatepickerPopup",["flexForms.ffDatepicker"]).directive("ffDatepickerPopup",["$compile","$window","$timeout",function(e,r,t){"use strict";return{restrict:"E",scope:!0,compile:function(n,i){return n.addClass("ff-datepicker-popup"),function(n,s,o){function a(){n.$apply("closeDP()")}s.parent().on("click",function(e){n.openDP(e),n.$apply()}),n.closeDP=function(){var e=angular.element(document.getElementById("ff-dp-popup"));e.remove(e),r.removeEventListener("click",a),angular.element(document.querySelector("main")).css("padding-bottom","")},n.openDP=function(o){o&&(o.preventDefault(),o.stopPropagation()),n.closeDP(),r.addEventListener("click",a);var l=angular.element('<ff-datepicker id="ff-dp-popup" tabindex="0" ng-click="$event.stopPropagation()"></ff-datepicker>');l.attr("ff-model",i.ffModel),l.attr("date-max",i.dateMax),l=e(l)(n),s.append(l),l[0].focus(),t(function(){l[0].querySelector(".ff-dp-cal-body").addEventListener("click",function(){n.$apply("closeDP()")});var e=document.querySelector("main"),t=parseInt(r.getComputedStyle(e).paddingBottom);angular.element(e).css("padding-bottom",t+e.scrollHeight-e.clientHeight+50+"px")})},n.$on("$destroy",function(){s.parent().off("click"),n.closeDP()})}}}}]),angular.module("flexForms.ffDatepicker",[]).directive("ffDatepicker",function(){"use strict";return{restrict:"EAC",scope:!0,templateUrl:"flex-forms/ff-datepicker/ff-datepicker.tpl.html",controller:"ffDatepickerCtrl as $ctrl",bindToController:{ffModel:"=",dateMin:"<?",dateMax:"<?",dateDisabled:"&",monthly:"<?"},compile:function(e,r){return e.addClass("ff-datepicker"),function(e,r,t,n){}}}}).controller("ffDatepickerCtrl",["$scope","$filter","$locale",function(e,r,t){"use strict";var n=this;function i(e){var r=moment([e.year(),e.month(),1]),t=r.clone().endOf("month");n.days=[];for(var i=1,s=t.date();i<=s;i++)n.days.push({str:i,date:moment([r.year(),r.month(),i])});n.prevMonthDays=[],(s=moment([e.year(),e.month(),1]).subtract(1,"M").endOf("month").date())-(i=s-(r.day()-1))<0&&(i=s-6);for(var o=r.clone().subtract(1,"M");i<=s;i++)n.prevMonthDays.push({str:i,date:moment([o.year(),o.month(),i])});for(n.nextMonthDays=[],s=6-t.day(),n.days.length+n.prevMonthDays.length+s<42&&(s+=7),i=1;i<=s;i++)n.nextMonthDays.push({str:i,date:moment([r.year(),r.month(),i]).add(1,"M")});for(s=e.year(),n.years=[],i=0;i<5;i++)n.years.push(i-2+s)}function s(e){return Array.apply(null,Array(12)).map(Number.prototype.valueOf,0).map(function(r,t){return{date:e.clone().month(t).date(1)}})}n.$onInit=function(){n.today=moment(),n.weekDays=t.DATETIME_FORMATS.SHORTDAY,n.date=moment.isMoment(n.ffModel)?n.ffModel.clone():moment(),n.date.date(1),i(n.date),n.monthly&&(n.months=s(n.date)),e.$watch("$ctrl.date",function(e,r){moment.isMoment(e)&&(moment.isMoment(r)&&e.month()===r.month()&&e.year()===r.year()||(i(n.date),n.monthly&&(n.months=s(n.date))))},!0)},n.checkDateDisabled=function(e){return e<n.dateMin||e>n.dateMax||n.dateDisabled({$date:e})},n.prevMonth=function(){n.monthly?n.date.subtract(1,"Y"):n.date.subtract(1,"M")},n.nextMonth=function(){n.monthly?n.date.add(1,"Y"):n.date.add(1,"M")},n.compareDates=function(e,r){return moment.isMoment(e)&&moment.isMoment(r)&&e.year()===r.year()&&e.month()===r.month()&&(e.date()===r.date()||n.monthly)},n.selectDay=function(e){n.ffModel=e.date.clone(),n.date=e.date.clone()},n.selectYear=function(e){n.date.year(e)}}]),angular.module("flexForms.ffIncludeAll",[]).directive("ffIncludeAll",function(){"use strict";return{restrict:"E",scope:!0,template:'<ff-checkbox class="ff-center ff-include-all" ff-model="inc.all" ff-click="inc.selectAll()" ff-disabled="!inc.items || !inc.items.length" title="Include All" flex="1 1 auto">{{\'GLOBAL.INCLUDE_ALL\' | translate}}</ff-checkbox>',controller:"IncludeAllCtrl as inc",bindToController:{items:"=",default:"="}}}).controller("IncludeAllCtrl",["$scope",function(e){"use strict";var r=this;r.selectAll=function(){angular.forEach(r.items,function(e){e.include=r.all})};var t=e.$watchCollection("inc.items",function(e){e&&(r.all=!!r.default,r.selectAll(),t())});e.$watchCollection(function(){return r.items&&r.items.map(function(e){return e.include})},function(e){r.all=r.items&&r.items.length&&r.items.every(function(e){return!!e.include})||!1})}]),angular.module("flexForms.ffPagination",[]).directive("ffPagination",["ffHelper",function(e){"use strict";return{restrict:"E",scope:{props:"=",ffClick:"&"},template:'<span ng-repeat="p in range(props.pageCount) track by $index" ff-spin="spin == $index + 1" ng-class="{ active: ($index + 1) == props.page }" ng-click="page($index + 1)">{{$index + 1}}</span>',link:function(e){e.range=function(e){return new Array(e)},e.page=function(r){e.spin||r==e.props.page||(e.spin=r,e.ffClick({$page:r}).finally(function(){e.spin=0}))}}}}]),angular.module("flexForms.ffBlock",["flexForms.ffBtnBlockEdit","flexForms.ffBtnBlockDelete","flexForms.ffBtnBlockSave","flexForms.ffBtnBlockCancel"]).directive("ffBlock",["$compile",function(e){"use strict";return{restrict:"A",scope:!0,priority:30,terminal:!0,controllerAs:"ffBlock",require:{ffBulkReadOnly:"^^?ffBulkReadOnly"},bindToController:{},controller:["$scope",function(e){this.delete=function(){return e.$eval(e.deleteExp).then(function(r){return e.ffSection&&e.ffSection.deleteBlock(e.$index),r})},e.$on("ffBlock::EditStart",function(){e.ffBlock.editMode=!0,e.editExp&&e.$eval(e.editExp+"=true")}),e.$on("ffBlock::EditEnd",function(){e.ffBlock.editMode=!1,e.editExp&&e.$eval(e.editExp+"=false")}),this.edit=function(){e.ffBlockForm.$setPristine(),e.$emit("ffBlock::EditStart")},this.save=function(){return e.$eval(e.saveExp).then(function(r){return e.$emit("ffBlock::EditEnd"),r})},this.cancel=function(){e.$eval(e.isNewExp)&&e.ffSection?e.ffSection.deleteBlock(e.$index):(e.$broadcast("ffControl::EditCancel"),e.$emit("ffBlock::EditCancel")),e.$emit("ffBlock::EditEnd")}}],compile:function(r,t){var n=this,i=angular.element('<form name="ffBlockForm"></form>');return i.append(r.contents()),r.empty().append(i),function(r,t,i,s){e(t,null,n.priority)(r),r.saveExp=i.ffBlockSave,r.deleteExp=i.ffBlockDelete,r.isNewExp=i.ffBlockIsNew,r.ffBlock.editMode=(!s.ffBulkReadOnly||s.ffBulkReadOnly.editMode)&&!!r.$eval(i.ffBlockEditDefault),r.editExp=i.ffBlockEdit,r.editExp&&r.$eval(r.editExp+"="+r.ffBlock.editMode),r.$eval(i.ffBlockDirtyDefault)&&r.ffBlockForm.$setDirty()}}}}]),angular.module("flexForms.ffBtnBlockCancel",[]).directive("ffBtnBlockCancel",["$compile","$translate",function(e,r){"use strict";return{restrict:"A",require:"^ffBlock",priority:30,terminal:!0,compile:function(t,n){var i=this;return n.$set("ffClick","ffBlock.cancel()"),n.$set("sense","cancel"),n.$set("size","sm"),n.$set("ffBtnBlockCancel",null),n.$set("ngShow","ffBlock.editMode"),t.html(r.instant("GLOBAL.BTN_CANCEL")),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("flexForms.ffBtnBlockDelete",[]).directive("ffBtnBlockDelete",["$compile","$translate",function(e,r){"use strict";return{restrict:"A",require:"^ffBlock",priority:30,terminal:!0,compile:function(t,n){var i=this;return n.$set("ffClick","ffBlock.delete()"),n.$set("sense","delete"),n.$set("size","sm"),n.$set("ngHide",n.ngHide||"ffBlock.editMode"),n.$set("ffBtnBlockDelete",null),t.html(r.instant("GLOBAL.BTN_DELETE")),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("flexForms.ffBtnBlockEdit",[]).directive("ffBtnBlockEdit",["$compile","$translate",function(e,r){"use strict";return{restrict:"A",require:"^ffBlock",priority:30,terminal:!0,compile:function(t,n){var i=this;return n.$set("ffClick","ffBlock.edit()"),n.$set("sense","edit"),n.$set("size","sm"),n.$set("ffBtnBlockEdit",null),n.$set("ngHide","ffBlock.editMode"),t.html(r.instant("GLOBAL.BTN_EDIT")),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("flexForms.ffBtnBlockSave",[]).directive("ffBtnBlockSave",["$compile","$translate",function(e,r){"use strict";return{restrict:"A",require:"^ffBlock",priority:30,terminal:!0,compile:function(t,n){var i=this;return n.$set("ffClick","ffBlock.save()"),n.$set("sense","ok"),n.$set("size","sm"),n.$set("type","submit"),n.$set("ffBtnBlockSave",null),n.$set("ffDisabled","ffBlockForm.$invalid || ffBlockForm.$pristine"),n.$set("ngShow","ffBlock.editMode"),t.html(r.instant("GLOBAL.BTN_OK")),function(r,t,n){e(t,null,i.priority)(r)}}}}]),angular.module("flexForms.ffBtnSectionNew",[]).directive("ffBtnSectionNew",["$translate",function(e){"use strict";return{restrict:"A",require:"^ffSection",priority:1e4,compile:function(r,t){return t.$set("ffClick","ffSection.newBlock()"),t.$set("sense","new"),t.$set("size",t.size||"sm"),t.$set("ffBtnSectionNew",null),r.html(r.html()||e.instant("GLOBAL.BTN_NEW")),this.link},link:function(e,r,t,n){}}}]),angular.module("flexForms.ffBulkReadOnly",[]).directive("ffBulkReadOnly",["$route","UserTasks","helper",function(e,r,t){"use strict";return{restrict:"A",scope:!0,controllerAs:"ffBlock",bindToController:{ffBulkReadOnly:"<"},controller:["$scope","$element",function(n,i){var s=this;function o(e){s.editMode=!!e,i.toggleClass("ff-bulk-read-only",!e)}function a(e){e.altKey&&e.shiftKey&&79===e.keyCode&&n.$apply(function(){o(!s.editMode)})}s.$onInit=function(){angular.isUndefined(s.ffBulkReadOnly)?(n.UserTasks=r,n.$watchCollection("UserTasks.tasks",function(r){var n=t.findByKeyValue(r,"url","/"+e.current.$$route.routeBranch);o(!!n&&!n.readOnly)})):n.$watch("ffBlock.ffBulkReadOnly",function(e){o(!e)}),document.addEventListener("keydown",a),n.$on("$destroy",function(){document.removeEventListener("keydown",a)})}}]}}]),angular.module("flexForms.ffSection",["flexForms.ffBlock","flexForms.ffBtnSectionNew"]).directive("ffSection",function(){"use strict";return{restrict:"AC",scope:!0,controllerAs:"ffSection",controller:["$scope",function(e){this.deleteBlock=function(r){e.collection.splice(r,1)},this.newBlock=function(){var r=e.$eval(e.newExp)||{};return e.collection.push(r),r}}],compile:function(e,r){var t=(r.ffSection||"").match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);return t&&(t=t[2],angular.element(e[0].querySelector("[ff-block]")).attr("ng-repeat",r.ffSection)),function(e,r,n,i){e.collection=e.$eval(t)||[],e.newExp=n.ffSectionNew}}}}),angular.module("flexForms.ffSort",[]).directive("ffSort",["ffHelper",function(e){"use strict";return{restrict:"E",scope:{colId:"<",props:"<",ffClick:"&"},template:'<span class="fa" ng-class="getClass()" ng-click="sort()" title="Click to sort"></span>',link:function(e,r){e.sort=function(){e.props.sort===e.colId?e.props.order=-e.props.order:(e.props.sort=e.colId,e.props.order=1),e.spin||(r.addClass("ff-spin"),e.ffClick().finally(function(){r.removeClass("ff-spin")}))},e.getClass=function(){return e.props.sort!==e.colId?"fa-sort":e.props.order<0?"fa-sort-desc":"fa-sort-asc"}}}}]),angular.module("flexForms.ffDim",[]).directive("ffDim",function(){"use strict";return{restrict:"AC",priority:1,scope:!0,controller:"ffDimCtrl as ffDim",bindToController:{dim:"<?ffDim",ffClick:"@",ngClick:"@"},compile:function(e,r){var t={ffClick:r.ffClick,ngClick:r.ngClick};return r.ffClick&&r.$set("ffClick","ffDim.click($event)"),r.ngClick&&r.$set("ngClick","ffDim.click($event)"),function(e,r,n,i){n.$set("ffClick",t.ffClick),n.$set("ngClick",t.ngClick)}}}}).controller("ffDimCtrl",["$scope","$element",function(e,r){"use strict";var t,n=this;n.$onChanges=function(){if(n.dim&&!r.hasClass("ff-dim"))return t||(t=angular.element('<div class="ff-dimmer ff-spin"></div>')).on("click",function(e){e.stopPropagation()}),r.append(t),void r.addClass("ff-dim");!n.dim&&t&&(t.remove(),r.removeClass("ff-dim"),t=null)},n.click=function(r){if(!(r.shiftKey||r.ctrlKey||r.altKey||r.metaKey)){var t=e.$eval(n.ffClick||n.ngClick);t&&t.finally&&(n.dim=!0,t.finally(function(){n.dim=!1}))}}}]),angular.module("flexForms.ffSpin",[]).directive("ffSpin",["$timeout",function(e){return{restrict:"A",priority:-1,link:function(e,r,t){e.$watch(t.ffSpin,function(e){var t=r[0].querySelector("button");r.toggleClass("ff-spin",!!e),t&&angular.element(t).toggleClass("disabled",!!e)})}}}]),angular.module("flexForms.ffTabsPane",[]).component("ffTabsPane",{controller:"TabsPaneController",bindings:{activeItem:"<"}}).controller("TabsPaneController",["$scope","$element","$compile",function(e,r,t){"use strict";var n=this;n.$onChanges=function(){r.empty(),n.activeItem&&n.activeItem.template&&r.append(t(n.activeItem.template)(e))}}]),angular.module("flexForms.ffTabs",["flexForms.ffTabsPane"]).component("ffTabs",{template:'<ff-row ng-repeat="item in $ctrl.items"><span class="ff-control" ng-class="{ active: item === $ctrl.activeItem }" ng-click="$ctrl.onClick(item)">{{item.name}}<i class="fa fa-angle-right"></i></span></ff-row>',controller:"TabsController",bindings:{items:"<",activeItem:"=",layout:"@"}}).controller("TabsController",["$scope","$element",function(e,r){"use strict";var t=this;t.$onChanges=function(){var e=t.items||[];t.activeItem=e.indexOf(t.activeItem)<0?e[0]:t.activeItem},t.$postLink=function(){r.addClass(t.layout)},t.onClick=function(e){t.activeItem=e}}]),angular.module("flexForms.ffHint",[]).directive("ffHint",function(){"use strict";return{restrict:"EAC",compile:function(e,r){e.addClass("ff-hint ff-tip-trigger");var t=angular.element('<ff-icon sense="info" class="text-primary"></ff-icon>'),n=angular.element("<ff-tip></ff-tip>");return t.addClass("text-"+r.hintType||"success"),t.attr("sense","warning"===r.hintType?"warning":"info"),n.attr("tip-type",r.hintType),n.append(e.html()),e.empty().append(t.append(n)),function(e,r,t){}}}}),angular.module("flexForms.ffTip",[]).directive("ffTip",["$window","$timeout",function(e,r){"use strict";return{restrict:"EAC",compile:function(t,n){t.addClass("ff-tip"),t.addClass(n.tipType);var i=angular.element('<div class="ff-tip-inner"></div>').append(t.html());t.empty().append(i);var s=angular.element("<i></i>");return t.append(s),function(t,n,i){for(var s,o="FF-TIP"===n[0].nodeName?n.parent():n,a=angular.element(n[0].querySelector("i")),l=0,c=o;l<5&&c.length;l++,c=c.parent())if(c.hasClass("ff-tip-trigger")){o=c;break}for(var u=0,d=n.parent();u<5&&d.length;u++,d=d.parent())if(d.hasClass("ff-tip-viewport")){s=d;break}function f(){n.hasClass("rc-marker-info")&&(n.css("margin-left",0),a.css("margin-left",0),r(function(){var r=n[0].getBoundingClientRect(),t=a[0].getBoundingClientRect(),i=parseInt(e.getComputedStyle(n[0]).marginLeft);i=Math.min(i-(r.right-e.innerWidth),0),n.css("margin-left",i+"px"),a.css("margin-left",Math.min(-i,(r.width-t.width)/2)+"px")},100)),s&&n.hasClass("ff-tip-right")?(n.css("margin-top",0),e.requestAnimationFrame(function(){!function r(t){if(!s)return;var i=s[0].getBoundingClientRect();var o=n[0].getBoundingClientRect();var l;o.top<i.top||o.height>i.height?(l=parseInt(n.css("margin-top")),l+=i.top-o.top+5,n.css("margin-top",l+"px"),a.css("margin-top",-Math.min(l,o.height/2-8)+"px")):o.bottom>i.bottom&&(l=parseInt(n.css("margin-top")),l+=i.bottom-o.bottom-5,n.css("margin-top",l+"px"),a.css("margin-top",Math.min(-l,o.height/2-5)+"px"));t>0&&e.requestAnimationFrame(function(){r(t-1)})}(10)})):n.toggleClass("ff-tip-bottom",o[0].getBoundingClientRect().top<parseInt(e.getComputedStyle(n[0]).height))}o.addClass("ff-tip-trigger"),o.on("mouseenter",f),t.$on("$destroy",function(){o.off("mouseenter",f)})}}}}]),angular.module("flexForms.ngCollapse",[]).directive("ngCollapse",["$compile","ffHelper",function(e,r){return{restrict:"A",compile:function(r,t){var n;return"false"!=t.lazyRendering&&(n=r.html(),r.empty()),r.addClass("ng-collapse ng-collapsed"),function(r,t,i,s){i.ngCollapse&&r.$watch(function(){return r.$eval(i.ngCollapse)},function(s){angular.isUndefined(s)&&(s=!1),"false"==i.lazyRendering||s||t.html()||(console.log("lazy"),t.append(e(n)(r))),t.toggleClass("ng-collapsed",s)})}}}}]),angular.module("flexForms.validation.ngDateDiff",[]).directive("ngDateDiff",["$parse","$timeout",function(e,r){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){var s=e.$on("ngDateDiff:validate",function(){i.$validate()});e.$on("$destroy",function(){s()}),e.$watch(n.ngModel,function(t){r(function(){for(var r=e;r.$parent&&!r.hasOwnProperty("vm");)r=r.$parent;r.$broadcast("ngDateDiff:validate")})}),i.$validators.dateDiff=function(r,t){var i,s=e.$eval(n.ngDateDiff);return angular.isObject(s)||(i=s,s=e.$eval(n.ngDateOrder)),Math.abs(s.late-s.early)/36e5<i}}}}]),angular.module("flexForms.validation.ngDateOrder",[]).directive("ngDateOrder",["$parse","$timeout",function(e,r){"use strict";return{restrict:"A",require:"?ngModel",scope:!0,link:function(e,t,n,i){var s=e.$on("ngDateOrder:validate",function(){i.$validate()});e.$on("$destroy",function(){s()}),e.$watch(n.ngModel,function(n){r(function(){for(var r=e;r.$parent&&!r.hasOwnProperty("vm");)r=r.$parent;r.$broadcast("ngDateOrder:validate",t[0].name)})}),i.$validators.dateOrder=function(r,i){var s,o,a=e.$eval(n.ngDateOrder),l=t.parent().parent()[0];return l&&l.tagName&&"ff-date"===l.tagName.toLowerCase()?(moment.isMoment(a.early)&&(s=a.early.clone()).hour(0).minute(0).second(0).millisecond(0),moment.isMoment(a.late)&&(o=a.late.clone()).hour(0).minute(0).second(0).millisecond(0),!moment.isMoment(s)||!moment.isMoment(o)||s<=o):!moment.isMoment(a.early)||!moment.isMoment(a.late)||a.early<a.late}}}}]),angular.module("flexForms.validation.ngGt",[]).directive("ngGt",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){n.$validators.gt=function(r,n){var i=parseFloat(n),s=e.$eval(t.ngGt);return s=angular.isDefined(s)?parseFloat(s):parseFloat(t.ngGt),isNaN(i)||isNaN(s)||i>s},e.$watch(t.ngGt,function(){n.$validate()})}}}),angular.module("flexForms.validation.ngGte",[]).directive("ngGte",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){n.$validators.gte=function(r,n){var i=parseFloat(n),s=e.$eval(t.ngGte);return s=angular.isDefined(s)?parseFloat(s):parseFloat(t.ngGte),isNaN(i)||isNaN(s)||i>=s},e.$watch(t.ngGte,function(){n.$validate()})}}}),angular.module("flexForms.validation.ngLt",[]).directive("ngLt",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){n.$validators.lt=function(r,n){var i=parseFloat(n),s=e.$eval(t.ngLt);return s=angular.isDefined(s)?parseFloat(s):parseFloat(t.ngLt),isNaN(i)||isNaN(s)||i<s},e.$watch(t.ngLt,function(){n.$validate()})}}}),angular.module("flexForms.validation.ngLte",[]).directive("ngLte",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){n.$validators.lte=function(r,n){var i=parseFloat(n),s=e.$eval(t.ngLte);return s=angular.isDefined(s)?parseFloat(s):parseFloat(t.ngLte),isNaN(i)||isNaN(s)||i<=s},e.$watch(t.ngGte,function(){n.$validate()})}}}),angular.module("flexForms.validation.ngMatch",[]).directive("ngMatch",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){if(n&&t.ngMatch){var i=function(r){var i=e.$eval(t.ngMatch);return n.$setValidity("match",!i&&!r||r===i),r};n.$parsers.push(i),e.$watch(t.ngMatch,function(){i(n.$viewValue)})}}}}),angular.module("flexForms.validation.ngNotContain",[]).directive("ngNotContain",function(){"use strict";return{restrict:"A",require:"?ngModel",link:function(e,r,t,n){if(n&&t.ngNotContain){var i=function(r){var i=e.$eval(t.ngNotContain);if(!i)return r;angular.isArray(i)||(i=[i]);var s=i.some(function(e){return e&&(r||"").toLowerCase().indexOf(e.toLowerCase())>=0});return n.$setValidity("notContain",!s),r};n.$parsers.push(i),e.$watch(t.ngMatch,function(){i(n.$viewValue)})}}}}),angular.module("flexForms.validation.ngTimeOrder",[]).directive("ngTimeOrder",["$parse","$timeout",function(e,r){return{restrict:"A",require:"?ngModel",scope:!0,link:function(e,t,n,i){var s=e.$on("ngTimeOrder:validate",function(e){i.$validate()});e.$on("$destroy",function(){s()}),e.$watch(n.ngModel,function(n){r(function(){for(var r=e;r.$parent&&!r.hasOwnProperty("vm");)r=r.$parent;r.$broadcast("ngTimeOrder:validate",t[0].name)})}),i.$validators.timeOrder=function(r,t){var i,s,o=e.$eval(n.ngTimeOrder);return moment.isMoment(o.early)&&(i=o.early.clone().year(0).month(0).date(0)),moment.isMoment(o.late)&&(s=o.late.clone().year(0).month(0).date(0)),!moment.isMoment(i)||!moment.isMoment(s)||i<s||!s.hour()&&!s.minute()}}}}]),angular.module("flexForms.validation.ngUnique",[]).directive("ngUnique",["$parse","$timeout",function(e,r){return{restrict:"A",require:"?ngModel",compile:function(e,r){return this.link},link:function(e,t,n,i){var s=e.$on("ngUnique:validate",function(e){i.$validate()});e.$on("$destroy",function(){for(var r=e;r.$parent&&!r.hasOwnProperty("vm");)r=r.$parent;r.$broadcast("ngUnique:validate",t[0].name),s()}),e.$watch(n.ngModel,function(n){r(function(){for(var r=e;r.$parent&&!r.hasOwnProperty("vm");)r=r.$parent;r.$broadcast("ngUnique:validate",t[0].name)})}),i.$validators.unique=function(r,t){var i=e.$eval(n.ngUnique),s=0;return i.array.forEach(function(e){t&&t===e[i.prop]&&s++}),s<=1}}}}]),angular.module("flexForms.ngValidateAlert",[]).directive("ngValidateAlert",["$timeout","$translate","$filter",function(e,r,t){"use strict";return{restrict:"A",require:["ngValidateAlert","ngModel"],scope:!1,controller:function(){},link:function(n,i,s,o){var a,l=o[0],c=o[1];a=(a=i.parent().attr("ng-form")?i.parent().parent().parent()[0].querySelector("ff-label"):i.parent().parent()[0].querySelector("ff-label"))?angular.element(a):i.parent();var u=angular.element(document.createElement("div")).addClass("ng-validate-alert").toggleClass("top","checkbox"===i.attr("type")||"ff-label"!==a[0].tagName.toLowerCase());function d(){e(function(){if(!c.$invalid||!c.$touched&&!c.$dirty&&!c.$error.ext)return u.removeClass("visible").html("");var e;try{e=n.$eval(s.ngValidateAlert)}catch(e){}e||(e={field:s.ngValidateAlert});var o=function(e){if(c.$error.required)return e.required||r.instant("GLOBAL.VALIDATION.REQUIRED",e);if(c.$error.date||c.$error.parse&&i.hasClass("ff-date"))return e.date||r.instant("GLOBAL.VALIDATION.DATE",e);if(c.$error.time||c.$error.parse&&i.hasClass("ff-time"))return(e.time||r.instant("GLOBAL.VALIDATION.TIME",e)).replace("Date","Time");if(c.$error.email)return e.email||r.instant("GLOBAL.VALIDATION.EMAIL",e);if(c.$error.url)return e.url||r.instant("GLOBAL.VALIDATION.URL",e);if(c.$error.minlength)return e.minlength||r.instant("GLOBAL.VALIDATION.MIN_LENGTH",{minLength:s.ngMinlength||s.minlength,field:e.field});if(c.$error.maxlength)return e.maxlength||r.instant("GLOBAL.VALIDATION.MAX_LENGTH",{maxlength:s.ngMaxlength||s.maxlength,field:e.field});if(c.$error.number)return e.number||r.instant("GLOBAL.VALIDATION.NUMBER",e);if(c.$error.price)return e.price||r.instant("GLOBAL.VALIDATION.PRICE",e);if(c.$error.pattern)return e.pattern;if(c.$error.match)return e.match||r.instant("GLOBAL.VALIDATION.MATCH",e);if(c.$error.cctype)return e.cctype||r.instant("GLOBAL.VALIDATION.CC_TYPE",l);if(c.$error.ccnumber)return e.ccnumber||r.instant("GLOBAL.VALIDATION.CC_NUMBER",e);if(c.$error.unique)return e.unique||r.instant("GLOBAL.VALIDATION.UNIQUE",e);if(c.$error.lte){var o=n.$eval(s.ngLte);return angular.isUndefined(o)&&(o=s.ngLte),e.lte||r.instant("GLOBAL.VALIDATION.LTE",{field:e.field,value:o})}if(c.$error.lt){var a=n.$eval(s.ngLt);return angular.isUndefined(a)&&(a=s.ngLt),e.lt||r.instant("GLOBAL.VALIDATION.LT",{field:e.field,value:a})}if(c.$error.gte){var u=n.$eval(s.ngGte);return angular.isUndefined(u)&&(u=s.ngGte),e.gte||r.instant("GLOBAL.VALIDATION.GTE",{field:e.field,value:u})}if(c.$error.gt){var d=n.$eval(s.ngGt);return angular.isUndefined(d)&&(d=s.ngGt),e.gt||r.instant("GLOBAL.VALIDATION.GT",{field:e.field,value:d})}if(c.$error.dateOrder||c.$error.timeOrder){if(angular.isString(e.late))return r.instant("GLOBAL.VALIDATION.DATE_BEFORE",{field:e.field,value:e.late});if(angular.isString(e.early))return r.instant("GLOBAL.VALIDATION.DATE_AFTER",{field:e.field,value:e.early})}if(c.$error.dateDiff){if(angular.isString(e.late))return r.instant("GLOBAL.VALIDATION.DATE_DIFF",{field:e.field,refField:e.late,value:t("hours")(s.ngDateDiff)});if(angular.isString(e.early))return r.instant("GLOBAL.VALIDATION.DATE_DIFF",{field:e.field,refField:e.early,value:t("hours")(s.ngDateDiff)})}if(c.$error.notContain)return e.notContain}(e);o&&u.addClass("visible").html(o)},200)}a.append(u),i.on("focus",function(){i.on("checkbox"===i.attr("type")?"change":"input",d),d()}),i.on("blur",function(){i.off("checkbox"===i.attr("type")?"change":"input",d),u.removeClass("visible").html("")})}}}]),angular.module("deskworks.members.checkInLog.list",["deskworks.checkInLog.service","deskworks.routeHelper"]).config(["$routeProvider",function(e){"use strict";e.when("/member-log",{templateUrl:"members/check-in-log/check-in-log.tpl.html",controller:"CheckInLogCtrl as $ctrl",label:"Check In Log",routeBranch:"member-log",translations:["check-in-log"],resolve:{user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}]}})}]).controller("CheckInLogCtrl",["$scope","$timeout","$translate","dwAlerts","state","helper","user","checkInLogService",function(e,r,t,n,i,s,o,a){"use strict";var l=this;l.state=i,l.operations=[{id:"checkIn",name:t.instant("CHECK_IN_LOG.CHECK_IN")},{id:"checkOut",name:t.instant("CHECK_IN_LOG.CHECK_OUT")}],i.setPageTitle(t.instant("CHECK_IN_LOG.PAGE_TITLE",{userName:o.firstName+" "+o.lastName})),l.fetch=function(e){return l.fetching=!0,a.getLog(i.getCurrentCenterId(),i.getCurrentUserId(),e||l.memberLog&&l.memberLog.page||1,100,l.mac||null).catch(function(e){return n.error(e,"Failed to query check-in log.")}).then(function(e){l.memberLog=e,angular.forEach(l.memberLog&&l.memberLog.log,function(e){e.operation=s.findByKeyValue(l.operations,"id",e.operation)||l.operations[0]})}).finally(function(){l.fetching=!1})},l.fetch(),l.delete=function(e){return a.deleteLog(i.getCurrentCenterId(),i.getCurrentUserId(),e.id).catch(function(e){return n.error(e,"Failed to delete check-in log record.")}).then(function(){l.memberLog.log.splice(s.findIndexByKeyValue(l.memberLog.log,"id",e.id),1),0===l.memberLog.log.length&&r(function(){+l.memberLog.page>1?l.fetch(+l.memberLog.page-1):l.fetch(+l.memberLog.page)},3e3)})},l.create=function(){l.rec={id:"new",operation:l.operations[0],time:moment()},window.scrollTo(0,0)},l.save=function(){if(!s.pointFirstInvalid("#checkInLogRec"))return a.checkInOut(i.getCurrentCenterId(),i.getCurrentUserId(),l.rec.operation.id,l.rec.time).catch(function(e){return n.error(e,"Failed to save check-in log record.")}).then(function(e){return l.rec.id=e.id,l.rec=null,l.fetch()})},l.setMac=function(e,r){e&&e.preventDefault(),l.mac!==r&&(l.mac=r,l.fetch(1))}}]),angular.module("deskworks.ManualCheckInLogCtrl",["deskworks.ManualCheckInLog","deskworks.ManualCheckIn","deskworks.routeHelper","session"]).config(["$routeProvider",function(e){"use strict";e.when("/manual-check-in-log",{templateUrl:"members/manual-check-in-log/manual-check-in-log.tpl.html",controller:"ManualCheckInLogCtrl as $ctrl",label:"Manual Check In Log",routeBranch:"manual-check-in-log",translations:["check-in-log"],resolve:{user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}]}})}]).controller("ManualCheckInLogCtrl",["$scope","$timeout","$translate","dwAlerts","state","helper","user","ManualCheckInLog","ManualCheckIn","session",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;u.isAdmin=c.isAdmin(),u.ops=[{id:"checkIn",name:t.instant("CHECK_IN_LOG.CHECK_IN")},{id:"checkOut",name:t.instant("CHECK_IN_LOG.CHECK_OUT")}],i.setPageTitle(t.instant("MANUAL_CHECK_IN_LOG.PAGE_TITLE",{userName:s.join([o.firstName,o.lastName]," ")})),l.query(i.getCurrentCenterId(),i.getCurrentUserId()).catch(function(e){return n.error(e,"Failed to query check-in log.")}).then(function(e){u.rbs=e}),u.fetch=function(e){return u.fetching=!0,a.query(i.getCurrentCenterId(),i.getCurrentUserId(),e||u.data&&u.data.page||1,100).catch(function(e){return n.error(e,"Failed to query manual check-in log.")}).then(function(e){u.data=e}).finally(function(){u.fetching=!1})},u.fetch(),u.delete=function(e){return a.delete(i.getCurrentCenterId(),i.getCurrentUserId(),e.id).catch(function(e){return n.error(e,"Failed to delete manual check-in log record.")}).then(function(){u.data.log.splice(s.findIndexByKeyValue(u.data.log,"id",e.id),1),0===u.data.log.length&&r(function(){+u.data.page>1?u.fetch(+u.data.page-1):u.fetch(+u.data.page)},3e3)})},u.create=function(){u.rec={id:"new",op:u.ops[0],time:moment(),recurringId:u.rbs&&u.rbs[0]&&u.rbs[0].id},window.scrollTo(0,0)},u.save=function(){if(!s.pointFirstInvalid("#manualCheckInLogRec"))return a.save(i.getCurrentCenterId(),i.getCurrentUserId(),u.rec.time,u.rec.recurringId,"checkIn"===u.rec.op.id).catch(function(e){return n.error(e,"Failed to save manual check-in log record.")}).then(function(e){return u.rec.id=e.id,u.rec=null,u.fetch()})}}]),angular.module("deskworks.MemberSignUpMembershipCtrl",["ngRoute","deskworks.center.service","deskworks.membership.service","deskworks.helper"]).controller("MemberSignUpMembershipCtrl",["$scope","$route","$timeout","$translate","$filter","dwAlerts","state","helper","reg","data","membershipService",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;o.setPageTitle(n.instant("MEMBER_SIGN_UP.MEMBERSHIP.PAGE_TITLE")),d.centers=c.centers,d.reg=l,d.settings=c.settings,d.settings.skipPlanMemberSignUp&&(d.reg.stepCount-=1),d.center=a.findByKeyValue(d.centers,"id",o.getCurrentCenterId()),d.center||1!==d.centers.length||(d.center=d.centers[0]),d.loadMembershipTypes=function(){d.center&&!d.settings.skipPlanMemberSignUp&&(d.updating=!0,u.query(d.center.id).then(function(e){d.membershipTypes=e.filter(function(e){return e.products.length>0}),delete d.membershipProduct,d.updating=!1,d.membershipStartDate=o.getParam("membershipStartDate"),d.membershipStartDate=d.membershipStartDate?i("toDate")(d.membershipStartDate):moment(),d.membershipTypes.some(function(e){var r=a.findByKeyValue(e.products,"id",o.getParam("productId"));return r?(d.membershipType=e,d.membershipProduct=r):delete d.membershipType,!!r})}).catch(function(e){return d.updating=!1,s.error(e,"Failed to query membership categories.")}))},d.loadMembershipTypes(),d.membershipTypeChange=function(){delete d.membershipProduct},d.next=function(){if(!a.pointFirstInvalid("#memberSignUpMembership"))return o.replace(),o.setCurrentCenterId(d.center.id),d.settings.skipPlanMemberSignUp||o.setParam("productId",d.membershipProduct.id),o.setParam("membershipStartDate",i("date")(d.membershipStartDate,"yyyy-MM-dd")),t(function(){return o.setPath(o.getPath()+"/"+(o.getCurrentUserId()||"new"))})}}]),angular.module("deskworks.MemberSignUpProfileCtrl",["ngRoute","deskworks.routeHelper","deskworks.helper","deskworks.userProfile.service","deskworks.userProfile.optsMembershipStatus"]).controller("MemberSignUpProfileCtrl",["$scope","$timeout","$q","$translate","dwAlerts","helper","state","userProfile","reg","userProfileService","purchaseService","settings","optsMembershipStatus",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;p.reg=l,p.schema=a.schema,p.userProfile=a,p.settings=d,o.getParam("productId")||(p.reg.stepCount-=1,p.userProfile.membershipStatus=f[0]),o.setPageTitle(n.instant(p.reg.new?"USER_PROFILE.NEW_MEMBER.PAGE_TITLE":"USER_PROFILE.PAGE_TITLE",{userName:p.userProfile.firstName+" "+p.userProfile.lastName})),c.bindTestUserGenerator(e,p.userProfile,p.reg),p.next=function(){if(!s.pointFirstInvalid("#userProfile"))return t.when().then(function(){if(p.reg.new)return c.registerNewUser(o.getCurrentCenterId(),p.userProfile,!0)}).then(function(){if(p.reg.new)return o.login(p.userProfile.login,p.userProfile.password).catch(function(e){return i.error(e,"Failed to login under created user.")})}).then(function(){if(p.reg.new)return o.replace(),o.setPath(o.getPath().replace(/\/new/,"/"+p.userProfile.id)),r()}).then(function(){if(o.getParam("productId"))return u.createPurchase(o.getCurrentCenterId(),p.userProfile.id,!0,o.getParam("productId"),null,o.getParam("membershipStartDate")).catch(function(e){return i.error(e,"Failed to create purchase.")})}).then(function(e){return o.getParam("productId")?o.setPath(o.getPath()+"/purchases/"+e.id):o.setPath(o.getPath()+"/billing")})},p.back=o.back}]),angular.module("deskworks.MemberSignUpPurchaseCtrl",["ngRoute","deskworks.helper","deskworks.dwAddCharges","deskworks.purchase.service"]).controller("MemberSignUpPurchaseCtrl",["$scope","$route","$translate","dwAlerts","helper","state","reg","center","purchase","purchaseService","userProfileService",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;d.reg=o,d.center=a,d.purchase=l,s.setPageTitle(t.instant("MEMBER_SIGN_UP.PURCHASE.PAGE_TITLE",{centerName:a.name})),d.next=function(){return s.setPath(s.getPath()+"/billing")},d.back=s.back,d.staffHelp=function(){return c.createStaffHelp(d.center.id,r.current.params.userId,r.current.params.purchaseId,!0,s.getParam("productId")).catch(function(e){return n.error(e,"Failed to create staff help.")}).then(function(t){return u.resetCache(),u.get(s.getCurrentCenterId(),r.current.params.userId).catch(function(e){return n.error(e,"Failed to get user profile.")}).then(function(r){return session.user.role=r.role,e.$emit("LOGIN"),s.setParam("notice",t.notice),s.setPath(s.getPath()+"/staff-help")})})},d.updateInvoice=function(){return c.get(s.getCurrentCenterId(),s.getCurrentUserId(),d.purchase.id).catch(function(e){return n.error(e,"Failed to update invoice.")}).then(function(e){d.purchase=e})}}]),angular.module("deskworks.MemberSignUpBillingCtrl",["ngRoute","deskworks.userProfile.service","deskworks.purchase.service","deskworks.routeHelper","deskworks.helper"]).controller("MemberSignUpBillingCtrl",["$scope","$timeout","$route","$window","$translate","helper","state","dwAlerts","userProfile","reg","settings","session","userProfileService","purchaseService",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p){"use strict";var m=this;if(m.userProfile=l,m.reg=c,m.settings=u,o.setPageTitle(i.instant("BILLING_PROFILE.PAGE_TITLE",{userName:m.userProfile.firstName+" "+m.userProfile.lastName})),u.creditCardTypes=u.creditCardTypes.filter(function(e){return e.enable}),m.userProfile.creditCards.forEach(function(e){e.type=s.findByKeyValue(u.creditCardTypes,"id",e.type)||e.type||{}}),m.userProfile.creditCards=m.userProfile.creditCards||[],!m.userProfile.creditCards.length){var h=f.creditCard.new(m.userProfile);h.type=u.creditCardTypes[0],m.userProfile.creditCards.push(h)}f.bindTestBillingGenerator(e,m.userProfile,m.reg),m.next=function(){if(!s.pointFirstInvalid("#simpleReservationBilling")){var i=o.prohibitBack(["MemberSignUpPurchaseCtrl"],"Please wait until payment gets completed.",e);return f.saveBillingProfile(o.getCurrentCenterId(),m.userProfile).then(function(){return p.createPayment(o.getCurrentCenterId(),t.current.params.userId,t.current.params.purchaseId,{},!0,o.getParam("productId"),o.getParam("membershipStartDate")).catch(function(e){return a.error(e,"Failed to make payment.")}).then(function(){return o.getParam("redirect")?(n.location.href=o.getParam("redirect")+"&login="+m.userProfile.login,r(15e3)):(f.resetCache(),f.get(o.getCurrentCenterId(),t.current.params.userId).catch(function(e){return a.error(e,"Failed to get user profile.")}).then(function(r){return d.user.role=r.role,e.$emit("LOGIN"),o.setPath(o.getPath()+"/complete")}))})}).catch(i)}},m.staffHelp=function(){return p.createStaffHelp(o.getCurrentCenterId(),t.current.params.userId,t.current.params.purchaseId,!0,o.getParam("productId")).catch(function(e){return a.error(e,"Failed to create staff help.")}).then(function(r){return f.resetCache(),f.get(o.getCurrentCenterId(),t.current.params.userId).catch(function(e){return a.error(e,"Failed to get user profile.")}).then(function(t){return d.user.role=t.role,e.$emit("LOGIN"),o.setParam("notice",r.notice),o.setPath(o.getPath().replace(/\/billing$/,"/staff-help"))})})},m.back=o.back}]),angular.module("deskworks.MemberSignUpCompleteCtrl",[]).controller("MemberSignUpCompleteCtrl",["$scope","$q","$timeout","$translate","dwAlerts","state","helper","deskworksConfig","center","purchase",function(e,r,t,n,i,s,o,a,l,c){"use strict";this.center=l,this.purchase=c,s.setPageTitle(n.instant("MEMBER_SIGN_UP.COMPLETE.PAGE_TITLE")),e.$on("$routeChangeStart",function(e,r,t){r.$$route&&"MemberSignUpBillingCtrl"===r.$$route.controller&&(i.error(n.instant("MEMBER_SIGN_UP.COMPLETE.BACK_ERROR")),e.preventDefault())}),this.home=function(){var e=s.getParam("origin"),n=s.getCurrentCenterId();return(e?s.logout():r.when()).finally(function(){s.resetParams(),s.setPath(e||a.getDefaultRoute()),e&&s.setCurrentCenterId(n)}),t(1e4)}}]),angular.module("deskworks.memberSignUp",["forbidStaff","deskworks.StaffHelpCtrl","deskworks.MemberSignUpProfileCtrl","deskworks.MemberSignUpMembershipCtrl","deskworks.MemberSignUpPurchaseCtrl","deskworks.MemberSignUpBillingCtrl","deskworks.MemberSignUpCompleteCtrl","deskworks.MemberSignUpNoPlanBillingCtrl","deskworks.MemberSignUpNoPlanCompleteCtrl"]).config(["$routeProvider",function(e){"use strict";e.when("/member-sign-up",{template:"<forbid-staff><div><ng-include src=\"'members/member-sign-up/01-membership.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpMembershipCtrl",controllerAs:"vm",label:"New Membership",routeBranch:"member-sign-up",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up"],resolve:{reg:function(){return{member:!0,selfRegistration:!0,step:1,stepCount:4}},data:["$q","dwAlerts","centerService","setupService","state","filterNonEmptyCenters",function(e,r,t,n,i,s){return e.all({centers:t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")}).then(s),settings:n.getSetupSettings().catch(function(e){return r.error(e,"Failed to get setup settings.")})}).then(function(e){return e.centers.length?e.settings.skipPlanMemberSignUp&&1===e.centers.length?(i.setCurrentCenterId(e.centers[0].id),i.setPath(i.getPath()+"/"+(i.getCurrentUserId()||"new"))):e:r.error("<b>No public centers.</b> At least one center needs <b>Center for Internal Use</b> setting <b>turned off.</b>")})}]}}),e.when("/member-sign-up/new",{template:"<forbid-staff><div><ng-include src=\"'members/user-profile/user-profile.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpProfileCtrl",controllerAs:"vm",label:"Member Sign Up",routeBranch:"member-sign-up",hideSidebar:!0,userTasksPolicy:!1,translations:["user-profile"],resolve:{reg:["$q","dwAlerts","centerService","setupService","filterNonEmptyCenters",function(e,r,t,n,i){return e.all({centers:t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")}).then(i),settings:n.getSetupSettings().catch(function(e){return r.error(e,"Failed to get setup settings.")})}).then(function(e){return e.centers.length?e.settings.skipPlanMemberSignUp&&1===e.centers.length?{member:!0,selfRegistration:!0,step:1,stepCount:3,new:!0}:{member:!0,selfRegistration:!0,step:2,stepCount:4,new:!0}:r.error("<b>No public centers.</b> At least one center needs <b>Center for Internal Use</b> setting <b>turned off.</b>")})}],userProfile:["dwAlerts","userProfileService","helper","state","centerService",function(e,r,t,n,i){return i.getCenter(n.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")}).then(function(t){return r.new(t,"member","signUp").catch(function(r){return e.error(r,"Failed to get new member profile template.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/member-sign-up/:userId",{template:"<forbid-staff><div><ng-include src=\"'members/user-profile/user-profile.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpProfileCtrl",controllerAs:"vm",label:"Member Sign Up",routeBranch:"member-sign-up",hideSidebar:!0,userTasksPolicy:!1,translations:["user-profile"],resolve:{reg:["$q","dwAlerts","centerService","setupService","filterNonEmptyCenters",function(e,r,t,n,i){return e.all({centers:t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")}).then(i),settings:n.getSetupSettings().catch(function(e){return r.error(e,"Failed to get setup settings.")})}).then(function(e){return e.centers.length?e.settings.skipPlanMemberSignUp&&1===e.centers.length?{member:!0,selfRegistration:!0,step:1,stepCount:3}:{member:!0,selfRegistration:!0,step:2,stepCount:4}:r.error("<b>No public centers.</b> At least one center needs <b>Center for Internal Use</b> setting <b>turned off.</b>")})}],userProfile:["dwAlerts","$route","routeHelper","userProfileService",function(e,r,t,n){return t.auth().then(function(){return n.getForRegistration(0,r.current.params.userId,"member","signUp").catch(function(r){return e.error(r,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/member-sign-up/:userId/purchases/:purchaseId",{template:"<forbid-staff><div><ng-include src=\"'members/member-sign-up/03-purchase.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpPurchaseCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up","purchase"],resolve:{reg:function(){return{member:!0,selfRegistration:!0,step:3,stepCount:4}},center:["dwAlerts","state","centerService",function(e,r,t){return t.get(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],purchase:["$route","dwAlerts","state","routeHelper","purchaseService",function(e,r,t,n,i){return n.auth().then(function(){return i.get(t.getCurrentCenterId(),e.current.params.userId,e.current.params.purchaseId,t.getParam("productId")).catch(function(e){return r.error(e,"Failed to get purchase.")})})}]}}),e.when("/member-sign-up/:userId/purchases/:purchaseId/billing",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/09-billing/billing.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpBillingCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up","billing-profile","user-profile","simple-reservation"],resolve:{reg:function(){return{member:!0,selfRegistration:!0,step:4,stepCount:4}},userProfile:["$q","$route","dwAlerts","state","routeHelper","userProfileService",function(e,r,t,n,i,s){return i.auth().then(function(){return s.get(n.getCurrentCenterId(),r.current.params.userId).catch(function(e){return t.error(e,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/member-sign-up/:userId/purchases/:purchaseId/staff-help",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/staff-help.tpl.html'\"></ng-include></div></forbid-staff>",controller:"StaffHelpCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{auth:["routeHelper",function(e){return e.auth()}]}}),e.when("/member-sign-up/:userId/purchases/:purchaseId/billing/complete",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/complete.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpCompleteCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up","purchase","simple-reservation"],resolve:{reg:function(){return{member:!0,selfRegistration:!0}},purchase:["$route","dwAlerts","routeHelper","state","purchaseService",function(e,r,t,n,i){return t.auth().then(function(){return i.get(n.getCurrentCenterId(),e.current.params.userId,e.current.params.purchaseId).catch(function(e){return r.error(e,"Failed to get purchase.")})})}],center:["state","dwAlerts","centerService",function(e,r,t){return t.get(e.getCurrentCenterId()).catch(function(e){return r.error(e,"Failed to get center.")})}]}}),e.when("/member-sign-up/:userId/billing",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/09-billing/billing.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpNoPlanBillingCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up","billing-profile","user-profile"],resolve:{reg:["$q","dwAlerts","centerService","setupService","filterNonEmptyCenters",function(e,r,t,n,i){return e.all({centers:t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")}).then(i),settings:n.getSetupSettings().catch(function(e){return r.error(e,"Failed to get setup settings.")})}).then(function(e){return e.centers.length?e.settings.skipPlanMemberSignUp&&1===e.centers.length?{member:!0,selfRegistration:!0,step:2,stepCount:2}:{member:!0,selfRegistration:!0,step:3,stepCount:3}:r.error("<b>No public centers.</b> At least one center needs <b>Center for Internal Use</b> setting <b>turned off.</b>")})}],userProfile:["$route","state","dwAlerts","routeHelper","userProfileService",function(e,r,t,n,i){return n.auth().then(function(){return i.get(r.getCurrentCenterId(),e.current.params.userId).catch(function(e){return t.error(e,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/member-sign-up/:userId/billing/complete",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/complete.tpl.html'\"></ng-include></div></forbid-staff>",controller:"MemberSignUpNoPlanCompleteCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["member-sign-up"],resolve:{reg:function(){return{member:!0,selfRegistration:!0}}}})}]).factory("filterNonEmptyCenters",function(){return function(e){return e.filter(function(e){return e.reservationUnitsCount>0})}}),angular.module("deskworks.MemberSignUpNoPlanBillingCtrl",["ngRoute","deskworks.userProfile.service","deskworks.routeHelper","deskworks.helper"]).controller("MemberSignUpNoPlanBillingCtrl",["$scope","$translate","helper","state","userProfile","reg","settings","userProfileService",function(e,r,t,n,i,s,o,a){"use strict";var l=this;if(l.userProfile=i,l.reg=s,l.settings=o,n.setPageTitle(r.instant("BILLING_PROFILE.PAGE_TITLE",{userName:l.userProfile.firstName+" "+l.userProfile.lastName})),o.creditCardTypes=o.creditCardTypes.filter(function(e){return e.enable}),l.userProfile.creditCards.forEach(function(e){e.type=t.findByKeyValue(o.creditCardTypes,"id",e.type)||e.type||{}}),l.userProfile.creditCards=l.userProfile.creditCards||[],!l.userProfile.creditCards.length){var c=a.creditCard.new(l.userProfile);c.type=o.creditCardTypes[0],l.userProfile.creditCards.push(c)}a.bindTestBillingGenerator(e,l.userProfile,l.reg),l.complete=function(){if(!t.pointFirstInvalid("#simpleReservationBilling"))return a.saveBillingProfile(0,l.userProfile).then(function(){return n.setPath(n.getPath()+"/complete")})},l.back=n.back}]),angular.module("deskworks.MemberSignUpNoPlanCompleteCtrl",[]).controller("MemberSignUpNoPlanCompleteCtrl",["$scope","$q","$timeout","$translate","state","helper","deskworksConfig",function(e,r,t,n,i,s,o){"use strict";i.setPageTitle(n.instant("MEMBER_SIGN_UP.COMPLETE.PAGE_TITLE")),this.home=function(){var e=i.getParam("origin"),n=i.getCurrentCenterId();return(e?i.logout():r.when()).finally(function(){i.resetParams(),i.setPath(e||o.getDefaultRoute()),e&&i.setCurrentCenterId(n)}),t(1e4)}}]),angular.module("deskworks.MemberUsageCtrl",["deskworks.memberUsageService","deskworks.inventory.product.service","deskworks.routeHelper"]).config(["$routeProvider",function(e){"use strict";e.when("/member-usage",{templateUrl:"members/member-usage/member-usage.tpl.html",controller:"MemberUsageCtrl as $ctrl",label:"Member Usage",routeBranch:"member-usage",translations:["member-usage"],resolve:{memberUsages:["dwAlerts","memberUsageService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.query(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to query member usages.")})})})}],products:["dwAlerts","productService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.getProducts().catch(function(r){return e.error(r,"Failed to query products.")})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],centers:["dwAlerts","centerService",function(e,r){return r.getCenters().catch(function(r){return e.error(r,"Failed to query centers.")})}]}})}]).controller("MemberUsageCtrl",["$scope","$translate","dwAlerts","state","helper","user","memberUsages","products","centers","memberUsageService",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;n.setPageTitle(r.instant("MEMBER_USAGE.PAGE_TITLE",{userName:s.firstName+" "+s.lastName})),u.memberUsages=o,u.memberUsages.days.forEach(function(e){e.collapsed=!0}),u.products=a.reduce(function(e,r){return e[r.id]=r,e},{}),u.centers=l.reduce(function(e,r){return e[r.id]=r,e},{}),u.centers[0]={id:0,name:r.instant("MEMBER_USAGE.FACILITY.ALL")},u.navPage=function(e){return c.query(n.getCurrentCenterId(),n.getCurrentUserId(),e).catch(function(e){return t.error(e,"Failed to query member usages.")}).then(function(e){u.memberUsages=e,u.memberUsages.days.forEach(function(e){e.collapsed=!0})}).catch(angular.noop)},u.delete=function(e,r){return c.delete(n.getCurrentCenterId(),n.getCurrentUserId(),r.id).catch(function(e){return t.error(e,"Failed to delete bucket refill.")}).then(function(){return u.navPage(u.memberUsages.page)}).then(function(){var r=u.memberUsages.days.reduce(function(r,t){return t.date.valueOf()===e.date.valueOf()?t:r},null);r&&(r.collapsed=e.collapsed)}).catch(angular.noop)}}]),angular.module("deskworks.OurMemberModalCtrl",[]).controller("OurMemberModalCtrl",["$scope","close","member",function(e,r,t){"use strict";e.close=r,e.member=t,e.emails=t.fields.filter(function(e){return"email"===e.type}),e.phones=t.fields.filter(function(e){return"phone"===e.type}),e.urls=t.fields.filter(function(e){return"url"===e.type}),e.fields=t.fields.filter(function(e){return["email","phone","url"].indexOf(e.type)<0}),t.email&&e.emails.unshift({value:t.email}),e.urls.forEach(function(e){var r=(e.name||"").toLowerCase(),t=(e.value||"").toLowerCase();r.indexOf("facebook")>=0||t.indexOf("facebook.com")>=0?e.icon="fa-facebook-square":r.indexOf("twitter")>=0||t.indexOf("twitter.com")>=0?e.icon="fa-twitter-square":r.indexOf("linkedin")>=0||t.indexOf("linkedin.com")>=0?e.icon="fa-linkedin-square":r.indexOf("github")>=0||t.indexOf("github.com")>=0?e.icon="fa-github-square":r.indexOf("youtube")>=0||t.indexOf("youtube.com")>=0?e.icon="fa-youtube-square":r.indexOf("vimeo")>=0||t.indexOf("vimeo.com")>=0?e.icon="fa-vimeo-square":r.match(/google(?:\s|-)?(?:plus|\+)/)||t.indexOf("plus.google.com")>=0?e.icon="fa-google-plus-square":e.icon="fa-globe"})}]),angular.module("deskworks.OurMembersCtrl",["infinite-scroll","dwModal","deskworks.routeHelper","deskworks.OurMembers","deskworks.OurMemberModalCtrl","deskworks.optsOurMembersSort"]).config(["$routeProvider",function(e){"use strict";e.when("/our-members",{templateUrl:"members/our-members/our-members.tpl.html",controller:"OurMembersCtrl as $ctrl",label:"Meet Our Members",routeBranch:"our-members",translations:["our-members"],reloadOnSearch:!1,userTasksPolicy:!1,resolve:{auth:["$route","routeHelper",function(e,r){return r.auth(null).then(function(){e.current.$$route.hideSidebar=!1}).catch(function(){e.current.$$route.hideSidebar=!0})}]}})}]).controller("OurMembersCtrl",["$scope","$translate","$location","$q","dwModal","dwAlerts","state","helper","OurMembers","optsOurMembersSort",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;function d(){u.members=[],u.params.offset=0,u.eof=!1}o.setPageTitle(r.instant("OUR_MEMBERS.PAGE_TITLE")),u.optsSort=c,u.params={centerId:o.getCurrentCenterId(),sort:"name",offset:0,limit:100},d(),e.$watch(function(){return t.search().centerId},function(e){u.params.centerId=angular.isDefined(e)?+e:o.getCurrentCenterId()}),e.$watch("$ctrl.params.centerId",function(e){t.search("centerId",e).replace()}),e.$watch(function(){return t.search().sort},function(e){u.params.sort=e||"name"}),e.$watch("$ctrl.params.sort",function(e){t.search("sort",e).replace()}),e.$watch(function(){return t.search().q},function(e){u.params.q=e||""}),e.$watch("$ctrl.params.q",function(e){t.search("q",e||void 0).replace()}),e.$watchGroup(["$ctrl.params.centerId","$ctrl.params.sort","$ctrl.params.q"],function(e,r){e.some(function(e,t){return e!==r[t]})&&n.when(u.fetching).finally(function(){d(),u.fetch()})}),u.fetch=function(){if(u.eof||u.fetching)return u.fetching;u.fetching=l.query(u.params).catch(function(e){return s.error(e,"Failed to query our members.")}).finally(function(){u.fetching=null}).then(function(e){u.members=u.members.concat(e),u.params.offset+=e.length,u.eof=e.length<u.params.limit})},u.view=function(r){i.show({scope:e,templateUrl:"members/our-members/our-member-modal.tpl.html",controller:"OurMemberModalCtrl",inputs:{member:r}})}}]),angular.module("deskworks.UsageEntryEditCtrl",["deskworks.usageEntryService","deskworks.routeHelper"]).config(["$routeProvider",function(e){"use strict";e.when("/usage-entry/:usageId",{templateUrl:"members/usage-entry/usage-entry-edit.tpl.html",controller:"UsageEntryEditCtrl as $ctrl",label:"Edit",routeBranch:"usage-entry",translations:["usage-entry"],resolve:{usage:["$route","dwAlerts","usageEntryService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return i.selectUser().then(function(){return t.get(n.getCurrentCenterId(),n.getCurrentUserId(),e.current.params.usageId).catch(function(e){return r.error(e,"Failed to get usage entry.")})})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}]}})}]).controller("UsageEntryEditCtrl",["$scope","$filter","$timeout","$route","$translate","dwAlerts","usage","user","usageEntryService","state","helper",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;e.backPath="/usage-entry",c.setPageTitle(i.instant("USAGE_ENTRY.NEW.PAGE_TITLE",{userName:a.firstName+" "+a.lastName})),d.editingUsage=o,"new"===o.id&&t(function(){d.form.$setDirty()}),e.$watch("$ctrl.editingUsage.checkInTime",function(e,r){moment.isMoment(e)&&moment.isMoment(r)&&(e.date()===r.date()&&e.month()===r.month()&&e.year()===r.year()||(d.editingUsage.checkOutTime=moment([e.year(),e.month(),e.date(),d.editingUsage.checkOutTime.hour()||e.hour(),d.editingUsage.checkOutTime.minute()||e.minute(),0,0])))}),d.back=function(){return c.setPath("/usage-entry")},d.save=function(){return l.save(c.getCurrentCenterId(),c.getCurrentUserId(),d.editingUsage).catch(function(e){return s.error(e,"Failed to save usage entry.")}).then(function(){d.form.$setPristine(),n.reload()})}}]),angular.module("deskworks.UsageEntryListCtrl",["deskworks.usageEntryService","deskworks.routeHelper"]).config(["$routeProvider",function(e){"use strict";e.when("/usage-entry",{templateUrl:"members/usage-entry/usage-entry-list.tpl.html",controller:"UsageEntryListCtrl as $ctrl",label:"Usage Entry",routeBranch:"usage-entry",translations:["usage-entry"],resolve:{usageList:["dwAlerts","usageEntryService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.query(t.getCurrentCenterId(),t.getCurrentUserId(),1,15).catch(function(r){return e.error(r,"Failed to query usage entry.")})})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}]}})}]).controller("UsageEntryListCtrl",["$scope","$timeout","$translate","dwAlerts","usageList","user","usageEntryService","state","helper",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;c.usageList=i,a.setPageTitle(t.instant("USAGE_ENTRY.PAGE_TITLE",{userName:s.firstName+" "+s.lastName})),c.create=function(){return a.setPath("/usage-entry/new")},c.delete=function(e){if(confirm("Are you sure to delete the usage?"))return o.delete(a.getCurrentCenterId(),a.getCurrentUserId(),e.id).catch(function(e){n.error(e,"Failed to delete usage entry.")}).then(function(){if(c.usageList.usages.splice(l.findIndexByKeyValue(c.usageList.usages,"id",e.id),1),0===c.usageList.usages.length)return r(function(){return+c.usageList.page>1?c.navPage(+c.usageList.page-1):c.navPage(+c.usageList.page)},3e3)})},c.navPage=function(e){return o.query(a.getCurrentCenterId(),a.getCurrentUserId(),e,15).catch(function(e){return n.error(e,"Failed to query usage entry.")}).then(function(e){c.usageList=e})}}]),angular.module("deskworks.members.userProfile.new",["ngRoute","deskworks.userProfile.service","deskworks.center.service","deskworks.UserField","deskworks.routeHelper","deskworks.helper"]).config(["$routeProvider",function(e){"use strict";e.when("/new-member",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\" ff-bulk-read-only></div>",controller:"RegisterUserCtrl as vm",label:"New Member",routeBranch:"new-member",translations:["user-profile"],resolve:{reg:function(){return{member:!0,selfRegistration:!1,step:1,stepCount:3,new:!0}},userProfile:["$q","$route","dwAlerts","centerService","userProfileService","state","routeHelper",function(e,r,t,n,i,s,o){return r.current.params["self-registration"]&&"false"!==r.current.params["self-registration"]?(s.setPath("/member-sign-up",!0),s.setParam("self-registration"),e.reject()):o.auth().then(function(){return n.get(s.getCurrentCenterId()).then(function(e){return i.new(e,"member","register").catch(function(e){return t.error(e,"Failed to load new member profile template.")})})})}],center:["state","centerService",function(e,r){return e.getCurrentCenterId()?r.get(e.getCurrentCenterId()):{}}]}}),e.when("/new-user",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\" ff-bulk-read-only></div>",controller:"RegisterUserCtrl as vm",label:"New User",routeBranch:"new-user",translations:["user-profile"],resolve:{reg:function(){return{member:!1,selfRegistration:!1,step:1,stepCount:2,new:!0}},userProfile:["dwAlerts","centerService","userProfileService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return r.get(n.getCurrentCenterId()).then(function(r){return t.new(r,"nonMember","register").catch(function(r){return e.error(r,"Failed to load new member profile template.")})})})}],center:["state","centerService",function(e,r){return e.getCurrentCenterId()?r.get(e.getCurrentCenterId()):{}}]}})}]).controller("RegisterUserCtrl",["$scope","$timeout","$translate","$filter","helper","state","dwAlerts","userProfile","reg","center","userProfileService","centerService","setupService","UserField",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p){"use strict";var m=this;s.setPageTitle(t.instant(l.member?"USER_PROFILE.NEW_MEMBER.PAGE_TITLE":"USER_PROFILE.NEW_NON_MEMBER.PAGE_TITLE")),m.reg=l,m.userProfile=a,m.center=c,m.schema=a.schema,f.getSetupSettings().catch(function(e){return o.error(e,"Failed to get setup settings.")}).then(function(e){m.settings=e}),(m.schema.customFields||m.schema.shareable)&&p.query().catch(function(e){return o.error(e,"Failed to query user profile fields.")}).then(function(e){e.forEach(function(e){e.value=null}),m.customFields=e.filter(function(e){return"customFields"===e.section})}),m.reg&&!m.reg.member&&(m.userProfile.password="123456",m.userProfile.passwordConfirmation="123456",e.$watch("vm.userProfile.lastName",function(e){m.userProfile.login=(e||"").toLowerCase().replace(/\W/g,"")+"-"+Date.now()})),m.next=function(){if(!i.pointFirstInvalid("#userProfile"))return u.registerNewUser(s.getCurrentCenterId(),m.userProfile,void 0,m.customFields).then(function(){return s.setPath(s.getPath()+"/"+m.userProfile.id,!0),s.setParam("productId",(m.userProfile.membershipProduct||{}).id),s.setParam("membershipStartDate",n("date")(m.userProfile.membershipStartDate,"yyyy-MM-dd")),s.setCurrentUserId(m.userProfile.id),s.setParam("attachedReservationUnitId",m.userProfile.attachedReservationUnit&&m.userProfile.attachedReservationUnit.id),r(function(){return s.setPath(s.getPath()+"/membership/billing-profile")})})},u.bindTestUserGenerator(e,m.userProfile,m.reg)}]),angular.module("deskworks.members.userProfile.edit",["deskworks.routeHelper","deskworks.helper","deskworks.setup.service","deskworks.userProfile.service","deskworks.UserProfileFields"]).config(["$routeProvider",function(e){"use strict";e.when("/profile",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\" ff-bulk-read-only></div>",controller:"UserProfileEditCtrl",controllerAs:"vm",label:"Profile",routeBranch:"profile",translations:["user-profile"],resolve:{reg:function(){},userProfile:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to load user profile.")})})})}],center:["state","centerService",function(e,r){return e.getCurrentCenterId()?r.get(e.getCurrentCenterId()):{}}]}}),e.when("/new-member/:userId",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\" ff-bulk-read-only></div>",controller:"UserProfileEditCtrl",controllerAs:"vm",label:"New Member",hideBreadcrumbs:"/new-member",routeBranch:"new-member",translations:["user-profile"],resolve:{reg:function(){return{member:!0,selfRegistration:!1,step:1,stepCount:3}},userProfile:["$route","dwAlerts","state","userProfileService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return n.getForRegistration(t.getCurrentCenterId(),e.current.params.userId,"member","register").catch(function(e){return r.error(e,"Failed to load user profile.")})})}],center:["state","centerService",function(e,r){return e.getCurrentCenterId()?r.get(e.getCurrentCenterId()):{}}]}}),e.when("/new-user/:userId",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\" ff-bulk-read-only></div>",controller:"UserProfileEditCtrl",controllerAs:"vm",label:"New User",hideBreadcrumbs:"/new-user",routeBranch:"new-user",translations:["user-profile"],resolve:{reg:function(){return{member:!1,selfRegistration:!1,step:1,stepCount:2}},userProfile:["$route","dwAlerts","state","userProfileService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return n.getForRegistration(t.getCurrentCenterId(),e.current.params.userId,"nonMember","register").catch(function(e){return r.error(e,"Failed to load user profile.")})})}],center:["state","centerService",function(e,r){return e.getCurrentCenterId()?r.get(e.getCurrentCenterId()):{}}]}})}]).controller("UserProfileEditCtrl",["$scope","$translate","$filter","dwAlerts","state","helper","reg","userProfile","userProfileService","setupService","center","UserProfileFields",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f=this;if(o)i.setPageTitle(o.member?"New Member Registration":"New Non-Member Registration");else{var p=r.instant("USER_PROFILE.PAGE_TITLE",{userName:a.firstName+" "+a.lastName});i.setPageTitle(p)}f.reg=o,f.center=u,f.userProfile=a,f.schema=a.schema,f.reg&&f.reg.member&&(f.userProfile.options.membershipTypes.some(function(e){var r=s.findByKeyValue(e.membershipPackages,"id",i.getParam("productId"));return r&&(f.userProfile.membershipType=e,f.userProfile.membershipProduct=r),!!r}),i.getParam("membershipStartDate")&&(f.userProfile.membershipStartDate=t("toDate")(i.getParam("membershipStartDate")))),f.reg||c.getSetupSettings().then(function(e){f.settings=e}).catch(function(e){return n.error(e,"Failed to get setup settings.")}).catch(angular.noop),(f.schema.customFields||f.schema.shareable)&&d.query(i.getCurrentCenterId(),f.userProfile.id).then(function(e){f.customFields=e.filter(function(e){return"customFields"===e.section}),f.shareable=e.filter(function(e){return"shareable"===e.section})}).catch(function(e){return n.error(e,"Failed to query user profile fields.")}).catch(angular.noop),f.next=function(){return i.setParam("productId",(f.userProfile.membershipProduct||{}).id),i.setParam("membershipStartDate",t("date")(f.userProfile.membershipStartDate,"yyyy-MM-dd")),i.setPath(i.getPath()+"/membership/billing-profile")}}]),angular.module("deskworks.members.userProfile",["deskworks.members.userProfile.sections.personalInfo","deskworks.members.userProfile.sections.loginInfo","deskworks.members.userProfile.sections.photo","deskworks.members.userProfile.sections.systemInfo","deskworks.members.userProfile.sections.addresses","deskworks.members.userProfile.sections.phones","deskworks.members.userProfile.sections.comments","deskworks.members.userProfile.sections.membership","deskworks.members.userProfile.sections.printerCodes","deskworks.members.userProfile.sections.documents","deskworks.members.userProfile.sections.leadSource","deskworks.members.userProfile.sections.coMembers","deskworks.members.userProfile.sections.mailboxes","deskworks.members.userProfile.sections.creditCards","deskworks.members.userProfile.sections.eChecks","deskworks.members.userProfile.sections.termsOfService","deskworks.members.userProfile.sections.accessCards","deskworks.members.userProfile.sections.customFields","deskworks.members.userProfile.sections.shareable","deskworks.members.userProfile.new","deskworks.members.userProfile.edit"]),angular.module("deskworks.userSearchState",["deskworks.optsMembershipFilter"]).factory("userSearchState",["$rootScope","$translate","optsMembershipFilter",function(e,r,t){"use strict";var n={advanced:!1,checkedIn:!1,centerId:0,page:1,sort:"lastName",order:1,pageSize:100,columns:[{id:"firstName",_name:"USER_SEARCH.COLUMNS.FIRST_NAME",include:!0},{id:"lastName",_name:"USER_SEARCH.COLUMNS.LAST_NAME",include:!0},{id:"company",_name:"USER_SEARCH.COLUMNS.COMPANY",include:!0},{id:"email",_name:"USER_SEARCH.COLUMNS.EMAIL",advanced:!0,include:!0},{id:"login",_name:"USER_SEARCH.COLUMNS.LOGIN",advanced:!0},{id:"phone",_name:"USER_SEARCH.COLUMNS.PHONE",advanced:!0},{id:"accessCode",_name:"USER_SEARCH.COLUMNS.ACCESS_CODE",advanced:!0},{id:"printerCode",_name:"USER_SEARCH.COLUMNS.PRINTER_CODE",advanced:!0},{id:"mailboxNumber",_name:"USER_SEARCH.COLUMNS.MAILBOX_NUMBER",advanced:!0},{id:"mailboxNames",_name:"USER_SEARCH.COLUMNS.MAILBOX_NAME",advanced:!0},{id:"occupation",_name:"USER_SEARCH.COLUMNS.OCCUPATION",advanced:!0},{id:"joinDate",_name:"USER_SEARCH.COLUMNS.JOIN_DATE",advanced:!0,tpl:"userSearchDateTpl"},{id:"macAddress",_name:"USER_SEARCH.COLUMNS.MAC_ADDRESS",advanced:!0,tpl:"userSearchMacTpl"}],resetColumns:function(){n.columns=angular.copy(i.columns),o()}};n.filters=angular.copy(t);var i=angular.copy(n);function s(){angular.copy(i,n),o()}function o(){n.filters.forEach(function(e){e.name=r.instant(e._name)}),n.columns.forEach(function(e){e.name=r.instant(e._name)})}return e.$on("LOGIN",s),e.$on("LOGOUT",s),o(),e.$on("$setTranslationsSuccess",o),n}]),angular.module("deskworks.members.userSearch",["deskworks.routeHelper","deskworks.dwAlerts","deskworks.state","deskworks.helper","deskworks.dwSelectCenter","deskworks.userSearchState","flexForms.ffPagination","deskworks.userProfile.service"]).config(["$routeProvider",function(e){"use strict";e.when("/user-search",{templateUrl:"members/user-search/user-search.tpl.html",controller:"UserSearchCtrl as $ctrl",label:"User Search",routeBranch:"user-search",reloadOnSearch:!1,userTasksPolicy:!1,translations:["user-search"],resolve:{auth:["routeHelper",function(e){return e.auth()}]}})}]).controller("UserSearchCtrl",["$scope","$filter","$translate","dwAlerts","state","helper","userSearchState","userProfileService",function(e,r,t,n,i,s,o,a){"use strict";var l=this;i.setPageTitle(t.instant("USER_SEARCH.PAGE_TITLE"));var c=e.us=o;c.centerId=i.getCurrentCenterId(),c.users&&(l.previousSearch=!0),c.resetColumns(),c.advanced=!1,l.search=function(e){var t=c.columns.filter(function(e){return!e.advanced||c.advanced}).reduce(function(e,r){return r.value&&(e[r.id]=r.value),e},{}),i=angular.extend({page:e||c.page,pageSize:c.pageSize,sort:c.sort,order:c.order},l.membershipFilter,t);return c.checkedIn&&(i.checkedIn=c.checkedIn),a.search(c.centerId,i).catch(function(e){return n.error(e,"Failed to search users.")}).then(function(e){e.users.forEach(function(e){e.joinDate=r("date")(e.joinDate,"mediumDate")}),angular.extend(c,e),l.previousSearch=!1})},l.filterResultColumns=function(e){return e.include&&(!e.advanced||c.advanced||"email"===e.id)},l.selectUser=function(e){i.setCurrentUserId(e.id);var r=i.getParam("redirect");return r&&"/user-search"!==r?(i.setParam("redirect"),i.setPath(r)):i.setPath("/profile")}}]),angular.module("deskworks.rcCalendar",["deskworks.rcDateSelector","deskworks.rcHelper","deskworks.rcToolbar","deskworks.rcSidebar","deskworks.rcAdjustments","deskworks.rcHeader","deskworks.rcLayerGridH","deskworks.rcLayerGridV","deskworks.rcLayerGridB","deskworks.rcLayerAvailability","deskworks.rcLayerReservations","deskworks.rcLayerActive","deskworks.calendarService"]).directive("rcCalendar",function(){return{scope:!0,templateUrl:"reservations/rc-calendar/rc-calendar.tpl.html",controller:"RcCalendarController as $ctrl",bindToController:{calData:"<",settings:"<"}}}).controller("RcCalendarController",["$element","$scope","$filter","$timeout","$interval","helper","rcHelper","state","dwAlerts","calendarService",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;function d(e){}u.$onInit=function(){u.rowHeight=u.settings.enableCalendarPhotos?50:36,u.rowGroupHeaderHeight=16,u.modes={day:{minWidth:1400,maxWidth:2400},week:{minWidth:1600,maxWidth:3600}},n(function(){u.modes.day.width=1670,u.modes.week.width=2400}),u.mode=a.getParam("mode")||"day",u.filter=a.getParam("filter")||"available",u.role=a.getParam("role"),u.date=t("toDate")(a.getParam("date")),moment.isMoment(u.date)||(u.date=moment()),o.floorDate(u.date,30),r.$watch("$ctrl.date",function(e){a.setParam("date",o.dateToStr(e)).replace()}),r.$watch("$ctrl.mode",function(e){a.setParam("mode",e).replace()}),r.$watch("$ctrl.filter",function(e){a.setParam("filter",e).replace()}),r.$watch("$ctrl.role",function(e){a.setParam("role",e||null).replace()}),n(function(){angular.element(document.querySelector(".rc-scroller")).on("scroll",d)})},u.$onDestroy=function(){i.cancel(u.timer)},r.$watch("$ctrl.mode",function(){var r;e.toggleClass("mode-day","day"===u.mode),e.toggleClass("mode-week","day"!==u.mode),r=u.date,n(function(){var e=document.querySelector(".rc-scroller");e.scrollLeft=Math.floor(u.modes[u.mode].width*u.dateToX(r-144e5)/100)})}),r.$watchGroup(["$ctrl.mode","$ctrl.date","$ctrl.role",function(){return a.getCurrentCenterId()}],function(e,r){angular.equals(e,r)?u.timer=i(u.fetch,6e4):(u.reservations=[],u.availabilities=[],u.fetch(!0))}),r.$watchGroup(["$ctrl.calData","$ctrl.filter","$ctrl.mode"],function(e,r){var t,n;(u.reservations=[],u.availabilities=[],u.staffOnly=[],u.reservationTypes=[],angular.isArray(u.calData))&&(u.calData.forEach(function(e){var r=angular.extend({},e);r.reservationUnits=[],e.reservationUnits.forEach(function(e){var t=e.reservations.filter(function(t){if(o.checkIntersection(t.from,t.to,u.getCalStartDate(),u.getCalEndDate()))return t.reservationType=r,t.reservationUnit=e,!0}),n=e.availabilities.filter(function(t){if(o.checkIntersection(t.from,t.to,u.getCalStartDate(),u.getCalEndDate()))return t.reservationType=r,t.reservationUnit=e,!0});(e.availabilities.length||"all"===u.filter||"staffOnly"===e.whoCanReserve)&&(u.reservations=u.reservations.concat(t),u.availabilities=u.availabilities.concat(n),r.reservationUnits.push(e),n.length||"staffOnly"!==e.whoCanReserve||u.staffOnly.push(e))}),r.reservationUnits.length&&u.reservationTypes.push(r)}),t=u.reservationTypes,n=0,t.forEach(function(e){e.top=n,n+=u.rowGroupHeaderHeight-1,e.reservationUnits.forEach(function(e){e.top=n,n+=u.rowHeight-1})}),u.gridHeight=n)}),u.getCalStartDate=function(){return("week"===u.mode?o.weekStart(u.date):u.date.clone()).hour(0).minute(0).second(0).millisecond(0)},u.getCalEndDate=function(){return("week"===u.mode?o.weekEnd(u.date):u.date.clone()).hour(24).minute(0).second(0).millisecond(0)},u.dateToX=function(e){var r=u.getCalStartDate();return 100*(e-r)/(u.getCalEndDate()-r)},u.fetch=function(e){if(i.cancel(u.timer),!u.fetching||e)return u.fetching=!0,c.query(a.getCurrentCenterId(),o.weekStart(u.date),o.weekEnd(u.date),u.role).then(function(e){u.calData=e}).catch(function(e){return l.error(e,"Failed to fetch calendar data.")}).finally(function(){u.fetching=!1,i.cancel(u.timer),u.timer=i(u.fetch,6e4)})}}]),angular.module("deskworks.rcHelper",[]).factory("rcHelper",["$filter",function(e){"use strict";return{weekStart:function(e){return(moment.isMoment(e)?e.clone():moment()).startOf("week")},weekEnd:function(e){return(moment.isMoment(e)?e.clone():moment()).endOf("week")},floorDate:function(e,r){return e.minutes(Math.floor(e.minutes()/r)*r,0,0),e},dateToStr:function(r){return e("date")(r,"yyyy-MM-ddTHH:mm:00Z")},checkIntersection:function(e,r,t,n){return e<=n&&e>=t||r<=n&&r>=t||e<=t&&r>=n}}}]),angular.module("deskworks.resReservation",["deskworks.rcHelper","deskworks.reservationUnit.optsRepeatFrequency","deskworks.timeSelector","deskworks.reservationService","deskworks.calendarService"]).directive("resReservation",function(){return{scope:!0,templateUrl:"reservations/res-reservation/res-reservation.tpl.html",controller:"ResReservationController as $ctrl",bindToController:{center:"<",calData:"<",user:"<",reservationPrices:"<"}}}).controller("ResReservationController",["$scope","$filter","$interval","$timeout","$route","$window","dwAlerts","helper","rcHelper","state","reservationService","calendarService","optsRepeatFrequency",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;p.$onInit=function(){e.state=c,p.optsRepeatFrequency=f,p.calendarMode=!i.current.params.centerId,p.calData.some(function(e){return e.reservationUnits.some(function(e){var r=a.findIndexByKeyValue(e.reservations,"id",i.current.params.reservationId);return r>=0&&(p.reservation=e.reservations[r],e.reservations.splice(r,1),c.setParam("unit",e.id).replace()),!!p.reservation})}),p.date=r("toDate")(i.current.params.date||c.getParam("date")),p.date=moment.isMoment(p.date)?p.date:moment(),l.floorDate(p.date,30);var n=p.reservation&&p.reservation.from||r("toDate")(c.getParam("start"));p.timeStart=moment.isMoment(n)?n:null,n=p.reservation&&p.reservation.to||r("toDate")(c.getParam("end")),p.timeEnd=moment.isMoment(n)&&p.timeStart?n:null,p.reservationNote=c.getParam("note")||p.reservation&&p.reservation.reservationNote,p.repeatFrequency=a.findByKeyValue(p.optsRepeatFrequency,"id",c.getParam("freq"))||p.optsRepeatFrequency[0],p.repeatDuration=c.getParam("duration")&&+c.getParam("duration")||p.repeatFrequency.repeatDurationOptions&&p.repeatFrequency.repeatDurationOptions[0],p.emailConfirmation=!!c.getParam("confirm"),e.$watch("$ctrl.calData",function(){var e;!function(){if(p.reservationTypes=[],!angular.isArray(p.calData))return;p.calData.forEach(function(e){e.reservationUnits=e.reservationUnits.filter(function(e){return e.availabilities.length||"staffOnly"===e.whoCanReserve}),e.reservationUnits.length&&p.reservationTypes.push(e)})}(),e=i.current.params.reservationUnitId||c.getParam("unit"),p.reservationTypes.some(function(r){var t=a.findByKeyValue(r.reservationUnits,"id",e);if(t)return p.reservationType=r,p.reservationUnit=t,!0}),p.reservationUnit||(p.reservationType=p.reservationTypes[0],p.reservationUnit=p.reservationType&&p.reservationType.reservationUnits[0])}),e.$watch("$ctrl.reservationUnit.id",function(e){c.setParam("unit",e).replace()}),e.$watch("$ctrl.date",function(e){c.setParam("date",l.dateToStr(e)).replace()}),e.$watch("$ctrl.timeStart",function(e){c.setParam("start",l.dateToStr(e)).replace()}),e.$watch("$ctrl.timeEnd",function(e){c.setParam("end",l.dateToStr(e)).replace()}),e.$watch("$ctrl.emailConfirmation",function(e){c.setParam("confirm",e||null).replace()}),e.$watch("$ctrl.repeatFrequency.id",function(e){c.setParam("freq",e).replace()}),e.$watch("$ctrl.repeatDuration",function(e){c.setParam("duration",e).replace()}),e.$watch("$ctrl.reservationNote",function(e){c.setParam("note",e).replace()}),e.$watch("$ctrl.date",function(e,r){e!==r?p.fetch(!0):(t.cancel(p.timer),p.timer=t(p.fetch,6e4))}),e.$watchGroup(["$ctrl.reservationType","$ctrl.timeStart","$ctrl.timeEnd"],function(){if(p.reservationType&&p.timeStart&&p.timeEnd){var e=a.findByKeyValue(p.reservationPrices,"id",p.reservationType.id),r=(p.timeEnd-p.timeStart)/6e4;p.reservationCost=e?e.passes.map(function(e){return function(e,r,t,n){var i=(u=Math.floor(e/60),d=e%60,f=r*t,o=60*u+d,a=f||.25,l=60*a,c=Math.floor(o/l),o-c*l>5&&(c+=1),c*l/60),s=Math.max(+(i/(r||1)).toFixed(2),1);var o,a,l,c;var u,d,f;n>0&&s>n&&(s=n);return s}(r,+e.passSize,+e.passMin,+e.passMax)*e.passPrice}).reduce(function(e,r){return r<e?r:e}):null}else p.reservationPrice=null}),e.$watch(function(){return c.getCurrentCenterId()},function(e,r){e!==r&&i.reload()})},p.$onDestroy=function(){t.cancel(p.timer)},p.next=function(){return p.calendarMode?c.setPath(a.interpolateRoute("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users",{centerId:p.center.id,reservationTypeId:p.reservationType.id,date:r("date")(p.date,"yyyy-MM-dd"),reservationUnitId:p.reservationUnit.id})):c.setPath(c.getPath()+"/users")},p.makeReservation=function(){var e={from:p.timeStart,to:p.timeEnd,reservationNote:p.reservationNote,centerId:p.center.id,reservationUnitId:p.reservationUnit.id,emailConfirmation:p.emailConfirmation,repeatFrequency:p.repeatFrequency.id,repeatDuration:angular.isDefined(p.repeatFrequency.repeatDurationOptions)?p.repeatDuration:""};return u.save(p.center.id,p.user.id,e).catch(function(e){return o.error(e,"Failed to save reservation.")}).then(function(){return p.navCalendar()})},p.updateReservation=function(){var e={id:p.reservation.id,from:p.timeStart,to:p.timeEnd,reservationNote:p.reservationNote,emailConfirmation:p.emailConfirmation};return u.save(p.center.id,p.user.id,e).catch(function(e){return o.error(e,"Failed to update reservation.")}).then(function(){return p.navCalendar()})},p.cancelReservation=function(){return u.delete(p.center.id,p.user.id,p.reservation.id,p.emailConfirmation).catch(function(e){return o.error(e,"Failed to cancel reservation.")}).then(function(){return p.navCalendar()})},p.fetch=function(e){if(t.cancel(p.timer),!p.fetching||e)return p.fetching=!0,d.query(c.getCurrentCenterId()||i.current.params.centerId,p.date,p.date,c.getParam("role")).catch(function(e){return o.error(e,"Failed to fetch calendar data.")}).then(function(e){p.calData=e}).finally(function(){p.fetching=!1,t.cancel(p.timer),p.timer=t(p.fetch,6e4)})},p.navCalendar=function(){return c.setParam("unit",null),c.setParam("start",null),c.setParam("end",null),c.setParam("confirm",null),c.setParam("freq",null),c.setParam("duration",null),c.setParam("note",null),c.setPath("/reservation-calendar")},p.back=c.back}]),angular.module("deskworks.timeSelector",["deskworks.state"]).directive("timeSelector",["$timeout","$filter","state",function(e,r,t){"use strict";r("toDate");return{templateUrl:"reservations/res-reservation/time-selector.tpl.html",restrict:"E",scope:{date:"<",reservations:"<",timeStart:"=",timeEnd:"=",availabilities:"<"},link:function(n,i,s){function o(){n.halves=[];for(var e=n.date.clone().startOf("day"),r=e.clone().add(1,"d");e<r;e.add(.5,"h"))n.halves.push({reserved:!1,time:e.clone(),timeEnd:e.clone().add(.5,"h")})}n.currentUserId=t.getCurrentUserId(),n.state=t,n.timeStartInitial=moment.isMoment(n.timeStart)?n.timeStart.clone():moment(),n.timeEndInitial=moment.isMoment(n.timeEnd)?n.timeEnd.clone():moment(),i.addClass("time-selector"),e(function(){var e=document.querySelector('.halves-wrapper .half[time-str="'+r("date")(n.date,"HH:mm:00")+'"]')||document.querySelector('.halves-wrapper .half[time-str="08:00:00"]');document.querySelector(".halves-wrapper").scrollTop=e.offsetTop}),o(),n.$watch("availabilities",function(e){var r;angular.forEach(n.halves,function(e){e.available=!1}),angular.forEach(n.availabilities,function(e){for(var r=Math.floor(2*e.from.hour()+e.from.minute()/30),t=Math.ceil(2*e.to.hour()+e.to.minute()/30||n.halves.length),i=r;i<t;i++)n.halves[i].available=!0}),n.halves=(r=n.halves).reduce(function(e,r){return r.optional=!1,r.available?++e:e},0)?(n.halves.some(function(e){if(e.available)return!0;e.optional=!0}),n.halves.some(function(e,r,t){if((e=t[t.length-r-1]).available)return!0;e.optional=!0}),r):r}),n.$watch("reservations",function(e,r){moment.isMoment(n.timeStartInitial)&&moment.isMoment(n.timeEndInitial)||n.selectClear(),angular.isDefined(n.reservations)&&(n.halves.forEach(function(e){e.reserved=!1,delete e.text,delete e.userId,delete e.reservedLength}),n.reservations.forEach(function(e){if(!(moment.isMoment(n.timeStartInitial)&&moment.isMoment(n.timeEndInitial)&&e.from.isSame(n.timeStartInitial)&&e.to.isSame(n.timeEndInitial))){var r=2*e.from.hours()+e.from.minutes()/30,t=Math.floor(r),i=r+(e.to-e.from)/1e3/60/60*2,s=Math.floor(i);s+=i!==s?1:0;for(var o=t;o<s;o++)n.halves[o].reserved=!0,n.halves[o].text=e.userCompany?e.userCompany+": ":"",n.halves[o].text+="<strong>"+e.userName+"</strong>",n.halves[o].userId=e.userId,o===t&&(n.halves[o].reservedLength=s-t)}}))}),n.$watch("date",function(e,r){angular.isDefined(e)&&angular.isDefined(r)&&!e.isSame(r)&&(n.selectClear(),o())}),n.selectionStart=n.timeStart?2*n.timeStart.hours()+n.timeStart.minutes()/30:-1,n.selectionEnd=n.timeEnd?n.selectionStart+(n.timeEnd-n.timeStart)/1e3/60/60*2-1:-1,n.selectTime=function(e){var r;if(!n.halves[e].reserved&&n.halves[e].available){if(-1===n.selectionStart)n.selectionStart=e,n.selectionEnd=e;else if(n.selectionEnd===n.selectionStart){if(e>n.selectionStart){for(n.selectionEnd=e,r=n.selectionStart;r<=n.selectionEnd;r++)if(n.halves[r].reserved||!n.halves[r].available){n.selectionStart=e,n.selectionEnd=e;break}}else if(e<n.selectionStart)for(n.selectionEnd=n.selectionStart,n.selectionStart=e,r=n.selectionEnd;r>=n.selectionStart;r--)if(n.halves[r].reserved||!n.halves[r].available){n.selectionStart=e,n.selectionEnd=e;break}}else n.selectionStart=e,n.selectionEnd=e;n.selectionStart>=0&&n.selectionEnd>=0?(n.timeStart=n.halves[n.selectionStart].time.clone(),n.timeEnd=n.halves[n.selectionEnd>=0?n.selectionEnd:n.selectionStart].timeEnd.clone()):(n.timeStart=null,n.timeEnd=null)}},n.selectClear=function(){n.selectionStart=-1,n.selectionEnd=-1,n.timeStart=null,n.timeEnd=null}}}}]),angular.module("autoSave",["debounce"]).factory("autoSave",["$q","debounce",function(e,r){"use strict";return{wrap:function(t,n){return r(function(r){return i=r||this,n&&n.$invalid?e.reject():e.when(i.$autoSaving).catch(function(){}).then(function(){return i.$autoSaving=t.call(i),i.$autoSaving.then(function(){n&&n.$setPristine()}).finally(function(){delete i.$autoSaving}),i.$autoSaving});var i},1e3)}}}]),angular.module("dateFilters",["deskworks.helper"]).config(["$provide",function(e){"use strict";e.decorator("dateFilter",["$delegate",function(e){return function(r,t,n){return r instanceof moment?e(r.toDate(),t,r.format("ZZ")):e(r,t,n)}}])}]).filter("numTimeToDate",function(){return function(e){return moment().hour(Math.floor(+e)).minute(+e%1?30:0).second(0).millisecond(0)}}).filter("toDate",["helper",function(e){"use strict";return function(r){return e.isDateString(r)?r.length<=8?moment.tz(r,"HH:mm:ss",moment.defaultZone.name):moment.tz(r,moment.defaultZone.name):r}}]),angular.module("datesDeserializer",[]).factory("datesDeserializer",["$filter",function(e){"use strict";var r=e("toDate");return function(e,t){return function(t){return t?(t=angular.fromJson(t),angular.forEach(angular.isArray(t)?t:[t],function(t){t&&angular.forEach(angular.isArray(e)?e:[e],function(e){var n=e.split(".");!function e(t,i){if(!i)return;t<n.length-1?angular.isArray(i[n[t]])&&i[n[t]].forEach(function(r){e(t+1,r)}):t<n.length&&(i[n[t]]=r(i[n[t]]))}(0,t)})}),angular.fromJson(t)):t}}}]),angular.module("debounce",[]).factory("debounce",["$timeout",function(e){"use strict";return function(r,t,n){var i;return function(){var s=this,o=arguments,a=n&&!i;return e.cancel(i),i=e(function(){if(i=null,!n)return r.apply(s,o)},t),a?r.apply(s,o):i}}}]),angular.module("deserializeNumbers",["deskworks.helper"]).factory("deserializeNumbers",["helper",function(e){"use strict";return function(e){return function(r){return r?(angular.forEach(angular.isArray(r)?r:[r],function(r){r&&angular.forEach(angular.isArray(e)?e:[e],function(e){var t=e.split(".");!function e(r,n){if(!n)return;r<t.length-1?angular.isArray(n[t[r]])&&n[t[r]].forEach(function(t){e(r+1,t)}):r<t.length&&n[t[r]]&&!isNaN(+n[t[r]])&&(n[t[r]]=+n[t[r]])}(0,r)})}),r):r}}}]),angular.module("deskworks.getAttachments.service",[]).factory("getAttachments",["$q","$timeout",function(e,r){"use strict";return function(t){return e.all(t.map(function(t){return e(function(e){var n=new FileReader;n.onload=function(n){r(function(){e({fileName:t.name,fileData:n.target.result})})},n.readAsDataURL(t)})}))}}]),angular.module("deskworks.helper",[]).factory("helper",["$window","$timeout","$compile","$templateCache","$filter",function(e,r,t,n,i){"use strict";return{findByKeyValue:function(e,r,t){if(angular.isArray(e)&&r)for(var n=0;n<e.length;n++)if(e[n]&&e[n][r]==t)return e[n]},findIndexByKeyValue:function(e,r,t){if(angular.isArray(e)&&r)for(var n=0;n<e.length;n++)if(e[n]&&e[n][r]==t)return n;return-1},findIndex:function(e,r){if(r&&!angular.isObject(r)&&(r={id:r}),angular.isArray(e)&&r){for(var t=0;t<e.length;t++){if(Object.keys(r).every(function(n){return e[t]&&e[t][n]==r[n]}))return t}return-1}},find:function(e,r){var t=this.findIndex(e,r);if(t>=0)return e[t]},isDateString:function(e){return angular.isString(e)&&!(!e.match(/^\d\d\d\d-\d\d-\d\d(?:T\d\d:\d\d:\d\d(?:(?:(?:-|\+)\d\d:?\d\d)|(?:\.\d\d\d\d?)?Z)?)?$/i)&&!e.match(/^\d\d:\d\d(?::?\d\d)?$/i))},isMobile:function(){if(e.navigator.userAgent&&(e.navigator.userAgent.match(/Android/i)||e.navigator.userAgent.match(/webOS/i)||e.navigator.userAgent.match(/iPhone/i)||e.navigator.userAgent.match(/iPad/i)||e.navigator.userAgent.match(/iPod/i)||e.navigator.userAgent.match(/BlackBerry/i)||e.navigator.userAgent.match(/Windows Phone/i)))return!0},isIE:function(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&!(!document.uniqueID&&!window.MSInputMethodContext)},interpolateRoute:function(e,r){var t=[];return angular.forEach((e||"").split(":"),function(e,n){if(0===n)t.push(e);else{var i=e.match(/(\w+)(?:[?*])?(.*)/),s=i[1];t.push(r[s]),t.push(i[2]||"")}}),t.join("")},unique:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)},uid:function(){return"dwuid"+Date.now()+Math.floor(Math.random()*Date.now()+Math.random()*Date.now())},isUid:function(e){return!!String(e).match(/^dwuid\d+/)},stripUid:function(e){if(!String(e).match(/^dwuid\d+/))return e},pointFirstInvalid:function(e){var t=document.querySelector(e+" .ng-invalid:not(ng-form):not(form):not([ng-form])");return t&&r(function(){t.focus(),t.blur(),t.focus()}),t},focus:function(e){r(function(){var r=document.querySelector(e);r&&r.focus()})},trim:function(e){return angular.isUndefined(e)||null===e?"":String(e).trim()},indexSoft:function(e,r,t){if(angular.isArray(e)&&angular.isArray(r)&&angular.isDefined(t)){t=String(t).trim().toLowerCase();for(var n=0;n<e.length;n++)for(var i=0;i<r.length;i++)if(String(e[n][r[i]]).trim().toLowerCase()===t)return n}return-1},searchSoft:function(e,r,t){if(angular.isArray(e)&&angular.isArray(r)&&angular.isDefined(t)){t=String(t).trim().toLowerCase();for(var n=0;n<e.length;n++)for(var i=0;i<r.length;i++)if(String(e[n][r[i]]).trim().toLowerCase()===t)return e[n]}},scrollTo:function(r){var t=document.querySelector(r);t&&e.scrollTo(0,e.pageYOffset+t.getBoundingClientRect().top)},purify:function(e,r,t){var n=this,i={};return r=angular.isArray(r)?r:Object.keys(r||{}),Object.keys(e).forEach(function(s){"$"===s[0]||r.some(function(e){return s===e})||(i[t?n.toDashCase(s):s]=e[s])}),i},transcludeElement:function(e,r,i,s,o){return r.after(this.transcludeAttrs(t(n.get(s))(e),i,o))},transcludeAttrs:function(e,r,t){return e.attr(this.purify(r,t,!0))},toDashCase:function(e){return e.replace(/[A-Z]/g,function(e,r){return(r?"-":"")+e.toLowerCase()})},join:function(e,r){return e.filter(function(e){return e}).join(r)},rgb2hex:function(e){if(!e||/^#[0-9A-F]{6}$/i.test(e))return e;function r(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+r((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+r(e[2])+r(e[3])},hex2rgbArr:function(e){if("string"==typeof e&&/^#[0-9A-Fa-f]{6}$/.test(e)){var r=parseInt(e.substr(1),16);return[r>>16&255,r>>8&255,255&r]}return e},toNumber:function(e){return e=+e,!isNaN(e)&&isFinite(e)?e:0},round:function(e,r){var t=+"1000000".slice(0,(r||2)+1);return Math.round(e*t)/t}}}]).filter("yesno",["$translate",function(e){return function(r,t,n){return e.instant(r?"GLOBAL.YES":"GLOBAL.NO")}}]).filter("pre",function(){return function(e,r,t){return angular.isString(e)?e.replace(/\s/g,"&nbsp;"):""}}).filter("ncurrency",["$filter",function(e){return function(r,t,n){return/^(\-|\+)?([0-9]+(\.[0-9]+)?)$/.test(r)?+r>=0?e("currency")(+r,t,n):"-"+e("currency")(-r,t,n):r}}]).filter("price",["$filter",function(e){return function(r,t,n){return angular.isNumber(r)||angular.isString(r)?e("number")(r,2).replace(",",""):"0.00"}}]).filter("nd",["$filter",function(e){return function(e,r,t){return e||0===e?e:"-"}}]).filter("zpad",function(){return function(e,r){if((e=""+(e||"")).length>=r)return e;return("00000000"+e).slice(-1*r)}}).filter("months",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.MONTHS_FILTER",{monthsCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("weeks",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.WEEKS_FILTER",{weeksCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("days",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.DAYS_FILTER",{daysCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("hours",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.HOURS_FILTER",{hoursCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("minutes",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.MINUTES_FILTER",{minCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("seconds",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.SECONDS_FILTER",{secCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("passes",["$translate",function(e){return function(r,t){if(angular.isUndefined(r)||null===r)return r;var n=e.instant("GLOBAL.PASSES_FILTER",{passCount:r},"messageformat");return t?n.replace(/\d+\s*/,""):n}}]).filter("highlight",function(){return function(e,r){if(!e||!r||0===e.length||0===r.length)return e;var t=(e=String(e)).toLowerCase().indexOf(r.toLowerCase());return t>=0?[e.slice(0,t),"<strong>",e.slice(t,t+r.length),"</strong>",e.slice(t+r.length)].join(""):e}}).filter("isArray",function(){return function(e,r){return angular.isArray(e)}}).filter("isString",function(){return function(e,r){return angular.isString(e)}}).filter("join",["helper",function(e){return function(r,t){return e.join(r,t)}}]),angular.module("deskworks.isMultiSite",["deskworks.state"]).factory("isMultiSite",["$rootScope","state",function(e,r){"use strict";function t(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.CookieManagementPlugin&&(window.cordova.plugins.CookieManagementPlugin.flush(),console.log("DEBUG: flush cookies"))}return e.$watch(function(){return window.cordova},t),e.$watch(function(){return r.getLoggedUserId()},function(e,r){!e&&r&&(document.cookie="DwSiteCookie=; expires=expires=Thu, 01 Jan 1970 00:00:01 GMT; domain=.satellitedeskworks.com; path=/"),t()}),e.$on("$routeChangeSuccess",function(){if(window.cordova&&r.getLoggedUserId()){var e=new Date;e.setTime(e.getTime()+2592e6),document.cookie="DwSiteCookie="+location.href+"; expires="+e.toGMTString()+"; domain=.satellitedeskworks.com; path=/",t()}}),function(){return!!window.cordova}}]),angular.module("NATS",[]).factory("NATS",["$rootScope","$window","deskworksConfig","state",function(e,r,t,n){"use strict";if(!r.NATS)throw new Error("Missing websocket-nats dependency.");return angular.extend({},r.NATS,{connect:function(n){if(!(n=n||t.getWsUrl()||"wss://"+t.getApiDomain()+"/nats"))throw new Error("NATS.connect: missing url");var s=r.NATS.connect(n);return s.publish=(l=s.publish,function(e,r,t,n){return(t||n)&&console.warn("we have opt_reply and opt_callback unimplemented in nats.publish"),e=i(e),(angular.isObject(r)||angular.isArray(r))&&(r=angular.toJson(r)),l.call(this,e,r)}),s.subscribe=(a=s.subscribe,function(r,t,n){var s=angular.isFunction(t)?t:n;if(r=i(r),s){var o=s;s=function(r,t,n){return e.$apply(function(){return o.call(null,r&&angular.fromJson(r),t,n)})}}return a.call(this,r,angular.isFunction(t)?s:t,angular.isFunction(n)?s:n)}),s.request=(o=s.request,function(e,r,t,n){return console.warn("we have nats.request unimplemented"),o.call(this,e,r,t,n)}),s;var o;var a;var l}});function i(e){return e&&e.replace(/:siteId/,t.getSiteId()).replace(/:centerId/,n.getCurrentCenterId())}}]),angular.module("resolveGtm",[]).factory("resolveGtm",["dwAlerts","setupService",function(e,r){"use strict";var t;return function(){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")}).then(function(e){e.gtmContainerId&&e.gtmContainerId!==t&&(t=e.gtmContainerId,function(e,r,t,n,i){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var s=r.getElementsByTagName("script")[0],o=r.createElement("script");o.async=!0,o.src="https://www.googletagmanager.com/gtm.js?id="+i,s.parentNode.insertBefore(o,s)}(window,document,0,"dataLayer",t))})}}]),angular.module("resolveTimezone",[]).factory("resolveTimezone",["$rootScope","$q","$route","$location","dwAlerts","helper","setupService","centerService",function(e,r,t,n,i,s,o,a){"use strict";var l;return e.$on("CHANGE-CENTER",function(){t.current.reloadOnSearch||c()}),c;function c(){return l||(l=r.all({timezones:o.queryTimezones().catch(function(e){return i.error(e,"Failed to query timezones.")}).then(function(e){return moment.tz.names().length<e.length&&moment.tz.add(e.map(function(e){return e.tz})),e}),centers:a.getCenters().catch(function(e){return i.error(e,"Failed to query centers.")}).then(function(e){return e})}).then(function(e){if(e.centers.length){var r="new"===t.current.params.centerId?null:+t.current.params.centerId;r=r||n.search().center&&+n.search().center||e.centers[0].id;var i=(s.findByKeyValue(e.centers,"id",r)||e.centers[0]).timezone,o=s.findByKeyValue(e.timezones,"id",i);o&&moment.tz.setDefault(o.tz.split("|")[0])}}).finally(function(){l=null}))}}]),angular.module("deskworks.routeHelper",["deskworks.state","session"]).service("routeHelper",["dwAlerts","$q","$timeout","session","state",function(e,r,t,n,i){"use strict";this.auth=function(e){return n.wait().then(function(){if(null===e){if(n.isAnonymous())throw null;return n.user}if(n.isAnonymous())throw e||i.setParam("redirect",i.getPath()),i.setPath(e||"/sign-in",!0),null;return i.getCentersPromise()})},this.selectUser=function(){return i.isUserSelected()?r.when():("/user-search"!==i.getPath()&&(i.setParam("redirect",i.getPath()),i.setPath("/user-search")),r.reject())}}]),angular.module("security",["deskworks.config"]).factory("security",["$http","$q","deskworksConfig",function(e,r,t){var n,i={login:function(r,s,o){return(n=e.post(t.getApiAbsUrl("/sessions"),{login:r,password:s,rememberMe:o})).then(function(e){i.currentUser=e.data.user}),n},logout:function(){return e.delete(t.getApiAbsUrl("/sessions/123")).then(function(){n=null,i.currentUser=null})},requestCurrentUser:function(){return n||(n=i.isAuthenticated()?r.when(i.currentUser):e.get(t.getApiAbsUrl("/sessions/123")).then(function(e){return angular.isDefined(e.data.success)&&!e.data.success?r.reject():(i.currentUser=e.data.user,r.when(i.currentUser))}))},currentUser:null,isAuthenticated:function(){return!!i.currentUser},isAdmin:function(){return!(!i.currentUser||!i.currentUser.admin)}};return i}]),angular.module("setLocale",["tmh.dynamicLocale"]).factory("setLocale",["$locale","$rootScope","tmhDynamicLocale","dwAlerts","helper",function(e,r,t,n,i){"use strict";return function(s){(s=s||{}).locale=s.locale||"en-us";var o=i.findByKeyValue(window.dwLocales,"id",s.locale)||{};return t.set(s.locale,{_rev:o._rev}).catch(function(e){return n.error(e,"Failed to set "+s.locale+" locale.")}).then(function(){var t=e.DATETIME_FORMATS,n=e.NUMBER_FORMATS;return e.timeFormat=s.timeFormat,t.shortTime=24===e.timeFormat?"HH:mm":"hh:mm a",t.mediumDate=t.mediumDate.replace(/ '\u0433'.$/,""),t.weekDate=t.fullDate.replace(/ '\u0433'.$/,"").replace("EEEE","EEE").replace("MMMM","MMM"),t.iso="yyyy-MM-ddTHH:mm:ssZ",n.DECIMAL_SEP=".",n.GROUP_SEP=",",r.$emit("$setLocaleSuccess"),e})}}]),angular.module("setTranslations",["pascalprecht.translate"]).factory("setTranslations",["$translatePartialLoader","$translate","$rootScope",function(e,r,t){"use strict";return function(n,i){return e.addPart("_global"),n.forEach(function(r){e.addPart(r)}),r.use(i.split("-")[0]).then(function(){return r.refresh()}).then(function(){t.$emit("$setTranslationsSuccess")})}}]).factory("$translateErrorHandler",["$q","dwAlerts",function(e,r){return function(t,n,i){return"en"!==n?e.when():r.error("Failed to load "+t+"-"+n+" translation.").catch(angular.noop)}}]),angular.module("deskworks.state",["ngRoute","session","deskworks.center.service","deskworks.userProfile.service","deskworks.helper","autoCacheFactory"]).factory("state",["$rootScope","$location","$q","$route","$timeout","$window","session","centerService","userProfileService","helper","autoCacheFactory","resolveTimezone",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f,p,m=[],h="";o.wait().then(function(){o.isAnonymous()||e.$emit("LOGIN")});var g,v={login:function(r,t,n){return o.login(r,t,n).then(function(){return e.$emit("LOGIN"),o.user})},logout:function(r){return o.logout().then(function(){e.$emit("LOGOUT",r)})},getCurrentUserId:function(){return angular.isDefined(r.search().user)?r.search().user:o.user&&o.user.id},setCurrentUserId:function(e){r.search("user",e||null)},getCurrentUser:function(){return f||o.user},setCurrentUser:function(e){f=e,this.setCurrentUserId((e||{}).id)},getLoggedUserId:function(){return o.user&&o.user.id},getLoggedUser:function(){return o.user},setLoggedUserCenter:function(e,r){o.user.centerId=e,o.user.centerName=r},isLoggedAdmin:o.isAdmin,isLoggedMember:function(){return o.isRole("member")},isLoggedNonMember:function(){return o.isRole("nonMember")},isUserSelected:function(){return angular.isDefined(r.search().user)||o.user&&!this.isLoggedAdmin()},isMasterProfile:function(){return!this.isLoggedAdmin()&&v.getLoggedUserId()&&this.getLoggedUserId()!=this.getCurrentUserId()},getCurrentCenterId:function(){var e=r.search().center;return angular.isDefined(e)&&null!==e?+e:void 0},setCurrentCenterId:function(t){r.search("center",t?+t:null),e.$emit("CHANGE-CENTER")},getUserCenters:function(){var e=this;return m.filter(function(r){return e.isLoggedAdmin()||r.reservationUnitsCount>0})},currentCenterId:function(e){return angular.isDefined(e)&&this.setCurrentCenterId(+e),this.getCurrentCenterId()},getCurrentCenter:function(){return c.findByKeyValue(m,"id",this.getCurrentCenterId())},setCurrentCenter:function(e){e&&this.setCurrentCenterId(e.id)},currentCenter:function(e){return angular.isDefined(e)&&this.setCurrentCenter(e),this.getCurrentCenter()},getParam:function(e){return r.search()[e]},setParam:function(e,t){return r.search(e,angular.isDefined(t)?t:null)},resetParams:function(e){var t=r.search().user,n=r.search().center;return r.$$search=angular.isDefined(e)?e:{},angular.isDefined(t)&&r.search("user",t),angular.isDefined(n)&&r.search("center",n),this},getPath:function(){return r.path()},setPath:function(e,t){return t&&r.replace(),r.path(e),i(5e3)},back:function(){return s.history.back(),i(5e3)},getPageTitle:function(){return h},setPageTitle:function(e){return h=e,e},replace:function(){r.replace()},getCentersPromise:function(){return p},prohibitBack:function(r,t,n){return(n=n||e).$on("$routeChangeStart",function(e,i,s){i.$$route&&r.indexOf(i.$$route.controller)>=0&&(n.showError(t||"Back is not allowed."),e.preventDefault())})}};return e.$on("$routeChangeSuccess",function(){h=""}),e.$watch(function(){return r.search().user},function(r){r?d().then(function(){l.get(v.getCurrentCenterId(),r).then(function(r){f=r,e.$emit("CHANGE-USER")})}):(f={},e.$emit("CHANGE-USER"))}),e.$on("LOGIN",function(){u.emptyAll(),e.$emit("CENTERS:REFRESH"),p.then(function(r){if(g&&g(),g=e.$on("$routeChangeStart",function(){m&&m.length>0&&!c.findByKeyValue(m,"id",v.getCurrentCenterId())&&v.setCurrentCenterId(o.user.centerId||m[0].id)}),!v.getCurrentCenterId()){v.replace();var t=o.user.centerId;m&&m.length>0&&!c.findByKeyValue(m,"id",t)&&(t=m[0].id),v.setCurrentCenterId(t)}})}),e.$on("LOGOUT",function(e,t){t=t||{},g&&(g(),g=null),u.emptyAll(),t.skipResetParams||(v.resetParams(),r.search("user",null),r.search("center",null)),m=[]}),e.$on("CHANGE-CENTER",function(){u.emptyAll()}),e.$on("CENTERS:REFRESH",function(){p=a.getCenters().then(function(e){return m=e,e}).catch(function(r){return e.showError(r,"CENTERS:REFRESH failed to load centers list")})}),e.$on("CurrentUser:refresh",function(){l.get(v.getCurrentCenterId(),v.getCurrentUserId()).then(function(e){f=e})}),v}]),angular.module("userTasksPolicy",["session","deskworks.routeHelper","deskworks.UserTasks.service"]).factory("userTasksPolicy",["$rootScope","$q","$route","dwAlerts","helper","state","session","UserTasks","routeHelper",function(e,r,t,n,i,s,o,a,l){"use strict";var c;return e.$on("CHANGE-CENTER",function(){t.current.reloadOnSearch||u()}),u;function u(){var e=["dashboard","sign-in","sign-out"];return!1===t.current.$$route.userTasksPolicy?r.resolve({}):e.indexOf(t.current.$$route.routeBranch)>=0?r.resolve({}):c||(c=o.wait().then(function(){return s.getCentersPromise()}).then(function(){return a.query(s.getCurrentCenterId(),s.isMasterProfile()&&s.getCurrentUserId()).catch(function(e){return n.error(e,"userTasksPolicy: failed to query user-tasks.")})}).then(function(n){if(!1===t.current.$$route.userTasksPolicy)return r.resolve({});if(e.indexOf(t.current.$$route.routeBranch)>=0)return r.resolve({});var i="/"+t.current.$$route.routeBranch;return n.some(function(e){return e.tasks.some(function(e){return e.url===i})})?r.resolve():(s.resetParams().setPath("/dashboard"),r.reject())}).finally(function(){c=null}))}}]),angular.module("deskworks.accounting.barUploads.service",["ngResource","ngFileUpload","deskworks.helper","datesDeserializer"]).factory("barUploadsService",["$resource","$q","$filter","datesDeserializer","deskworksConfig","helper","Upload",function(e,r,t,n,i,s,o){"use strict";var a=i.getApiAbsUrl("/centers/:centerId/bar-uploads/:barUploadId/:action"),l=n(["barUploads.postDate","postDate","orders.paymentTime"]),c=e(a,{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,l]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,l]},update:{method:"PUT"}});return{query:function(e,r,t){return c.query({centerId:e||0,page:r||1,pageSize:t||20}).$promise},get:function(e,r,t,n,i){return c.get({centerId:e||0,barUploadId:r,page:t||1,pageSize:n||50,sort:i||"paymentTime"}).$promise},save:function(e,r){return c.update({centerId:e||0,barUploadId:r.id},this.serialize(r)).$promise},delete:function(e,r){return c.delete({centerId:e||0,barUploadId:r}).$promise},postCharges:function(e,r){return c.save({centerId:e||0,barUploadId:r,action:"charge"},{}).$promise},import:function(e,t){return o.upload({url:a.replace(":centerId",e).replace("/:barUploadId/:action","/import"),method:"POST",withCredentials:!0,data:{file:t}}).catch(function(e){return r.reject(e.data)})},serialize:function(e){return{number:e.number,postDate:t("date")(e.postDate,"yyyy-MM-dd")}}}}]),angular.module("deskworks.accounting.bulkInvoicing.service",["ngResource","deskworks.config","deskworks.helper","datesDeserializer"]).factory("bulkInvoicingService",["$resource","datesDeserializer","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=r(["date","items.date"]),s=e(t.getApiAbsUrl("/centers/:centerId/send-invoices"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,i]}}),o=e(t.getApiAbsUrl("/centers/:centerId/bulk-charges"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,i]}});return{getInvoices:function(e){return s.query({centerId:e}).$promise},sendEmails:function(e,r){return s.save({centerId:e},r).$promise},getPurchases:function(e){return o.query({centerId:e}).$promise},billPurchases:function(e,r){return o.save({centerId:e},r).$promise}}}]),angular.module("deskworks.accounting.printerUsage.service",["ngResource","ngFileUpload","deskworks.helper","datesDeserializer"]).factory("printerUsageService",["$resource","$q","$filter","datesDeserializer","deskworksConfig","helper","Upload",function(e,r,t,n,i,s,o){"use strict";var a=i.getApiAbsUrl("/centers/:centerId/printer-usages/:printerUsageId/:action"),l=n(["printerUsages.postDate","postDate"]),c=e(a,{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,l]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,l]},update:{method:"PUT"}});return{query:function(e,r,t){return c.query({centerId:e||0,page:r||1,pageSize:t||20}).$promise},get:function(e,r,t,n,i){return c.get({centerId:e||0,printerUsageId:r,page:t||1,pageSize:n||50,sort:i||"id"}).$promise},save:function(e,r){return c.update({centerId:e||0,printerUsageId:r.id},this.serialize(r)).$promise},delete:function(e,r){return c.delete({centerId:e||0,printerUsageId:r}).$promise},postCharges:function(e,r){return c.save({centerId:e||0,printerUsageId:r,action:"charge"},{}).$promise},import:function(e,r){return o.upload({url:a.replace(":centerId",e).replace("/:printerUsageId/:action","/import"),method:"POST",withCredentials:!0,data:{file:r}})},serialize:function(e){return{number:e.number,postDate:t("date")(e.postDate,"yyyy-MM-dd")}}}}]),angular.module("ccValidator",[]).factory("ccValidator",function(){"use strict";var e={},r="visa",t="master",n="american_express",i="diners-club",s="discover",o="unionpay",a="maestro",l=[r,t,n,i,s,"jcb",o,a];function c(e){var r,t,n;return e?(r=e.prefixPattern.source,t=e.exactPattern.source,(n=JSON.parse(JSON.stringify(e))).prefixPattern=r,n.exactPattern=t,n):null}function u(r){var t,n,i,s=[],o=[];if(!("string"==typeof r||r instanceof String))return[];for(i=0;i<l.length;i++)t=l[i],n=e[t],0!==r.length?n.exactPattern.test(r)?o.push(c(n)):n.prefixPattern.test(r)&&s.push(c(n)):s.push(c(n));return o.length?o:s}return e.visa={niceType:"Visa",type:r,prefixPattern:/^4$/,exactPattern:/^4\d*$/,gaps:[4,8,12],lengths:[16,18,19],code:{name:"CVV",size:3}},e[t]={niceType:"MasterCard",type:t,prefixPattern:/^(5|5[1-5]|2|22|222|222[1-9]|2[3-6]|27|27[0-2]|2720)$/,exactPattern:/^(5[1-5]|222[1-9]|2[3-6]|27[0-1]|2720)\d*$/,gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},e[n]={niceType:"American Express",type:n,prefixPattern:/^(3|34|37)$/,exactPattern:/^3[47]\d*$/,isAmex:!0,gaps:[4,10],lengths:[15],code:{name:"CID",size:4}},e[i]={niceType:"Diners Club",type:i,prefixPattern:/^(3|3[0689]|30[0-5])$/,exactPattern:/^3(0[0-5]|[689])\d*$/,gaps:[4,10],lengths:[14,16,19],code:{name:"CVV",size:3}},e[s]={niceType:"Discover",type:s,prefixPattern:/^(6|60|601|6011|65|64|64[4-9])$/,exactPattern:/^(6011|65|64[4-9])\d*$/,gaps:[4,8,12],lengths:[16,19],code:{name:"CID",size:3}},e.jcb={niceType:"JCB",type:"jcb",prefixPattern:/^(2|21|213|2131|1|18|180|1800|3|35)$/,exactPattern:/^(2131|1800|35)\d*$/,gaps:[4,8,12],lengths:[16],code:{name:"CVV",size:3}},e[o]={niceType:"UnionPay",type:o,prefixPattern:/^((6|62|62\d|(621(?!83|88|98|99))|622(?!06)|627[02,06,07]|628(?!0|1)|629[1,2])|622018)$/,exactPattern:/^(((620|(621(?!83|88|98|99))|622(?!06|018)|62[3-6]|627[02,06,07]|628(?!0|1)|629[1,2]))\d*|622018\d{12})$/,gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVN",size:3}},e[a]={niceType:"Maestro",type:a,prefixPattern:/^(5|5[06-9]|6\d*)$/,exactPattern:/^(5[06-9]|6[37])\d*$/,gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],code:{name:"CVC",size:3}},u.getTypeInfo=function(r){return c(e[r])},u.types={VISA:r,MASTERCARD:t,AMERICAN_EXPRESS:n,DINERS_CLUB:i,DISCOVER:s,JCB:"jcb",UNIONPAY:o,MAESTRO:a},function(e){var r,t,n,i,s,o;"number"==typeof e&&(e=String(e));if("string"!=typeof e)return d(null,!1,!1);if(e=e.replace(/\-|\s/g,""),!/^\d*$/.test(e))return d(null,!1,!1);{if(0===(r=u(e)).length)return d(null,!1,!1);if(1!==r.length)return d(null,!0,!1)}i="unionpay"===(t=r[0]).type||function(e){var r,t=0,n=!1,i=e.length-1;for(;i>=0;)r=parseInt(e.charAt(i),10),n&&(r*=2)>9&&(r=r%10+1),n=!n,t+=r,i--;return t%10==0}(e);for(o=Math.max.apply(null,t.lengths),s=0;s<t.lengths.length;s++)if(t.lengths[s]===e.length)return n=e.length!==o||i,d(t,n,i);return d(t,e.length<o,!1)};function d(e,r,t){return{card:e,isPotentiallyValid:r,isValid:t}}}),angular.module("deskworks.billing.optsBillingFrequency",[]).factory("optsBillingFrequency",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"monthly",_name:"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY.MONTHLY",months:1},{id:"quarterly",_name:"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY.QUARTERLY",months:3},{id:"semiAnnual",_name:"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY.SEMI_ANNUAL",months:6},{id:"annual",_name:"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY.ANNUAL",months:12},{id:"asNeeded",_name:"RECURRING_BILLING.GENERAL.BILLING_FREQUENCY.AS_NEEDED"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsDiscountType",[]).factory("optsDiscountType",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:0,_name:"RECURRING_BILLING.DISCOUNT.TYPE.NO"},{id:1,_name:"RECURRING_BILLING.DISCOUNT.TYPE.$"},{id:2,_name:"RECURRING_BILLING.DISCOUNT.TYPE.%"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsMonthsOfDiscount",[]).factory("optsMonthsOfDiscount",["$rootScope","$translate",function(e,r){"use strict";for(var t=[{id:1,_name:"RECURRING_BILLING.DISCOUNT.MONTHS.SINGLE"}],n=2;n<25;n++)t.push({id:n,name:String(n)});function i(){t[0].name=r.instant(t[0]._name)}return i(),e.$on("$setTranslationsSuccess",i),t}]),angular.module("deskworks.billing.optsNoticePeriod",[]).factory("optsNoticePeriod",["$rootScope","$filter",function(e,r){"use strict";var t=[{id:10,name:"10 days"},{id:30,name:"30 days"},{id:60,name:"60 days"},{id:90,name:"90 days"},{id:120,name:"120 days"}];function n(){t.forEach(function(e){e.name=r("days")(e.id)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsPaymentMethod",[]).factory("optsPaymentMethod",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"existing_cc",_name:"PURCHASE.PAYMENT.METHOD.CC"},{id:"cash",_name:"PURCHASE.PAYMENT.METHOD.CASH"},{id:"check",_name:"PURCHASE.PAYMENT.METHOD.CHECK"},{id:"write_off",_name:"PURCHASE.PAYMENT.METHOD.WRITE_OFF"},{id:"other",_name:"PURCHASE.PAYMENT.METHOD.OTHER"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsRecurringChargeStatus",[]).factory("optsRecurringChargeStatus",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"active",_name:"RECURRING_BILLING.STATUS_NOTES.STATUS.ACTIVE"},{id:"inactive",_name:"RECURRING_BILLING.STATUS_NOTES.STATUS.INACTIVE"},{id:"deleted",_name:"RECURRING_BILLING.STATUS_NOTES.STATUS.DELETED"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsRecurringChargeTerminate",[]).factory("optsRecurringChargeTerminate",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"never",_name:"RECURRING_BILLING.DATES.TERMINATE.NEVER"},{id:"usedUp",_name:"RECURRING_BILLING.DATES.TERMINATE.WHEN_USED_UP"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsRefundMethod",[]).factory("optsRefundMethod",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"existing_cc",_name:"PURCHASE.REFUND.METHOD.CC"},{id:"cash",_name:"PURCHASE.REFUND.METHOD.CASH"},{id:"check",_name:"PURCHASE.REFUND.METHOD.CHECK"},{id:"write_off",_name:"PURCHASE.REFUND.METHOD.WRITE_OFF"},{id:"e-check",_name:"PURCHASE.REFUND.METHOD.E_CHECK"},{id:"other",_name:"PURCHASE.REFUND.METHOD.OTHER"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.billing.optsRenewalNoticePeriod",[]).factory("optsRenewalNoticePeriod",["$rootScope","$filter","$translate",function(e,r,t){"use strict";var n=[{id:null,_name:"RECURRING_BILLING.RENEWAL_NOTICE_PERIOD.NO_NOTICE"},{id:10},{id:30},{id:60},{id:67},{id:90},{id:120}];function i(){n.forEach(function(e){e.name=e._name?t.instant(e._name):r("days")(e.id)})}return i(),e.$on("$setTranslationsSuccess",i),n}]),angular.module("deskworks.billing.optsRenewalTerm",[]).factory("optsRenewalTerm",["$rootScope","$filter",function(e,r){"use strict";var t=[{id:1},{id:3},{id:6},{id:12},{id:24}];function n(){t.forEach(function(e){e.name=r("months")(e.id)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.purchase.service",["ngResource","deskworks.config","datesDeserializer"]).factory("purchaseService",["$resource","deskworksConfig","helper","datesDeserializer",function(e,r,t,n){"use strict";var i=n(["open.firstOpened","paid.firstOpened","credit.firstOpened","deposit.firstOpened","open.lastModified","paid.lastModified","credit.lastModified","deposit.lastModified","items.billedAt","items.createdAt"]),s=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId"),{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,i]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,i]},update:{method:"PUT"}}),o=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/items/:itemId"),{},{update:{method:"PUT"}}),a=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/charges"),{},{update:{method:"PUT"}}),l=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/discounts"),{},{update:{method:"PUT"}}),c=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/refunds"),{},{update:{method:"PUT"}}),u=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/payments"),{},{update:{method:"PUT"}}),d=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/deposits"),{},{update:{method:"PUT"}}),f=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/staff-helps"),{},{update:{method:"PUT"}}),p=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/purchases/:purchaseId/consolidations"),{},{update:{method:"PUT"}});return{get:function(e,r,t,n){return s.get({centerId:e||0,userId:r,purchaseId:t,productId:n}).$promise},getPurchases:function(e,r){return s.query({centerId:e||0,userId:r}).$promise},query:function(e,r){return s.query({centerId:e||0,userId:r}).$promise.then(function(e){return e.open.map(function(e){return e.type="open",e}).concat(e.paid.map(function(e){return e.type="paid",e})).concat(e.credit.map(function(e){return e.type="credit",e})).concat(e.deposit.map(function(e){return e.type="deposit",e}))})},createPurchase:function(e,r,t,n,i,o){return s.save({centerId:e||0,userId:r,registration:t,productId:n||void 0,attachedReservationUnitId:i||void 0,membershipStartDate:o||void 0},{}).$promise},createPurchaseForReservation:function(e,r,t,n,i,o){return s.save({centerId:e||0,userId:r,reservation:!0,"reservation-unit-id":t,"reservation-length":n,reservationUnitId:t,reservationFrom:i,reservationTo:o},{}).$promise},createCharge:function(e,r,t,n,i,s,o){return a.save({centerId:e||0,userId:r,purchaseId:t,custom:i,registration:s||void 0,productId:o},n).$promise},createDiscount:function(e,r,t,n){return l.save({centerId:e||0,userId:r,purchaseId:t},n).$promise},createRefund:function(e,r,t,n){return c.save({centerId:e||0,userId:r,purchaseId:t},n).$promise},deletePurchaseItem:function(e,r,t,n){return o.delete({centerId:e||0,userId:r,purchaseId:t,itemId:n}).$promise},createPayment:function(e,r,t,n,i,s,o){var a;return angular.isObject(e)&&(a=e,n=r),u.save(a||{centerId:e||0,userId:r,purchaseId:t,registration:i,productId:s,membershipStartDate:o},n).$promise},createDeposit:function(e,r,t,n,i,s){return d.save({centerId:e||0,userId:r,purchaseId:t,registration:i,productId:s},n).$promise},createStaffHelp:function(e,r,t,n,i){return f.save({centerId:e||0,userId:r,purchaseId:t,registration:n,productId:i},{}).$promise},consolidate:function(e,r,t,n){return p.save({centerId:e||0,userId:r,purchaseId:t},{sourcePurchaseId:n.id}).$promise}}}]),angular.module("deskworks.recurringCharge.service",["ngResource","datesDeserializer","deskworks.config","deskworks.billing.optsBillingFrequency","deskworks.billing.optsRecurringChargeStatus","deskworks.billing.optsNoticePeriod","deskworks.billing.optsDiscountType","deskworks.userProfile.optsMonthsOfDiscount","deskworks.billing.optsRecurringChargeTerminate","deskworks.billing.optsRenewalTerm","deskworks.billing.optsRenewalNoticePeriod"]).factory("RecurringCharge",["$resource","$q","$timeout","$filter","deskworksConfig","helper","datesDeserializer","optsBillingFrequency","optsRecurringChargeStatus","optsNoticePeriod","optsDiscountType","optsMonthsOfDiscount","optsRecurringChargeTerminate","optsRenewalTerm","optsRenewalNoticePeriod",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m){"use strict";var h=o(["lastBillDate","nextBillDate","entryDate","startDate","terminate","discountStartDate","noticeDate","renewalDate"]),g=e(i.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/recurring-charges/:recurringId"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,h]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,h]},update:{method:"PUT"}});return{new:function(e){return(e=e||{}).lastBillDate=moment(),e.nextBillDate=moment().add(1,"M"),e.status=l[0],e.billingFrequency=a[0],e.quantity=1,e.entryDate=moment(),e.startDate=moment(),e.noticePeriod=c[1],e.renewalDate=moment().add(1,"M"),e.renewalTerm=p[0].id,e.renewalNoticePeriod=m[0].id,e.discountType=u[0],e.discountTrialOccurrences=d[0],e.discountStartDate=moment(),e.attachedCoMembersIds=[],e},isNew:function(e){return e&&(!e.id||s.isUid(e.id)||"new"===e.id)},save:function(e,r,t){return this.isNew(t)?g.save({centerId:e,userId:r},this.unresolve(t)).$promise.then(function(e){return t.id=e.id,e}):g.update({centerId:e,userId:r,recurringId:t.id},this.unresolve(t)).$promise},query:function(e,r){return g.query({centerId:e,userId:r}).$promise.then(function(e){return angular.forEach(e,function(e){e.status=s.findByKeyValue(l,"id",e.status)}),e})},get:function(e,r,t){var n=this;return g.get({centerId:e,userId:r,recurringId:t}).$promise.then(function(e){return e.userName=e.memberName,n.isNew(e)?n.new(e):(e.status=s.findByKeyValue(l,"id",e.status),e.priceListProduct=s.findByKeyValue(e.options.priceListProducts,"id",e.priceListProductId),e.priceListProduct&&(e.billingFrequency=s.findByKeyValue(a,"id",e.priceListProduct.billingFrequency)),e.terminate&&e.billingFrequency&&"asNeeded"===e.billingFrequency.id&&(e.terminate=s.findByKeyValue(f,"id",e.terminate)),e.noticePeriod=s.findByKeyValue(c,"id",e.noticePeriod),e.discountType=s.findByKeyValue(u,"id",e.discountTypeId)||u[0],e.discountTrialOccurrences=s.findByKeyValue(d,"id",e.discountTrialOccurrences)||d[0],e.attachedCoMembersIds||(e.attachedCoMembersIds=[]),e)})},setUseForCheckInBilling:function(e,r,t){return g.update({centerId:e,userId:r,recurringId:t},{useForCheckInBilling:!0}).$promise},unresolve:function(e){var r={description:e.description,priceListProductId:e.priceListProduct?e.priceListProduct.id:null,customPrice:e.customPrice||0===e.customPrice?+e.customPrice:null,startDate:n("date")(e.startDate,"yyyy-MM-dd"),nextBillDate:n("date")(e.nextBillDate,"yyyy-MM-dd"),lastBillDate:n("date")(e.lastBillDate,"yyyy-MM-dd"),noticeDate:moment.isMoment(e.noticeDate)?n("date")(e.noticeDate,"yyyy-MM-dd"):e.noticeDate,terminate:"asNeeded"===e.billingFrequency.id?e.terminate.id:n("date")(e.terminate,"yyyy-MM-dd"),quantity:+e.quantity,noticePeriod:e.noticePeriod?e.noticePeriod.id:e.noticePeriod,status:e.status?e.status.id:e.status,notes:e.notes,attachedReservationUnitId:e.attachedReservationUnitId?+e.attachedReservationUnitId:null,renewalDate:n("date")(e.renewalDate,"yyyy-MM-dd"),renewalTerm:e.renewalTerm,renewalNoticePeriod:e.renewalNoticePeriod,attachedCoMembersIds:e.attachedCoMembersIds};return e.discountType&&e.discountType.id?(r.discountTypeId=e.discountType.id,r.discountValue=e.discountValue,e.discountTrialOccurrences&&(r.discountTrialOccurrences=e.discountTrialOccurrences.id),r.discountStartDate=n("date")(e.discountStartDate,"yyyy-MM-dd")):r.discountTypeId=0,"asNeeded"===e.billingFrequency.id&&(r.passBalance=+e.passBalance,r.refill=e.refill),this.isNew(e)&&(r.postProration=!!e.postProration),r}}}]),angular.module("deskworks.emailAllMembers.service",["ngResource","deskworks.config"]).factory("emailAllMembers",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/email-all-members"),{},{update:{method:"PUT"}});return{send:function(e,r){return t.save({test:r||null},e).$promise},query:function(e){return t.query({includeNonMembers:e}).$promise}}}]),angular.module("deskworks.emailSiteMembers.service",["ngResource","deskworks.config"]).factory("emailSiteMembers",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/centers/:centerId/email-site-members"),{},{update:{method:"PUT"}});return{send:function(e,r,n){return t.save({centerId:e,test:n||null},r).$promise},query:function(e,r,n){return t.query({centerId:e,membershipTypeId:r,checkedInOnly:n}).$promise}}}]),angular.module("deskworks.MessageBoard",["ngResource","deskworks.config","datesDeserializer"]).factory("MessageBoard",["$resource","deskworksConfig","datesDeserializer","helper",function(e,r,t,n){"use strict";var i=t(["createdAt"]),s=e(r.getApiAbsUrl("/message-board/messages/:messageId"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,o]},update:{method:"PUT"}});return{query:function(e){return s.query(e).$promise},save:function(e){return e.id?s.update({messageId:e.id},e).$promise:s.save({},e).$promise.then(function(r){return e.id=r.id,r})},delete:function(e){return s.delete({messageId:e}).$promise},deserialize:o};function o(e){return e=i(e),angular.forEach(angular.isArray(e)?e:[e],function(e){e&&e.author&&(e.author.fullName=n.join([e.author.firstName,e.author.lastName]," "))}),e}}]),angular.module("deskworks.SplashPage",["ngResource","deskworks.config"]).factory("SplashPage",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/net-check-in/splash-page/:centerId"),{},{update:{method:"PUT"}});return{get:function(e){return t.get({centerId:e}).$promise},save:function(e,r){return t.update({centerId:e},r).$promise}}}]),angular.module("deskworks.taToolbarEmail",[]).factory("taToolbarEmail",function(){"use strict";return[["h1","h2","h3","h4","p","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html","insertImage","insertLink","wordcount","charcount"]]}),angular.module("deskworks.inventory.membershipCategory.service",["ngResource","deskworks.config"]).factory("membershipCategoryService",["$resource","$q","deskworksConfig",function(e,r,t){"use strict";var n=e(t.getApiAbsUrl("/membership-types/:membershipTypeId"),{},{update:{method:"PUT"}});return{query:function(){return n.query().$promise},get:function(e){return n.get({membershipTypeId:e}).$promise},create:function(e){return n.save({},e).$promise},update:function(e,r){return n.update({membershipTypeId:e},r).$promise},delete:function(e){return n.delete({membershipTypeId:e}).$promise},save:function(e){return(e.id?n.update({membershipTypeId:e.id},e).$promise:n.save({},e).$promise).then(function(r){return e.id=r.id,r})}}}]),angular.module("deskworks.inventory.optsCountCheckInsPer",[]).factory("optsCountCheckInsPer",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"coMember",_name:"PRODUCTS.COUNT_CHECK_INS_PER.CO_MEMBER"},{id:"company",_name:"PRODUCTS.COUNT_CHECK_INS_PER.COMPANY"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.inventory.optsPassMax",[]).factory("optsPassMax",function(){"use strict";return[{id:"1",name:"1"},{id:"2",name:"2"},{id:"4",name:"4"},{id:"0",name:""}]}),angular.module("deskworks.inventory.optsPassMin",[]).factory("optsPassMin",function(){"use strict";return[{id:"0.25",name:""},{id:"0.5",name:""},{id:"1.0",name:"1"}]}),angular.module("deskworks.inventory.optsProductType",[]).factory("optsProductType",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"membership",_name:"PRODUCTS.PRODUCT_TYPE.MEMBERSHIP",import:"Membership"},{id:"registration",_name:"PRODUCTS.PRODUCT_TYPE.REGISTRATION",import:"Registration"},{id:"rental",_name:"PRODUCTS.PRODUCT_TYPE.RENTAL_HOURS",import:"Rental Hours"},{id:"print",_name:"PRODUCTS.PRODUCT_TYPE.PRINT",import:"Print"},{id:"services",_name:"PRODUCTS.PRODUCT_TYPE.SERVICES",import:"Services"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.PassProduct.service",["ngResource","deskworks.config"]).factory("PassProduct",["$resource","$q","deskworksConfig",function(e,r,t){"use strict";var n=e(t.getApiAbsUrl("/centers/:centerId/pass-products"));return{query:function(e){return n.query({centerId:e}).$promise}}}]),angular.module("deskworks.inventory.priceList.service",["ngResource","deskworks.config","datesDeserializer"]).factory("priceListService",["$resource","$q","datesDeserializer","deskworksConfig",function(e,r,t,n){"use strict";var i=t(["date"]),s=e(n.getApiAbsUrl("/centers/:centerId/price-lists/:priceListId"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,i]},get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,i]},update:{method:"PUT"}}),o=e(n.getApiAbsUrl("/centers/:centerId/price-lists/:priceListId/price-list-products/:productRelId"),{},{update:{method:"PUT"}});return{getPricelists:function(e){return s.query({centerId:e}).$promise},getPricelist:function(e,t){if("new"===t){return r.when({id:"new",name:"",visibleForVisitors:!0,useFor:"none",products:[],options:{products:[]}})}return s.get({centerId:e,priceListId:t}).$promise},createPricelist:function(e,r){return s.save({centerId:e},r).$promise},updatePricelist:function(e,r,t){return s.update({centerId:e,priceListId:r},t).$promise},deletePricelist:function(e,r){return s.delete({centerId:e,priceListId:r}).$promise},clonePricelist:function(e,r,t){return s.save({centerId:e,copy:r,destination:t},{}).$promise},save:function(e,r){return(r.id?s.update({centerId:e,priceListId:r.id},r).$promise:s.save({centerId:e},r).$promise).then(function(e){return r.id=e.id,e})},createProduct:function(e,r,t){return o.save({centerId:e,priceListId:r},t).$promise},updateProduct:function(e,r,t,n){return o.update({centerId:e,priceListId:r,productRelId:t},n).$promise},deleteProduct:function(e,r,t){return o.delete({centerId:e,priceListId:r,productRelId:t}).$promise}}}]),angular.module("deskworks.ProductCategory",["ngResource","deskworks.config","deskworks.helper"]).factory("ProductCategory",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/product-categories/:productCategoryId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return e.id?i.update({productCategoryId:e.id},e).$promise:i.save(e).$promise.then(function(r){e.id=r.id})},delete:function(e){return i.delete({productCategoryId:e}).$promise}}}]),angular.module("deskworks.inventory.product.service",["ngResource","deskworks.config","deskworks.inventory.optsProductType","deskworks.billing.optsBillingFrequency","deskworks.inventory.optsPassMin","deskworks.inventory.optsPassMax"]).factory("productService",["$resource","$q","$filter","deskworksConfig","helper","optsProductType","optsBillingFrequency","optsPassMin","optsPassMax",function(e,r,t,n,i,s,o,a,l){"use strict";var c=e(n.getApiAbsUrl("/products/:productId"),{},{update:{method:"PUT"}}),u=e(n.getApiAbsUrl("/centers/:centerId/membership-products")),d=e(n.getApiAbsUrl("/products/:productId/price-list-products/:priceListRelId"),{},{update:{method:"PUT"}});return{new:function(){return this.resolve({})},getProducts:function(){return c.query().$promise},getMembershipProducts:function(e){return u.query({centerId:e}).$promise},getProduct:function(e){var r=this;return c.get({productId:e}).$promise.then(function(e){return r.resolve(e)})},createProduct:function(e){return c.save({},this.unresolve(e)).$promise},updateProduct:function(e){return c.update({productId:e.id},this.unresolve(e)).$promise},deleteProduct:function(e){return c.delete({productId:e}).$promise},save:function(e){return(e.id?c.update({productId:e.id},this.unresolve(e)).$promise:c.save({},this.unresolve(e)).$promise).then(function(r){return e.id=r.id,r})},createPriceList:function(e,r){return d.save({productId:e},r).$promise},updatePriceList:function(e,r,t){return d.update({productId:e,priceListRelId:r},t).$promise},deletePriceList:function(e,r){return d.delete({productId:e,priceListRelId:r}).$promise},savePriceItem:function(e,r){return(r.id?d.update({productId:e,priceListRelId:r.id},r).$promise:d.save({productId:e},r).$promise).then(function(e){return r.id=e.id,e})},resolve:function(e){return e.priceLists||(e.priceLists=[]),e.options||(e.options={}),e.options.productTypes=s,e.options.billingFrequencies=o,e.id?(e.type=i.findByKeyValue(s,"id",e.type),e.options.membershipTypes&&e.options.membershipTypes.length>0&&(e.membershipType=i.findByKeyValue(e.options.membershipTypes,"id",e.membershipTypeId)),e.options.priceLists&&e.options.priceLists.length>0&&e.priceLists.forEach(function(r){r.priceList=i.findByKeyValue(e.options.priceLists,"id",r.priceListId),r.price=t("price")(r.price),r.reservationCredit&&(r.reservationCredit=t("price")(r.reservationCredit)),null===r.passQty&&(r.passQty=0)}),e.billingFrequency=i.findByKeyValue(e.options.billingFrequencies,"id",e.billingFrequency),e.billingFrequency=e.billingFrequency||e.options.billingFrequencies[0],e.passMin=e.passMin||a[0].id,e.passMax=i.findByKeyValue(l,"id",e.passMax)||l[2],e.reservationTypeId=e.reservationTypeId&&e.reservationTypeId.toString()||e.reservationTypeId,e.printerUsageFreeCopiesSettings&&e.printerUsageFreeCopiesSettings.length||(e.printerUsageFreeCopiesSettings=[{printerUsageType:"printBlack",freeCount:0},{printerUsageType:"printColor",freeCount:0},{printerUsageType:"scan",freeCount:0},{printerUsageType:"fax",freeCount:0}])):(e.type=s[0],e.options.membershipTypes&&e.options.membershipTypes.length>0&&(e.membershipType=e.options.membershipTypes[0]),e.billingFrequency=e.options.billingFrequencies[0],e.passMin=a[0].id,e.passMax=l[2],e.taxable=!0,e.reserveWithNonMemberRules=!1,e.countCheckInsPer="company",e.hideInSelfRegistration=!0,e.hasRegistrationFee=!0),e},unresolve:function(e){var r={name:e.name,type:e.type?e.type.id:void 0,description:e.description,custom:!!e.custom,productCategoryId:e.productCategoryId,productNumber:+e.productNumber,taxable:e.taxable,hideInSelfRegistration:!!e.hideInSelfRegistration,hasRegistrationFee:!!e.hasRegistrationFee};return e.type&&"membership"===e.type.id&&(r.isCreditable=!!e.isCreditable,r.membershipTypeId=e.membershipType?e.membershipType.id:void 0,r.reserveWithNonMemberRules=!!e.reserveWithNonMemberRules,r.countCheckInsPer=e.countCheckInsPer,r.hasPasses=!!e.hasPasses,r.trackAcrossAllCenters=!!e.trackAcrossAllCenters,r.hasPasses&&e.passProduct&&(r.passProductId=e.passProduct.id),r.printerUsageFreeCopiesSettings=e.printerUsageFreeCopiesSettings),!e.type||"membership"!==e.type.id&&"services"!==e.type.id||(r.billingFrequency=e.billingFrequency.id),e.type&&"rental"===e.type.id&&(r.passSize=e.passSize,r.passMin=e.passMin,r.passMax=e.passMax.id,r.allowReservationCredits=!!e.allowReservationCredits,r.canBuyOnSplashPage=!!e.canBuyOnSplashPage,r.reservationTypeId=e.reservationTypeId),r}}}]),angular.module("deskworks.reservationCategory.service",["ngResource","deskworks.config","ngFileUpload"]).factory("reservationCategoryService",["$resource","$q","Upload","deskworksConfig",function(e,r,t,n){"use strict";var i=e(n.getApiAbsUrl("/centers/:centerId/reservation-types/:reservationTypeId/:unavailableDates"),{},{update:{method:"PUT"}}),s=e(n.getApiAbsUrl("/centers/:centerId/reservation-types/:reservationTypeId/photos/:photoId"),{},{update:{method:"PUT"}});return{get:function(e,t){return"new"===t?r.when({id:"new",cancellationNonMemberNoticeHours:24,cancellationMemberNoticeHours:24}):i.get({centerId:e,reservationTypeId:t}).$promise},query:function(e){return i.query({centerId:e}).$promise},create:function(e,r){return i.save({centerId:e},r).$promise},update:function(e,r,t){return i.update({centerId:e,reservationTypeId:r},t).$promise},delete:function(e,r){return i.delete({centerId:e,reservationTypeId:r}).$promise},save:function(e,r){return r.id?i.update({centerId:e,reservationTypeId:r.id},r).$promise:i.save({centerId:e},r).$promise.then(function(e){return r.id=e.id,e})},getUnavailableDates:function(e,r){return i.query({centerId:e,reservationTypeId:r,unavailableDates:"unavailable-dates"}).$promise},createPhoto:function(e,r,i){return t.upload({url:n.getApiAbsUrl("/centers/"+e+"/reservation-types/"+r+"/photos"),method:"POST",withCredentials:!0,data:{photo:i}})},updatePhoto:function(e,r,i,s){return t.upload({url:n.getApiAbsUrl("/centers/"+e+"/reservation-types/"+r+"/photos/"+i),method:"PUT",withCredentials:!0,data:{photo:s}})},deletePhoto:function(e,r,t){return s.delete({centerId:e,reservationTypeId:r,photoId:t}).$promise}}}]),angular.module("deskworks.reservationUnit.service",["ngResource","ngFileUpload","deskworks.config"]).factory("reservationUnitService",["$resource","$q","$filter","deskworksConfig","Upload","helper",function(e,r,t,n,i,s){"use strict";var o="/centers/:centerId/reservation-units/:reservationUnitId",a=e(n.getApiAbsUrl("/centers/:centerId/reservation-types/:reservationTypeId/reservation-units/:reservationUnitId"),{},{update:{method:"PUT"}}),l=e(n.getApiAbsUrl(o),{},{update:{method:"PUT"}});return{getReservationUnit:function(e,r,t,n){return a.get({centerId:e,reservationTypeId:r,reservationUnitId:t,"availability-date":n}).$promise},getReservationUnitExt:function(e,t){return"new"===t?r.when({id:"new",expectedUsePerMonth:160}):l.get({centerId:e,reservationUnitId:t}).$promise},getReservationUnits:function(e,r,t){return r?a.query({centerId:e,reservationTypeId:r,"availability-date":t}).$promise:l.query({centerId:e}).$promise},createReservationUnit:function(e,r){return l.save({centerId:e},r).$promise},updateReservationUnit:function(e,r,t){return l.update({centerId:e,reservationUnitId:r},t).$promise},deleteReservationUnit:function(e,r){return l.delete({centerId:e,reservationUnitId:r}).$promise},save:function(e,r){return r.id?l.update({centerId:e,reservationUnitId:r.id},r).$promise:l.save({centerId:e},r).$promise.then(function(e){return r.id=e.id,e})},uploadPhoto:function(e,r,t){var a=s.interpolateRoute(o,{centerId:e,reservationUnitId:r});return i.upload({url:n.getApiAbsUrl(a),method:"PUT",withCredentials:!0,data:{photo:t}})}}}]),angular.module("deskworks.checkInLog.service",["ngResource","deskworks.config"]).factory("checkInLogService",["$resource","$filter","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=r("toDate"),s=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/logs/:logId"),{},{update:{method:"PUT"}});return{getLog:function(e,r,t,n,o){return s.get({centerId:e,userId:r,page:t,pageSize:n,macAddress:o}).$promise.then(function(e){return e.checkInTime=i(e.checkInTime),e.log.forEach(function(e){e.time=i(e.time)}),e})},updateLog:function(e,r,t,n){return s.update({centerId:e,userId:r,logId:t},n).$promise},deleteLog:function(e,r,t){return s.delete({centerId:e,userId:r,logId:t}).$promise},checkInOut:function(e,t,n,i){return i=r("date")(i,"iso"),s.save({centerId:e,userId:t},{operation:n,time:i}).$promise}}}]),angular.module("deskworks.CheckedInMembers",["ngResource","deskworks.config"]).factory("CheckedInMembers",["$resource","$timeout","$filter","deskworksConfig","helper",function(e,r,t,n,i){"use strict";var s=e(n.getApiAbsUrl("/centers/:centerId/checked-in-members"),{},{});return{query:function(e){return s.query({centerId:e}).$promise}}}]),angular.module("deskworks.CheckedInUsers",["ngResource","deskworks.config"]).factory("CheckedInUsers",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/centers/:centerId/checked-in-users"));return{query:function(e){return t.query({centerId:e}).$promise}}}]),angular.module("deskworks.ManualCheckInLog",["ngResource","datesDeserializer","deskworks.config"]).factory("ManualCheckInLog",["$resource","$filter","deskworksConfig","datesDeserializer",function(e,r,t,n){"use strict";var i=n(["log.time"]),s=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/manual-check-in-logs/:logId"),{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,i]},update:{method:"PUT"}});return{query:function(e,r,t,n){return s.query({centerId:e,userId:r,page:t,pageSize:n}).$promise},delete:function(e,r,t){return s.delete({centerId:e,userId:r,logId:t}).$promise},save:function(e,t,n,i,o){return n=r("date")(n,"iso"),s.save({centerId:e,userId:t},{time:n,recurringId:i,checkedIn:o}).$promise}}}]),angular.module("deskworks.memberUsageService",["ngResource","deskworks.config","datesDeserializer","deskworks.optsUsageSource","deskworks.optsCreditType"]).factory("memberUsageService",["$resource","$filter","$q","deskworksConfig","helper","datesDeserializer","optsUsageSource","optsCreditType",function(e,r,t,n,i,s,o,a){"use strict";var l=s(["days.date","days.usages.from","days.usages.to"]),c=e(n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/member-usages/:usageId"),{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,l]}});return{query:function(e,r,t,n){return c.query({centerId:e,userId:r,page:t||1,pageSize:n||10}).$promise.then(function(e){return angular.forEach(e.days,function(e){e.usages.forEach(function(e){e.sourceName=(i.findByKeyValue(o,"id",e.sourceId)||{}).name||e.sourceId}),e.usageAmount=i.round(e.usageTotals.reduce(function(e,r){return+r.amount+e},0)),e.appliedAmount=i.round(e.creditsApplied.reduce(function(e,r){return+r.amount+e},0)),u(e.openingBalance),u(e.creditsApplied),u(e.closingBalance)}),e})},delete:function(e,r,t){return c.delete({centerId:e,userId:r,usageId:t}).$promise}};function u(e){e.forEach(function(e){angular.isDefined(e.passes)?e.typeId="pass":angular.isDefined(e.bucketPasses)?(e.typeId="bucket",e.passes=e.bucketPasses,delete e.bucketPasses):e.typeId="reservation",e.typeName=(i.findByKeyValue(a,"id",e.typeId)||{}).name})}}]),angular.module("deskworks.membership.service",["ngResource","deskworks.config"]).factory("membershipService",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/centers/:centerId/membership-types"));return{query:function(e){return t.query({centerId:e}).$promise}}}]),angular.module("deskworks.optsCreditType",[]).factory("optsCreditType",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"reservation",_name:"MEMBER_USAGE.CREDIT_TYPE.RESERVATION"},{id:"pass",_name:"MEMBER_USAGE.CREDIT_TYPE.PASS"},{id:"bucket",_name:"MEMBER_USAGE.CREDIT_TYPE.BUCKET"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.optsOurMembersSort",[]).factory("optsOurMembersSort",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"name",_name:"OUR_MEMBERS.SORT.NAME"},{id:"occupation",_name:"OUR_MEMBERS.SORT.OCCUPATION"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.optsUsageSource",[]).factory("optsUsageSource",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"reservation",_name:"MEMBER_USAGE.SOURCE.RESERVATION"},{id:"network",_name:"MEMBER_USAGE.SOURCE.NETWORK"},{id:"manual",_name:"MEMBER_USAGE.SOURCE.MANUAL"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.OurMembers",["ngResource","deskworks.config"]).factory("OurMembers",["$resource","$timeout","deskworksConfig",function(e,r,t){"use strict";var n=e(t.getApiAbsUrl("/our-members"));return{query:function(e){var r={centerId:e.centerId||null,sort:e.sort||null,q:e.q||null,limit:e.limit||null,offset:e.offset||null};return n.query(r).$promise}}}]),angular.module("deskworks.usageEntryService",["ngResource","deskworks.config","datesDeserializer"]).factory("usageEntryService",["$resource","$q","$filter","deskworksConfig","helper","datesDeserializer",function(e,r,t,n,i,s){"use strict";var o=t("date"),a=s(["usages.checkInTime","usages.checkOutTime"]),l=e(n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/usage-entries/:usageId"),{},{query:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,a]},save:{method:"POST",transformRequest:[c,angular.toJson]},update:{method:"PUT",transformRequest:[c,angular.toJson]}});function c(e){return(e=angular.extend({},e)).checkInTime=o(e.checkInTime,"iso"),e.checkOutTime=o(e.checkOutTime,"iso"),e}return{query:function(e,r,t,n){return l.query({userId:r,centerId:e,page:t,pageSize:n}).$promise},get:function(e,t,n){return"new"===n?r.when({id:"new",checkInTime:moment(),checkOutTime:moment(),notes:""}):l.query({userId:t,centerId:e}).$promise.then(function(e){var t=i.findByKeyValue(e.usages,"id",n);return t||r.reject({data:{error:"Failed to find usage with id="+n}})})},save:function(e,r,t){return t.id&&"new"!==t.id?l.update({userId:r,centerId:e,usageId:t.id},t).$promise:l.save({userId:r,centerId:e},t).$promise},delete:function(e,r,t){return l.delete({userId:r,centerId:e,usageId:t}).$promise}}}]),angular.module("deskworks.reservationRules.optsDaysInAdvance",[]).factory("optsDaysInAdvance",["$rootScope","$translate","$filter",function(e,r,t){"use strict";var n=[{id:0,_name:"RESERVATION_RULES.UNLIMITED"},{id:180},{id:120},{id:90},{id:60},{id:45},{id:30},{id:14},{id:7},{id:1}];function i(){n.forEach(function(e){e.name=e._name?r.instant(e._name):t("days")(e.id)})}return i(),e.$on("$setTranslationsSuccess",i),n}]),angular.module("deskworks.reservationRules.optsReservationLimitMax",[]).factory("optsReservationLimitMax",["$rootScope","$translate","$filter",function(e,r,t){"use strict";var n=[{id:"0.0",_name:"RESERVATION_RULES.UNLIMITED"},{id:"8.0",value:8,unit:"hours"},{id:"7.0",value:7,unit:"hours"},{id:"6.0",value:6,unit:"hours"},{id:"5.0",value:5,unit:"hours"},{id:"4.0",value:4,unit:"hours"},{id:"3.0",value:3,unit:"hours"},{id:"2.0",value:2,unit:"hours"},{id:"1.0",value:1,unit:"hours"},{id:"0.5",value:30,unit:"minutes"}];function i(){n.forEach(function(e){e._name&&(e.name=r.instant(e._name)),e.unit&&(e.name=t(e.unit)(e.value)+"/"+t("days")(1,!0))})}return i(),e.$on("$setTranslationsSuccess",i),n}]),angular.module("deskworks.reservationRules.optsReservationLimitMin",[]).factory("optsReservationLimitMin",["$rootScope","$translate","$filter",function(e,r,t){"use strict";var n=[{id:"0.25",value:15,unit:"minutes",name:"15 min"},{id:"0.5",value:30,unit:"minutes",name:"30 min"},{id:"1.0",value:1,unit:"hours",name:"1 hr"},{id:"2.0",value:2,unit:"hours",name:"2 hr"},{id:"4.0",value:4,unit:"hours",name:"4 hr"},{id:"24.0",value:1,unit:"days",name:"1 day"},{id:"72.0",value:3,unit:"days",name:"3 day"},{id:"168.0",value:1,unit:"weeks",name:"1 week"}];function i(){n.forEach(function(e){e.name=t(e.unit)(e.value)})}return i(),e.$on("$setTranslationsSuccess",i),n}]),angular.module("deskworks.reservationRules.optsWhoCanReserve",[]).factory("optsWhoCanReserve",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"anyone",_name:"RESERVATION_RULES.WHO_CAN_RESERVE.ANYONE"},{id:"nonMember",_name:"RESERVATION_RULES.WHO_CAN_RESERVE.NON_MEMBER"},{id:"member",_name:"RESERVATION_RULES.WHO_CAN_RESERVE.MEMBER"},{id:"staffOnly",_name:"RESERVATION_RULES.WHO_CAN_RESERVE.STAFF_ONLY"},{id:"notAvailable",_name:"RESERVATION_RULES.WHO_CAN_RESERVE.NOT_AVAILABLE"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.reservationRules.service",["ngResource","deskworks.config"]).factory("ReservationRules",["$resource","$timeout","$filter","$rootScope","$translate","$locale","helper","deskworksConfig",function(e,r,t,n,i,s,o,a){"use strict";var l=a.getApiAbsUrl("/centers/:centerId/reservation-rules/:ruleId"),c=a.getApiAbsUrl("/centers/:centerId/reservation-units/:reservationUnitId/reservation-rules/:ruleId"),u=e(l,{centerId:"@centerId",ruleId:"@ruleId"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,m]},save:{method:"POST",transformRequest:[h,angular.toJson],transformResponse:[angular.fromJson,m]},update:{method:"PUT",transformRequest:[h,angular.toJson],transformResponse:[angular.fromJson,m]},delete:{method:"DELETE"}}),d=e(c,{centerId:"@centerId",reservationUnitId:"@reservationUnitId",ruleId:"@ruleId"},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,m]},save:{method:"POST",transformRequest:[h,angular.toJson],transformResponse:[angular.fromJson,m]},update:{method:"PUT",transformRequest:[h,angular.toJson],transformResponse:[angular.fromJson,m]}}),f=[{id:"member",_name:"RESERVATION_RULES.MEMBER",$isVisible:function(e){return"staffOnly"!==e&&"notAvailable"!==e&&"nonMember"!==e}},{id:"nonMember",_name:"RESERVATION_RULES.NON_MEMBER",$isVisible:function(e){return"anyone"===e||"nonMember"===e}}];function p(){f.forEach(function(e){e.name=i.instant(e._name)})}return p(),n.$on("$setTranslationsSuccess",p),{roles:f,query:function(e){return e.reservationUnitId?d.query(e).$promise:u.query(e).$promise},save:function(e,r){return e=Object.assign({ruleId:r.id},e),(r.id?e.reservationUnitId?d.update(e,r).$promise:u.update(e,r).$promise:e.reservationUnitId?d.save(e,r).$promise:u.save(e,r).$promise).then(function(e){return r.id=e.id,f.forEach(function(t){e[t.id]&&e[t.id].intervals&&(r[t.id].intervals=e[t.id].intervals)}),r})},delete:function(e){return u.delete(e).$promise}};function m(e){return(angular.isArray(e)?e:[e]).forEach(function(e){switch(e.uid){case"whoCanReserve":case"fullTimeProduct":e.type="value";break;case"attachedUser":e.type="static";break;case"limitMin":case"limitMax":case"daysInAdvance":e.type="roles";break;case"sun":e.name=s.DATETIME_FORMATS.SHORTDAY[0],e.type="weekday";break;case"mon":e.name=s.DATETIME_FORMATS.SHORTDAY[1],e.type="weekday";break;case"tue":e.name=s.DATETIME_FORMATS.SHORTDAY[2],e.type="weekday";break;case"wed":e.name=s.DATETIME_FORMATS.SHORTDAY[3],e.type="weekday";break;case"thu":e.name=s.DATETIME_FORMATS.SHORTDAY[4],e.type="weekday";break;case"fri":e.name=s.DATETIME_FORMATS.SHORTDAY[5],e.type="weekday";break;case"sat":e.name=s.DATETIME_FORMATS.SHORTDAY[6],e.type="weekday";break;default:e.type="date"}"weekday"!==e.type&&"date"!==e.type||f.forEach(function(r){e[r.id].intervals.forEach(function(e){e.from=t("toDate")(e.from),e.to=t("toDate")(e.to)})}),"date"===e.type&&(e.date=t("toDate")(e.date))}),e}function h(e){var r=e.type;return e=angular.copy(o.purify(e,["type"])),"weekday"!==r&&"date"!==r||f.forEach(function(r){e[r.id]=o.purify(e[r.id]),angular.forEach(e[r.id].intervals,function(e){e.from=t("date")(e.from,"HH:mm"),e.to=t("date")(e.to,"HH:mm"),"00:00"===e.to&&(e.to="24:00")})}),"date"===r&&(e.date=t("date")(e.date,"yyyy-MM-dd")),e}}]),angular.module("deskworks.calendarService",["ngResource","deskworks.config","datesDeserializer"]).factory("calendarService",["$resource","$filter","deskworksConfig","helper","datesDeserializer",function(e,r,t,n,i){"use strict";var s=i(["reservationUnits.reservations.from","reservationUnits.reservations.to","reservationUnits.availabilities.from","reservationUnits.availabilities.to"]),o=e(t.getApiAbsUrl("/centers/:centerId/reservations"),{centerId:"@centerId",from:"@from",to:"@to"},{query:{method:"GET",isArray:!0,transformResponse:s}});return{query:function(e,t,n,i){return o.query({centerId:e,from:r("date")(t,"yyyy-MM-dd"),to:r("date")(n,"yyyy-MM-dd"),role:i||void 0}).$promise}}}]),angular.module("deskworks.reservationUnit.optsRepeatFrequency",[]).factory("optsRepeatFrequency",["$rootScope","$filter","$translate",function(e,r,t){"use strict";var n=[{_name:"RESERVATIONS.REPEAT_FREQUENCY.NONE"},{id:"1.day",_name:"RESERVATIONS.REPEAT_FREQUENCY.DAILY",repeatDurationFilter:r("days"),repeatDurationOptions:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]},{id:"1.week",_name:"RESERVATIONS.REPEAT_FREQUENCY.WEEKLY",repeatDurationFilter:r("weeks"),repeatDurationOptions:[1,2,3,4,5,6,7,8,9,10,11,12]},{id:"1.month",_name:"RESERVATIONS.REPEAT_FREQUENCY.MONTHLY",repeatDurationFilter:r("months"),repeatDurationOptions:[1,2,3,4,5,6,7,8,9,10,11,12]},{id:"4.weeks",_name:"RESERVATIONS.REPEAT_FREQUENCY.MONTHLY_WEEKLY",repeatDurationFilter:r("months"),repeatDurationOptions:[1,2,3,4,5,6,7,8,9,10,11,12]}];function i(){n.forEach(function(e){e.name=t.instant(e._name)})}return i(),e.$on("$setTranslationsSuccess",i),n}]),angular.module("deskworks.ReservationPrice.service",["ngResource","deskworks.config"]).factory("ReservationPrice",["$resource","$q","deskworksConfig",function(e,r,t){"use strict";return e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/reservation-prices"),{centerId:"@centerId",userId:"@userId"},{query:{method:"GET",isArray:!0}})}]),angular.module("deskworks.reservationService",["ngResource","deskworks.config","datesDeserializer"]).factory("reservationService",["$resource","$filter","deskworksConfig","helper","datesDeserializer",function(e,r,t,n,i){"use strict";var s=r("date"),o=i(["from","to","updatedAt"]),a=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/reservations/:reservationId"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,o]},save:{method:"POST",transformRequest:l},update:{method:"PUT",transformRequest:l}});return{query:function(e){return(e=angular.extend({},e)).from=e.from&&s(e.from,"iso"),e.to=e.to&&s(e.to,"iso"),a.query(e).$promise},save:function(e,r,t){return t.id?a.update({centerId:e,userId:r,reservationId:t.id},t).$promise:a.save({centerId:e,userId:r},t).$promise.then(function(e){return t.id=e.id,t.accessCode=e.accessCode,t})},delete:function(e,r,t,n){return a.delete({centerId:e,userId:r,reservationId:t,emailConfirmation:n}).$promise}};function l(e){return(e=angular.extend({},e)).from=s(e.from,"iso"),e.to=s(e.to,"iso"),angular.toJson(e)}}]),angular.module("sessionInjector",["session"]).factory("sessionInjector",["$injector",function(e){"use strict";return{request:function(r){if(!r.url.match(/\/api\//i))return r;var t=e.get("session");t.isAnonymous()||(r.headers.Authorization="Bearer "+t.accessToken);return r}}}]),angular.module("sessionRefresher",["session"]).factory("sessionRefresher",["$q","$injector","$location",function(e,r,t){"use strict";return{responseError:function(n){if(419===n.status){var i=r.get("$http");return r.get("session").refresh().catch(function(r){return t.search("redirect",t.path()),t.path("/sign-in"),e.reject(r)}).then(function(){return i(n.config)})}return e.reject(n)}}}]),angular.module("session",["deskworks.config","deskworks.userRoles"]).factory("session",["$q","$http","deskworksConfig","userRoles",function(e,r,t,n){"use strict";var i=t.getApiAbsUrl("/auth"),s={wait:function(){return e.when(o)},refresh:l,login:function(t,n,s){return e.when(o).finally(function(){return o=r.post(i,{username:t,password:n,remember:s}).then(c).finally(function(){o=null})})},logout:function(){return e.when(o).finally(function(){return r.delete(i).finally(a)})},isAnonymous:function(){return!s.user},isAdmin:function(){return s.user&&n[s.user.role]&&"admin"===n[s.user.role].type||!1},isRole:function(e){angular.isArray(e)||(e=[e]);return s.user&&e.some(function(e){return e===s.user.role})||!1}};a();var o=l().finally(function(){o=null});return s;function a(){s.accessToken=null,s.user=null,s.expireAt=null}function l(){return o||(o=r.get(i).then(c).catch(function(e){if(401!==e.status)throw e}).finally(function(){o=null}))}function c(e){return s.accessToken=e.data.accessToken,s.user=e.data.user,e}}]),angular.module("deskworks.allowedHost.service",["ngResource","deskworks.config","deskworks.helper"]).factory("allowedHostService",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/setup/allowed-hosts/:allowedHostId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return e.id?i.update({allowedHostId:e.id},e).$promise:i.save(e).$promise.then(function(r){e.id=r.id})},delete:function(e){return i.delete({allowedHostId:e}).$promise}}}]),angular.module("deskworks.bank.service",["ngResource","deskworks.config","datesDeserializer"]).factory("bankService",["$resource","$q","$filter","deskworksConfig","helper","datesDeserializer",function(e,r,t,n,i,s){"use strict";var o=s(["creditCardCutOffTime"]),a=e(n.getApiAbsUrl("/banks/:bankId"),{},{query:{method:"GET",isArray:!0,transformResponse:o},get:{method:"GET",transformResponse:o},update:{method:"PUT"}});return{query:function(){return a.query().$promise},get:function(e){return"new"===e?r.when({id:e}):a.get({bankId:e}).$promise},save:function(e){var r=angular.copy(e);return r.creditCardCutOffTime=t("date")(e.creditCardCutOffTime,"HH:mm"),e.id&&"new"!==e.id?a.update({bankId:e.id},r).$promise:a.save({},r).$promise.then(function(r){return e.id=r.id,r})},delete:function(e){return a.delete({bankId:e}).$promise}}}]),angular.module("deskworks.NetCheckInSettings",["ngResource","deskworks.config"]).factory("NetCheckInSettings",["$resource","deskworksConfig",function(e,r){var t=e(r.getApiAbsUrl("/net-check-in/settings//:centerId"),{},{update:{method:"PUT"}});return{get:function(e){return t.get({centerId:e}).$promise},save:function(e,r){return t.update({centerId:e},r).$promise}}}]),angular.module("deskworks.optsDashboardIncome",[]).factory("optsDashboardIncome",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"cash",_name:"SETUP_SETTINGS.DASHBOARD_INCOME.CASH"},{id:"accrual",_name:"SETUP_SETTINGS.DASHBOARD_INCOME.ACCRUAL"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsFreeAccessLength",[]).factory("optsFreeAccessLength",["$rootScope","$translate",function(e,r){var t=[{id:0,_name:"CENTERS.FREE_ACCESS.DISABLED"},{id:30,hours:.5},{id:60,hours:1},{id:90,hours:1.5},{id:120,hours:2},{id:180,hours:3}];function n(){t.forEach(function(e){e._name?e.name=r.instant(e._name):e.name=r.instant("GLOBAL.HOURS_FILTER",{hoursCount:e.hours},"messageformat")})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsInvoiceDate",[]).factory("optsInvoiceDate",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"invoiceDate",_name:"SETUP_SETTINGS.INVOICE_DATE.INVOICE_DATE"},{id:"chargeDate",_name:"SETUP_SETTINGS.INVOICE_DATE.CHARGE_DATE"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsMinPassFractionUnit",[]).factory("optsMinPassFractionUnit",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:!0,_name:"SETUP_SETTINGS.MIN_PASS_UNIT.PASSES"},{id:!1,_name:"SETUP_SETTINGS.MIN_PASS_UNIT.HOURS"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsProrateAtStart",[]).factory("optsProrateAtStart",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:null,_name:"GLOBAL.NONE"},{id:"firstCharge",_name:"SETUP_SETTINGS.PRO_RATE_AT_START.FIRST_MONTH"},{id:"secondCharge",_name:"SETUP_SETTINGS.PRO_RATE_AT_START.SECOND_MONTH"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsProrateAtTermination",[]).factory("optsProrateAtTermination",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:null,_name:"GLOBAL.NONE"},{id:"noticeDate",_name:"SETUP_SETTINGS.PRO_RATE_AT_TERMINATION.NOTICE_DATE"},{id:"terminationDate",_name:"SETUP_SETTINGS.PRO_RATE_AT_TERMINATION.TERMINATION_DATE"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsRecurringPeriodBase",[]).factory("optsRecurringPeriodBase",["$rootScope","$translate",function(e,r){var t=[{id:"paymentDate",_name:"SETUP_SETTINGS.RECURRING_PERIOD_BASE.PAYMENT_DATE"},{id:"invoiceDate",_name:"SETUP_SETTINGS.RECURRING_PERIOD_BASE.INVOICE_DATE"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.setup.optsReservationCreditsUnit",[]).factory("optsReservationCreditsUnit",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"$",_name:"SETUP_SETTINGS.RESERVATION_CREDITS_UNIT.MONEY"},{id:"hours",_name:"SETUP_SETTINGS.RESERVATION_CREDITS_UNIT.HOURS"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.optsTaskPermission",[]).factory("optsTaskPermission",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:null,_name:"TASKS.PERMISSION.NONE"},{id:"view",_name:"TASKS.PERMISSION.VIEW"},{id:"edit",_name:"TASKS.PERMISSION.EDIT"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.optsTimezone",[]).factory("optsTimezone",function(){"use strict";return[{id:"Hawaii",name:"Hawaii"},{id:"Alaska",name:"Alaska"},{id:"Pacific Time (US & Canada)",name:"Pacific Time (US & Canada)"},{id:"Mountain Time (US & Canada)",name:"Mountain Time (US & Canada)"},{id:"Central Time (US & Canada)",name:"Central Time (US & Canada)"},{id:"Eastern Time (US & Canada)",name:"Eastern Time (US & Canada)"},{id:"Amsterdam",name:"Amsterdam"},{id:"Helsinki",name:"Helsinki"},{id:"Jerusalem",name:"Gaza"},{id:"Singapore",name:"Singapore"},{id:"Sydney",name:"Sydney"}]}),angular.module("deskworks.Owner",["ngResource","deskworks.config","deskworks.helper"]).factory("Owner",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/owners/:ownerId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return e.id?i.update({ownerId:e.id},e).$promise:i.save(e).$promise.then(function(r){e.id=r.id})},delete:function(e){return i.delete({ownerId:e}).$promise}}}]),angular.module("deskworks.printerUsageTypeNames",[]).factory("printerUsageTypeNames",["$rootScope","$translate",function(e,r){"use strict";var t={},n={printBlack:r.instant("PRINTER_USAGE_SETTINGS.TYPE.PRINT_BLACK"),printColor:r.instant("PRINTER_USAGE_SETTINGS.TYPE.PRINT_COLOR"),scan:r.instant("PRINTER_USAGE_SETTINGS.TYPE.SCAN"),fax:r.instant("PRINTER_USAGE_SETTINGS.TYPE.FAX")};function i(){Object.keys(n).forEach(function(e){t[e]=r.instant(n[e])})}return i(),e.$on("$setTranslationsSuccess",i),t}]),angular.module("deskworks.Region",["ngResource","deskworks.config","deskworks.helper"]).factory("Region",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/regions/:regionId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return e.id?i.update({regionId:e.id},e).$promise:i.save(e).$promise.then(function(r){e.id=r.id})},delete:function(e){return i.delete({regionId:e}).$promise}}}]),angular.module("deskworks.setup.service",["ngResource","ngFileUpload","autoCacheFactory","deskworks.config","deskworks.helper","deskworks.whitelabel","deskworks.setup.optsInvoiceDate","deskworks.setup.optsReservationCreditsUnit"]).factory("setupService",["$resource","$q","$filter","$http","deskworksConfig","helper","Upload","optsInvoiceDate","whitelabel","centerService","userProfileService","autoCacheFactory",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f=d("settings",30),p=e(i.getApiAbsUrl("/setup/settings"),{},{get:{method:"GET",cache:f},update:{method:"PUT"}}),m=e(i.getApiAbsUrl("/setup/printer-usages"),{},{update:{method:"PUT"}}),h=e(i.getApiAbsUrl("/setup/bar-uploads"),{},{update:{method:"PUT"}});return{resetCache:function(){f.removeAll()},getSetupSettings:function(){return p.get({}).$promise.then(function(e){return e.invoiceDate=s.findByKeyValue(a,"id",e.invoiceDate),e.homepageUrl=e.homepageUrl||angular.element(l.getHeaderTemplate()).attr("href"),l.setHomepageUrl(e.homepageUrl),e.tosLinkUrl=e.tosLinkUrl||angular.element("<span></span>").append(l.getTermsAndConditionsTemplate()).children().attr("href"),e.tosLinkText=e.tosLinkText||angular.element("<span></span>").append(l.getTermsAndConditionsTemplate()).text(),e.contactLinkUrl=e.contactLinkUrl||angular.element("<span></span>").append(l.getContactTemplate()).children().attr("href"),e})},updateSetupSettings:function(e){var r={locale:e.locale,timeFormat:e.timeFormat,sendNoticesFromLocalCenter:!!e.sendNoticesFromLocalCenter,enableEChecks:e.enableEChecks,skipPlanMemberSignUp:e.skipPlanMemberSignUp,creditCardTypes:e.creditCardTypes,creditCardAddressOptional:e.creditCardAddressOptional,enableEmailing:e.enableEmailing,dashboardIncome:e.dashboardIncome,enableAccessCodes:e.enableAccessCodes,isFranchise:e.isFranchise,enableCalendarPhotos:e.enableCalendarPhotos,multiLevelProductCategory:e.multiLevelProductCategory,enableRecurringPerCoMembers:e.enableRecurringPerCoMembers,sweepCharges:!!e.sweepCharges,emailSweptInvoices:!!e.emailSweptInvoices,invoiceDate:e.invoiceDate.id,prorateAtStart:e.prorateAtStart,prorateAtTermination:e.prorateAtTermination,addCenterPrefixToCalendar:!!e.addCenterPrefixToCalendar,calendarOwners:e.calendarOwners.filter(function(e){return!!e.owner}).map(function(e){return{id:e.id,owner:angular.isNumber(e.owner)?e.owner:(e.owner||{}).id,mask:e.mask}}),memberDirectoryUrl:e.memberDirectoryUrl,companyName:e.companyName,homepageUrl:e.homepageUrl,contactLinkUrl:e.contactLinkUrl,tosLinkUrl:e.tosLinkUrl&&""!==e.tosLinkUrl?e.tosLinkUrl:e.homepageUrl,tosLinkText:e.tosLinkText&&""!==e.tosLinkText?e.tosLinkText:e.shortName+" Terms and Conditions",sendReservationReminder:e.sendReservationReminder,reservationCreditsUnit:e.reservationCreditsUnit,minPassInPercent:e.minPassInPercent,publicReservationDetails:e.publicReservationDetails,gtmContainerId:e.gtmContainerId};return e.sweepCharges&&(r.advanceInvoicingDays=e.advanceInvoicingDays.id,r.recurringPeriodBase=e.recurringPeriodBase),f.removeAll(),p.save({},r).$promise},updateSetupSettingsRaw:function(e){return f.removeAll(),p.save({},e).$promise},uploadTermsOfService:function(e){return f.removeAll(),o.upload({url:i.getApiAbsUrl("/setup/settings"),method:"POST",withCredentials:!0,data:{termsOfService:e}})},queryLocales:function(){return r.when(window.dwLocales)},queryTimezones:function(){return n.get("assets/timezones.json",{cache:!0}).then(function(e){return angular.fromJson(e.data)})},getPrinterUsageSettings:function(e){var r=this;return m.get({centerId:e}).$promise.then(function(e){return r.resolvePrinterUsageSettings(e)})},updatePrinterUsageSettings:function(e,r){var t={centerId:e,printerFormattingType:r.printerFormattingType,colPrinterCode:r.colPrinterCode,colJobMode:r.colJobMode,colBWCount:r.colBWCount,colColorCount:r.colColorCount,colScanCount:r.colScanCount,colFaxCount:r.colFaxCount,printerUsageTypes:r.printerUsageTypes};return m.save({},t).$promise},resolvePrinterUsageSettings:function(e){return e},getBarUploadSettings:function(e){return h.get({centerId:e}).$promise.then(function(e){return e.product=s.findByKeyValue(e.options.serviceProducts,"id",e.productId),e})},updateBarUploadSettings:function(e){var r={centerId:e.centerId,productId:e.product&&e.product.id||null,colMemberName:e.colMemberName,colChargeAmount:e.colChargeAmount};return h.save({},r).$promise}}}]),angular.module("deskworks.Task",["ngResource","deskworks.config","autoCacheFactory"]).factory("Task",["$resource","deskworksConfig","helper","autoCacheFactory",function(e,r,t,n){"use strict";var i=e(r.getApiAbsUrl("/tasks/:taskId"),{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return{query:function(){return i.query().$promise},get:function(e){return i.get({taskId:e}).$promise},save:function(e){var r=t.purify(e,["options"]);return n.emptyAll(),e.id&&"new"!==e.id?i.update({taskId:e.id},r).$promise:i.save({},r).$promise.then(function(r){return e.id=r.id,e})},delete:function(e){return n.emptyAll(),i.delete({taskId:e}).$promise}}}]),angular.module("deskworks.UserField",["ngResource","deskworks.config","deskworks.helper"]).factory("UserField",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/user-fields/:fieldId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return e.id?i.update({fieldId:e.id},e).$promise:i.save(e).$promise.then(function(r){e.id=r.id})},delete:function(e){return i.delete({fieldId:e}).$promise}}}]),angular.module("deskworks.accessCard.service",["ngResource","deskworks.config"]).factory("AccessCard",["$resource","deskworksConfig",function(e,r){"use strict";return e(r.getApiAbsUrl("/centers/:centerId/access-cards/:accessCardId"),{centerId:"@centerId",accessCardId:"@accessCardId"},{update:{method:"PUT"}})}]),angular.module("deskworks.Admin",["ngResource","deskworks.config","deskworks.helper"]).factory("Admin",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/administrators/:adminId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},get:function(e){return i.get({adminId:e}).$promise.then(function(r){return"new"===e?(r.role=r.options.roles[0],r.receiveUrgentReservationNotices=!0,r.receiveWelcomeEmailCopies=!1,r.receiveReservationConfirmationCopies=!1,r.seeDashboardRevenue=!0,r.centers.forEach(function(e){e.emailing=!0,e.permission="all"})):r.role=n.findByKeyValue(r.options.roles,"id",r.role),r.centers=r.centers||{},r})},save:function(e){var r=n.purify(e,["options","printerCode"]);return r.role=r.role&&r.role.id?r.role.id:r.role,e.id&&"new"!==e.id?i.update({adminId:e.id},r).$promise:i.save({},r).$promise.then(function(r){return e.id=r.id,e})},delete:function(e){return i.delete({adminId:e}).$promise}}}]),angular.module("deskworks.center.service",["ngResource","deskworks.config","autoCacheFactory","ngFileUpload","deskworks.helper","deskworks.userProfile.optsCountry","deskworks.userProfile.optsState"]).factory("centerService",["$resource","$filter","Upload","deskworksConfig","autoCacheFactory","helper","optsCountry","optsState",function(e,r,t,n,i,s,o,a){"use strict";var l=i("center",60),c=e(n.getApiAbsUrl("/centers/:centerId"),{},{get:{method:"GET",cache:l},query:{method:"GET",cache:l,isArray:!0},update:{method:"PUT"}});return{resetCache:function(){l.removeAll()},getCenter:function(e){return c.get({centerId:e}).$promise},getCenters:function(){return c.query().$promise},createCenter:function(e){return l.removeAll(),c.save({},e).$promise},updateCenter:function(e,r){return l.removeAll(),c.update({centerId:e},r).$promise},deleteCenter:function(e){return l.removeAll(),c.delete({centerId:e}).$promise},uploadThumbnail:function(e,r){return l.removeAll(),t.upload({url:n.getApiAbsUrl("/centers/"+e),method:"PUT",withCredentials:!0,data:{photo:r}})},get:function(e){var r=this;return c.get({centerId:e}).$promise.then(function(e){return r.resolve(e)})},save:function(e){return l.removeAll(),"new"===e.id?c.save({},this.unresolve(e)).$promise.then(function(r){return e.id=r.id,r}):c.update({centerId:e.id||0},this.unresolve(e)).$promise},resolve:function(e){return e.id&&"new"!==e.id?(e.street=e.address,e.country=s.findByKeyValue(o,"id",e.countryId),e.country&&a[e.country.id]&&(e.state=s.findByKeyValue(a[e.country.id],"id",e.state))):(e.id="new",e.country=s.findByKeyValue(o,"id","US"),e.state=s.findByKeyValue(a.US,"id","CA"),e.bankId=e.options.banks[0]&&e.options.banks[0].id,e.taxRates=[],e.ownerId=null,e.regionId=null),e},unresolve:function(e){var r={name:e.name,shortName:e.shortName,street1:e.street1,street2:e.street2,city:e.city,state:e.state.id?e.state.id:e.state,countryId:e.country.id,zip:e.zip,phone:e.phone,fax:e.fax,email:e.email,bankId:e.bankId,forInternalUse:!!e.forInternalUse,description:e.description,map:e.map,directions:e.directions,color:e.color,timezone:e.timezone,ownerId:e.ownerId,regionId:e.regionId,taxId:e.taxId,taxRates:e.taxRates.map(function(e){return e.rate=+e.rate,e})};return e.options.qboClasses&&(r.qboClassId=e.qboClassId),r}}}]),angular.module("deskworks.optsAdminPermission",[]).factory("optsAdminPermission",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:null,_name:"ADMINISTRATORS.PERMISSION.NONE"},{id:"all",_name:"ADMINISTRATORS.PERMISSION.ALL"},{id:"viewProfileAndCalendar",_name:"ADMINISTRATORS.PERMISSION.VIEW_PROFILE_AND_CALENDAR"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.optsSystemEmailFunction",[]).factory("optsSystemEmailFunction",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:0,_name:"SYSTEM_EMAILS.FUNCTION.FROM"},{id:1,_name:"SYSTEM_EMAILS.FUNCTION.SIGN_UP"},{id:2,_name:"SYSTEM_EMAILS.FUNCTION.LOST_ACCESS_CARD"},{id:3,_name:"SYSTEM_EMAILS.FUNCTION.NEW_ORDER"},{id:4,_name:"SYSTEM_EMAILS.FUNCTION.EXISTING_ORDER"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.system.service",["ngResource","deskworks.config","deskworks.helper"]).factory("systemService",["$resource","$q","deskworksConfig","helper",function(e,r,t,n){"use strict";var i=e(t.getApiAbsUrl("/system-emails/:systemEmailId"),{},{update:{method:"PUT"}}),s=e(t.getApiAbsUrl("/centers/:centerId/access-cards/:accessCardId"),{},{update:{method:"PUT"}}),o=e(t.getApiAbsUrl("/lead-sources/:leadSourceId"),{},{update:{method:"PUT"}});return{getSystemEmails:function(){return i.query().$promise},getSystemEmail:function(e){return"new"===e?r.when({}):i.query({}).$promise.then(function(t){var i=n.findByKeyValue(t,"id",e);return i||r.reject({data:{error:"System Email not found."}})})},createSystemEmail:function(e){return i.save({},e).$promise},updateSystemEmail:function(e,r){return i.update({systemEmailId:e},r).$promise},removeSystemEmail:function(e){return i.delete({systemEmailId:e}).$promise},getAccessCards:function(e){return s.query({centerId:e}).$promise},getAccessCard:function(e,t){return"new"===t?r.when({effectiveDate:moment()}):s.query({centerId:e}).$promise.then(function(e){var i=n.findByKeyValue(e,"id",t);return i||r.reject({data:{error:"Access Card not found."}})})},createAccessCard:function(e,r){return s.save({centerId:e},r).$promise},updateAccessCard:function(e,r,t){return s.update({centerId:e,accessCardId:r},t).$promise},removeAccessCard:function(e,r){return s.delete({centerId:e,accessCardId:r}).$promise},getLeadSources:function(){return o.query().$promise},getLeadSource:function(e){return o.get({leadSourceId:e}).$promise},createLeadSource:function(e){return o.save({},e).$promise},updateLeadSource:function(e,r){return o.update({leadSourceId:e},r).$promise},removeLeadSource:function(e){return o.delete({leadSourceId:e}).$promise}}}]),angular.module("deskworks.userProfile.optsAddressType",[]).factory("optsAddressType",function(){"use strict";return[{id:1,name:"GLOBAL.ADDRESS.TYPE.HOME"},{id:2,name:"GLOBAL.ADDRESS.TYPE.BUSINESS"},{id:3,name:"GLOBAL.ADDRESS.TYPE.MAILING"},{id:4,name:"GLOBAL.ADDRESS.TYPE.BILLING"}]}),angular.module("deskworks.userProfile.optsBankAccountHolderType",[]).factory("optsBankAccountHolderType",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"personal",_name:"BILLING_PROFILE.E_CHECKS.ACCOUNT_HOLDER_TYPE.PERSONAL"},{id:"business",_name:"BILLING_PROFILE.E_CHECKS.ACCOUNT_HOLDER_TYPE.BUSINESS"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsBankAccountType",[]).factory("optsBankAccountType",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"checking",_name:"BILLING_PROFILE.E_CHECKS.ACCOUNT_TYPE.CHECKING"},{id:"savings",_name:"BILLING_PROFILE.E_CHECKS.ACCOUNT_TYPE.SAVINGS"}];return e.$on("$setTranslationsSuccess",function(){t.forEach(function(e){e.name=r.instant(e._name)})}),t}]),angular.module("deskworks.userProfile.optsBillingMethod",[]).factory("optsBillingMethod",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"credit_card",_name:"USER_PROFILE.MEMBERSHIP.BILLING_METHOD.CREDIT_CARD",import:"Credit Card"},{id:"email_invoice",_name:"USER_PROFILE.MEMBERSHIP.BILLING_METHOD.EMAIL_INVOICE",import:"Email Invoice"},{id:"paper_invoice",_name:"USER_PROFILE.MEMBERSHIP.BILLING_METHOD.PAPER_INVOICE",import:"Paper Invoice"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsCCExpiryMonth",[]).factory("optsCCExpiryMonth",["$filter","$rootScope",function(e,r){"use strict";var t=[],n=new Date,i=new Date;n.setDate(1),i.setDate(1);for(var s=0;s<12;s++)n.setMonth(s),t.push({id:s+1<10?"0"+(s+1):""+(s+1),name:e("date")(n,"MM - LLLL")});return r.$on("$setLocaleSuccess",function(){t.forEach(function(r,t){n.setMonth(t),r.name=e("date")(n,"MM - LLLL")})}),t}]),angular.module("deskworks.userProfile.optsCCExpiryYear",[]).factory("optsCCExpiryYear",["$filter",function(e){"use strict";var r=[],t=new Date,n=new Date;t.setDate(1),n.setDate(1);for(var i=0;i<11;i++)t.setFullYear(n.getFullYear()+i),r.push({id:String(t.getFullYear()),name:e("date")(t,"yyyy")});return r}]),angular.module("deskworks.userProfile.optsCountry",[]).factory("optsCountry",function(){"use strict";return[{id:"AF",name:"Afghanistan"},{id:"AL",name:"Albania"},{id:"DZ",name:"Algeria"},{id:"AS",name:"American Samoa"},{id:"AD",name:"Andorra"},{id:"AO",name:"Angola"},{id:"AI",name:"Anguilla"},{id:"AG",name:"Antigua and Barbuda"},{id:"AR",name:"Argentina"},{id:"AM",name:"Armenia"},{id:"AW",name:"Aruba"},{id:"AU",name:"Australia"},{id:"AT",name:"Austria"},{id:"AZ",name:"Azerbaijan"},{id:"BS",name:"Bahamas"},{id:"BH",name:"Bahrain"},{id:"BD",name:"Bangladesh"},{id:"BB",name:"Barbados"},{id:"BY",name:"Belarus"},{id:"BE",name:"Belgium"},{id:"BZ",name:"Belize"},{id:"BJ",name:"Benin"},{id:"BM",name:"Bermuda"},{id:"BT",name:"Bhutan"},{id:"BO",name:"Bolivia"},{id:"BA",name:"Bosnia and Herzegovina"},{id:"BW",name:"Botswana"},{id:"BV",name:"Bouvet Island"},{id:"BR",name:"Brazil"},{id:"IO",name:"British Indian Ocean Territory"},{id:"BN",name:"Brunei Darussalam"},{id:"BG",name:"Bulgaria"},{id:"BF",name:"Burkina Faso"},{id:"BI",name:"Burundi"},{id:"KH",name:"Cambodia"},{id:"CM",name:"Cameroon"},{id:"CA",name:"Canada"},{id:"CV",name:"Cape Verde"},{id:"KY",name:"Cayman Islands"},{id:"CF",name:"Central African Republic"},{id:"TD",name:"Chad"},{id:"CL",name:"Chile"},{id:"CN",name:"China"},{id:"CX",name:"Christmas Island"},{id:"CC",name:"Cocos (Keeling) Islands"},{id:"CO",name:"Colombia"},{id:"KM",name:"Comoros"},{id:"CG",name:"Congo"},{id:"CD",name:"Congo, the Democratic Republic of the"},{id:"CK",name:"Cook Islands"},{id:"CR",name:"Costa Rica"},{id:"CI",name:"Cote D'Ivoire"},{id:"HR",name:"Croatia"},{id:"CU",name:"Cuba"},{id:"CY",name:"Cyprus"},{id:"CZ",name:"Czech Republic"},{id:"DK",name:"Denmark"},{id:"DJ",name:"Djibouti"},{id:"DM",name:"Dominica"},{id:"DO",name:"Dominican Republic"},{id:"EC",name:"Ecuador"},{id:"EG",name:"Egypt"},{id:"SV",name:"El Salvador"},{id:"GQ",name:"Equatorial Guinea"},{id:"ER",name:"Eritrea"},{id:"EE",name:"Estonia"},{id:"ET",name:"Ethiopia"},{id:"FK",name:"Falkland Islands (Malvinas)"},{id:"FO",name:"Faroe Islands"},{id:"FJ",name:"Fiji"},{id:"FI",name:"Finland"},{id:"FR",name:"France"},{id:"GF",name:"French Guiana"},{id:"PF",name:"French Polynesia"},{id:"TF",name:"French Southern Territories"},{id:"GA",name:"Gabon"},{id:"GM",name:"Gambia"},{id:"GE",name:"Georgia"},{id:"DE",name:"Germany"},{id:"GH",name:"Ghana"},{id:"GI",name:"Gibraltar"},{id:"GR",name:"Greece"},{id:"GL",name:"Greenland"},{id:"GD",name:"Grenada"},{id:"GP",name:"Guadeloupe"},{id:"GU",name:"Guam"},{id:"GT",name:"Guatemala"},{id:"GG",name:"Guernsey"},{id:"GN",name:"Guinea"},{id:"GW",name:"Guinea-Bissau"},{id:"GY",name:"Guyana"},{id:"HT",name:"Haiti"},{id:"HM",name:"Heard Island And Mcdonald Islands"},{id:"VA",name:"Holy See (Vatican City State)"},{id:"HN",name:"Honduras"},{id:"HK",name:"Hong Kong"},{id:"HU",name:"Hungary"},{id:"IS",name:"Iceland"},{id:"IN",name:"India"},{id:"ID",name:"Indonesia"},{id:"IR",name:"Iran, Islamic Republic of"},{id:"IQ",name:"Iraq"},{id:"IE",name:"Ireland"},{id:"IM",name:"Isle Of Man"},{id:"IL",name:"Israel"},{id:"IT",name:"Italy"},{id:"JM",name:"Jamaica"},{id:"JP",name:"Japan"},{id:"JE",name:"Jersey"},{id:"JO",name:"Jordan"},{id:"KZ",name:"Kazakhstan"},{id:"KE",name:"Kenya"},{id:"KI",name:"Kiribati"},{id:"KP",name:"Korea, Democratic People's Republic of"},{id:"KR",name:"Korea, Republic of"},{id:"KW",name:"Kuwait"},{id:"KG",name:"Kyrgyzstan"},{id:"LA",name:"Lao People's Democratic Republic"},{id:"LV",name:"Latvia"},{id:"LB",name:"Lebanon"},{id:"LS",name:"Lesotho"},{id:"LR",name:"Liberia"},{id:"LY",name:"Libyan Arab Jamahiriya"},{id:"LI",name:"Liechtenstein"},{id:"LT",name:"Lithuania"},{id:"LU",name:"Luxembourg"},{id:"MO",name:"Macao"},{id:"MK",name:"Macedonia, the Former Yugoslav Republic of"},{id:"MG",name:"Madagascar"},{id:"MW",name:"Malawi"},{id:"MY",name:"Malaysia"},{id:"MV",name:"Maldives"},{id:"ML",name:"Mali"},{id:"MT",name:"Malta"},{id:"MH",name:"Marshall Islands"},{id:"MQ",name:"Martinique"},{id:"MR",name:"Mauritania"},{id:"MU",name:"Mauritius"},{id:"YT",name:"Mayotte"},{id:"MX",name:"Mexico"},{id:"FM",name:"Micronesia, Federated States of"},{id:"MD",name:"Moldova, Republic of"},{id:"MC",name:"Monaco"},{id:"MN",name:"Mongolia"},{id:"ME",name:"Montenegro"},{id:"MS",name:"Montserrat"},{id:"MA",name:"Morocco"},{id:"MZ",name:"Mozambique"},{id:"MM",name:"Myanmar"},{id:"NA",name:"Namibia"},{id:"NR",name:"Nauru"},{id:"NP",name:"Nepal"},{id:"NL",name:"Netherlands"},{id:"AN",name:"Netherlands Antilles"},{id:"NC",name:"New Caledonia"},{id:"NZ",name:"New Zealand"},{id:"NI",name:"Nicaragua"},{id:"NE",name:"Niger"},{id:"NG",name:"Nigeria"},{id:"NU",name:"Niue"},{id:"NF",name:"Norfolk Island"},{id:"MP",name:"Northern Mariana Islands"},{id:"NO",name:"Norway"},{id:"OM",name:"Oman"},{id:"PK",name:"Pakistan"},{id:"PW",name:"Palau"},{id:"PS",name:"Palestinian Territory, Occupied"},{id:"PA",name:"Panama"},{id:"PG",name:"Papua New Guinea"},{id:"PY",name:"Paraguay"},{id:"PE",name:"Peru"},{id:"PH",name:"Philippines"},{id:"PN",name:"Pitcairn"},{id:"PL",name:"Poland"},{id:"PT",name:"Portugal"},{id:"PR",name:"Puerto Rico"},{id:"QA",name:"Qatar"},{id:"RE",name:"Reunion"},{id:"RO",name:"Romania"},{id:"RU",name:"Russian Federation"},{id:"RW",name:"Rwanda"},{id:"BL",name:"Saint Barthlemy"},{id:"SH",name:"Saint Helena"},{id:"KN",name:"Saint Kitts and Nevis"},{id:"LC",name:"Saint Lucia"},{id:"MF",name:"Saint Martin (French part)"},{id:"PM",name:"Saint Pierre and Miquelon"},{id:"VC",name:"Saint Vincent and the Grenadines"},{id:"WS",name:"Samoa"},{id:"SM",name:"San Marino"},{id:"ST",name:"Sao Tome and Principe"},{id:"SA",name:"Saudi Arabia"},{id:"SN",name:"Senegal"},{id:"RS",name:"Serbia"},{id:"SC",name:"Seychelles"},{id:"SL",name:"Sierra Leone"},{id:"SG",name:"Singapore"},{id:"SK",name:"Slovakia"},{id:"SI",name:"Slovenia"},{id:"SB",name:"Solomon Islands"},{id:"SO",name:"Somalia"},{id:"ZA",name:"South Africa"},{id:"GS",name:"South Georgia and the South Sandwich Islands"},{id:"ES",name:"Spain"},{id:"LK",name:"Sri Lanka"},{id:"SD",name:"Sudan"},{id:"SR",name:"Suriname"},{id:"SJ",name:"Svalbard and Jan Mayen"},{id:"SZ",name:"Swaziland"},{id:"SE",name:"Sweden"},{id:"CH",name:"Switzerland"},{id:"SY",name:"Syrian Arab Republic"},{id:"TW",name:"Taiwan, Province of China"},{id:"TJ",name:"Tajikistan"},{id:"TZ",name:"Tanzania, United Republic of"},{id:"TH",name:"Thailand"},{id:"TL",name:"Timor Leste"},{id:"TG",name:"Togo"},{id:"TK",name:"Tokelau"},{id:"TO",name:"Tonga"},{id:"TT",name:"Trinidad and Tobago"},{id:"TN",name:"Tunisia"},{id:"TR",name:"Turkey"},{id:"TM",name:"Turkmenistan"},{id:"TC",name:"Turks and Caicos Islands"},{id:"TV",name:"Tuvalu"},{id:"UG",name:"Uganda"},{id:"UA",name:"Ukraine"},{id:"AE",name:"United Arab Emirates"},{id:"GB",name:"United Kingdom"},{id:"US",name:"United States",import:"USA"},{id:"UM",name:"United States Minor Outlying Islands"},{id:"UY",name:"Uruguay"},{id:"UZ",name:"Uzbekistan"},{id:"VU",name:"Vanuatu"},{id:"VE",name:"Venezuela"},{id:"VN",name:"Viet Nam"},{id:"VG",name:"Virgin Islands, British"},{id:"VI",name:"Virgin Islands, U.S."},{id:"WF",name:"Wallis and Futuna"},{id:"EH",name:"Western Sahara"},{id:"YE",name:"Yemen"},{id:"ZM",name:"Zambia"},{id:"ZW",name:"Zimbabwe"},{id:"AX",name:"land Islands"}]}),angular.module("deskworks.userProfile.optsMailboxHandling",[]).factory("optsMailboxHandling",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"dropOff",_name:"USER_PROFILE.MAILBOXES.HANDLING.DROP_OFF"},{id:"mailbox",_name:"USER_PROFILE.MAILBOXES.HANDLING.MAILBOX"},{id:"forward",_name:"USER_PROFILE.MAILBOXES.HANDLING.FORWARD"},{id:"email",_name:"USER_PROFILE.MAILBOXES.HANDLING.EMAIL"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsMembershipStatus",[]).factory("optsMembershipStatus",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"active",_name:"USER_PROFILE.MEMBERSHIP.STATUS.ACTIVE",import:"Active"},{id:"inactive",_name:"USER_PROFILE.MEMBERSHIP.STATUS.INACTIVE",import:"Inactive"},{id:"nonMember",_name:"USER_PROFILE.MEMBERSHIP.STATUS.NON_MEMBER",import:"Non-Member"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsPhoneType",[]).factory("optsPhoneType",function(){"use strict";return[{id:1,name:"USER_PROFILE.PHONES.TYPE.HOME"},{id:2,name:"USER_PROFILE.PHONES.TYPE.WORK"},{id:3,name:"USER_PROFILE.PHONES.TYPE.MOBILE"},{id:4,name:"USER_PROFILE.PHONES.TYPE.FAX"},{id:5,name:"USER_PROFILE.PHONES.TYPE.OTHER"}]}),angular.module("deskworks.optsShareEmail",[]).factory("optsShareEmail",["$rootScope","$translate",function(e,r){"use strict";var t=[{id:"private",_name:"USER_PROFILE.SHAREABLE_INFO.EMAIL.PRIVATE"},{id:"members",_name:"USER_PROFILE.SHAREABLE_INFO.EMAIL.MEMBERS"},{id:"public",_name:"USER_PROFILE.SHAREABLE_INFO.EMAIL.PUBLIC"}];function n(){t.forEach(function(e){e.name=r.instant(e._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.userProfile.optsState",[]).factory("optsState",function(){"use strict";return{US:[{id:"AL",name:"AL"},{id:"AK",name:"AK"},{id:"AZ",name:"AZ"},{id:"AR",name:"AR"},{id:"CA",name:"CA"},{id:"CO",name:"CO"},{id:"CT",name:"CT"},{id:"DE",name:"DE"},{id:"DC",name:"DC"},{id:"FL",name:"FL"},{id:"GA",name:"GA"},{id:"HI",name:"HI"},{id:"ID",name:"ID"},{id:"IL",name:"IL"},{id:"IN",name:"IN"},{id:"IA",name:"IA"},{id:"KS",name:"KS"},{id:"KY",name:"KY"},{id:"LA",name:"LA"},{id:"ME",name:"ME"},{id:"MD",name:"MD"},{id:"MA",name:"MA"},{id:"MI",name:"MI"},{id:"MN",name:"MN"},{id:"MS",name:"MS"},{id:"MO",name:"MO"},{id:"MT",name:"MT"},{id:"NE",name:"NE"},{id:"NV",name:"NV"},{id:"NH",name:"NH"},{id:"NJ",name:"NJ"},{id:"NM",name:"NM"},{id:"NY",name:"NY"},{id:"NC",name:"NC"},{id:"ND",name:"ND"},{id:"OH",name:"OH"},{id:"OK",name:"OK"},{id:"ON",name:"ON"},{id:"OR",name:"OR"},{id:"PA",name:"PA"},{id:"RI",name:"RI"},{id:"SC",name:"SC"},{id:"SD",name:"SD"},{id:"TN",name:"TN"},{id:"TX",name:"TX"},{id:"UT",name:"UT"},{id:"VT",name:"VT"},{id:"VA",name:"VA"},{id:"WA",name:"WA"},{id:"WV",name:"WV"},{id:"WI",name:"WI"},{id:"WY",name:"WY"}]}}),angular.module("deskworks.userProfile.service.address",["ngResource","deskworks.helper","deskworks.userProfile.cache","deskworks.userProfile.optsAddressType","deskworks.userProfile.optsCountry","deskworks.userProfile.optsState"]).factory("upAddressService",["$resource","deskworksConfig","userProfileCache","helper","optsAddressType","optsCountry","optsState",function(e,r,t,n,i,s,o){"use strict";var a=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/addresses/:addressId"),{},{update:{method:"PUT"}});return{new:function(e,r){return{id:n.uid(),type:i[3],country:e&&n.findByKeyValue(s,"id",e.id||e)||n.findByKeyValue(s,"id","US"),state:n.findByKeyValue(o[e&&e.id||e||"US"],"id",r&&r.id||r||"CA")}},isNew:function(e){return e&&n.isUid(e.id)},save:function(e,r,i){return t.removeAll(),n.isUid(i.id)?a.save({centerId:e||0,userId:r},this.unresolve(i)).$promise.then(function(e){return i.id=e.id,e}):a.update({centerId:e||0,userId:r,addressId:i.id},this.unresolve(i)).$promise},delete:function(e,r,n){return t.removeAll(),a.delete({centerId:e||0,userId:r,addressId:n.id}).$promise},resolve:function(e){return e.type=n.findByKeyValue(i,"id",e.typeId),e.state=o[e.country]?n.findByKeyValue(o[e.country],"id",e.state):e.state,e.country=n.findByKeyValue(s,"id",e.country),e},unresolve:function(e){return{typeId:e.type&&e.type.id?e.type.id:e.type,street:e.street,city:e.city,country:e.country&&e.country.id?e.country.id:e.country,state:e.state&&e.state.id?e.state.id:e.state,zip:e.zip}}}}]),angular.module("deskworks.userProfile.cache",["autoCacheFactory"]).factory("userProfileCache",["autoCacheFactory",function(e){"use strict";return e("userProfile",60)}]),angular.module("deskworks.userProfile.service.coMember",["ngResource","deskworks.helper","deskworks.userProfile.cache"]).factory("upCoMemberService",["$resource","deskworksConfig","userProfileCache","helper",function(e,r,t,n){"use strict";var i=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/co-members/:coMemberId"),{},{update:{method:"PUT"}});return{new:function(){return{id:n.uid(),accessCards:[]}},isNew:function(e){return e&&n.isUid(e.id)},save:function(e,r,s){return t.removeAll(),n.isUid(s.id)?i.save({centerId:e||0,userId:r},this.unresolve(s)).$promise.then(function(e){return s.id=e.id,s.userId=e.userId,e}):i.update({centerId:e||0,userId:r,coMemberId:s.id},this.unresolve(s)).$promise},delete:function(e,r,n,s){return t.removeAll(),i.delete({centerId:e||0,userId:r,coMemberId:n.id,makeInactive:s}).$promise},resolve:function(e){return e.email=n.stripUid(e.email),e.login=n.stripUid(e.login),e},unresolve:function(e){return{userId:e.userId,existingUserId:e.existingUserId,fullName:e.fullName,email:e.email||n.uid()+"@"+n.uid()+".com",phone:e.phone,login:e.login||n.uid(),password:!n.isUid(e.id)||e.userId||e.existingUserId?e.password||void 0:e.password||n.uid(),notes:e.notes,canMakeReservations:!!e.canMakeReservations,canSeeAccountingInfo:!!e.canSeeAccountingInfo,getCenterNotices:!!e.getCenterNotices}},convertUserToCoMember:function(e){return{id:n.uid(),existingUserId:e.id,fullName:e.firstName+" "+e.lastName,email:e.email,phone:e.phones&&e.phones.length>0?e.phones[0].number:void 0,login:e.login,notes:e.comments,accessCards:e.accessCards}}}}]),angular.module("deskworks.userProfile.service.creditCard",["ngResource","deskworks.helper","deskworks.userProfile.cache","deskworks.userProfile.optsCCExpiryMonth","deskworks.userProfile.optsCCExpiryYear","deskworks.userProfile.optsCountry","deskworks.userProfile.optsState"]).factory("upCreditCardService",["$resource","$filter","deskworksConfig","userProfileCache","helper","optsCCExpiryMonth","optsCCExpiryYear","optsCountry","optsState",function(e,r,t,n,i,s,o,a,l){"use strict";var c=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/credit-cards/:creditCardId"),{},{update:{method:"PUT"}});return{new:function(e){var r={id:i.uid(),country:i.findByKeyValue(a,"id","US"),state:i.findByKeyValue(l.US,"id","CA")};return e&&(r.firstName=e.firstName,r.lastName=e.lastName,r.company=e.company,e.billingAddress&&(r.street=e.billingAddress.street,r.city=e.billingAddress.city,r.country=e.billingAddress.country,r.state=e.billingAddress.state,r.zip=e.billingAddress.zip)),r},isNew:function(e){return e&&i.isUid(e.id)},save:function(e,r,t){return n.removeAll(),i.isUid(t.id)?c.save({centerId:e||0,userId:r},this.unresolve(t)).$promise.then(function(e){return t.id=e.id,t.ccv="***",e}):c.update({centerId:e||0,userId:r,creditCardId:t.id},{defaultPaymentMethod:!0}).$promise},delete:function(e,r,t){return n.removeAll(),c.delete({centerId:e||0,userId:r,creditCardId:t.id}).$promise},resolve:function(e){var t=r("toDate")(e.expiry),n=t.month()+1;return e.expiryMonth=i.findByKeyValue(s,"id",r("zpad")(n,2)),e.expiryYear=i.findByKeyValue(o,"id",t.year()),e.expiryYear=i.findByKeyValue(o,"id",t.year()),e.ccv="***",e.state=l[e.country]?i.findByKeyValue(l[e.country],"id",e.state):e.state,e.country=i.findByKeyValue(a,"id",e.country),e},unresolve:function(e){return{type:e.type.id,number:e.number,verification:e.ccv,city:e.city,company:e.company,country:e.country.id,expiry:e.expiryYear.id+"-"+e.expiryMonth.id+"-01",firstName:e.firstName,lastName:e.lastName,state:e.state.id||e.state,street:e.street,zip:e.zip,defaultPaymentMethod:!0}}}}]),angular.module("deskworks.userProfile.service.document",["ngResource","ngFileUpload","deskworks.helper","deskworks.userProfile.cache"]).factory("upDocumentService",["$resource","Upload","deskworksConfig","userProfileCache","helper",function(e,r,t,n,i){"use strict";var s=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/documents/:documentId"),{},{update:{method:"PUT"}});return{new:function(e){return{id:i.uid(),file:e,name:e.name}},isNew:function(e){return e&&i.isUid(e.id)},save:function(e,o,a){return n.removeAll(),i.isUid(a.id)?r.upload({url:t.getApiAbsUrl("/centers/"+(e||0)+"/user-profiles/"+o+"/documents"),method:"POST",withCredentials:!0,data:{document:a.file,name:a.name}}).then(function(e){return a.id=e.data.id,a.document=e.data.document,delete a.file,e.data}):s.update({centerId:e||0,userId:o,documentId:a.id},this.unresolve(a)).$promise},delete:function(e,r,t){return n.removeAll(),s.delete({centerId:e||0,userId:r,documentId:t.id}).$promise},resolve:function(e){return e},unresolve:function(e){return{name:e.name}}}}]),angular.module("deskworks.userProfile.service.eCheck",["ngResource","deskworks.helper","deskworks.userProfile.cache","deskworks.userProfile.optsBankAccountHolderType","deskworks.userProfile.optsBankAccountType"]).factory("upECheckService",["$resource","$filter","deskworksConfig","userProfileCache","helper","optsBankAccountHolderType","optsBankAccountType",function(e,r,t,n,i,s,o){"use strict";var a=e(t.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/e-checks/:eCheckId"),{},{update:{method:"PUT"}});return{new:function(){return{id:i.uid(),bankAccountHolderType:s[0],bankAccountType:o[0]}},isNew:function(e){return e&&i.isUid(e.id)},save:function(e,r,t){return n.removeAll(),i.isUid(t.id)?a.save({centerId:e||0,userId:r},this.unresolve(t)).$promise.then(function(e){return t.id=e.id,e}):a.update({centerId:e||0,userId:r,eCheckId:t.id},{defaultPaymentMethod:!0}).$promise},delete:function(e,r,t){return n.removeAll(),a.delete({centerId:e||0,userId:r,eCheckId:t.id}).$promise},resolve:function(e){return e.bankAccountHolderType=i.findByKeyValue(s,"id",e.bankAccountHolderType),e.bankAccountType=i.findByKeyValue(o,"id",e.bankAccountType),e},unresolve:function(e){return{bankAccountHolderType:e.bankAccountHolderType.id,bankAccountType:e.bankAccountType.id,bankName:e.bankName,bankRoutingNumber:e.bankRoutingNumber,bankAccountNumber:e.bankAccountNumber,fullName:e.fullName,defaultPaymentMethod:!0}}}}]),angular.module("deskworks.userProfile.service.mailbox",["ngResource","deskworks.helper","deskworks.userProfile.cache","deskworks.userProfile.optsMailboxHandling"]).factory("upMailboxService",["$resource","deskworksConfig","userProfileCache","helper","optsMailboxHandling",function(e,r,t,n,i){"use strict";var s=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/mailboxes/:mailboxId"),{},{update:{method:"PUT"}});return{new:function(){return{id:n.uid(),handling:i[0]}},isNew:function(e){return e&&n.isUid(e.id)},save:function(e,r,i){return t.removeAll(),n.isUid(i.id)?s.save({centerId:e||0,userId:r},this.unresolve(i)).$promise.then(function(e){return i.id=e.id,e}):s.update({centerId:e||0,userId:r,mailboxId:i.id},this.unresolve(i)).$promise},delete:function(e,r,n){return t.removeAll(),s.delete({centerId:e||0,userId:r,mailboxId:n.id}).$promise},resolve:function(e){return e.handling=n.findByKeyValue(i,"id",e.handling),e},unresolve:function(e){return{number:e.number,key:e.key,names:e.names,handling:e.handling?e.handling.id:e.handling}}}}]),angular.module("deskworks.userProfile.service.phone",["ngResource","deskworks.helper","deskworks.userProfile.cache","deskworks.userProfile.optsPhoneType"]).factory("upPhoneService",["$resource","deskworksConfig","userProfileCache","helper","optsPhoneType",function(e,r,t,n,i){"use strict";var s=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/phones/:phoneId"),{},{update:{method:"PUT"}});return{new:function(){return{id:n.uid(),type:i[2]}},isNew:function(e){return e&&n.isUid(e.id)},save:function(e,r,i){return t.removeAll(),n.isUid(i.id)?s.save({centerId:e||0,userId:r},this.unresolve(i)).$promise.then(function(e){return i.id=e.id,e}):s.update({centerId:e||0,userId:r,phoneId:i.id},this.unresolve(i)).$promise},delete:function(e,r,n){return t.removeAll(),s.delete({centerId:e||0,userId:r,phoneId:n.id}).$promise},resolve:function(e){return e.type=n.findByKeyValue(i,"id",e.typeId),e},unresolve:function(e){return{typeId:e.type&&e.type.id?e.type.id:e.type,number:e.number,ext:e.ext}}}}]),angular.module("deskworks.userProfile.service.photo",["ngResource","ngFileUpload","deskworks.config","deskworks.helper","deskworks.userProfile.cache"]).factory("upPhotoService",["$resource","$q","deskworksConfig","userProfileCache","helper","Upload",function(e,r,t,n,i,s){"use strict";return{isNew:function(e){return e&&e.photoFile},save:function(e,i,o){return this.isNew(i)?(n.removeAll(),s.upload({url:t.getApiAbsUrl("/centers/"+(e||0)+"/"+(i&&i.membershipStatus&&("active"===i.membershipStatus.id||"inactive"===i.membershipStatus.id)?"members":"non-members")+"/"+i.id),method:"PUT",withCredentials:!0,data:{photo:i.photoFile}}).then(function(e){return i.photo=e.data.photo,delete i.photoFile,e.data})):r.when()}}}]),angular.module("deskworks.userProfile.service.printerCode",["ngResource","deskworks.helper","deskworks.userProfile.cache"]).factory("upPrinterCodeService",["$resource","deskworksConfig","userProfileCache","helper",function(e,r,t,n){"use strict";var i=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/printer-codes/:printerCodeId"),{},{update:{method:"PUT"}});return{new:function(){return{id:n.uid()}},isNew:function(e){return e&&n.isUid(e.id)},save:function(e,r,s){return t.removeAll(),n.isUid(s.id)?i.save({centerId:e||0,userId:r},this.unresolve(s)).$promise.then(function(e){return s.id=e.id,e}):i.update({centerId:e||0,userId:r,printerCodeId:s.id},this.unresolve(s)).$promise},delete:function(e,r,n){return t.removeAll(),i.delete({centerId:e||0,userId:r,printerCodeId:n.id}).$promise},resolve:function(e){return e},unresolve:function(e){return{code:e.code}}}}]),angular.module("deskworks.UserProfileFields",["ngResource","deskworks.helper"]).factory("UserProfileFields",["$resource","$q","$filter","deskworksConfig","helper",function(e,r,t,n,i){"use strict";var s=e(n.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/fields"),{},{query:{method:"GET",isArray:!0,transformResponse:[angular.fromJson,function(e){return angular.forEach(e,function(e){"date"===e.type&&(e.value=t("toDate")(e.value))}),e}]},update:{method:"PUT",transformRequest:[function(e){return angular.forEach(e,function(e){"date"===e.type&&(e.value=t("date")(e.value,"yyyy-MM-dd"))}),e},angular.toJson]}});return{query:function(e,r){return s.query({centerId:e,userId:r}).$promise},save:function(e,r,t){return s.update({centerId:e,userId:r},t).$promise}}}]),angular.module("deskworks.userProfile.service",["ngResource","ngFileUpload","deskworks.config","deskworks.userProfile.cache","deskworks.helper","deskworks.system.service","deskworks.userProfile.service.photo","deskworks.userProfile.service.address","deskworks.userProfile.service.phone","deskworks.userProfile.service.printerCode","deskworks.userProfile.service.document","deskworks.userProfile.service.coMember","deskworks.userProfile.service.mailbox","deskworks.userProfile.service.creditCard","deskworks.userProfile.service.eCheck","deskworks.UserProfileFields","deskworks.userProfile.optsMembershipStatus","deskworks.userProfile.optsBillingMethod","deskworks.userProfile.optsCCExpiryMonth","deskworks.userProfile.optsCCExpiryYear"]).factory("userProfileService",["$resource","$q","$timeout","$filter","dwAlerts","Upload","deskworksConfig","userProfileCache","helper","upPhotoService","upAddressService","upPhoneService","upPrinterCodeService","upDocumentService","upCoMemberService","upMailboxService","upCreditCardService","systemService","upECheckService","optsMembershipStatus","optsBillingMethod","optsCCExpiryMonth","optsCCExpiryYear","UserProfileFields",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m,h,g,v,C,k,w,y,I,b){"use strict";var S=e(o.getApiAbsUrl("/centers/:centerId/user-profiles/:userId"),{},{get:{method:"GET",cache:a},query:{method:"GET",isArray:!1}}),$=e(o.getApiAbsUrl("/centers/:centerId/members/:userId"),{},{get:{method:"GET",cache:a},update:{method:"PUT"}}),E=e(o.getApiAbsUrl("/centers/:centerId/non-members/:userId"),{},{get:{method:"GET",cache:a},update:{method:"PUT"}}),P=e(o.getApiAbsUrl("/restore-password"),{},{update:{method:"PUT"}});function A(e){return e&&e.membershipStatus&&("active"===e.membershipStatus.id||"inactive"===e.membershipStatus.id)?$:E}return{phone:d,address:u,printerCode:f,document:p,photo:c,creditCard:g,eCheck:C,coMember:m,mailbox:h,resetCache:function(){a.removeAll()},new:function(e,r,t){var n=this;return("member"===r?$:E).get({centerId:e.id||0,userId:"new",scenario:t}).$promise.then(function(i){return i.id=l.uid(),i.isNew=function(){return n.isNew(this)},n.resolve(i),i.addresses="nonMember"===r&&"register"===t?[]:[u.new(e.countryId,e.state)],i.phones=[d.new()],i.printerCodes=[],i.documents=[],i.coMembers=[],i.mailboxes=[],i.accessCards=[],"member"===r&&"register"===t&&(i.membershipStatus=l.findByKeyValue(k,"id","active"),i.membershipBillingMethod=l.findByKeyValue(w,"id","credit_card"),i.membershipStartDate=moment()),i})},isNew:function(e){return e&&l.isUid(e.id)},save:function(e,r,t){return a.removeAll(),l.isUid(r.id)||!r.id?A(r).save({centerId:e||0,registration:t},this.unresolve(r)).$promise.then(function(e){return r.id=e.id,e}):A(r).update({centerId:e||0,userId:r.id},this.unresolve(r)).$promise},updateRaw:function(e,r,t){return a.removeAll(),A(r).update({centerId:e||0,userId:r.id},t).$promise},get:function(e,r){var t=this;return S.get({centerId:e||0,userId:r}).$promise.then(function(e){var r=t.resolve(e);return r.schema&&(r.schema.shareable=!0),r})},getForRegistration:function(e,r,t,n){var i=this;return("member"===t?$:E).get({centerId:e||0,userId:r,scenario:n}).$promise.then(function(e){return i.resolve(e)})},search:function(e,r){return r.joinDate=n("date")(r.joinDate,"yyyy-MM-dd"),(r=angular.extend({pageSize:100,sort:"lastName",order:1},r)).centerId=e||0,S.query(r).$promise.then(function(e){return e.users.forEach(function(e){e.fullName=e.fullName||[e.firstName,e.lastName].join(" "),e.login=l.stripUid(e.login),e.email=l.stripUid(e.email),e.joinDate=n("toDate")(e.joinDate)}),e})},query:function(e,r){return r=angular.extend({pageSize:0},r),this.search(e,r).then(function(e){return e.users})},quickSearch:function(e,r){var t={centerId:e||0,quickSearch:r,pageSize:50,activeMembers:!0,nonMembers:!0};return this.search(e,t).then(function(e){return e.users})},restorePassword:function(e){return a.removeAll(),P.save({},e).$promise},delete:function(e,r){return S.delete({centerId:e||0,userId:r}).$promise},resolve:function(e){var r=this;return e.login=l.stripUid(e.login),e.email=l.stripUid(e.email),e.joinDate=n("toDate")(e.joinDate),e.membershipStatus=l.findByKeyValue(k,"id",e.membershipStatus),e.membershipPriceList=l.findByKeyValue((e.options||{}).membershipPriceLists,"id",e.membershipPriceListId),e.membershipBillingMethod=l.findByKeyValue(w,"id",e.membershipBillingType),e.leadSource=l.findByKeyValue((e.options||{}).leadSources,"id",e.leadSourceId),(e.addresses||[]).forEach(function(r){u.resolve(r),r.type&&4===r.type.id&&!e.billingAddress&&(e.billingAddress=r)}),!e.billingAddress&&e.addresses&&e.addresses.length>0&&(e.billingAddress=e.addresses[0]),(e.phones||[]).forEach(function(e){d.resolve(e)}),(e.coMembers||[]).forEach(function(e){r.coMember.resolve(e)}),(e.mailboxes||[]).forEach(function(e){r.mailbox.resolve(e)}),(e.creditCards||[]).forEach(function(e){r.creditCard.resolve(e)}),(e.eChecks||[]).forEach(function(e){r.eCheck.resolve(e)}),e.isNew=function(){return r.isNew(this)},e},unresolve:function(e){return{login:e.login,password:e.password,passwordConfirmation:e.passwordConfirmation,email:e.email,firstName:e.firstName,lastName:e.lastName,middleName:e.middleName,occupation:e.occupation,company:e.company,leadSourceId:(e.leadSource||{}).id,comments:e.comments,membershipBillingType:(e.membershipBillingMethod||{}).id,membershipPriceListId:(e.membershipPriceList||{}).id,membershipStatus:(e.membershipStatus||{}).id,membershipStartDate:n("date")(e.membershipStartDate,"yyyy-MM-dd")}},bindTestUserGenerator:function(e,r,t){function n(n){if(n.altKey&&84===n.keyCode){var i="test"+moment().unix();r.firstName=i,r.lastName=i,r.email=i+"@z5ut48g83bf04bvg93f.com",(!t||t.member||t.selfRegistration)&&(r.login=i,r.password="Zx123456",r.passwordConfirmation="Zx123456"),r.addresses[0].street="test123",r.addresses[0].city="test123",r.addresses[0].zip="test123",r.phones[0].number="1234567890",t&&t.member&&!t.selfRegistration&&(r.membershipType=r.options.membershipTypes[0],r.membershipProduct=r.options.membershipTypes[0].membershipPackages[0],r.membershipPriceList=r.options.membershipPriceLists[0]),r.leadSource=r.options.leadSources[0],r.termsOfService=!0,e.$apply()}}document.addEventListener("keydown",n),e.$on("$destroy",function(){document.removeEventListener("keydown",n)})},bindTestBillingGenerator:function(e,r,t){var n=this;function i(t){t.altKey&&84===t.keyCode&&(r.creditCards.forEach(function(e){n.creditCard.isNew(e)&&(e.number="4111111111111111",e.ccv="123",e.expiryMonth=y[5],e.expiryYear=I[5])}),e.$apply())}document.addEventListener("keydown",i),e.$on("$destroy",function(){document.removeEventListener("keydown",i)})},registerNewUser:function(e,t,n,s){var o=this;return o.save(e,t,n).catch(function(e){return i.error(e,"Failed to create user profile.")}).then(function(){var n=[];return n.push(o.photo.save(e,t).catch(function(e){return i.error(e,"Failed to upload photo.")})),t.addresses.forEach(function(r){n.push(o.address.save(e,t.id,r).catch(function(e){return i.error(e,"Failed to create address.")}))}),t.phones.forEach(function(r){n.push(o.phone.save(e,t.id,r).catch(function(e){return i.error(e,"Failed to create phone.")}))}),t.printerCodes.forEach(function(r){n.push(o.printerCode.save(e,t.id,r).catch(function(e){return i.error(e,"Failed to create printer code.")}))}),t.documents.forEach(function(r){n.push(o.document.save(e,t.id,r).catch(function(e){return i.error(e,"Failed to create document.")}))}),t.accessCards.forEach(function(r){r.userId=t.id,n.push(v.createAccessCard(e,r).catch(function(e){return i.error(e,"Failed to create access card.")}))}),s&&n.push(b.save(e,t.id,s).catch(function(e){return i.error(e,"Failed to save custom fields.")})),r.all(n)})},saveBillingProfile:function(e,n){var s=this,o=[];return n.creditCards.forEach(function(r){s.creditCard.isNew(r)&&o.push(s.creditCard.save(e,n.id,r).then(function(e){return t(function(){var r=document.querySelector("#upCreditCard-"+e.id);r&&(angular.element(r).scope().$broadcast("ffBlock::EditEnd"),angular.forEach(n.creditCards,function(r){r.defaultPaymentMethod=r.id===e.id}),angular.forEach(n.eChecks,function(e){e.defaultPaymentMethod=!1}))})}).catch(function(e){return i.error(e,"Failed to create credit card.")}))}),angular.forEach(n.eChecks,function(r){s.eCheck.isNew(r)&&o.push(s.eCheck.save(e,n.id,r).then(function(e){return t(function(){var r=document.querySelector("#upECheck-"+e.id);r&&(angular.element(r).scope().$broadcast("ffBlock::EditEnd"),angular.forEach(n.creditCards,function(e){e.defaultPaymentMethod=!1}),angular.forEach(n.eChecks,function(r){r.defaultPaymentMethod=r.id===e.id}))})}).catch(function(e){return i.error(e,"Failed to create eCheck.")}))}),r.all(o)}}}]),angular.module("deskworks.userRoles",[]).factory("userRoles",["$rootScope","$translate",function(e,r){"use strict";var t={nonMember:{_name:"GLOBAL.ROLE.NON_MEMBER",color:"default",type:"user"},member:{_name:"GLOBAL.ROLE.MEMBER",color:"primary",type:"user"},accountant:{_name:"GLOBAL.ROLE.ACCOUNTANT",color:"warning",type:"admin"},coordinator:{_name:"GLOBAL.ROLE.COORDINATOR",color:"warning",type:"admin"},admin:{_name:"GLOBAL.ROLE.ADMIN",color:"warning",type:"admin"},management:{_name:"GLOBAL.ROLE.MANAGEMENT",color:"warning",type:"admin"},master:{_name:"GLOBAL.ROLE.MASTER",color:"warning",type:"admin"}};function n(){Object.keys(t).forEach(function(e){t[e].name=r.instant(t[e]._name)})}return n(),e.$on("$setTranslationsSuccess",n),t}]),angular.module("deskworks.SimpleReservationCentersCtrl",[]).controller("SimpleReservationCentersCtrl",["$scope","$translate","centers","state",function(e,r,t,n){"use strict";n.setPageTitle(r.instant("SIMPLE_RES.CENTERS.PAGE_TITLE")),1===t.length&&(n.replace(),n.setParam("skip-steps",1),n.setPath(n.getPath()+"/centers/"+t[0].id+"/types")),this.centers=t,this.selectCenter=function(e,r){e.preventDefault(),e.stopPropagation(),r.selectSpin=!0,n.setPath("/simple-reservation/centers/"+r.id+"/types")}}]),angular.module("deskworks.SimpleReservationCategoriesCtrl",[]).controller("SimpleReservationCategoriesCtrl",["$scope","$translate","state","center","reservationCategories",function(e,r,t,n,i){"use strict";t.setPageTitle(r.instant("SIMPLE_RES.CATEGORIES.PAGE_TITLE")),this.center=n,this.resTypes=i.filter(function(e){var r=e.reservationUnits.filter(function(e){return"staffOnly"===e.whoCanReserve}).length,n=e.reservationUnits.filter(function(e){return"notAvailable"!==e.whoCanReserve&&("staffOnly"!==e.whoCanReserve||t.isLoggedAdmin())&&("member"!==e.whoCanReserve||t.isLoggedMember()||t.isLoggedAdmin())&&("nonMember"!==e.whoCanReserve||t.isLoggedNonMember()||t.isLoggedAdmin()||!t.getLoggedUserId())}).length;return e.staffOnly=!!r&&!n,!!n||!!r}),this.selectResType=function(e,r){e.preventDefault(),e.stopPropagation(),r.$spin=!0,t.setPath(t.getPath()+"/"+r.id)},this.back=t.back}]),angular.module("deskworks.SimpleReservationCategoryCtrl",["ngSanitize","ui.bootstrap.tabs","swiper"]).controller("SimpleReservationCategoryCtrl",["$scope","$route","$sce","$translate","reservationCategory","state",function(e,r,t,n,i,s){"use strict";this.centerId=r.current.params.centerId,this.reservationType=i,s.setPageTitle(n.instant("SIMPLE_RES.CATEGORY.PAGE_TITLE")),this.reservationType.description=t.trustAsHtml(this.reservationType.description),this.reservationType.photos&&(this.reservationType.photoUrls=this.reservationType.photos.map(function(e){return e.url})),this.reserveIt=function(e,r){return s.setPath(s.getPath()+"/dates")},this.back=s.back}]),angular.module("deskworks.SimpleReservationDateCtrl",[]).controller("SimpleReservationDateCtrl",["$scope","$route","$filter","$translate","unavailableDates","state",function(e,r,t,n,i,s){"use strict";var o=this;s.setPageTitle(n.instant("SIMPLE_RES.DATE.PAGE_TITLE")),o.centerId=r.current.params.centerId,o.reservationTypeId=r.current.params.reservationTypeId,o.unavailableDates=i,o.dateMin=moment().startOf("day"),o.checkDateDisabled=function(e){return o.unavailableDates.indexOf(t("date")(e,"yyyy-MM-dd"))>=0},o.next=function(){if(angular.isDefined(o.selectedDate))return s.setPath(s.getPath()+"/"+t("date")(o.selectedDate,"yyyy-MM-dd")+"/units")},o.back=s.back}]),angular.module("deskworks.SimpleReservationUnitsCtrl",["deskworks.resClock"]).controller("SimpleReservationUnitsCtrl",["$scope","$route","$translate","$locale","state","resUnits","center",function(e,r,t,n,i,s,o){"use strict";var a=this;i.setPageTitle(t.instant("SIMPLE_RES.UNITS.PAGE_TITLE")),a.am=!0,a.center=o,a.resTypeId=r.current.params.reservationTypeId,a.date=r.current.params.date,a.AMPMS=n.DATETIME_FORMATS.AMPMS,a.resUnits=s.filter(function(e){return e.availabilities.length||"staffOnly"===e.whoCanReserve}),e.$on("LOGOUT",r.reload),e.$on("LOGIN",r.reload),a.selectResUnit=function(e,r){return e&&(e.preventDefault(),e.stopPropagation()),r.$spin=!0,i.setPath(i.getPath()+"/"+r.id)},1===a.resUnits.length&&"staffOnly"!==a.resUnits[0].whoCanReserve&&(i.replace(),i.setParam("skip-steps",+(i.getParam("skip-steps")||0)+1),a.selectResUnit(null,a.resUnits[0])),a.back=i.back}]),angular.module("deskworks.SimpleReservationTimeCtrl",["deskworks.simpleSelectTime"]).controller("SimpleReservationTimeCtrl",["$scope","$translate","state",function(e,r,t){"use strict";t.setPageTitle(r.instant("SIMPLE_RES.TIME.PAGE_TITLE"))}]),angular.module("deskworks.simpleSelectTime",["deskworks.resReservation"]).component("simpleSelectTime",{templateUrl:"simple-reservation/06-time/simple-select-time.tpl.html",controller:"ResReservationController",bindings:{center:"<",calData:"<",date:"<"}}),angular.module("deskworks.SimpleReservationUserProfileCtrl",["ngRoute","deskworks.userProfile.service","deskworks.center.service","deskworks.routeHelper","deskworks.helper"]).controller("SimpleReservationUserProfileCtrl",["$scope","$filter","$timeout","$q","$route","$translate","dwAlerts","helper","state","userProfile","reg","userProfileService","centerService","setupService","purchaseService",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m){"use strict";var h=this;h.reg=u,h.userProfile=c,h.schema=c.schema,l.setPageTitle(s.instant(h.reg.new?"USER_PROFILE.NEW_USER.PAGE_TITLE":"USER_PROFILE.PAGE_TITLE",{userName:h.userProfile.firstName+" "+h.userProfile.lastName})),p.getSetupSettings().catch(function(e){return o.error(e,"Failed to get settings.")}).then(function(e){h.settings=e}),d.bindTestUserGenerator(e,h.userProfile,h.reg),h.next=function(){if(!a.pointFirstInvalid("#userProfile"))return(h.reg.new?d.registerNewUser(0,h.userProfile):n.when()).then(function(){if(h.reg.new)return l.login(h.userProfile.login,h.userProfile.password).catch(function(e){return o.error(e,"Failed to login under created user.")})}).then(function(){var e=r("toDate")(l.getParam("start")),t=(r("toDate")(l.getParam("end"))-e)/36e5;return m.createPurchaseForReservation(i.current.params.centerId,h.userProfile.id,i.current.params.reservationUnitId,t,l.getParam("start"),l.getParam("end")).catch(function(e){return o.error(e,"Failed to create purchase for reservation.")}).finally(function(){h.reg.new&&(l.replace(),i.updateParams({userId:h.userProfile.id}))})}).then(function(e){return t(function(){return e.purchasePackageId&&l.setParam("purchasePackageId",e.purchasePackageId),l.setPath(l.getPath()+"/purchases/"+e.id)})})}}]),angular.module("deskworks.SimpleReservationPurchaseCtrl",["ngRoute","deskworks.helper","deskworks.purchase.service","deskworks.reservationUnit.service","deskworks.reservationUnit.optsRepeatFrequency"]).controller("SimpleReservationPurchaseCtrl",["$scope","$filter","$timeout","$q","$route","$translate","dwAlerts","helper","state","reg","center","purchase","reservationUnit","purchaseService","optsRepeatFrequency",function(e,r,t,n,i,s,o,a,l,c,u,d,f,p,m){"use strict";var h=this;l.setPageTitle(s.instant("SIMPLE_RES.PURCHASE.PAGE_TITLE",{centerName:u.name})),h.reg=c,h.center=u,h.purchase=d,h.reservationUnit=f,h.date=r("toDate")(i.current.params.date),h.timeStart=r("toDate")(l.getParam("start")),h.timeEnd=r("toDate")(l.getParam("end")),h.reservationNote=l.getParam("note")||"",h.emailConfirmation="true"===l.getParam("confirm"),h.repeatFrequency=m[0],l.getParam("freq")&&(h.repeatFrequency=a.findByKeyValue(m,"id",l.getParam("freq")),h.repeatFrequency&&h.repeatFrequency.repeatDurationOptions&&l.getParam("duration")-1<h.repeatFrequency.repeatDurationOptions.length&&(h.repeatDuration=+l.getParam("duration"))),h.next=function(){return l.setPath(l.getPath()+"/billing")},h.back=function(){return l.setPath(l.getPath().replace(/\/purchases\/\d+$/,""))},h.staffHelp=function(){return p.createStaffHelp(h.center.id,i.current.params.userId,i.current.params.purchaseId).catch(function(e){return o.error(e,"Failed to create staff help.")}).then(function(e){return l.setParam("notice",e.notice),l.setPath(l.getPath()+"/staff-help")})}}]),angular.module("deskworks.SimpleReservationBillingCtrl",["ngRoute","deskworks.userProfile.service","deskworks.purchase.service","deskworks.reservationService","deskworks.routeHelper","deskworks.helper"]).controller("SimpleReservationBillingCtrl",["$scope","$filter","$route","$translate","dwAlerts","helper","state","userProfile","reg","settings","userProfileService","purchaseService","reservationService",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;if(p.userProfile=a,p.reg=l,p.settings=c,o.setPageTitle(n.instant("BILLING_PROFILE.PAGE_TITLE",{userName:p.userProfile.firstName+" "+p.userProfile.lastName})),c.creditCardTypes=c.creditCardTypes.filter(function(e){return e.enable}),p.userProfile.creditCards.forEach(function(e){e.type=s.findByKeyValue(c.creditCardTypes,"id",e.type)||e.type||{}}),p.userProfile.creditCards=p.userProfile.creditCards||[],!p.userProfile.creditCards.length){var m=u.creditCard.new(p.userProfile);m.type=c.creditCardTypes[0],p.userProfile.creditCards.push(m)}u.bindTestBillingGenerator(e,p.userProfile,p.reg),p.next=function(){if(!s.pointFirstInvalid("#simpleReservationBilling")){var a=o.prohibitBack(["SimpleReservationPurchaseCtrl"],n("SIMPLE_RES.BILLING.BACK_ERROR"),e);return u.saveBillingProfile(t.current.params.centerId,p.userProfile).then(function(){var e={from:r("toDate")(o.getParam("start")),to:r("toDate")(o.getParam("end")),reservationNote:o.getParam("note"),centerId:+t.current.params.centerId,reservationUnitId:t.current.params.reservationUnitId,emailConfirmation:o.getParam("confirm"),repeatFrequency:o.getParam("freq"),repeatDuration:o.getParam("duration")};return o.getParam("purchasePackageId")&&(e.purchasePackageId=+o.getParam("purchasePackageId")),f.save(t.current.params.centerId,t.current.params.userId,e).catch(function(e){return i.error(e,"Failed to make reservation.")}).then(function(e){var r={centerId:t.current.params.centerId,userId:t.current.params.userId,purchaseId:t.current.params.purchaseId,reservationId:e.id};return d.createPayment(r,{}).then(function(r){return o.setParam("accessCode",e.accessCode),o.setPath(o.getPath()+"/complete")}).catch(function(r){return f.delete(t.current.params.centerId,t.current.params.userId,e.id),i.error(r,"Failed to make payment.")})})}).catch(a)}},p.staffHelp=function(){return d.createStaffHelp(t.current.params.centerId,t.current.params.userId,t.current.params.purchaseId).catch(function(e){return i.error(e,"Failed to create staff help.")}).then(function(e){return o.setParam("notice",e.notice),o.setPath(o.getPath().replace(/\/billing$/,"/staff-help"))})},p.back=function(){return o.setPath(o.getPath().replace(/\/billing$/,""))}}]),angular.module("deskworks.members.userProfile.sections.accessCards",[]).directive("userProfileAccessCards",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-access-cards.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upAccessCardsCtrl as $ctrl",bindToController:{user:"<userProfile",save:"="},link:function(n,i,s,o,a){a(function(){i.after(e(r.get(t))(n))})}}}]).controller("upAccessCardsCtrl",["$scope","$q","$filter","$timeout","state","helper","systemService",function(e,r,t,n,i,s,o){"use strict";var a=this;function l(){var e=[];return angular.forEach(a.user.accessCards,function(r){var t=s.findByKeyValue(a.rollback,"id",r.id);if(!t||t.number!==r.number){var n={number:r.number,userId:a.user.userId||a.user.id};r.id&&"new"!==r.id?e.push(o.updateAccessCard(i.getCurrentCenterId(),r.id,n)):e.push(o.createAccessCard(i.getCurrentCenterId(),n).then(function(e){r.id=e.id}))}}),angular.forEach(a.rollback,function(r){s.findByKeyValue(a.user.accessCards,"id",r.id)||e.push(o.removeAccessCard(i.getCurrentCenterId(),r.id))}),r.all(e)}a.$onInit=function(){a.save=l,e.$watch("ffBlock.editMode",function(e){e&&(a.rollback=angular.copy(a.user.accessCards))}),e.$on("ffControl::EditCancel",function(){e.ffBlock.editMode&&(a.user.accessCards=a.rollback||a.user.accessCards,a.rollback=null)})},a.add=function(){e.ffBlock.editMode||e.$emit("ffBlock::EditStart"),o.getAccessCard(i.getCurrentCenterId(),"new").then(function(e){n(function(){a.user.accessCards.push(e)})})},a.delete=function(r){var t=a.user.accessCards.indexOf(r);t>=0&&(a.user.accessCards.splice(t,1),e.ffBlockForm.$setDirty())}}]),angular.module("deskworks.members.userProfile.sections.addresses",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfileAddresses",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-addresses.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upAddressesCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<",center:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upAddressesCtrl",["$scope","$q","$window","$translate","dwAlerts","state","helper","userProfileService","optsAddressType","optsCountry","optsState",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;d.types=l,d.countries=c,d.states=u,d.new=a.address.new,d.isNew=a.address.isNew,d.countExisting=function(){return d.user.addresses.reduce(function(e,r){return o.isUid(r.id)?e:e+1},0)},d.save=function(e){return a.address.save(s.getCurrentCenterId(),d.user.id,e).catch(function(e){return i.error(e,"Failed to save address.")})},d.delete=function(e){return a.address.isNew(e)?r.when():t.confirm(n.instant("USER_PROFILE.ADDRESSES.CONFIRM_DELETE"))?a.address.delete(s.getCurrentCenterId(),d.user.id,e).catch(function(e){return i.error(e,"Failed to delete address.")}):r.reject()}}]),angular.module("deskworks.members.userProfile.sections.coMembers",["dwModal","deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfileCoMembers",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-co-members.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upCoMembersCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upCoMembersCtrl",["$scope","$q","dwAlerts","dwModal","helper","state","userProfileService",function(e,r,t,n,i,s,o){"use strict";var a=this;a.exUserCollapsed=!0,a.new=o.coMember.new,a.isNew=o.coMember.isNew,a.makeCoMemberInactive=!0,a.save=function(e){return o.coMember.save(s.getCurrentCenterId(),a.user.id,e).then(function(){return e.saveAccessCards?e.saveAccessCards().catch(function(e){return t.error(e,"Failed to save access cards.")}):null},function(e){return t.error(e,"Failed to save co-member.")})},a.delete=function(r){return n.show({scope:e,templateUrl:"DeleteCoMemberTpl",controller:["$scope","close",function(e,r){e.close=r}]}).then(function(e){return e.element[0].querySelector("button[type=submit]").focus(),e.close.then(function(e){if(!e)throw"modal cancel"})}).then(function(){return o.coMember.delete(s.getCurrentCenterId(),a.user.id,r,a.makeCoMemberInactive).catch(function(e){return t.error(e,"Failed to delete co-member.")})})},a.isNewExisting=function(e){return(e.userId||e.existingUserId)&&i.isUid(e.id)},a.newExisting=function(e){return o.get(s.getCurrentCenterId(),e.id).catch(function(e){return t.error(e,"Failed to get user profile.")}).then(function(e){a.user.coMembers.push(o.coMember.convertUserToCoMember(e)),delete a.quickUser})}}]),angular.module("deskworks.members.userProfile.sections.comments",["deskworks.userProfile.service"]).directive("userProfileComments",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-comments.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upCommentsCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upCommentsCtrl",["$scope","dwAlerts","state","userProfileService",function(e,r,t,n){"use strict";var i=this;i.save=function(){return n.updateRaw(t.getCurrentCenterId(),i.user,{comments:i.user.comments}).catch(function(e){return r.error(e,"Failed to save comments.")})}}]),angular.module("deskworks.members.userProfile.sections.creditCards",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfileCreditCards",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-credit-cards.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upCreditCardsCtrl as $ctrl",bindToController:{user:"<userProfile",reg:"<",settings:"<"},link:function(n,i,s,o,a){a(function(){i.after(e(r.get(t))(n))})}}}]).controller("upCreditCardsCtrl",["$scope","$element","$attrs","$q","$window","$translate","dwAlerts","helper","state","userProfileService",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;u.$onInit=function(){e.$on("up:ResetDefaultPaymentMethod",function(){u.user.creditCards.forEach(function(e){e.defaultPaymentMethod=!1})})},u.new=function(){var e=c.creditCard.new();return e.firstName=u.user.firstName,e.lastName=u.user.lastName,e.company=u.user.company,e.type=u.settings.creditCardTypes[0],u.user.billingAddress&&(e.street=u.user.billingAddress.street,e.city=u.user.billingAddress.city,e.country=u.user.billingAddress.country,e.state=u.user.billingAddress.state,e.zip=u.user.billingAddress.zip),e},u.isNew=c.creditCard.isNew,u.countExisting=function(){return u.user.creditCards.reduce(function(e,r){return a.isUid(r.id)?e:e+1},0)},u.save=function(r){return c.creditCard.save(l.getCurrentCenterId(),u.user.id,r).catch(function(e){return o.error(e,"Failed to save credit card.")}).then(function(t){return e.$parent.$parent.$broadcast("up:ResetDefaultPaymentMethod"),r.defaultPaymentMethod=!0,t})},u.delete=function(e){return c.creditCard.isNew(e)?n.when():i.confirm(s.instant("BILLING_PROFILE.CREDIT_CARDS.CONFIRM_DELETE"))?c.creditCard.delete(l.getCurrentCenterId(),u.user.id,e).catch(function(e){return o.error(e,"Failed to delete credit card.")}).then(function(r){if(e.defaultPaymentMethod)for(var t=0;t<u.user.creditCards.length;t++)if(u.user.creditCards[t]!==e&&!u.isNew(u.user.creditCards[t]))return u.makeDefault(u.user.creditCards[t]).then(function(){return r}).catch(function(){return r});return r}):n.reject()},u.makeDefault=function(r){return c.creditCard.save(l.getCurrentCenterId(),u.user.id,r).catch(function(e){return o.error(e,"Failed to set credit card as default payment method.")}).then(function(t){return e.$parent.$parent.$broadcast("up:ResetDefaultPaymentMethod"),r.defaultPaymentMethod=!0,t})}}]),angular.module("deskworks.members.userProfile.sections.customFields",["deskworks.UserProfileFields"]).directive("userProfileCustomFields",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-custom-fields.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upCustomFieldsCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<",fields:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upCustomFieldsCtrl",["$scope","dwAlerts","state","UserProfileFields",function(e,r,t,n){"use strict";var i=this;i.save=function(){return n.save(t.getCurrentCenterId(),i.user.id,i.fields).catch(function(e){return r.error(e,"Failed to save user profile fields.")})}}]),angular.module("deskworks.members.userProfile.sections.documents",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfileDocuments",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-documents.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upDocumentsCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){var a=e(r.get(t))(n);i.after(a)})}}}}]).controller("upDocumentsCtrl",["$scope","$element","$q","$translate","dwAlerts","helper","state","userProfileService",function(e,r,t,n,i,s,o,a){"use strict";var l=this;l.$onInit=function(){e.$on("ffBlock::EditStart",function(){l.docsRollback=angular.copy(l.user.documents)}),e.$on("ffBlock::EditCancel",function(){l.user.documents=l.docsRollback})},l.add=function(t,s){if(s&&s.length>0)return i.error(n.instant("USER_PROFILE.DOCUMENTS.INVALID_FORMAT"));t&&t.length>0&&(l.editMode||e.$broadcast("ffBlock::EditStart"),t.forEach(function(e){l.user.documents.push(a.document.new(e))}),angular.element(r[0].nextSibling.nextSibling.querySelector('form[name="ffBlockForm"]')).scope().ffBlockForm.$setDirty())},l.save=function(){var e=[];return l.user.documents.forEach(function(r){var t=s.findByKeyValue(l.docsRollback,"id",r.id);t&&t.name===r.name||e.push(a.document.save(o.getCurrentCenterId(),l.user.id,r).catch(function(e){return i.error(e,"Failed to save document.")}))}),l.docsRollback.forEach(function(r){s.findByKeyValue(l.user.documents,"id",r.id)||e.push(a.document.delete(o.getCurrentCenterId(),l.user.id,r).catch(function(e){return i.error(e,"Failed to delete document.")}))}),t.all(e)},l.delete=function(e){var t=s.findIndexByKeyValue(l.user.documents,"id",e.id);t>=0&&(l.user.documents.splice(t,1),angular.element(r[0].nextSibling.nextSibling.querySelector('form[name="ffBlockForm"]')).scope().ffBlockForm.$setDirty())}}]),angular.module("deskworks.members.userProfile.sections.eChecks",["deskworks.helper","deskworks.state","deskworks.userProfile.service","deskworks.dwECheck"]).directive("userProfileEChecks",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-e-checks.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upEChecksCtrl as $ctrl",bindToController:{user:"<userProfile",reg:"<"},link:function(n,i,s,o,a){a(function(){i.after(e(r.get(t))(n))})}}}]).controller("upEChecksCtrl",["$scope","$element","$attrs","$q","$window","$translate","dwAlerts","helper","state","userProfileService",function(e,r,t,n,i,s,o,a,l,c){"use strict";var u=this;u.$onInit=function(){e.$on("up:ResetDefaultPaymentMethod",function(){u.user.eChecks.forEach(function(e){e.defaultPaymentMethod=!1})})},u.new=function(){var e=c.eCheck.new();return e.fullName=u.user.firstName+" "+u.user.lastName,e},u.isNew=c.eCheck.isNew,u.countExisting=function(){return u.user.eChecks.reduce(function(e,r){return a.isUid(r.id)?e:e+1},0)},u.save=function(r){return c.eCheck.save(l.getCurrentCenterId(),u.user.id,r).catch(function(e){return o.error(e,"Failed to save eCheck.")}).then(function(t){return e.$parent.$parent.$broadcast("up:ResetDefaultPaymentMethod"),r.defaultPaymentMethod=!0,t})},u.delete=function(e){return c.eCheck.isNew(e)?n.when():i.confirm(s.instant("BILLING_PROFILE.E_CHECKS.CONFIRM_DELETE"))?c.eCheck.delete(l.getCurrentCenterId(),u.user.id,e).catch(function(e){return o.error(e,"Failed to delete eCheck.")}).then(function(r){if(e.defaultPaymentMethod){for(var t=0;t<u.user.eChecks.length;t++)if(u.user.eChecks[t]!==e&&!u.isNew(u.user.eChecks[t]))return u.makeDefault(u.user.eChecks[t]).catch(function(e){return o.error(e,"Failed to set default payment method.")}).then(function(){return r});for(t=0;t<u.user.creditCards.length;t++)if(!u.isNew(u.user.creditCards[t]))return c.creditCard.save(l.getCurrentCenterId(),u.user.id,u.user.creditCards[t]).catch(function(e){return o.error(e,"Failed to set default payment method.")}).then(function(e){return u.user.creditCards[t].defaultPaymentMethod=!0,e})}return r}):n.reject()},u.makeDefault=function(r){return c.eCheck.save(l.getCurrentCenterId(),u.user.id,r).catch(function(e){return o.error(e,"Failed to set eCheck as default payment method.")}).then(function(t){return e.$parent.$parent.$broadcast("up:ResetDefaultPaymentMethod"),r.defaultPaymentMethod=!0,t})}}]),angular.module("deskworks.members.userProfile.sections.leadSource",["deskworks.userProfile.service"]).directive("userProfileLeadSource",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-lead-source.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upLeadSourceCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upLeadSourceCtrl",["$scope","dwAlerts","state","userProfileService",function(e,r,t,n){"use strict";var i=this;i.save=function(){return n.updateRaw(t.getCurrentCenterId(),i.user,{leadSourceId:i.user.leadSource.id}).catch(function(e){return r.error(e,"Failed to save lead source.")})}}]),angular.module("deskworks.members.userProfile.sections.loginInfo",[]).directive("userProfileLoginInfo",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-login-info.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upLoginInfoCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<",memberDirectoryUrl:"<"},link:function(n,i,s,o,a){a(function(){i.after(e(r.get(t))(n))})}}}]).controller("upLoginInfoCtrl",["$scope","dwAlerts","state","userProfileService",function(e,r,t,n){"use strict";var i=this;i.save=function(){var e={login:i.user.login,password:i.user.password,passwordConfirmation:i.user.passwordConfirmation};return n.updateRaw(t.getCurrentCenterId(),i.user,e).catch(function(e){return r.error(e,"Failed to save login information.")}).then(function(){return i.saveAccessCards?i.saveAccessCards().catch(function(e){return r.error(e,"Failed to save access cards.")}):null})}}]),angular.module("deskworks.members.userProfile.sections.mailboxes",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfileMailboxes",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-mailboxes.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upMailboxesCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upMailboxesCtrl",["$scope","$window","$q","$translate","dwAlerts","helper","state","userProfileService","optsMailboxHandling",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;c.handlingOpts=l,c.new=a.mailbox.new,c.isNew=a.mailbox.isNew,c.save=function(e){return a.mailbox.save(o.getCurrentCenterId(),c.user.id,e).catch(function(e){return i.error(e,"Failed to save mailbox.")})},c.delete=function(e){return r.confirm(n.instant("USER_PROFILE.MAILBOXES.CONFIRM_DELETE"))?a.mailbox.delete(o.getCurrentCenterId(),c.user.id,e).catch(function(e){return i.error(e,"Failed to delete mailbox.")}):t.reject()}}]),angular.module("deskworks.members.userProfile.sections.membership",["deskworks.helper","deskworks.state","deskworks.userProfile.service","deskworks.reservationUnit.service"]).directive("userProfileMembership",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-membership.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upMembershipCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upMembershipCtrl",["$scope","$timeout","$window","$translate","$filter","dwAlerts","state","helper","userProfileService","reservationUnitService","optsMembershipStatus","optsBillingMethod",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f,p=this;p.$onInit=function(){p.billingMethods=d,p.membStatuses=u.filter(function(e){return!p.reg||!p.reg.member&&"nonMember"===e.id||p.reg.member&&("active"===e.id||"inactive"===e.id)}),p.schema.membership&&!1!==p.schema.membership.attachedReservationUnit&&c.getReservationUnits(o.getCurrentCenterId()).then(function(e){e.unshift({name:n.instant("USER_PROFILE.MEMBERSHIP.ATTACHED_RESERVATION_UNIT.NONE")}),p.user.attachedReservationUnit=a.findByKeyValue(e,"id",o.getParam("attachedReservationUnitId")),p.reservationUnits=e.filter(function(e){return!e.attachedUserId||e.id==(p.user.attachedReservationUnit&&p.user.attachedReservationUnit.id)})}).catch(function(e){return s.error(e,"Failed to query Reservation Units")}),e.$on("ffBlock::EditStart",function(){f=p.user.membershipStatus,delete p.user.makeRecurringBillingsInactive,delete p.user.makeCoMembersInactive}),e.$on("ffBlock::EditEnd",function(){delete p.user.makeRecurringBillingsInactive,delete p.user.makeCoMembersInactive})},p.save=function(){var e={};return"active"!==p.user.membershipStatus.id&&"inactive"!==p.user.membershipStatus.id||(e={membershipStatus:p.user.membershipStatus.id,membershipPriceListId:p.user.membershipPriceList.id,membershipBillingType:p.user.membershipBillingMethod.id,makeRecurringBillingsInactive:p.user.makeRecurringBillingsInactive,selfRegistrationStatus:null},p.user.coMembers&&p.user.coMembers.length&&(e.makeCoMembersInactive=p.user.makeCoMembersInactive)),p.schema.membership&&!1!==p.schema.membership.attachedReservationUnit&&(o.setParam("attachedReservationUnitId",p.user.attachedReservationUnit&&p.user.attachedReservationUnit.id),o.replace()),l.updateRaw(o.getCurrentCenterId(),p.user,e).then(function(){p.user.selfRegistrationStatus=null},function(e){return s.error(e,"Failed to save membership.")})},p.onChangeStatus=function(){!p.reg&&f&&("inactive"===p.user.membershipStatus.id&&"active"===f.id?(p.user.makeRecurringBillingsInactive=!0,p.user.makeCoMembersInactive=!0):(delete p.user.makeRecurringBillingsInactive,delete p.user.makeCoMembersInactive))},p.resetSelfRegistrationStatus=function(){return l.updateRaw(o.getCurrentCenterId(),p.user,{selfRegistrationStatus:null}).then(function(){r(function(){p.user.selfRegistrationStatus=null})}).catch(function(e){return s.error(e,"Failed to reset abandoned self-registration status.")})},p.deleteUser=function(){if(t.confirm(n.instant("USER_PROFILE.MEMBERSHIP.CONFIRM_DELETE_USER")))return l.delete(o.getCurrentCenterId(),p.user.id).catch(function(e){return s.error(e,"Failed to delete user.")}).then(function(){o.setCurrentUser(null)})}}]),angular.module("deskworks.members.userProfile.sections.personalInfo",["deskworks.userProfile.service"]).directive("userProfilePersonalInfo",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-personal-info.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upPersonalInfoCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upPersonalInfoCtrl",["$scope","dwAlerts","state","userProfileService",function(e,r,t,n){"use strict";var i=this;i.onChangeLastName=function(){if(i.reg&&!i.reg.member&&!i.reg.selfRegistration){var e=angular.element(document.getElementsByName("login")),r=e.scope();r&&r.field&&!e.hasClass("ng-dirty")&&(r.field.value=(i.user.lastName||"").toLowerCase().replace(/\W/g,"")+"-"+Date.now())}},i.save=function(){var s={firstName:i.user.firstName,middleName:i.user.middleName,lastName:i.user.lastName,email:i.user.email,company:i.user.company,occupation:i.user.occupation};return n.updateRaw(t.getCurrentCenterId(),i.user,s).then(function(){e.$emit("CurrentUser:refresh")}).catch(function(e){return r.error(e,"Failed to save personal information.")})}}]),angular.module("deskworks.members.userProfile.sections.phones",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfilePhones",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-phones.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upPhonesCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upPhonesCtrl",["$scope","$q","$window","$translate","dwAlerts","helper","state","userProfileService","optsPhoneType",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;c.types=l.map(function(e){return angular.extend(e,{name:n.instant(e.name)})}),c.new=a.phone.new,c.isNew=a.phone.isNew,c.countExisting=function(){return c.user.phones.reduce(function(e,r){return s.isUid(r.id)?e:e+1},0)},c.save=function(e){return a.phone.save(o.getCurrentCenterId(),c.user.id,e).catch(function(e){return i.error(e,"Failed to save phone.")})},c.delete=function(e){return a.phone.isNew(e)?r.when():t.confirm(n.instant("USER_PROFILE.PHONES.CONFIRM_DELETE"))?a.phone.delete(o.getCurrentCenterId(),c.user.id,e).catch(function(e){return i.error(e,"Failed to delete phone.")}):r.reject()}}]),angular.module("deskworks.members.userProfile.sections.photo",[]).directive("userProfilePhoto",["$compile","$templateCache","$timeout",function(e,r,t){"use strict";var n="members/user-profile/sections/user-profile-photo.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:n,controller:"upPhotoCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(t,i){return function(t,i,s,o,a){a(function(s,o){i.after(e(r.get(n))(t))})}}}}]).controller("upPhotoCtrl",["$scope","$timeout","$translate","dwAlerts","state","userProfileService",function(e,r,t,n,i,s){"use strict";var o=this;o.save=function(a,l){if(l&&l.length>0)return n.error(t.instant("GLOBAL.PHOTO.INVALID_FORMAT"));if(a&&a.length>0){if(!o.user.isNew())return o.spin=!0,o.user.photoFile=a[0],s.photo.save(i.getCurrentCenterId(),o.user).then(function(){o.spin=!1,e.$emit("CurrentUser:refresh")},function(e){return o.spin=!1,n.error(e,"Failed to upload photo.")});if(o.user.photoFile=a[0],window.FileReader&&a[0].type.indexOf("image")>-1){var c=new FileReader;c.readAsDataURL(a[0]),c.onload=function(e){r(function(){o.user.photo=e.target.result})}}}}}]),angular.module("deskworks.members.userProfile.sections.printerCodes",["deskworks.helper","deskworks.state","deskworks.userProfile.service"]).directive("userProfilePrinterCodes",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-printer-codes.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upPrinterCodesCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){var a=e(r.get(t))(n);i.after(a)})}}}}]).controller("upPrinterCodesCtrl",["$scope","$element","$q","dwAlerts","helper","state","userProfileService",function(e,r,t,n,i,s,o){"use strict";var a=this;a.$onInit=function(){e.$on("ffBlock::EditStart",function(){a.prCodesRollback=angular.copy(a.user.printerCodes)}),e.$on("ffBlock::EditCancel",function(){a.user.printerCodes=a.prCodesRollback})},a.add=function(){a.editMode||e.$broadcast("ffBlock::EditStart"),a.user.printerCodes.push(o.printerCode.new())},a.save=function(){var e=[];return a.user.printerCodes.forEach(function(r){var t=i.findByKeyValue(a.prCodesRollback,"id",r.id);t&&t.code===r.code||e.push(o.printerCode.save(s.getCurrentCenterId(),a.user.id,r).catch(function(e){return n.error(e,"Failed to save printer code.")}))}),a.prCodesRollback.forEach(function(r){i.findByKeyValue(a.user.printerCodes,"id",r.id)||e.push(o.printerCode.delete(s.getCurrentCenterId(),a.user.id,r).catch(function(e){return n.error(e,"Failed to delete printer code.")}))}),t.all(e)},a.delete=function(e){var t=i.findIndexByKeyValue(a.user.printerCodes,"id",e.id);t>=0&&(a.user.printerCodes.splice(t,1),angular.element(r[0].nextSibling.nextSibling.querySelector('form[name="ffBlockForm"]')).scope().ffBlockForm.$setDirty())}}]),angular.module("deskworks.members.userProfile.sections.shareable",["deskworks.userProfile.service","deskworks.UserProfileFields","deskworks.optsShareEmail"]).directive("userProfileShareable",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-shareable.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upShareableCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<",fields:"<"},link:function(n,i,s,o,a){a(function(){i.after(e(r.get(t))(n))})}}}]).controller("upShareableCtrl",["$scope","$q","dwAlerts","state","userProfileService","UserProfileFields","optsShareEmail",function(e,r,t,n,i,s,o){"use strict";var a=this;a.$onInit=function(){a.optsShareEmail=o},a.save=function(){var o={sharePhoto:a.user.sharePhoto,shareCompany:a.user.shareCompany,shareOccupation:a.user.shareOccupation,shareEmail:a.user.shareEmail};return r.all([i.updateRaw(n.getCurrentCenterId(),a.user,o).then(function(){e.$emit("CurrentUser:refresh")}).catch(function(e){return t.error(e,"Failed to save user shareable info.")}).catch(angular.noop),s.save(n.getCurrentCenterId(),a.user.id,a.fields).catch(function(e){return t.error(e,"Failed to save user profile fields.")}).catch(angular.noop)])}}]),angular.module("deskworks.members.userProfile.sections.systemInfo",[]).directive("userProfileSystemInfo",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-system-info.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upSystemInfoCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upSystemInfoCtrl",function(){"use strict";var e=this;e.$onChanges=function(){e.user&&(e.user.activatedAt=e.user.activatedAt&&e.user.activatedAt.map(function(e){return e.centerName}).join(", "),e.user.masterMembers=e.user.masterMembers&&e.user.masterMembers.map(function(e){return e.fullName+(e.company?" ("+e.company+")":"")}).join(", "))}}),angular.module("deskworks.members.userProfile.sections.termsOfService",["deskworks.helper","deskworks.state","deskworks.whitelabel"]).directive("userProfileTermsOfService",["$compile","$templateCache",function(e,r){"use strict";var t="members/user-profile/sections/user-profile-terms-of-service.tpl.html";return{restrict:"E",scope:!0,transclude:"element",templateUrl:t,controller:"upTermsCtrl as $ctrl",bindToController:{reg:"<",user:"<",schema:"<",settings:"<"},compile:function(n,i){return function(n,i,s,o,a){a(function(s,o){i.after(e(r.get(t))(n))})}}}}]).controller("upTermsCtrl",["$scope",function(e){"use strict"}]),angular.module("deskworks.rcAdjustments",[]).component("rcAdjustments",{template:'<ff-label><span translate="RESERVATIONS.CALENDAR.ZOOM"></span></ff-label><input type="range" class="rc-range" title="{{\'RESERVATIONS.CALENDAR.ZOOM.HINT\' | translate}}" min="{{$ctrl.$rcCalendar.modes.day.minWidth}}" max="{{$ctrl.$rcCalendar.modes.day.maxWidth}}" ng-model="$ctrl.$rcCalendar.modes.day.width" ng-show="$ctrl.$rcCalendar.mode === \'day\'"><input type="range" class="rc-range" title="{{\'RESERVATIONS.CALENDAR.ZOOM.HINT\' | translate}}" min="{{$ctrl.$rcCalendar.modes.week.minWidth}}" max="{{$ctrl.$rcCalendar.modes.week.maxWidth}}" ng-model="$ctrl.$rcCalendar.modes.week.width" ng-show="$ctrl.$rcCalendar.mode === \'week\'">',controller:"RcAdjustmentsController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcAdjustmentsController",function(){"use strict"}),angular.module("deskworks.rcHeader",[]).component("rcHeader",{templateUrl:"reservations/rc-calendar/header/rc-header.tpl.html",controller:"RcHeaderController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcHeaderController",["$element","$scope","$locale",function(e,r,t){"use strict";var n=this;n.$onInit=function(){n.weekTimeFormat=24===t.timeFormat?"H":"h"},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.getCalStartDate().valueOf()"],function(){var e,r,t=n.$rcCalendar.getCalStartDate(),i=n.$rcCalendar.getCalEndDate();for(r="week"===n.$rcCalendar.mode?1:.5,n.vgrid=[],e=t.clone();e<=i;e.add(r,"h"))n.vgrid.push(n.$rcCalendar.dateToX(e));n.times=[];var s="week"===n.$rcCalendar.mode?"isBefore":"isSameOrBefore";for(e=t.clone();e[s](i);e.add(1,"h"))"week"===n.$rcCalendar.mode&&e.hour()%2!=0||n.times.push({x:n.$rcCalendar.dateToX(e),time:e.clone(),highlight:"week"===n.$rcCalendar.mode||e.hour()%12==0});if("week"===n.$rcCalendar.mode)for(n.weekdays=[],e=t.clone();e<i;e.add(1,"d"))n.weekdays.push({x:n.$rcCalendar.dateToX(e),width:n.$rcCalendar.dateToX(e.clone().add(1,"d"))-n.$rcCalendar.dateToX(e),time:e.clone()})})}]),angular.module("deskworks.rcAvailability",[]).component("rcAvailability",{template:"",controller:"RcAvailabilityController",require:{$rcCalendar:"^^rcCalendar",ffBlock:"^^ffBulkReadOnly"},bindings:{availability:"<"}}).controller("RcAvailabilityController",["$element","$scope","$translate","rcHelper","state",function(e,r,t,n,i){"use strict";var s=this;s.$onInit=function(){if(s.ffBlock&&!s.ffBlock.editMode)return e.attr("title",t.instant("RESERVATIONS.CALENDAR.NO_PERMISSION.HINT"));e.attr("title",t.instant("RESERVATIONS.CALENDAR.AVAILABLE.HINT")),e.on("click",function(e){s.onClick(e),r.$apply()})},s.$onDestroy=function(){e.off("click")},s.onClick=function(r){var t=moment(Math.floor(s.from+(s.to-s.from)*r.offsetX/e[0].offsetWidth));return n.floorDate(t,30),i.setParam("date",n.dateToStr(t)),i.setParam("unit",s.availability.reservationUnit.id),i.setPath("/new-reservation")},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.filter"],function(){s.from=Math.max(s.availability.from,s.$rcCalendar.getCalStartDate()),s.to=Math.min(s.availability.to,s.$rcCalendar.getCalEndDate());var r=s.$rcCalendar.dateToX(s.from),t=s.$rcCalendar.dateToX(s.to)-r;e.css("top",s.availability.reservationUnit.top+"px"),e.css("height",s.$rcCalendar.rowHeight+"px"),e.css("left",r+"%"),e.css("width",t+"%")})}]),angular.module("deskworks.rcLayerActive",["deskworks.rcAvailability","deskworks.rcStaffOnly"]).component("rcLayerActive",{templateUrl:"reservations/rc-calendar/layers/rc-layer-active.tpl.html",controller:"RcLayerActiveController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerActiveController",["$element","$scope","$locale","$translate",function(e,r,t,n){"use strict";var i=this;i.$onInit=function(){e.addClass("rc-layer"),e.attr("title",n.instant("RESERVATIONS.CALENDAR.NOT_AVAILABLE.HINT")),i.markerTimeFormat=24===t.timeFormat?"HH:mm":"hh:mm"},i.onClickHint=function(e){e.preventDefault(),e.stopPropagation()}}]),angular.module("deskworks.rcLayerAvailability",["deskworks.rcAvailability"]).component("rcLayerAvailability",{template:'<rc-availability ng-repeat="availability in $ctrl.$rcCalendar.availabilities" availability="availability"></rc-availability>',controller:"RcLayerAvailabilityController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerAvailabilityController",["$element","$scope",function(e,r){"use strict";this.$onInit=function(){e.addClass("rc-layer")}}]),angular.module("deskworks.rcLayerGridB",[]).component("rcLayerGridB",{template:'<div class="rc-borders-b" ng-repeat="x in $ctrl.bgrid" ng-style="{ left: x + \'%\' }"></div>',controller:"RcLayerGridBController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerGridBController",["$element","$scope",function(e,r){"use strict";var t=this;t.$onInit=function(){e.addClass("rc-layer")},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.getCalStartDate().valueOf()"],function(){var e,r=t.$rcCalendar.getCalStartDate(),n=t.$rcCalendar.getCalEndDate();if(t.bgrid=[],"week"===t.$rcCalendar.mode)for(e=r.clone();e<=n;e.add(1,"d"))t.bgrid.push(t.$rcCalendar.dateToX(e));else for(e=r.clone();e<=n;e.hour(e.hour()?24:12))t.bgrid.push(t.$rcCalendar.dateToX(e))})}]),angular.module("deskworks.rcLayerGridH",[]).component("rcLayerGridH",{template:'<div class="rc-borders-h" ng-repeat-start="resType in $ctrl.$rcCalendar.reservationTypes" ng-style="{ top: resType.top + \'px\', height: $ctrl.$rcCalendar.rowGroupHeaderHeight + \'px\' }"></div><div class="rc-borders-h" ng-repeat-end ng-repeat="resUnit in resType.reservationUnits" ng-style="{ top: resUnit.top + \'px\', height: $ctrl.$rcCalendar.rowHeight + \'px\' }"></div>',controller:"RcLayerGridHController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerGridHController",["$element",function(e){"use strict";this.$onInit=function(){e.addClass("rc-layer")}}]),angular.module("deskworks.rcLayerGridV",[]).component("rcLayerGridV",{template:'<div class="rc-borders-v" ng-repeat="x in $ctrl.vgrid" ng-style="{ left: x + \'%\' }"></div>',controller:"RcLayerGridVController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerGridVController",["$element","$scope",function(e,r){"use strict";var t=this;t.$onInit=function(){e.addClass("rc-layer")},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.getCalStartDate().valueOf()"],function(){var e,r=t.$rcCalendar.getCalStartDate(),n=t.$rcCalendar.getCalEndDate(),i="week"===t.$rcCalendar.mode?3:.5;for(t.vgrid=[],e=r.clone();e<=n;e.add(.5,"h"))(e.hour()+e.minute()/60)%i==0&&t.vgrid.push(t.$rcCalendar.dateToX(e))})}]),angular.module("deskworks.rcLayerReservations",["deskworks.rcReservation"]).component("rcLayerReservations",{template:'<rc-reservation ng-repeat="reservation in $ctrl.$rcCalendar.reservations" reservation="reservation"></rc-reservation>',controller:"RcLayerReservationsController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcLayerReservationsController",["$element","$scope",function(e,r){"use strict";this.$onInit=function(){e.addClass("rc-layer")}}]),angular.module("deskworks.rcReservation",[]).component("rcReservation",{template:"",controller:"RcReservationController",require:{$rcCalendar:"^^rcCalendar",ffBlock:"^^ffBulkReadOnly"},bindings:{reservation:"<"}}).controller("RcReservationController",["$element","$scope","$translate","rcHelper","state",function(e,r,t,n,i){"use strict";var s=this;s.$onInit=function(){e.attr("title",t.instant("RESERVATIONS.CALENDAR.RESERVED.HINT")),s.reservation.userId==i.getCurrentUserId()&&e.addClass("own"),s.ffBlock&&!s.ffBlock.editMode||e.on("click",function(e){s.onClick(e),r.$apply()})},s.$onDestroy=function(){e.off("click")},s.onClick=function(e){if(i.isLoggedAdmin()||s.reservation.userId==i.getCurrentUserId())return i.setParam("date",n.dateToStr(s.reservation.from)),i.setPath("/edit-reservation/"+s.reservation.id)},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.filter"],function(){s.from=Math.max(s.reservation.from,s.$rcCalendar.getCalStartDate()),s.to=Math.min(s.reservation.to,s.$rcCalendar.getCalEndDate());var r=s.$rcCalendar.dateToX(s.from),t=s.$rcCalendar.dateToX(s.to)-r;e.css("top",s.reservation.reservationUnit.top+"px"),e.css("height",s.$rcCalendar.rowHeight+"px"),e.css("left",r+"%"),e.css("width",t+"%")})}]),angular.module("deskworks.rcStaffOnly",[]).component("rcStaffOnly",{template:"",controller:"RcStaffOnlyController",require:{$rcCalendar:"^rcCalendar"},bindings:{reservationUnit:"<"}}).controller("RcStaffOnlyController",["$element","$scope","$translate",function(e,r,t){"use strict";var n=this;n.$onInit=function(){e.attr("title",t.instant("RESERVATIONS.CALENDAR.STAFF_ONLY.HINT"))},r.$watchGroup(["$ctrl.$rcCalendar.mode","$ctrl.$rcCalendar.filter"],function(){var r=n.$rcCalendar.dateToX(n.$rcCalendar.getCalStartDate()),t=n.$rcCalendar.dateToX(n.$rcCalendar.getCalEndDate())-r;e.css("top",n.reservationUnit.top+"px"),e.css("height",n.$rcCalendar.rowHeight+"px"),e.css("left",r+"%"),e.css("width",t+"%")})}]),angular.module("deskworks.rcSidebar",["deskworks.rcLayerGridH"]).component("rcSidebar",{templateUrl:"reservations/rc-calendar/sidebar/rc-sidebar.tpl.html",controller:"RcSidebarController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcSidebarController",function(){"use strict";var e=this;e.$onInit=function(){e.enablePhotos=e.$rcCalendar.settings.enableCalendarPhotos}}),angular.module("deskworks.rcDateSelector",[]).component("rcDateSelector",{templateUrl:"reservations/rc-calendar/toolbar/rc-date-selector.tpl.html",controller:"RcDateSelectorController as $ctrl",bindings:{mode:"<",date:"="}}).controller("RcDateSelectorController",["$scope",function(e){"use strict";var r=this;e.$watch("$ctrl.date",function(){moment.isMoment(r.date)&&(r.weekStart=r.date.clone().startOf("week"),r.weekEnd=r.weekStart.clone().endOf("week"))}),r.prev=function(){moment.isMoment(r.date)&&(r.date=r.date.clone().subtract("week"===r.mode?7:1,"d"))},r.next=function(){moment.isMoment(r.date)&&(r.date=r.date.clone().add("week"===r.mode?7:1,"d"))}}]),angular.module("deskworks.rcLegend",["deskworks.state"]).component("rcLegend",{template:'<div class="rc-reserved" translate="RESERVATIONS.CALENDAR.LEGEND.RESERVED" title="{{\'RESERVATIONS.CALENDAR.LEGEND.RESERVED.HINT\' | translate}}"></div><div class="rc-own" translate="RESERVATIONS.CALENDAR.LEGEND.OWN" title="{{\'RESERVATIONS.CALENDAR.LEGEND.OWN.HINT\' | translate}}"></div><div class="rc-available" translate="RESERVATIONS.CALENDAR.LEGEND.AVAILABLE" title="{{\'RESERVATIONS.CALENDAR.LEGEND.AVAILABLE.HINT\' | translate}}"></div>',controller:"RcLegendController"}).controller("RcLegendController",["state",function(e){"use strict";var r=this;r.$onInit=function(){r.state=e}}]),angular.module("deskworks.rcOptions",["deskworks.state"]).component("rcOptions",{templateUrl:"reservations/rc-calendar/toolbar/rc-options.tpl.html",controller:"RcOptionsController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcOptionsController",["state",function(e){"use strict";var r=this;r.$onInit=function(){r.state=e}}]),angular.module("deskworks.rcToolbar",["deskworks.rcDateSelector","deskworks.rcLegend","deskworks.rcOptions"]).component("rcToolbar",{templateUrl:"reservations/rc-calendar/toolbar/rc-toolbar.tpl.html",controller:"RcToolbarController",require:{$rcCalendar:"^rcCalendar"}}).controller("RcToolbarController",function(){"use strict"}),angular.module("deskworks.accounting",["ngRoute","oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts","deskworks.accounting.barUploads.service","deskworks.accounting.bulkInvoicing.service","deskworks.accounting.printerUsage.service"]).config(["$routeProvider",function(e){"use strict";e.when("/bar-uploads",{template:"<div ng-include=\"'bar-uploads/bar-uploads-list.tpl.html'\"></div>",controller:"BarUploadsListCtrl as $ctrl",label:"Bar Uploads",routeBranch:"bar-uploads",translations:["bar-uploads"],resolve:{barUploads:["dwAlerts","barUploadsService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query bar uploads.")})})}],lazy:"lazyLoadAccounting"}}),e.when("/bar-uploads/:barUploadId",{template:"<div ng-include=\"'bar-uploads/bar-uploads-edit.tpl.html'\"></div>",controller:"BarUploadsEditCtrl as $ctrl",label:"Edit Bar Upload",routeBranch:"bar-uploads",translations:["bar-uploads"],resolve:{barUpload:["$route","dwAlerts","barUploadsService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(n.getCurrentCenterId(),e.current.params.barUploadId).catch(function(e){return r.error(e,"Failed to get bar upload.")})})}],lazy:"lazyLoadAccounting"}}),e.when("/bulk-charges",{template:"<div ng-include=\"'bulk-charges/bulk-charges.tpl.html'\"></div>",controller:"AccountingBulkChargesCtrl as vm",label:"Bulk Charges",routeBranch:"bulk-charges",translations:["purchase","bulk-charges"],resolve:{invoices:["dwAlerts","bulkInvoicingService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getPurchases(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query orders.")})})}],lazy:"lazyLoadAccounting"}}),e.when("/bulk-invoicing",{template:"<div ng-include=\"'bulk-invoicing/bulk-invoicing.tpl.html'\"></div>",controller:"AccountingBulkInvoicingCtrl as vm",label:"Bulk Invoicing",routeBranch:"bulk-invoicing",translations:["purchase","bulk-invoicing"],resolve:{invoices:["dwAlerts","bulkInvoicingService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getInvoices(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query invoices.")})})}],lazy:"lazyLoadAccounting"}}),e.when("/printer-usage",{template:"<div ng-include=\"'printer-usage/printer-usage-list.tpl.html'\"></div>",controller:"PrinterUsageListCtrl as vm",label:"Printer Usage",routeBranch:"printer-usage",translations:["printer-usage"],resolve:{usage:["dwAlerts","printerUsageService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query printer usages.")})})}],lazy:"lazyLoadAccounting"}}),e.when("/printer-usage/:printerUsageId",{template:"<div ng-include=\"'printer-usage/printer-usage-edit.tpl.html'\"></div>",controller:"PrinterUsageEditCtrl as vm",label:"Edit Printer Usage",routeBranch:"printer-usage",translations:["printer-usage"],resolve:{usage:["$route","dwAlerts","printerUsageService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(n.getCurrentCenterId(),e.current.params.printerUsageId).catch(function(e){return r.error(e,"Failed to get printer usage.")})})}],lazy:"lazyLoadAccounting"}})}]).factory("lazyLoadAccounting",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("accounting").catch(function(e){return r.error(e||"Failed to load accounting module.")})}]),angular.module("deskworks.bundleReservation",["oc.lazyLoad","deskworks.SimpleReservationCentersCtrl","deskworks.setup.service"]).config(["$routeProvider",function(e){"use strict";t.$inject=["dwAlerts","$ocLazyLoad"],r.$inject=["$route","helper","routeHelper"];function r(e,r,t){return t.auth(r.interpolateRoute("/bundle-reservation/:reservationBundleId",e.current.params))}function t(e,r){return r.load("bundle-reservation").catch(function(){return e.error("Failed to load bundle-reservation bundle")})}e.when("/bundle-reservation/:reservationBundleId",{template:"<div ng-include=\"'simple-reservation/simple-reservation-sign-in.tpl.html'\"></div>",controller:"BundleReservationSignInCtrl",controllerAs:"vm",routeBranch:"bundle-reservation",translations:["sign-in"],hideSidebar:!0,userTasksPolicy:!1,resolve:{redirect:["$q","state","routeHelper","dwAlerts","userProfileService",function(e,r,t,n,i){return t.auth(null).then(function(){return i.get(r.getCurrentCenterId(),r.getCurrentUserId()).catch(function(e){return n.error(e,"Failed to load user profile.")}).then(function(t){return"nonMember"===t.role?r.setPath(r.getPath()+"/user-profile",!0):r.setPath(r.getPath()+"/confirm",!0),e.reject()})},function(){})}],lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/user-profile",{template:"<div ng-include=\"'members/user-profile/user-profile.tpl.html'\"></div>",controller:"BundleReservationUserProfileCtrl",controllerAs:"vm",label:"Profile",routeBranch:"bundle-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["user-profile"],resolve:{reg:function(){return{member:!1,selfRegistration:!0,step:1,stepCount:3}},userProfile:["state","$q","dwAlerts","helper","routeHelper","userProfileService",function(e,r,t,n,i,s){return i.auth(null).then(function(){return e.getCurrentCenterId()?s.getForRegistration(e.getCurrentCenterId(),e.getCurrentUserId(),"nonMember","signUp").catch(function(e){return t.error(e,"Failed to get user profile.")}):r.reject()},function(){return s.new({},"nonMember","signUp").catch(function(e){return t.error(e,"Failed to get new member profile template.")})})}],centers:["dwAlerts","centerService",function(e,r){return r.resetCache(),r.getCenters().catch(function(r){return e.error(r,"Failed to get center.")})}],lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/user-profile/purchase/:purchaseId",{template:"<div ng-include=\"'simple-reservation/08-purchase/purchase.tpl.html'\"></div>",controller:"BundleReservationPurchaseCtrl",controllerAs:"vm",label:"Purchase",routeBranch:"bundle-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["purchase","simple-reservation"],resolve:{reg:function(){return{member:!1,selfRegistration:!0,step:2,stepCount:3}},center:["dwAlerts","state","centerService",function(e,r,t){return t.get(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center data.")})}],purchase:["$route","dwAlerts","state","helper","routeHelper","purchaseService",function(e,t,n,i,s,o){return r(e,i,s).then(function(){return o.get(n.getCurrentCenterId(),n.getCurrentUserId(),e.current.params.purchaseId).catch(function(e){return t.error(e,"Failed to get purchase.")})})}],lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/user-profile/purchase/:purchaseId/staff-help",{template:"<div ng-include=\"'simple-reservation/staff-help.tpl.html'\"></div>",controller:"BundleReservationStaffHelpCtrl",controllerAs:"vm",label:"Staff Help",routeBranch:"bundle-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{auth:r,lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/user-profile/purchase/:purchaseId/billing",{template:"<div ng-include=\"'simple-reservation/09-billing/billing.tpl.html'\"></div>",controller:"BundleReservationBillingCtrl",controllerAs:"vm",label:"Billing",routeBranch:"bundle-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["billing-profile","user-profile","simple-reservation"],resolve:{reg:function(){return{member:!1,selfRegistration:!0,step:3,stepCount:3}},userProfile:["dwAlerts","$route","helper","state","routeHelper","userProfileService",function(e,t,n,i,s,o){return r(t,n,s).then(function(){return o.get(i.getCurrentCenterId(),i.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}],lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/user-profile/purchase/:purchaseId/billing/complete",{template:"<div ng-include=\"'simple-reservation/complete.tpl.html'\"></div>",controller:"BundleReservationCompleteCtrl",label:"Complete",routeBranch:"bundle-reservation",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["purchase","simple-reservation"],resolve:{reg:function(){return{member:!1,selfRegistration:!0}},purchase:["dwAlerts","$route","state","helper","routeHelper","purchaseService",function(e,t,n,i,s,o){return r(t,i,s).then(function(){return o.get(n.getCurrentCenterId(),n.getCurrentUserId(),t.current.params.purchaseId).catch(function(r){return e.error(r,"Failed to get purchase.")})})}],center:["dwAlerts","$route","state","centerService",function(e,r,t,n){return n.get(t.getCurrentCenterId()).catch(function(r){return e.error(result,"Failed to get center.")})}],lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/confirm",{template:"<div ng-include=\"'bundle-reservation-confirm.tpl.html'\"></div>",controller:"BundleReservationConfirmCtrl",controllerAs:"vm",routeBranch:"bundle-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["reservations"],resolve:{auth:r,lazy:t}}),e.when("/bundle-reservation/:reservationBundleId/complete",{template:"<div ng-include=\"'bundle-reservation-complete.tpl.html'\"></div>",controller:"BundleReservationCompleteCtrl",label:"Complete",routeBranch:"bundle-reservation",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{purchase:function(){return null},center:function(){return null},lazy:t}})}]),angular.module("deskworks.communications",["oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts","deskworks.center.service","deskworks.inventory.membershipCategory.service","deskworks.SplashPage"]).config(["$routeProvider",function(e){"use strict";e.when("/email-all-members",{template:"<div ng-include=\"'email-all-members/email-all-members.tpl.html'\"></div>",controller:"EmailAllMembersCtrl as $ctrl",label:"Email All Members",routeBranch:"email-all-members",translations:["email-members"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadCommunications"}}),e.when("/email-site-members",{template:"<div ng-include=\"'email-site-members/email-site-members.tpl.html'\"></div>",controller:"EmailSiteMembersCtrl as $ctrl",label:"Email Site Members",routeBranch:"email-site-members",translations:["email-members"],resolve:{membershipCategories:["dwAlerts","membershipCategoryService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query membership categories.")})})}],center:["dwAlerts","state","centerService",function(e,r,t){return t.getCenter(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],lazy:"lazyLoadCommunications"}}),e.when("/message-board",{template:"<div ng-include=\"'message-board/message-board.tpl.html'\"></div>",controller:"MessageBoardCtrl as $ctrl",label:"Message Board",routeBranch:"message-board",translations:["message-board"],resolve:{lazy:"lazyLoadCommunications"}}),e.when("/splash-page",{template:"<div ng-include=\"'splash-page/splash-page.tpl.html'\"></div>",controller:"SplashPageCtrl as $ctrl",label:"Splash Page",routeBranch:"splash-page",translations:["splash-page"],resolve:{auth:["routeHelper",function(e){return e.auth()}],center:["dwAlerts","state","centerService",function(e,r,t){return t.getCenter(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],splashPage:["dwAlerts","SplashPage","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.get(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get splash page settings.")})})}],lazy:"lazyLoadCommunications"}})}]).factory("lazyLoadCommunications",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("communications").catch(function(e){return r.error(e||"Failed to load communications module.")})}]),angular.module("deskworks.globalConfig",["ngRoute","ngStorage","oc.lazyLoad","tmh.dynamicLocale","pascalprecht.translate","dateFilters","setLocale","setTranslations","resolveTimezone","deskworks.config","deskworks.setup.service","userTasksPolicy","resolveGtm","sessionInjector","sessionRefresher"]).config(["$httpProvider","$localStorageProvider","$ocLazyLoadProvider","$routeProvider","$locationProvider","$translateProvider","$qProvider","deskworksConfigProvider","tmhDynamicLocaleProvider",function(e,r,t,n,i,s,o,a,l){"use strict";e.defaults.withCredentials=!0,r.setKeyPrefix("dw"),t.config({modules:angular.fromJson(window.dwBundles)}),i.html5Mode(!0).hashPrefix(""),e.interceptors.push("sessionInjector"),e.interceptors.push("sessionRefresher"),s.fallbackLanguage("en").preferredLanguage("en").useLoader("$translatePartialLoader",{urlTemplate:"assets/translations/{part}-{lang}.json",loadFailureHandler:"$translateErrorHandler"}).useSanitizeValueStrategy("sceParameters").addInterpolation("$translateMessageFormatInterpolation"),l.localeLocationPattern("assets/locales/angular-locale_{{locale}}.js?_rev={{_rev}}"),l.defaultLocale("en-us"),a.setApiUrl("/api/v1"),n.otherwise({redirectTo:function(e,r,t){var n=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");return a.getDefaultRoute()+(n.length>0?"?"+n:"")}}),n.whenOrig=n.when,n.when=function(e,r){return r.resolve=r.resolve||{},r.resolve.resolveLocale=["$q","dwAlerts","setLocale","setTranslations","setupService",function(e,t,n,i,s){return s.getSetupSettings().catch(function(e){return t.error(e,"Failed to get setup settings.")}).then(function(t){return e.all([n(t),i(r.translations||[],t.locale)])})}],r.resolve.resolveTimezone=["resolveTimezone",function(e){return e()}],r.resolve.userTasksPolicy=["userTasksPolicy",function(e){return e()}],r.resolve.resolveGtm=["resolveGtm",function(e){return e()}],n.whenOrig(e,r)}}]),angular.module("deskworks.import",["oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts"]).config(["$routeProvider",function(e){"use strict";e.when("/setup/import",{template:"<div ng-include=\"'import.tpl.html'\"></div>",controller:"SetupImportCtrl as $ctrl",label:"Setup Import",routeBranch:"setup/import",translations:["reservation-rules","user-profile","products"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:["$ocLazyLoad","dwAlerts",function(e,r){return e.load("import").catch(function(e){return r.error(e||"Failed to load import module.")})}]}})}]),angular.module("deskworks.inventory",["ngRoute","oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts","deskworks.center.service","deskworks.inventory.membershipCategory.service","deskworks.reservationCategory.service","deskworks.reservationUnit.service","deskworks.inventory.priceList.service","deskworks.inventory.product.service","deskworks.ProductCategory"]).config(["$routeProvider",function(e){"use strict";e.when("/membership-types",{template:"<div ng-include=\"'membership-category/membership-category-list.tpl.html'\"></div>",controller:"MembershipCategoryListCtrl as vm",label:"Membership Categories",routeBranch:"membership-types",translations:["membership-categories"],resolve:{membershipCategories:["dwAlerts","membershipCategoryService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query membership categories.")})})}],lazy:"lazyLoadInventory"}}),e.when("/membership-types/:membershipCategoryId",{template:"<div ng-include=\"'membership-category/membership-category-edit.tpl.html'\"></div>",controller:"MembershipCategoryEditCtrl as vm",label:"Edit",routeBranch:"membership-types",translations:["membership-categories"],resolve:{membershipCategories:["dwAlerts","membershipCategoryService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query membership categories.")})})}],lazy:"lazyLoadInventory"}}),e.when("/pricelists",{template:"<div ng-include=\"'price-list/price-list-list.tpl.html'\"></div>",controller:"PriceListListCtrl as vm",label:"Price Lists",routeBranch:"pricelists",reloadOnSearch:!1,translations:["price-lists","reports"],resolve:{priceLists:["dwAlerts","priceListService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getPricelists(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query price lists.")})})}],centers:["dwAlerts","centerService",function(e,r){return r.getCenters().catch(function(r){return e.error(r,"Failed to query centers.")})}],lazy:"lazyLoadInventory"}}),e.when("/pricelists/:priceListId",{template:"<div ng-include=\"'price-list/price-list-edit.tpl.html'\"></div>",controller:"PriceListEditCtrl as vm",label:"Edit",routeBranch:"pricelists",translations:["price-lists","products"],resolve:{priceList:["$route","dwAlerts","priceListService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.getPricelist(n.getCurrentCenterId(),e.current.params.priceListId).catch(function(e){return r.error(e,"Failed to get price list.")})})}],lazy:"lazyLoadInventory"}}),e.when("/products",{template:"<div ng-include=\"'product/product-list.tpl.html'\"></div>",controller:"ProductListCtrl as vm",label:"Products",routeBranch:"products",translations:["products"],resolve:{products:["dwAlerts","productService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.getProducts().catch(function(r){return e.error(r,"Failed to query products.")})})}],lazy:"lazyLoadInventory"}}),e.when("/products/:productId",{template:"<div ng-include=\"'product/product-edit.tpl.html'\"></div>",controller:"ProductEditCtrl as vm",label:"Edit",routeBranch:"products",translations:["products","recurring-billing","printer-usage-settings"],resolve:{product:["$route","dwAlerts","productService","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.getProduct(e.current.params.productId).catch(function(e){return r.error(e,"Failed to get product.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}],productCategories:["dwAlerts","ProductCategory","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query product categories.")})})}],lazy1:"lazyLoadInventory",lazy2:"lazyLoadQuickBooks"}}),e.when("/reservation-types",{template:"<div ng-include=\"'reservation-category/reservation-category-list.tpl.html'\"></div>",controller:"InventoryReservationCategoriesCtrl as vm",label:"Reservation Categories",routeBranch:"reservation-types",translations:["reservation-categories"],resolve:{reservationCategories:["dwAlerts","reservationCategoryService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation categories.")})})}],lazy:"lazyLoadInventory"}}),e.when("/reservation-types/:reservationTypeId",{template:"<div ng-include=\"'reservation-category/reservation-category-edit.tpl.html'\"></div>",controller:"InventoryReservationCategoryEditCtrl as vm",label:"Edit",routeBranch:"reservation-types",translations:["reservation-categories"],resolve:{reservationCategory:["$route","dwAlerts","reservationCategoryService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(n.getCurrentCenterId(),e.current.params.reservationTypeId).catch(function(e){return r.error(e,"Failed to get reservation category.")})})}],reservationCategories:["dwAlerts","reservationCategoryService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation categories.")})})}],lazy:"lazyLoadInventory"}}),e.when("/reservation-units",{template:"<div ng-include=\"'reservation-unit/reservation-unit-list.tpl.html'\"></div>",controller:"InventoryReservationUnitListCtrl as vm",label:"Reservation Units",routeBranch:"reservation-units",translations:["reservation-units","reservation-rules"],resolve:{reservationUnits:["dwAlerts","reservationUnitService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getReservationUnits(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation units.")})})}],lazy:"lazyLoadInventory"}}),e.when("/reservation-units/:reservationUnitId",{template:"<div ng-include=\"'reservation-unit/reservation-unit-edit.tpl.html'\"></div>",controller:"InventoryReservationUnitEditCtrl as vm",label:"Edit",routeBranch:"reservation-units",translations:["reservation-units","reservation-rules"],resolve:{reservationUnit:["$route","dwAlerts","reservationUnitService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.getReservationUnitExt(n.getCurrentCenterId(),e.current.params.reservationUnitId).catch(function(e){return r.error(e,"Failed to get reservation unit.")})})}],reservationCategories:["dwAlerts","reservationCategoryService","state",function(e,r,t){return r.query(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation categories.")})}],lazy:"lazyLoadInventory"}}),e.when("/product-categories",{template:"<div ng-include=\"'product-categories/product-categories.tpl.html'\"></div>",controller:"ProductCategoriesCtrl as $ctrl",label:"Product Categories",routeBranch:"product-categories",translations:["product-categories"],resolve:{categories:["dwAlerts","ProductCategory","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query product categories.")})})}],lazy:"lazyLoadInventory"}})}]).factory("lazyLoadInventory",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("inventory").catch(function(e){return r.error(e||"Failed to load inventory module.")})}]),angular.module("deskworks.notifications",["oc.lazyLoad","deskworks.routeHelper","deskworks.notifications.service"]).config(["$routeProvider",function(e){"use strict";e.when("/setup/bulk-invoices",{template:"<div ng-include=\"'bulk-invoices/bulk-invoices.tpl.html'\"></div>",controller:"BulkInvoicesTplCtrl as $ctrl",label:"Bulk Invoices Setup",routeBranch:"setup/bulk-invoices",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getBulkInvoices().catch(function(r){return e.error(r,"Failed to load bulk invoices template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/recurring-invoices",{template:"<div ng-include=\"'recurring-invoices/recurring-invoices.tpl.html'\"></div>",controller:"RecurringInvoicesEmailCtrl as $ctrl",label:"Recurring Invoices Setup",routeBranch:"setup/recurring-invoices",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getRecurringInvoices().catch(function(r){return e.error(r,"Failed to load recurring invoices template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/expired-card-email",{template:"<div ng-include=\"'expired-card-email/expired-card-email.tpl.html'\"></div>",controller:"ExpiredCardEmailCtrl as $ctrl",label:"Expired Card Email Setup",routeBranch:"setup/expired-card-email",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getExpiredCardEmail().catch(function(r){return e.error(r,"Failed to load expired card email template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/declined-card-email",{template:"<div ng-include=\"'declined-card-email/declined-card-email.tpl.html'\"></div>",controller:"DeclinedCardEmailCtrl as $ctrl",label:"Declined Card Email Setup",routeBranch:"setup/declined-card-email",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getDeclinedCardEmail().catch(function(r){return e.error(r,"Failed to load declined card email template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/welcome-letter",{template:"<div ng-include=\"'welcome-letter/welcome-letter.tpl.html'\"></div>",controller:"WelcomeLetterCtrl as $ctrl",label:"Welcome Letter Setup",routeBranch:"setup/welcome-letter",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getWelcomeLetter().catch(function(r){return e.error(r,"Failed to load welcome letter template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/reservation-confirmation",{template:"<div ng-include=\"'reservation-confirmation/reservation-confirmation.tpl.html'\"></div>",controller:"ReservationConfirmationEmailCtrl as $ctrl",label:"Reservation Confirmation Setup",routeBranch:"setup/reservation-confirmation",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getReservationConfirmation().catch(function(r){return e.error(r,"Failed to load reservation confirmation template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/reservation-reminder",{template:"<div ng-include=\"'reservation-reminder/reservation-reminder.tpl.html'\"></div>",controller:"ReservationReminderEmailCtrl as $ctrl",label:"Reservation Reminder",routeBranch:"setup/reservation-reminder",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getReservationReminder().catch(function(r){return e.error(r,"Failed to get reservation reminder template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/cal-sync-error-email",{template:"<div ng-include=\"'cal-sync-error-email/cal-sync-error-email.tpl.html'\"></div>",controller:"CalSyncErrorEmailCtrl as $ctrl",label:"Cal Sync Error",routeBranch:"setup/cal-sync-error-email",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getCalSyncErrorEmail().catch(function(r){return e.error(r,"Failed to get calendar sync error email template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/passes-used-up-email",{template:"<div ng-include=\"'passes-used-up-email/passes-used-up-email.tpl.html'\"></div>",controller:"PassesUsedUpEmailCtrl as $ctrl",label:"Passes Used Up Email",routeBranch:"setup/passes-used-up-email",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getPassesUsedUpEmail().catch(function(r){return e.error(r,"Failed to get passes used up email template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/setup/renewal-notice-email",{template:"<div ng-include=\"'renewal-notice-email/renewal-notice-email.tpl.html'\"></div>",controller:"RenewalNoticeEmailCtrl as $ctrl",label:"Renewal Notice Email",routeBranch:"setup/renewal-notice-email",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getRenewalNoticeEmail().catch(function(r){return e.error(r,"Failed to get renewal notice email template.")})})}],lazy:"lazyLoadNotifications"}}),e.when("/notifications/receipt-email",{template:"<div ng-include=\"'receipt-email/receipt-email.tpl.html'\"></div>",controller:"ReceiptEmailTplCtrl as $ctrl",label:"Receipt Email",routeBranch:"notifications/receipt-email",translations:["notifications"],resolve:{tpls:["$q","dwAlerts","Notifications","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return e.all([{$$id:"receipt",$$name:"NOTIFICATIONS.RECEIPT.GENERAL"},{$$id:"reservation-receipt",$$name:"NOTIFICATIONS.RECEIPT.RESERVATION"},{$$id:"pass-receipt",$$name:"NOTIFICATIONS.RECEIPT.PASS"}].map(function(e){return t.getEmailTemplate(e.$$id).catch(function(e){return r.error(e,"Failed to get receipt email template.")}).then(function(r){return angular.extend(r,e)})}))})}],lazy:"lazyLoadNotifications"}}),e.when("/desk-tablet-template",{template:"<div ng-include=\"'desk-tablet-template/desk-tablet-template.tpl.html'\"></div>",controller:"DeskTabletTemplateCtrl as $ctrl",routeBranch:"desk-tablet-template",translations:["notifications"],resolve:{tpl:["dwAlerts","Notifications","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getDeskTabletTemplate(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get desk tablet template.")})})}],lazy:"lazyLoadNotifications"}})}]).factory("lazyLoadNotifications",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("notifications").catch(function(e){return r.error(e||"Failed to load notifications module.")})}]),angular.module("deskworks.reports",["oc.lazyLoad","deskworks.setup.service","deskworks.center.service","deskworks.userProfile.service","deskworks.purchase.service","deskworks.bank.service","deskworks.UserField"]).config(["$routeProvider",function(e){"use strict";e.when("/invoice/:orderId",{template:"<div ng-include=\"'invoice/invoice.tpl.html'\"></div>",controller:"InvoiceCtrl as vm",label:"Invoice",routeBranch:"invoice",reloadOnSearch:!1,hideSidebar:!0,userTasksPolicy:!1,translations:["reports","invoice"],resolve:{user:["dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n){return r.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})}],center:["dwAlerts","state","centerService",function(e,r,t){return t.get(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],orderId:["$route",function(e){return e.current.params.orderId}],lazy:"lazyLoadReports"}}),e.when("/purchases/:purchaseId/view",{template:"<div ng-include=\"'invoice/invoice.tpl.html'\"></div>",controller:"InvoiceCtrl as vm",label:"Invoice",routeBranch:"purchases",reloadOnSearch:!1,translations:["reports","invoice"],resolve:{user:["dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n){return r.auth().then(function(){return r.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],center:["dwAlerts","state","centerService",function(e,r,t){return t.get(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],orderId:["$route",function(e){return e.current.params.purchaseId}],back:["state",function(e){return function(){return e.resetParams(),e.setPath("/purchases")}}],preventOrderUserMismatch:["$route","$q","routeHelper","state","helper","purchaseService",function(e,r,t,n,i,s){return t.auth().then(function(){return t.selectUser().then(function(){return s.query(n.getCurrentCenterId(),n.getCurrentUserId()).catch(function(e){return dwAlerts.error(e,"Failed to query purchases.")}).then(function(t){if(!i.findByKeyValue(t,"id",e.current.params.purchaseId))return n.resetParams(),n.setPath("/purchases"),r.reject()})})})}],lazy:"lazyLoadReports"}}),e.when("/generate-invoice",{template:"<div ng-include=\"'invoice/invoice.tpl.html'\"></div>",controller:"InvoiceCtrl as vm",label:"Generate Invoice",routeBranch:"generate-invoice",reloadOnSearch:!1,translations:["reports","invoice"],resolve:{user:["dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n){return r.auth().then(function(){return r.selectUser().then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],center:["dwAlerts","state","centerService",function(e,r,t){return t.get(r.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get center.")})}],orderId:function(){},lazy:"lazyLoadReports"}}),e.when("/member-statement",{template:"<div ng-include=\"'member-statement/member-statement.tpl.html'\"></div>",controller:"MemberStatementCtrl as vm",label:"Member Statement",routeBranch:"member-statement",reloadOnSearch:!1,translations:["reports","member-statement"],resolve:{user:["routeHelper","dwAlerts","state","userProfileService",function(e,r,t,n){return e.auth().then(function(){return e.selectUser()}).then(function(){return n.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(e){return r.error(e,"Failed to get user profile,")})})}],lazy:"lazyLoadReports"}}),e.when("/mailbox-report",{template:"<div ng-include=\"'mailbox-report/mailbox-report.tpl.html'\"></div>",controller:"MailboxReportCtrl as vm",label:"Mailbox Report",routeBranch:"mailbox-report",reloadOnSearch:!1,translations:["reports","mailbox-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/membership-report",{template:"<div ng-include=\"'membership-report/membership-report.tpl.html'\"></div>",controller:"MembershipReportCtrl as vm",label:"Membership Report",routeBranch:"membership-report",reloadOnSearch:!1,translations:["reports","membership-report","user-search"],resolve:{auth:["routeHelper",function(e){return e.auth()}],fields:["dwAlerts","UserField",function(e,r){return r.query().catch(function(r){return e.error(r,"Failed to query user fields.")})}],lazy:"lazyLoadReports"}}),e.when("/deposit-transaction-report",{template:"<div ng-include=\"'deposit-transaction-report/deposit-transaction-report.tpl.html'\"></div>",controller:"DepositTransactionReportCtrl as vm",label:"Deposit Transaction Report",routeBranch:"deposit-transaction-report",reloadOnSearch:!1,translations:["reports","deposit-transaction-report"],resolve:{banks:["routeHelper","dwAlerts","bankService",function(e,r,t){return e.auth().then(function(){return t.query().catch(function(e){return r.error(e,"Failed to query banks.")})})}],centers:["routeHelper","dwAlerts","centerService",function(e,r,t){return e.auth().then(function(){return t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")})})}],lazy:"lazyLoadReports"}}),e.when("/income-by-item-report",{template:"<div ng-include=\"'income-by-item-report/income-by-item-report.tpl.html'\"></div>",controller:"IncomeByItemReportCtrl as vm",label:"Income By Item Report",routeBranch:"income-by-item-report",reloadOnSearch:!1,translations:["reports","income-by-item-report"],resolve:{settings:["routeHelper","dwAlerts","setupService",function(e,r,t){return e.auth().then(function(){return t.getSetupSettings().catch(function(e){return r.error(e,"Failed to get setup settings.")})})}],lazy:"lazyLoadReports"}}),e.when("/income-report",{template:"<div ng-include=\"'income-report/income-report.tpl.html'\"></div>",controller:"IncomeReportCtrl as vm",label:"Income Report",routeBranch:"income-report",reloadOnSearch:!1,translations:["reports","income-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/accounts-receivable-report",{template:"<div ng-include=\"'accounts-receivable-report/accounts-receivable-report.tpl.html'\"></div>",controller:"AccountsReceivableReportCtrl as vm",label:"Accounts Receivable Report",routeBranch:"accounts-receivable-report",reloadOnSearch:!1,translations:["reports","accounts-receivable-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/credit-balance-report",{template:"<div ng-include=\"'credit-balance-report/credit-balance-report.tpl.html'\"></div>",controller:"CreditBalanceReportCtrl as vm",label:"Credit Balance Report",routeBranch:"credit-balance-report",reloadOnSearch:!1,translations:["reports","credit-balance-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/recurring-billing-report",{template:"<div ng-include=\"'recurring-billing-report/recurring-billing-report.tpl.html'\"></div>",controller:"RecurringBillingReportCtrl as vm",label:"Recurring Billings Report",routeBranch:"recurring-billing-report",reloadOnSearch:!1,translations:["reports","recurring-billings-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/reservation-report",{template:"<div ng-include=\"'reservation-report/reservation-report.tpl.html'\"></div>",controller:"ReservationReportCtrl as vm",label:"Reservation Report",routeBranch:"reservation-report",reloadOnSearch:!1,translations:["reports","reservation-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/security-deposit-report",{template:"<div ng-include=\"'security-deposit-report/security-deposit-report.tpl.html'\"></div>",controller:"SecurityDepositReportCtrl as vm",label:"Security Deposit Report",routeBranch:"security-deposit-report",reloadOnSearch:!1,translations:["reports","security-deposit-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/availability-report",{template:"<div ng-include=\"'availability-report/availability-report.tpl.html'\"></div>",controller:"AvailabilityReportCtrl as vm",label:"Availability Report",routeBranch:"availability-report",reloadOnSearch:!1,translations:["reports","availability-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/member-usage-report",{template:"<div ng-include=\"'member-usage-report/member-usage-report.tpl.html'\"></div>",controller:"MemberUsageReportCtrl as vm",label:"Member Usage Report",routeBranch:"member-usage-report",reloadOnSearch:!1,translations:["reports","member-usage-report"],resolve:{auth:["routeHelper",function(e){return e.auth().then(function(){return e.selectUser()})}],lazy:"lazyLoadReports"}}),e.when("/revenue-forecast-report",{template:"<div ng-include=\"'revenue-forecast-report/revenue-forecast-report.tpl.html'\"></div>",controller:"RevenueForecastReportCtrl as vm",label:"Revenue Forecast Report",routeBranch:"revenue-forecast-report",reloadOnSearch:!1,translations:["reports","revenue-forecast-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/reservation-usage-report",{template:"<div ng-include=\"'reservation-usage-report/reservation-usage-report.tpl.html'\"></div>",controller:"ReservationUsageReportCtrl as vm",label:"Reservation Usage Report",routeBranch:"reservation-usage-report",reloadOnSearch:!1,translations:["reports","reservation-usage-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/pass-usage-report",{template:"<div ng-include=\"'pass-usage-report/pass-usage-report.tpl.html'\"></div>",controller:"PassUsageReportCtrl as vm",label:"Pass Usage Report",routeBranch:"pass-usage-report",reloadOnSearch:!1,translations:["reports","pass-usage-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}}),e.when("/space-utilization-report",{template:"<div ng-include=\"'space-utilization-report/space-utilization-report.tpl.html'\"></div>",controller:"SpaceUtilizationReportCtrl as $ctrl",label:"Space Utilization Report",routeBranch:"space-utilization-report",reloadOnSearch:!1,translations:["reports","reservation-units","space-utilization-report"],resolve:{auth:["routeHelper",function(e){return e.auth()}],lazy:"lazyLoadReports"}})}]).factory("lazyLoadReports",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("reports").catch(function(e){return r.error(e||"Failed to load reports module.")})}]),angular.module("deskworks.setup",["ngRoute","oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts","deskworks.setup.service","deskworks.bank.service","deskworks.center.service","deskworks.allowedHost.service","deskworks.Task","deskworks.Admin","deskworks.Owner","deskworks.Region","deskworks.UserField"]).config(["$routeProvider",function(e){"use strict";e.when("/setup/settings",{template:"<div ng-include=\"'settings/settings.tpl.html'\"></div>",controller:"SetupSettingsCtrl as vm",label:"Setup Settings",routeBranch:"setup/settings",translations:["setup-settings"],resolve:{settings:["dwAlerts","setupService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})})}],locales:["dwAlerts","setupService",function(e,r){return r.queryLocales().catch(function(r){return e.error(r,"Failed to query locales.")})}],lazy:"lazyLoadSetup"}}),e.when("/setup/printer-usage-settings",{template:"<div ng-include=\"'printer-usage-settings/printer-usage-settings.tpl.html'\"></div>",controller:"PrinterUsageSettingsCtrl as $ctrl",label:"Printer Usage Settings",routeBranch:"setup/printer-usage-settings",translations:["printer-usage-settings"],resolve:{settings:["dwAlerts","setupService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getPrinterUsageSettings(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get printer usage settings.")})})}],lazy:"lazyLoadSetup"}}),e.when("/setup/bar-upload-settings",{template:"<div ng-include=\"'bar-upload-settings/bar-upload-settings.tpl.html'\"></div>",controller:"BarUploadSettingsCtrl as vm",label:"Bar Upload Settings",routeBranch:"setup/bar-upload-settings",translations:["bar-upload-settings"],resolve:{settings:["dwAlerts","setupService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getBarUploadSettings(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to get bar upload settings.")})})}],lazy:"lazyLoadSetup"}}),e.when("/banks",{template:"<div ng-include=\"'banks/banks.tpl.html'\"></div>",controller:"SetupBanksCtrl as $ctrl",label:"Banks",routeBranch:"banks",translations:["banks"],resolve:{banks:["dwAlerts","bankService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query banks.")})})}],lazy:"lazyLoadSetup"}}),e.when("/banks/:bankId",{template:"<div ng-include=\"'banks/bank-edit.tpl.html'\"></div>",controller:"SetupBankEditCtrl as $ctrl",label:"Bank Edit",routeBranch:"banks",translations:["banks"],resolve:{bank:["$route","dwAlerts","bankService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(e.current.params.bankId).catch(function(e){return r.error(e,"Failed to get bank.")})})}],lazy:"lazyLoadSetup"}}),e.when("/centers",{template:"<div ng-include=\"'center/center-list.tpl.html'\"></div>",controller:"CenterListCtrl as vm",label:"Centers",translations:["centers"],routeBranch:"centers",resolve:{centers:["dwAlerts","centerService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.getCenters().catch(function(r){return e.error(r,"Failed to query centers.")})})}],admin:["dwAlerts","Admin","routeHelper","state",function(e,r,t,n){return t.auth().then(function(){if(n.isLoggedAdmin())return r.get(n.getLoggedUserId()).catch(function(r){return e.error(r,"Failed to get admin.")})})}],lazy:"lazyLoadSetup"}}),e.when("/centers/:centerId",{template:"<div ng-include=\"'center/center-edit.tpl.html'\"></div>",controller:"CenterEditCtrl as vm",label:"Edit",routeBranch:"centers",translations:["centers","reservation-rules"],resolve:{center:["$route","dwAlerts","centerService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}],lazy:"lazyLoadSetup"}}),e.when("/system-emails",{template:"<div ng-include=\"'system-email/system-email-list.tpl.html'\"></div>",controller:"SystemEmailListCtrl as $ctrl",label:"System Emails",routeBranch:"system-emails",translations:["system-emails"],resolve:{systemEmails:["dwAlerts","systemService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.getSystemEmails().catch(function(r){return e.error(r,"Failed to query system emails.")})})}],lazy:"lazyLoadSetup"}}),e.when("/system-emails/:systemEmailId",{template:"<div ng-include=\"'system-email/system-email-edit.tpl.html'\"></div>",controller:"SystemEmailEditCtrl as $ctrl",label:"Edit",routeBranch:"system-emails",translations:["system-emails"],resolve:{systemEmail:["$route","dwAlerts","systemService","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.getSystemEmail(e.current.params.systemEmailId).catch(function(e){return r.error(e,"Failed to get system email.")})})}],lazy:"lazyLoadSetup"}}),e.when("/tasks",{template:"<div ng-include=\"'task/task-list.tpl.html'\"></div>",controller:"TaskListCtrl as $ctrl",label:"Tasks",routeBranch:"tasks",translations:["tasks"],resolve:{tasks:["dwAlerts","Task","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query tasks.")})})}],lazy:"lazyLoadSetup"}}),e.when("/tasks/:taskId",{template:"<div ng-include=\"'task/task-edit.tpl.html'\"></div>",controller:"TaskEditCtrl as $ctrl",label:"Edit",routeBranch:"tasks",translations:["tasks"],resolve:{task:["$route","dwAlerts","Task","state","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return t.get(e.current.params.taskId).catch(function(e){return r.error(e,"Failed to get task.")})})}],lazy:"lazyLoadSetup"}}),e.when("/setup/api-settings",{template:"<div ng-include=\"'api-settings/api-settings.tpl.html'\"></div>",controller:"ApiSettingsCtrl as $ctrl",label:"API Settings",routeBranch:"setup/api-settings",translations:["api-settings"],resolve:{allowedHosts:["dwAlerts","allowedHostService","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query allowed hosts.")})})}],lazy:"lazyLoadSetup"}}),e.when("/owners-regions",{template:"<div ng-include=\"'owners-regions/owners-regions.tpl.html'\"></div>",controller:"OwnersRegionsCtrl as $ctrl",label:"Owners & Regions",routeBranch:"owners-regions",translations:["owners-regions"],resolve:{owners:["dwAlerts","Owner","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query owners.")})})}],regions:["dwAlerts","Region","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query regions.")})})}],lazy:"lazyLoadSetup"}}),e.when("/user-fields",{template:"<div ng-include=\"'user-fields/user-fields.tpl.html'\"></div>",controller:"UserFieldsCtrl as $ctrl",label:"User Profile Fields",routeBranch:"user-fields",translations:["user-fields"],resolve:{userFields:["dwAlerts","UserField","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query user fields.")})})}],lazy:"lazyLoadSetup"}}),e.when("/integrations-setup",{template:"<div ng-include=\"'integrations-setup/integrations-setup.tpl.html'\"></div>",controller:"IntegrationsSetupCtrl as $ctrl",label:"Integrations Setup",routeBranch:"integrations-setup",translations:["integrations-setup"],resolve:{lazy1:"lazyLoadSetup",lazy2:"lazyLoadAppointmentPlus",lazy3:"lazyLoadQuickBooks"}})}]).factory("lazyLoadSetup",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("setup").catch(function(e){return r.error(e,"Failed to load setup module.")})}]).factory("lazyLoadAppointmentPlus",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("appointment-plus").catch(function(){return[]})}]).factory("lazyLoadQuickBooks",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("quick-books").catch(function(){return[]})}]),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").catch(function(e){console.log("SW registration failed: ",e)})}),angular.module("deskworks.system",["ngRoute","oc.lazyLoad","deskworks.routeHelper","deskworks.dwAlerts","deskworks.accessCard.service","deskworks.system.service","deskworks.Admin"]).config(["$routeProvider",function(e){"use strict";e.when("/access-cards",{template:"<div ng-include=\"'access-card/access-card-list.tpl.html'\"></div>",controller:"AccessCardListCtrl as vm",label:"Access Cards",routeBranch:"access-cards",translations:["access-cards"],resolve:{accessCards:["dwAlerts","AccessCard","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.query({centerId:t.getCurrentCenterId()}).$promise.catch(function(r){return e.error(r,"Failed to query access cards.")})})}],lazy:"lazyLoadSystem"}}),e.when("/access-cards/:accessCardId",{template:"<div ng-include=\"'access-card/access-card-edit.tpl.html'\"></div>",controller:"AccessCardEditCtrl as vm",label:"Edit",routeBranch:"access-cards",translations:["access-cards"],resolve:{accessCard:["$route","dwAlerts","AccessCard","state","helper","routeHelper",function(e,r,t,n,i,s){return s.auth().then(function(){return t.query({centerId:n.getCurrentCenterId()}).$promise.catch(function(e){return r.error(e,"Failed to query access cards.")}).then(function(r){return i.findByKeyValue(r,"id",e.current.params.accessCardId)})})}],user:["dwAlerts","state","userProfileService",function(e,r,t){return t.get(r.getCurrentCenterId(),r.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})}],lazy:"lazyLoadSystem"}}),e.when("/administrators",{template:"<div ng-include=\"'administrator/administrator-list.tpl.html'\"></div>",controller:"AdministratorListCtrl as $ctrl",label:"Administrators",routeBranch:"administrators",translations:["administrators"],resolve:{admins:["dwAlerts","Admin","routeHelper",function(e,r,t){return t.auth().then(function(){return r.query().catch(function(r){return e.error(r,"Failed to query administrators.")})})}],lazy:"lazyLoadSystem"}}),e.when("/administrators/:adminId",{template:"<div ng-include=\"'administrator/administrator-edit.tpl.html'\"></div>",controller:"AdminEditCtrl as $ctrl",label:"Edit",routeBranch:"administrators",translations:["administrators","user-profile"],resolve:{admin:["$route","dwAlerts","Admin","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.get(e.current.params.adminId).catch(function(e){return r.error(e,"Failed to get administrator.")})})}],userProfile:["$route","state","dwAlerts","userProfileService","routeHelper",function(e,r,t,n,i){return i.auth().then(function(){return n.get(r.getCurrentCenterId(),e.current.params.adminId).catch(function(e){return t.error(e,"Failed to get administrator user profile.")})})}],lazy:"lazyLoadSystem"}}),e.when("/lead-sources",{template:"<div ng-include=\"'lead-source/lead-source-list.tpl.html'\"></div>",controller:"LeadSourceListCtrl as vm",label:"Lead Sources",routeBranch:"lead-sources",translations:["lead-sources"],resolve:{leadSources:["dwAlerts","systemService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return r.getLeadSources().catch(function(r){return e.error(r,"Failed to query lead sources.")})})}],lazy:"lazyLoadSystem"}})}]).factory("lazyLoadSystem",["$ocLazyLoad","dwAlerts",function(e,r){"use strict";return e.load("system").catch(function(e){return r.error(e||"Failed to load system module.")})}]),angular.module("deskworks.billing",["deskworks.billing.purchase.list","deskworks.billing.purchase.edit","deskworks.billing.recurringCharge.list","deskworks.billing.recurringCharge.edit"]),angular.module("deskworks.buyPass.selectPass",["ngRoute","deskworks.helper"]).controller("BuyPassSelectPassCtrl",["$scope","$translate","state","helper","passes",function(e,r,t,n,i){"use strict";var s=this;t.setPageTitle(r.instant("BUY_PASS.SELECT_PASS.PAGE_TITLE")),s.passes=i,s.pass=n.findByKeyValue(s.passes,"id",t.getParam("pass")),s.next=function(){if(!n.pointFirstInvalid("#selectPass"))return t.setPath(t.getPath()+"/user")},s.onPassChange=function(){t.replace(),t.setParam("pass",s.pass.id)}}]),angular.module("deskworks.buyPass.signIn",["flexForms","deskworks.state","deskworks.config","deskworks.dwSignIn"]).controller("BuyPassSignInCtrl",["$scope","$translate","state",function(e,r,t){"use strict";t.setPageTitle(r.instant("SIGN_IN.PAGE_TITLE")),e.$on("dwSignIn:SignIn",function(e){e.stopPropagation(),t.replace(),t.setPath(t.getPath()+"/"+t.getLoggedUserId())}),e.$on("dwSignIn:SignUp",function(e){e.stopPropagation(),t.setPath(t.getPath()+"/new")})}]),angular.module("deskworks.buyPass.userProfile",["ngRoute","deskworks.userProfile.service","deskworks.helper"]).controller("BuyPassUserProfileCtrl",["$scope","$timeout","$q","$route","$translate","helper","state","dwAlerts","userProfile","reg","userProfileService","setupService","purchaseService",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;p.reg=c,p.userProfile=l,p.schema=l.schema,o.setPageTitle(i.instant(p.reg.new?"USER_PROFILE.NEW_MEMBER.PAGE_TITLE":"USER_PROFILE.PAGE_TITLE",{userName:p.userProfile.firstName+" "+p.userProfile.lastName})),d.getSetupSettings().catch(function(e){return a.error(e,"Failed to get settings.")}).then(function(e){p.settings=e}),u.bindTestUserGenerator(e,p.userProfile,p.reg),p.next=function(){if(!s.pointFirstInvalid("#userProfile"))return t.when(p.reg.new&&u.registerNewUser(0,p.userProfile)).then(function(){if(p.reg.new)return o.login(p.userProfile.login,p.userProfile.password).catch(function(e){return a.error(e,"Failed to log in with created user.")})}).then(function(){return f.createPurchase(o.getCurrentCenterId(),p.userProfile.id,void 0,o.getParam("pass")).catch(function(e){return a.error(e,"Failed to create purchase.")}).finally(function(){p.reg.new&&(o.replace(),n.updateParams({userId:p.userProfile.id}))})}).then(function(e){return r(function(){return o.setPath(o.getPath()+"/purchase/"+e.id)})})},p.back=o.back}]),angular.module("deskworks.buyPass.purchase",["ngRoute","deskworks.helper","deskworks.purchase.service"]).controller("BuyPassPurchaseCtrl",["$scope","$route","$translate","dwAlerts","helper","state","center","purchase","purchaseService",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;s.setPageTitle(t.instant("BUY_PASS.PURCHASE.PAGE_TITLE")),c.center=o,c.purchase=a,c.next=function(){return s.setPath(s.getPath()+"/billing")},c.staffHelp=function(){return l.createStaffHelp(c.center.id,r.current.params.userId,c.purchase.id).catch(function(e){return n.error(e,"Failed to create staff help.")}).then(function(e){return s.setParam("notice",e.notice),s.setPath(s.getPath()+"/staff-help")})}}]),angular.module("deskworks.buyPass.staffHelp",["ngRoute","deskworks.helper","deskworks.config"]).controller("BuyPassStaffHelpCtrl",["$scope","$timeout","$window","$translate","dwAlerts","helper","state",function(e,r,t,n,i,s,o){"use strict";o.setPageTitle(n.instant("SIMPLE_RES.STAFF_HELP.PAGE_TITLE")),this.notice=o.getParam("notice"),e.$on("$routeChangeStart",function(e,r,t){var s=r.$$route&&r.$$route.controller;"BuyPassPurchaseCtrl"!==s&&"BuyPassBillingCtrl"!==s||(i.error(n.instant("SIMPLE_RES.STAFF_HELP.BACK_ERROR")),e.preventDefault())}),this.home=function(){return t.location.href=o.getParam("redirect"),r(1e4)}}]),angular.module("deskworks.buyPass.billing",["ngRoute","deskworks.userProfile.service","deskworks.purchase.service","deskworks.routeHelper","deskworks.helper"]).controller("BuyPassBillingCtrl",["$scope","$route","$timeout","$window","$translate","dwAlerts","helper","state","settings","userProfile","reg","userProfileService","purchaseService",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;if(p.userProfile=c,p.reg=u,p.settings=l,a.setPageTitle(i.instant("BILLING_PROFILE.PAGE_TITLE",{userName:p.userProfile.firstName+" "+p.userProfile.lastName})),l.creditCardTypes=l.creditCardTypes.filter(function(e){return e.enable}),p.userProfile.creditCards.forEach(function(e){e.type=o.findByKeyValue(l.creditCardTypes,"id",e.type)||e.type||{}}),p.userProfile.creditCards=p.userProfile.creditCards||[],!p.userProfile.creditCards.length){var m=d.creditCard.new(p.userProfile);m.type=l.creditCardTypes[0],p.userProfile.creditCards.push(m)}d.bindTestBillingGenerator(e,p.userProfile,p.reg),p.next=function(){if(!o.pointFirstInvalid("#simpleReservationBilling")){var l=a.prohibitBack(["BuyPassPurchaseCtrl"],i.instant("SIMPLE_RES.BILLING.BACK_ERROR"),e);return d.saveBillingProfile(a.getCurrentCenterId(),p.userProfile).then(function(){return f.createPayment(a.getCurrentCenterId(),r.current.params.userId,r.current.params.purchaseId,{},void 0,a.getParam("pass")).then(function(e){return n.location.href=a.getParam("redirect")+"&accessCode="+e.accessCode,t(15e3)}).catch(function(e){return s.error(e,"Failed to make payment.")})}).catch(l)}},p.staffHelp=function(){return f.createStaffHelp(a.getCurrentCenterId(),r.current.params.userId,r.current.params.purchaseId).catch(function(e){return s.error(e,"Failed to create staff help.")}).then(function(e){return a.setParam("notice",e.notice),a.setPath(a.getPath().replace(/\/billing$/,"/staff-help"))})},p.back=a.back}]),angular.module("deskworks.buyPass",["forbidStaff","deskworks.PassProduct.service","deskworks.buyPass.selectPass","deskworks.buyPass.signIn","deskworks.buyPass.userProfile","deskworks.buyPass.purchase","deskworks.buyPass.staffHelp","deskworks.buyPass.billing","deskworks.setup.service"]).config(["$routeProvider",function(e){"use strict";var r="/buy-pass/user";e.when("/buy-pass",{template:"<forbid-staff><div><ng-include src=\"'buy-pass/01-select-pass.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassSelectPassCtrl as $ctrl",label:"Buy A Pass",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,reloadOnSearch:!1,translations:["buy-pass"],resolve:{reg:function(){return{step:1,stepCount:4}},passes:["state","dwAlerts","PassProduct",function(e,r,t){return e.getCurrentCenterId()?t.query(e.getCurrentCenterId()).catch(function(e){return r.error(e,"Failed to query passes.")}):r.error(null,"Center is not selected.")}]}}),e.when("/buy-pass/user",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/simple-reservation-sign-in.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassSignInCtrl as vm",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,translations:["sign-in"],resolve:{redirect:["$q","state",function(e,r){if(r.getLoggedUserId())return r.setPath(r.getPath()+"/"+r.getLoggedUserId(),!0),e.reject()}]}}),e.when("/buy-pass/user/:userId",{template:"<forbid-staff><div><ng-include src=\"'members/user-profile/user-profile.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassUserProfileCtrl as vm",label:"Profile",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,translations:["user-profile"],resolve:{reg:["$route",function(e){return{step:2,stepCount:4,member:!1,selfRegistration:!0,new:"new"===e.current.params.userId}}],userProfile:["$route","helper","state","routeHelper","dwAlerts","userProfileService","centerService",function(e,t,n,i,s,o,a){return"new"===e.current.params.userId?a.get(n.getCurrentCenterId()).then(function(e){return o.new(e,"nonMember","signUp").catch(function(e){return s.error(e,"Failed to get new user profile template.")})}):i.auth(r).then(function(){return o.getForRegistration(n.getCurrentCenterId(),e.current.params.userId,"nonMember","signUp").catch(function(e){return s.error(e,"Failed to get user profile.")})})}]}}),e.when("/buy-pass/user/:userId/purchase/:purchaseId",{template:"<forbid-staff><div><ng-include src=\"'buy-pass/04-purchase.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassPurchaseCtrl",controllerAs:"$ctrl",label:"Purchase",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,translations:["buy-pass","purchase"],resolve:{reg:["state",function(e){return{member:!1,selfRegistration:!0,step:3,stepCount:4}}],center:["state","dwAlerts","centerService",function(e,r,t){return t.get(e.getCurrentCenterId()).catch(function(e){return r.error(e,"Failed to get center.")})}],purchase:["$route","dwAlerts","state","routeHelper","purchaseService",function(e,t,n,i,s){return i.auth(r).then(function(){return s.get(n.getCurrentCenterId(),e.current.params.userId,e.current.params.purchaseId).catch(function(e){return t.error(e,"Failed to get purchase.")})})}]}}),e.when("/buy-pass/user/:userId/purchase/:purchaseId/staff-help",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/staff-help.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassStaffHelpCtrl as vm",label:"Staff Help",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{auth:["routeHelper",function(e){return e.auth(r)}]}}),e.when("/buy-pass/user/:userId/purchase/:purchaseId/billing",{template:"<forbid-staff><div><ng-include src=\"'simple-reservation/09-billing/billing.tpl.html'\"></ng-include></div></forbid-staff>",controller:"BuyPassBillingCtrl",controllerAs:"vm",label:"Billing",routeBranch:"buy-pass",hideSidebar:!0,userTasksPolicy:!1,translations:["billing-profile","user-profile","simple-reservation"],resolve:{reg:["state",function(e){return{member:!1,selfRegistration:!0,step:4,stepCount:4}}],userProfile:["$route","dwAlerts","state","routeHelper","userProfileService",function(e,t,n,i,s){return i.auth(r).then(function(){return s.get(n.getCurrentCenterId(),e.current.params.userId).catch(function(e){return t.error(e,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}})}]),angular.module("deskworks.checkIn",["deskworks.center.service","deskworks.checkIn.service","deskworks.checkIn.kbwAccessCard"]).config(["$routeProvider",function(e){"use strict";e.when("/check-in",{templateUrl:"check-in/check-in.tpl.html",controller:"CheckInCtrl",controllerAs:"vm",hideSidebar:!0,userTasksPolicy:!1,landing:!0,resolve:{center:["$rootScope","state","helper","centerService",function(e,r,t,n){return n.getCenters().then(function(e){return t.findByKeyValue(e,"id",r.getCurrentCenterId())||e[0]||{}},function(r){return e.showError(r,"Failed to load centers list.")})}]}})}]).controller("CheckInCtrl",["$scope","$q","state","helper","center","checkInService",function(e,r,t,n,i,s){"use strict";var o=this;t.setPageTitle("Check-In"),o.center=i,o.auth=function(e){if(!o.busy){if(delete o.error,n.pointFirstInvalid("#checkIn"))return;return o.accessCardNumber||o.login||o.password?(o.busy=!0,(e?s.checkOut(o.center.id,o):s.checkIn(o.center.id,o)).then(function(){o.countdown=3},function(r){o.error=r.data.error||(e?"Failed to check out.":"Failed to check in.")}).finally(function(){o.busy=!1})):void(o.error="Please use access number or login/password")}},o.init=function(){delete o.accessCardNumber,delete o.login,delete o.password,delete o.error,delete o.countdown},e.$on("kbw::accessCard",function(e,r){e.stopPropagation(),o.busy||(o.accessCardNumber=r,delete o.login,delete o.password,delete o.error,delete o.countdown,o.auth())}),o.signUpNonMember=function(){return t.setCurrentCenterId(o.center.id),t.setParam("origin","/check-in"),t.setParam("skip-steps",1),t.setPath("/simple-reservation/centers/"+o.center.id+"/types")},o.signUpMember=function(){return t.setCurrentCenterId(o.center.id),t.setParam("origin","/check-in"),t.setPath("/member-sign-up")}}]),angular.module("deskworks.checkIn.kbwAccessCard",[]).directive("kbwAccessCard",["$timeout",function(e){"use strict";var r,t,n="PACS"+String.fromCharCode(186),i=0;return{restrict:"EAC",scope:!0,compile:function(s,o){return function(s,o,a,l,c){function u(o){16!==o.which&&(e.cancel(t),t=e(function(){r=null,i=0},1e3),angular.isString(r)?13===o.which?(s.$emit("kbw::accessCard",r),s.$apply(),r=null):r+=String.fromCharCode(o.which):String.fromCharCode(o.which)===n.charAt(i)?++i===n.length&&(r="",i=0):i=0)}document.addEventListener("keydown",u),s.$on("$destroy",function(){document.removeEventListener("keydown",u)})}}}}]),angular.module("deskworks.components",["deskworks.dwControls","deskworks.dwSelectCenter","deskworks.dwSelectUser","deskworks.dwAddress","deskworks.dwCreditCard","deskworks.dwDateTime","deskworks.dwInvoice","deskworks.resClock","deskworks.dwAlerts","swiper","deskworks.dwCheckInWidget","deskworks.dwManualCheckInWidget","deskworks.dwSelectProfileWidget","deskworks.niceTime","scrollbarSize","deskworks.membershipFilter","deskworks.formDesign.fdField"]),angular.module("deskworks.accessCodeOfTheDay",["deskworks.routeHelper","deskworks.notifications.service"]).config(["$routeProvider",function(e){"use strict";e.when("/access-code-of-the-day",{templateUrl:"dashboard/access-code-of-the-day.tpl.html",controller:"AccessCodeOfTheDayCtrl as $ctrl",label:"Access Code Of The Day",routeBranch:"access-code-of-the-day",translations:["dashboard"],userTasksPolicy:!1,hideSidebar:!0,hideFooter:!0,resolve:{}})}]).controller("AccessCodeOfTheDayCtrl",["$scope","$translate","$interval","$q","state","dwAlerts","dashboardService","Notifications",function(e,r,t,n,i,s,o,a){"use strict";var l=this;i.setPageTitle(r.instant("DASHBOARD.ADMIN.ACCESS_CODE.HEADER")),l.fetch=function(){return t.cancel(l.timer),l.fetching=!0,n.all({stats:o.getCenterStats(i.getCurrentCenterId()).catch(function(e){return s.error(e,"Failed to get center stats.")}),tpl:a.getDeskTabletTemplate(i.getCurrentCenterId()).catch(function(e){return s.error(e,"Failed to get desk tablet template.")})}).then(function(e){l.accessCode=e.stats.accessCode,l.tpl=e.tpl,l.tpl.body=l.tpl.body.replace(/{{access-code}}/g,l.accessCode)}).finally(function(){l.fetching=!1,t.cancel(l.timer),l.timer=t(l.fetch,3e5)})},l.fetch(),l.$onDestroy=function(){t.cancel(l.timer)}}]),angular.module("deskworks.dashboard.admin",["NATS","deskworks.routeHelper","flexForms","deskworks.dashboard.dashWidget","deskworks.dashboard.user","deskworks.dashboard.dashAdminReservations","deskworks.dashboard.dashAdminAccessCode","deskworks.dashboard.dashAdminBilling","deskworks.dashboard.dashAdminUsersCheckedIn","deskworks.dashboard.dashAdminReservationConflicts","deskworks.dashboard.dashAdminSelfRegistrations","deskworks.dashboard.service","deskworks.Admin","deskworks.dashboard.dashMobileApp"]).config(["$routeProvider",function(e){"use strict";e.when("/dashboard-admin",{templateUrl:"dashboard/dashboard-admin.tpl.html",controller:"DashboardAdminCtrl as vm",label:"Dashboard",routeBranch:"dashboard",translations:["dashboard"],resolve:{admin:["$q","dwAlerts","routeHelper","state","userProfileService","Admin",function(e,r,t,n,i,s){return t.auth().then(function(){return e.all([i.get(n.getCurrentCenterId(),n.getLoggedUserId()).catch(function(e){return r.error(e,"Failed to get admin profile.")}),s.get(n.getLoggedUserId()).catch(function(e){return r.error(e,"Failed to get admin.")})]).then(function(e){return angular.extend(e[1],e[2])})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}})}]).controller("DashboardAdminCtrl",["$scope","$filter","$timeout","$translate","state","helper","admin","dwAlerts","settings","dashboardService","userProfileService","NATS",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f=this;f.settings=l,f.nats=d.connect(),f.nats.on("error",function(e){console.warn("NATS error:",e)}),e.$on("$destroy",function(){f.nats.close()});var p=n.instant("DASHBOARD.ADMIN.PAGE_TITLE",{userName:o.firstName+" "+o.lastName});i.setPageTitle(p),i.isUserSelected()&&u.get(i.getCurrentCenterId(),i.getCurrentUserId()).catch(function(e){return a.error(e,"Failed to get user profile.")}).then(function(e){f.user=e}),f.hideAll="all"!==(s.findByKeyValue(o.centers,"id",i.getCurrentCenterId())||{}).permission,f.hideAll||c.getCenterStats(i.getCurrentCenterId()).catch(function(e){return a.error(e,"Failed to get center stats.")}).then(function(r){f.centerStats=r,t(function(){e.$broadcast("dwWidget:SpinStop")})})}]),angular.module("deskworks.dashboard.user",["NATS","deskworks.routeHelper","flexForms","deskworks.dashboard.dashWidget","deskworks.dashboard.upcomingReservations","deskworks.dashboard.dashGeneral","deskworks.dashboard.recurringCharges","deskworks.dashboard.dashOutstandingCharges","deskworks.dashboard.dashMembersCheckedIn","deskworks.dashboard.dashMessageBoard"]).config(["$routeProvider",function(e){"use strict";e.when("/dashboard",{templateUrl:"dashboard/dashboard-user.tpl.html",controller:"DashboardUserCtrl",controllerAs:"vm",label:"Dashboard",routeBranch:"dashboard",translations:["dashboard"],resolve:{user:["$q","dwAlerts","routeHelper","state","userProfileService",function(e,r,t,n,i){return t.auth().then(function(){return n.isLoggedAdmin()?(n.setPath("/dashboard-admin",!0),e.reject()):i.get(n.getCurrentCenterId(),n.getCurrentUserId()).catch(function(e){return r.error(e,"Failed to get user profile.")})})}],userLogged:["dwAlerts","state","routeHelper","userProfileService",function(e,r,t,n){return t.auth(null).then(function(){return n.get(r.getCurrentCenterId(),r.getLoggedUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}})}]).controller("DashboardUserCtrl",["$scope","$translate","state","helper","user","userLogged","settings","NATS",function(e,r,t,n,i,s,o,a){"use strict";var l=this;l.user=i,l.userLogged=s,l.settings=o;var c=t.isMasterProfile()&&l.user.company?l.user.company:l.user.firstName+" "+l.user.lastName,u=r.instant("DASHBOARD.USER.PAGE_TITLE",{userName:c});t.setPageTitle(u),l.nats=a.connect(),l.nats.on("error",function(e){console.warn("NATS error:",e)}),e.$on("$destroy",function(){l.nats.close()}),l.canSeeAccountingInfo=function(){return!t.isMasterProfile()||(n.findByKeyValue(l.userLogged.masterMembers,"id",l.user.id)||{}).canSeeAccountingInfo}}]),angular.module("deskworks.dashboard",["deskworks.dashboard.user","deskworks.dashboard.admin","deskworks.accessCodeOfTheDay"]),angular.module("flexForms.ffRowHead",[]).directive("ffRowHead",function(){"use strict";return{restrict:"E",scope:!1,compile:function(e,r){e.addClass("ff-row");var t=e.parent();return t[0]&&"ff-two-columns"===t[0].tagName.toLowerCase()&&1===t[0].querySelectorAll("ff-row-head").length&&e.after(e.clone()),function(){}}}}),angular.module("flexForms.ffRow",[]).directive("ffRow",function(){return{restrict:"E",scope:!0,compile:function(e,r){return e.addClass("ff-row"),this.link},link:function(e,r,t){t.ffClick&&angular.element(r[0].getElementsByTagName("ff-static")).on("click",function(){e.$apply(t.ffClick)})}}}),angular.module("flexForms.flexFormTitle",[]).directive("flexFormTitle",["$compile","ffHelper",function(e,r){"use strict";return{restrict:"EAC",transclude:"element",compile:function(e,r){return function(e,r,t,n,i){i(function(e,t){for(var n,i=0,s=r[0].parentNode;i<5&&s.parentNode&&!(n=s.querySelector(".panel-heading"));i++,s=s.parentNode);angular.element(n).append(angular.element('<div class="panel-title"></div>').append(e))})}}}}]),angular.module("flexForms.flexForm",[]).directive("flexForm",["ffHelper",function(e){return{restrict:"E",compile:function(e,r){var t='<div class="panel-heading">'+(r.ffLabel?'<div class="panel-title">'+r.ffLabel+(r.ffLabelAddon?r.ffLabelAddon:"")+"</div>":"")+(r.ffLabelExt?'<div class="panel-title">'+r.ffLabelExt+"</div>":"")+'</div><div class="panel-body">'+e.html()+"</div>";return e.addClass("panel panel-default flex-form"),e.html(t),function(e,r,t){}}}}]),angular.module("flexForms",["flexForms.flexForm","flexForms.flexFormTitle","flexForms.flex","flexForms.ffRow","flexForms.ffRowHead","flexForms.ffLabel","flexForms.ffStatic","flexForms.ffText","flexForms.ffUrl","flexForms.ffLogin","flexForms.ffPassword","flexForms.ffEmail","flexForms.ffTime","flexForms.ffDate","flexForms.ffDatepicker","flexForms.ffDatepickerPopup","flexForms.ffNumber","flexForms.ffPrice","flexForms.ffSelect","flexForms.ffTextarea","flexForms.ffCheckbox","flexForms.ffRadio","flexForms.ffBtn","flexForms.ffBtnGroup","flexForms.ngValidateAlert","flexForms.ffSpin","flexForms.ffDim","flexForms.ffImg","flexForms.ffRichtext","flexForms.ffSearch","flexForms.validation.ngTimeOrder","flexForms.validation.ngDateOrder","flexForms.validation.ngDateDiff","flexForms.validation.ngUnique","flexForms.validation.ngLte","flexForms.validation.ngLt","flexForms.validation.ngGte","flexForms.validation.ngGt","flexForms.validation.ngMatch","flexForms.validation.ngNotContain","flexForms.ngCollapse","flexForms.ffPagination","flexForms.ffIcon","flexForms.ffInfo","flexForms.ffSection","flexForms.ffTip","flexForms.ffHint","flexForms.ffCountdown","flexForms.ffTabs","flexForms.ffIncludeAll","flexForms.ffSort","flexForms.ffCcNumber","flexForms.ffBulkReadOnly"]).factory("ffHelper",function(){"use strict";return{copyInnerAttrs:function(e,r,t){for(var n in r.$attr)0===r.$attr[n].indexOf("ff-")&&"ff-countdown"!==r.$attr[n]&&t.attr("ng-"+r.$attr[n].substr(3),r[n]);return r.name&&(t.attr("name",r.name),r.$set("name",null)),t.attr("minlength",r.minlength),r.$set("minlength",null),t.attr("maxlength",r.maxlength),r.$set("maxlength",null),t.attr("placeholder",r.placeholder),r.$set("placeholder",null),t.attr("ff-countdown",r.ffCountdown),r.$set("ffCountdown",null),t.attr("ta-toolbar",r.taToolbar),r.$set("taToolbar",null),t},isMobile:function(){if(navigator.userAgent&&(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)))return!0}}}),angular.module("flexForms.flex",[]).directive("flex",function(){"use strict";return{link:function(e,r,t){t.$observe("flex",function(e){r.css("-webkit-flex",t.flex),r.css("-ms-flex",t.flex),r.css("-moz-flex",t.flex),r.css("flex",t.flex)})},restrict:"A"}}),angular.module("deskworks.members",["deskworks.members.userProfile","deskworks.members.billingProfile.edit","deskworks.UsageEntryListCtrl","deskworks.UsageEntryEditCtrl","deskworks.MemberUsageCtrl","deskworks.members.userSearch","deskworks.members.checkInLog.list","deskworks.ManualCheckInLogCtrl","deskworks.OurMembersCtrl"]),angular.module("deskworks.reservationCalendar",["deskworks.rcCalendar","deskworks.resReservation","deskworks.center.service","deskworks.ReservationPrice.service","deskworks.state","deskworks.routeHelper","deskworks.calendarService"]).config(["$routeProvider",function(e){"use strict";e.when("/reservation-calendar",{template:'<rc-calendar cal-data="$resolve.calData" settings="$resolve.settings" ff-bulk-read-only></rc-calendar>',label:"Reservation Calendar",routeBranch:"reservation-calendar",reloadOnSearch:!1,translations:["reservations"],resolve:{calData:["$q","$filter","state","helper","routeHelper","dwAlerts","calendarService","rcHelper","resolveTimezone",function(e,r,t,n,i,s,o,a,l){return e.all([i.auth(),l()]).then(function(){var e=r("toDate")(t.getParam("date"),"Z");return e=moment.isMoment(e)?e:moment(),o.query(t.getCurrentCenterId(),a.weekStart(e),a.weekEnd(e),t.getParam("role")).catch(function(e){return s.error(e,"Failed to fetch calendar data.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/new-reservation",{template:'<res-reservation center="$resolve.center" user="$resolve.user" cal-data="$resolve.calData" reservation-prices="$resolve.reservationPrices" ff-bulk-read-only></res-reservation>',label:"New Reservation",routeBranch:"new-reservation",reloadOnSearch:!1,translations:["reservations"],resolve:{user:["$q","userProfileService","state","dwAlerts","routeHelper","resolveTimezone",function(e,r,t,n,i,s){return e.all([i.auth(),s()]).then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(e){return n.error(e,"Failed to get user profile.")})})}],center:["state","dwAlerts","centerService","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.get(e.getCurrentCenterId()).catch(function(e){return r.error(e,"Failed to get center.")})})}],calData:["$q","$filter","state","helper","dwAlerts","calendarService","routeHelper","resolveTimezone",function(e,r,t,n,i,s,o,a){return e.all([o.auth(),a()]).then(function(){var e=r("toDate")(t.getParam("date"),"Z");return e=moment.isMoment(e)?e:moment(),s.query(t.getCurrentCenterId(),e,e,t.getParam("role")).catch(function(e){return i.error(e,"Failed to fetch calendar data.")})})}],reservationPrices:["state","dwAlerts","ReservationPrice","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.query({centerId:e.getCurrentCenterId(),userId:e.getCurrentUserId()}).$promise.catch(function(e){return r.error(e,"Failed to query reservation prices.")})})}]}}),e.when("/edit-reservation/:reservationId",{template:'<res-reservation center="$resolve.center" user="$resolve.user" cal-data="$resolve.calData" reservation-prices="$resolve.reservationPrices" ff-bulk-read-only></res-reservation>',label:"Edit Reservation",routeBranch:"reservation-calendar",reloadOnSearch:!1,translations:["reservations"],resolve:{user:["$q","userProfileService","state","dwAlerts","routeHelper","resolveTimezone",function(e,r,t,n,i,s){return e.all([i.auth(),s()]).then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(e){return n.error(e,"Failed to get user profile.")})})}],center:["state","dwAlerts","centerService","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.get(e.getCurrentCenterId()).catch(function(e){return r.error(e,"Failed to get center.")})})}],calData:["$q","$filter","state","helper","dwAlerts","calendarService","routeHelper","resolveTimezone",function(e,r,t,n,i,s,o,a){return e.all([o.auth(),a()]).then(function(){var e=r("toDate")(t.getParam("date"),"Z");return e=moment.isMoment(e)?e:moment(),s.query(t.getCurrentCenterId(),e,e,t.getParam("role")).catch(function(e){return i.error(e,"Failed to fetch calendar data.")})})}],reservationPrices:["state","dwAlerts","ReservationPrice","routeHelper",function(e,r,t,n){return n.auth().then(function(){return t.query({centerId:e.getCurrentCenterId(),userId:e.getCurrentUserId()}).$promise.catch(function(e){return r.error(e,"Failed to query reservation prices.")})})}]}})}]),angular.module("deskworks.reservations",["deskworks.userReservations"]),angular.module("deskworks.userReservations",["deskworks.reservationUnit.service","deskworks.reservationService","deskworks.routeHelper","flexForms"]).config(["$routeProvider",function(e){"use strict";e.when("/reservations",{templateUrl:"reservations/user-reservations.tpl.html",controller:"UserReservationsCtrl as $ctrl",label:"Reservations",routeBranch:"reservations",translations:["user-reservations"],resolve:{reservationUnits:["dwAlerts","routeHelper","state","reservationUnitService",function(e,r,t,n){return r.auth().then(function(){return n.getReservationUnits(t.getCurrentCenterId()).catch(function(r){return e.error(r,"Failed to query reservation units.")})})}],user:["dwAlerts","userProfileService","state","routeHelper",function(e,r,t,n){return n.auth().then(function(){return n.selectUser().then(function(){return r.get(t.getCurrentCenterId(),t.getCurrentUserId()).catch(function(r){return e.error(r,"Failed to get user profile.")})})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}})}]).controller("UserReservationsCtrl",["$scope","$filter","$route","$translate","$timeout","dwAlerts","reservationService","reservationUnitService","reservationUnits","user","state","helper","settings",function(e,r,t,n,i,s,o,a,l,c,u,d,f){"use strict";var p=this;u.setPageTitle(n.instant("USER_RESERVATIONS.PAGE_TITLE",{userName:c.firstName+" "+c.lastName})),p.optsFilter=[{id:"all",name:n.instant("USER_RESERVATIONS.FILTER.ALL")},{id:"upcoming",name:n.instant("USER_RESERVATIONS.FILTER.UPCOMING")},{id:"past",name:n.instant("USER_RESERVATIONS.FILTER.PAST")}],p.filter=p.optsFilter[0].id,p.settings=f,p.reservations=[],p.params={centerId:u.getCurrentCenterId(),userId:u.getCurrentUserId(),offset:0,limit:50},p.fetch=function(){if(p.eof||p.fetching)return p.fetching;p.fetching=o.query(p.params).catch(function(e){return s.error(e,"Failed to query reservations.")}).finally(function(){p.fetching=null}).then(function(e){e.forEach(function(e){e.resCategoryName=d.findByKeyValue(l,"id",e.reservationUnitId),e.resCategoryName&&(e.resCategoryName=e.resCategoryName.reservationTypeName)}),p.reservations=p.reservations.concat(e),p.params.offset=p.reservations.length,p.eof=e.length<p.params.limit})},p.onFilter=function(){p.reservations=[],p.params.offset=0,p.eof=!1,p.params.from="upcoming"===p.filter?moment():null,p.params.to="past"===p.filter?moment():null,p.fetch()},e.$watch("$ctrl.editingReservation.from",function(e,r){moment.isMoment(e)&&moment.isMoment(r)&&(e.date()===r.date()&&e.month()===r.month()&&e.year()===r.year()||(p.editingReservation.to=moment([e.year(),e.month(),e.date(),p.editingReservation.to.hour()||e.hour(),p.editingReservation.to.minute()||e.minute(),0,0])))}),p.saveReservation=function(){if(p.editingReservation&&!d.pointFirstInvalid(".reservations-edit")){var e={id:p.editingReservation.id,from:p.editingReservation.from,to:p.editingReservation.to,reservationNote:p.editingReservation.reservationNote};return o.save(u.getCurrentCenterId(),u.getCurrentUserId(),e).catch(function(e){return s.error(e,"Failed to update reservation.")}).then(function(){delete p.editingReservation,p.onFilter()})}},p.editReservation=function(e){p.editingReservation=angular.copy(e)},p.back=function(){delete p.editingReservation},p.cancelReservation=function(e){if(confirm(n.instant("USER_RESERVATIONS.CONFIRM_DELETE")))return o.delete(u.getCurrentCenterId(),u.getCurrentUserId(),e.id).catch(function(e){return s.error(e,"Failed to cancel reservation.")}).then(function(){var r=d.findIndexByKeyValue(p.reservations,"id",e.id);p.reservations.splice(r,1)})},p.newReservation=function(){return u.setPath("/new-reservation")}}]),angular.module("deskworks.checkIn.service",["ngResource","deskworks.config"]).factory("checkInService",["$resource","deskworksConfig","helper",function(e,r,t){"use strict";var n=e(r.getApiAbsUrl("/centers/:centerId/check-in")),i=e(r.getApiAbsUrl("/centers/:centerId/check-out"));return{checkIn:function(e,r){var t={accessCardNumber:r.accessCardNumber||void 0,login:r.login||void 0,password:r.password||void 0};return n.save({centerId:e},t).$promise},checkOut:function(e,r){var t={accessCardNumber:r.accessCardNumber||void 0,login:r.login||void 0,password:r.password||void 0};return i.save({centerId:e},t).$promise}}}]),angular.module("deskworks.dashboard.service",["ngResource","deskworks.config","deskworks.helper","datesDeserializer"]).service("dashboardService",["$resource","deskworksConfig","helper","datesDeserializer",function(e,r,t,n){"use strict";var i=n(["reservationsToday.startTime","reservationsToday.endTime","reservationsToday.updatedAt","reservationsTomorrow.startTime","reservationsTomorrow.endTime","reservationsTomorrow.updatedAt","reservationsConflicts.startTime","reservationsConflicts.endTime"]),s=e(r.getApiAbsUrl("/dashboard/center-stats"),{},{get:{method:"GET",isArray:!1,transformResponse:[angular.fromJson,i]},update:{method:"PUT"}}),o=e(r.getApiAbsUrl("/dashboard/reservations-conflicts/:conflictId"),{},{update:{method:"PUT"}});this.getCenterStats=function(e){return s.get({centerId:e}).$promise},this.resetReservationConflict=function(e){return o.delete({conflictId:e}).$promise}}]),angular.module("deskworks.config",[]).provider("deskworksConfig",function(){"use strict";var e="",r="",t="/dashboard",n=null,i=null,s="https://sites.satellitedeskworks.com/";return{setApiUrl:function(r){e=r},setApiPostfix:function(e){r=e},getDefaultRoute:function(){return t},setDefaultRoute:function(e){t=e},setWsUrl:function(e){n=e},setSiteId:function(e){i=e},setSitesUrl:function(e){s=e},$get:["$window",function(o){return{getApiDomain:function(){var r=e.match(/^(.*:)\/\/([A-Za-z0-9\-\.]+)(:[0-9]+)?(.*)$/i);return r&&r[2]?r[2]:o.location.hostname},getSiteId:function(){if(i)return i;var e=this.getApiDomain().split(".");if(!(e=e[e.length-3]))throw new Error("configuration issue: siteId is undefined");return e},getApiAbsUrl:function(t){return e+t+r},getDefaultRoute:function(){return t},getWsUrl:function(){return n},getSitesUrl:function(){return s}}}]}}),angular.module("deskworks.ManualCheckIn",["ngResource","deskworks.config"]).factory("ManualCheckIn",["$resource","deskworksConfig",function(e,r){"use strict";var t=e(r.getApiAbsUrl("/centers/:centerId/user-profiles/:userId/manual-check-ins/:recurringId"),{},{query:{method:"GET",isArray:!0},update:{method:"PUT"}});return{query:function(e,r){return t.query({centerId:e,userId:r}).$promise.then(function(e){return e.forEach(function(e){e.$$count=e.$$count||e.checkInCount||1}),e})},save:function(e,r,n,i){return t.update({centerId:e,userId:r,recurringId:n},i).$promise}}}]),angular.module("deskworks.notifications.service",["ngResource","deskworks.config","deskworks.helper"]).factory("Notifications",["$resource","deskworksConfig","helper",function(e,r,t){"use strict";var n=e(r.getApiAbsUrl("/email-templates/:id"),{},{update:{method:"PUT"}}),i=e(r.getApiAbsUrl("/setup/bulk-invoices")),s=e(r.getApiAbsUrl("/setup/recurring-invoices")),o=e(r.getApiAbsUrl("/setup/expired-card-emails")),a=e(r.getApiAbsUrl("/setup/declined-card-emails")),l=e(r.getApiAbsUrl("/setup/welcome-letters")),c=e(r.getApiAbsUrl("/setup/welcome-letters/123/attachments/:attachmentId")),u=e(r.getApiAbsUrl("/setup/reservation-confirmations")),d=e(r.getApiAbsUrl("/setup/reservation-confirmations/123/attachments/:attachmentId")),f=e(r.getApiAbsUrl("/setup/reservation-reminders")),p=e(r.getApiAbsUrl("/setup/reservation-reminders/123/attachments/:attachmentId")),m=e(r.getApiAbsUrl("/setup/calendar-sync-error-emails")),h=e(r.getApiAbsUrl("/setup/passes-used-up-emails")),g=e(r.getApiAbsUrl("/email-templates/renewal-notice")),v=e(r.getApiAbsUrl("/centers/:centerId/desk-tablet-template"),{},{update:{method:"PUT"}});return{getEmailTemplate:function(e){return n.get({id:e}).$promise},saveEmailTemplate:function(e,r){return n.update({id:e},r).$promise},getBulkInvoices:function(){return i.get({}).$promise},saveBulkInvoices:function(e){return i.save({},e).$promise},getRecurringInvoices:function(){return s.get({}).$promise},saveRecurringInvoices:function(e){return s.save({},e).$promise},getExpiredCardEmail:function(){return o.get({}).$promise},saveExpiredCardEmail:function(e){return o.save({},e).$promise},getDeclinedCardEmail:function(){return a.get({}).$promise},saveDeclinedCardEmail:function(e){return a.save({},e).$promise},getWelcomeLetter:function(){return l.get({}).$promise},saveWelcomeLetter:function(e){return l.save({},e).$promise},attachWelcomeLetter:function(e){return c.save({},e).$promise},detachWelcomeLetter:function(e){return c.delete({attachmentId:e}).$promise},getCalSyncErrorEmail:function(){return m.get({}).$promise},saveCalSyncErrorEmail:function(e){return m.save({},e).$promise},getPassesUsedUpEmail:function(){return h.get({}).$promise},savePassesUsedUpEmail:function(e){return h.save({},e).$promise},getRenewalNoticeEmail:function(){return g.get({}).$promise},saveRenewalNoticeEmail:function(e){return g.save({},e).$promise},getReservationConfirmation:function(){return u.get({}).$promise},saveReservationConfirmation:function(e){return u.save({},e).$promise},attachReservationConfirmation:function(e){return d.save({},e).$promise},detachReservationConfirmation:function(e){return d.delete({attachmentId:e}).$promise},getReservationReminder:function(){return f.get({}).$promise},saveReservationReminder:function(e){return f.save({},e).$promise},attachReservationReminder:function(e){return p.save({},e).$promise},detachReservationReminder:function(e){return p.delete({attachmentId:e}).$promise},getDeskTabletTemplate:function(e){return v.get({centerId:e}).$promise},saveDeskTabletTemplate:function(e,r){return v.update({centerId:e},r).$promise}}}]),angular.module("deskworks.UserTasks.service",["ngResource","autoCacheFactory","deskworks.config","deskworks.state","deskworks.sidebarTasks.service"]).factory("UserTasks",["$resource","autoCacheFactory","deskworksConfig","state","sidebarTasks",function(e,r,t,n,i){"use strict";var s=r("user-tasks",120),o=e(t.getApiAbsUrl("/centers/:centerId/user-tasks"),{},{query:{method:"GET",cache:s,isArray:!0}});return{query:function(e,r){return o.query({centerId:e,userId:r||void 0}).$promise.then(function(e){return(r=e)?(r.forEach(function(e){e.open=!1,e.tasks.forEach(function(e){if(e.url&&e.url.match(/^https?:\/\//i))return e.url.indexOf("{{target:self}}")>=0?e.target="_self":(e.target="_blank",e.rel="noopener"),e.url=e.url.replace("{{target:self}}",""),void(e.directUrl=a(e.url));e.url=i.indexOf(e.url)>=0?"/"+e.url:null})}),r):r;var r})},interpolateTaskUrl:a,tasks:[]};function a(e){var r=[],t=e.split("?");return(t=t[t.length-1])?(t.split("&").forEach(function(e){var t;"{{center}}"===(e=e.split("="))[1]&&n.getCurrentCenterId()?t=n.getCurrentCenterId():"{{user}}"===e[1]&&n.isLoggedAdmin()&&n.getCurrentUserId()!==n.getLoggedUserId()&&(t=n.getCurrentUserId()),t&&r.push(e[0]+"="+encodeURIComponent(t))}),r.length?(r=r.join("&"),(t=e.split("?"))[t.length-1]=r,t.join("?")):e):e}}]),angular.module("deskworks.sidebarTasks.service",[]).factory("sidebarTasks",function(){"use strict";return["widget-check-in","widget-manual-check-in","profile","new-member","new-user","usage-entry","member-usage","our-members","member-log","manual-check-in-log","new-reservation","simple-reservation","reservation-calendar","reservations","equipment-reservation","billing-profiles","purchases","recurring-charges","member-statement","generate-invoice","bulk-invoicing","bulk-charges","printer-usage","bar-uploads","membership-report","recurring-billing-report","income-report","income-by-item-report","accounts-receivable-report","deposit-transaction-report","credit-balance-report","reservation-report","mailbox-report","security-deposit-report","availability-report","member-usage-report","revenue-forecast-report","reservation-usage-report","pass-usage-report","space-utilization-report","pricelists","products","membership-types","reservation-types","reservation-units","product-categories","email-all-members","email-site-members","message-board","splash-page","tasks","system-emails","access-cards","centers","administrators","lead-sources","setup/bulk-invoices","setup/recurring-invoices","setup/expired-card-email","setup/declined-card-email","setup/welcome-letter","setup/reservation-confirmation","setup/reservation-reminder","setup/cal-sync-error-email","setup/passes-used-up-email","notifications/receipt-email","setup/renewal-notice-email","setup/settings","setup/api-settings","setup/printer-usage-settings","setup/bar-upload-settings","setup/import","banks","owners-regions","user-fields","integrations-setup","desk-tablet-template"]}),angular.module("deskworks.sidebar",["deskworks.UserTasks.service","deskworks.centerSelector","deskworks.whitelabel","deskworks.signInLink","flexForms.ngCollapse","deskworks.sidebarTasks.service","deskworks.setup.service"]).directive("sidebar",function(){return{restrict:"E",scope:!0,templateUrl:"sidebar/sidebar.tpl.html",controller:"SidebarCtrl as $ctrl"}}).controller("SidebarCtrl",["$scope","$rootScope","$element","$route","$timeout","state","helper","whitelabel","routeHelper","UserTasks","setupService",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;function f(){return s.isLoggedAdmin()||(d.tasks=[],c.tasks=[]),i(function(){if(s.getLoggedUserId()&&s.getCurrentCenterId())return c.query(s.getCurrentCenterId(),s.isMasterProfile()&&s.getCurrentUserId()).then(function(e){d.tasks=e,c.tasks=[],d.tasks.forEach(function(e){c.tasks=c.tasks.concat(e.tasks)}),p()})})}function p(){var e;if(d.currentTask&&d.tasks&&d.tasks.length)return d.tasks.forEach(function(r){r.active=!!o.findByKeyValue(r.tasks,"url",d.currentTask),r.active&&(e=!0,r.open=!0,i(function(){r.open=!0}))}),e||"/dashboard"===d.currentTask||"/sign-in"===d.currentTask||"/sign-out"===d.currentTask}function m(e){e.reduce(function(e,r){return r?e+1:e},0)&&r.$emit("SIDEBAR:ACCORD-COLLAPSED")}function h(){angular.forEach(d.tasks,function(e){angular.forEach(e.tasks,function(e){e.directUrl&&(e.directUrl=c.interpolateTaskUrl(e.url))})})}function g(){d.offLogin=r.$on("LOGIN",f),d.offLogout=r.$on("LOGOUT",f),d.offRefresh=r.$on("SIDEBAR:REFRESH",f),d.offCenter=r.$on("CHANGE-CENTER",f),d.offCollapseAll=r.$on("SIDEBAR:ACCORD-COLLAPSE-ALL",function(){angular.forEach(d.tasks,function(e){e.open=!1})}),d.offChangeUser=r.$on("CHANGE-USER",function(){s.isLoggedAdmin()||f()})}d.$onInit=function(){d.getWhitelabelTemplate=a.getSidebarTemplate,d.state=s,u.getSetupSettings().then(function(e){d.settings=e,e.homepageUrl&&a.setHomepageUrl(e.homepageUrl)}),d.offRouteStart=r.$on("$routeChangeStart",function(e,r){r.$$route&&(d.pendingTask="/"+r.$$route.routeBranch)}),d.offRouteSuccess=r.$on("$routeChangeSuccess",function(){d.currentTask=d.pendingTask,d.pendingTask=null,e.$app.dim=!1}),d.offRouteError=r.$on("$routeChangeError",function(){d.pendingTask=null,e.$app.dim=!1}),l.auth(null).finally(function(){f().finally(g)}).catch(angular.noop),e.$watch("$ctrl.currentTask",p),e.$watchGroup(["$ctrl.tasks",s.getCurrentCenterId,s.getCurrentUserId],h),e.$watchCollection(function(){return d.tasks?d.tasks.map(function(e){return e.open}):[]},m)},d.$onDestroy=function(){d.offRouteStart(),d.offRouteSuccess(),d.offRouteError(),function(){d.offLogin&&d.offLogin();d.offLogout&&d.offLogout();d.offRefresh&&d.offRefresh();d.offCenter&&d.offCenter();d.offCollapseAll&&d.offCollapseAll();d.offChangeUser&&d.offChangeUser()}()},d.$postLink=function(){t.addClass("sidebar")},d.toggleGroup=function(e){var r=e.open;d.tasks.forEach(function(e){e.open=!1}),e.open=!r},d.navigate=function(r,t){t.directUrl||(r.preventDefault(),r.stopPropagation(),t.dashboard&&(t.url=s.isLoggedAdmin()?"/dashboard-admin":"/dashboard"),t.url&&(t.url===s.getPath()?(n.reload(),e.$app.dim=!0):(s.resetParams(),s.setPath(t.url),e.$app.dim=!0)))}}]),angular.module("deskworks.signInLink",["deskworks.state"]).directive("signInLink",["state",function(e){return{template:'<a ng-href="{{state.getLoggedUserId() ? \'#/sign-out\' : \'#/sign-in\'}}" ng-click="signInOrOut($event)" ff-spin="spin" snap-close class="sidebar-item" ng-class="{ active: active }"><span ng-if="!state.getLoggedUserId()" translate="SIDEBAR.SIGN_IN"></span><span ng-if="state.getLoggedUserId()" translate="SIDEBAR.SIGN_OUT"></span></a>',restrict:"E",scope:!0,link:function(r,t,n){r.state=e,n.$observe("active",function(e){r.active="true"===e}),r.signInOrOut=function(r){r.stopPropagation(),r.preventDefault(),e.resetParams(),e.setPath(e.getLoggedUserId()?"/sign-out":"/sign-in")}}}}]),angular.module("deskworks.dwSignIn",["deskworks.helper","deskworks.state","ngStorage","deskworks.userProfile.service"]).directive("dwSignIn",function(){"use strict";return{restrict:"EAC",scope:!0,templateUrl:"sign-in/dw-sign-in.tpl.html",controller:"dwSignIn",controllerAs:"dwSignIn",bindToController:{showSignUp:"="},compile:function(e,r){return function(e,r,t,n,i){}}}}).controller("dwSignIn",["$scope","$element","$attrs","$q","$timeout","$localStorage","$translate","helper","state","userProfileService","session",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";var d=this;d.rememberMe=!angular.isDefined(s.rememberMe)||s.rememberMe,d.signIn=function(){return d.error=null,d.success=null,d.info=o.instant("SIGN_IN.SIGNING_IN"),l.login(d.login,d.password,d.rememberMe).then(function(r){return d.info=o.instant("SIGN_IN.SUCCESS"),s.rememberMe=d.rememberMe,e.$emit("dwSignIn:SignIn"),i(5e3)}).catch(function(e){return d.info=null,d.error=e.data&&e.data.error||o.instant("SIGN_IN.INVALID_LOGIN_PASSWORD"),n.reject(d.error)})},d.forgotPassword=function(e){d.error=null,d.info=null,d.success=null,d.restorePassword=e},d.sendPassword=function(){return d.error=null,d.info=o.instant("SIGN_IN.RESTORE_PASSWORD.SENDING"),c.restorePassword({email:d.email}).then(function(){d.info=null,d.success=o.instant("SIGN_IN.RESTORE_PASSWORD.SUCCESS"),d.restorePassword=!1}).catch(function(e){return d.info=null,d.error=e.data&&e.data.error||"Failed to restore password.",n.reject(d.error)})},d.signUp=function(){e.$emit("dwSignIn:SignUp")}}]),angular.module("deskworks.signIn",["ngRoute","ngStorage","flexForms","deskworks.state","deskworks.config","deskworks.dwSignIn","deskworks.isMultiSite"]).config(["$routeProvider",function(e){"use strict";var r;e.when("/sign-in",{templateUrl:"sign-in/sign-in.tpl.html",controller:"SignInCtrl",controllerAs:"vm",label:"Sign In",routeBranch:"sign-in",hideSidebar:!0,userTasksPolicy:!1,landing:!0,reloadOnSearch:!1,translations:["sign-in"]}),e.when("/sign-out",{routeBranch:"sign-out",hideSidebar:!0,userTasksPolicy:!1,landing:!0,resolve:{logout:["state","isMultiSite","deskworksConfig",function(e,t,n){return r=e.getParam("silent")||r,e.logout().finally(function(){if(!r)return t()?void(window.location=n.getSitesUrl()):e.setPath("/sign-in")})}]}})}]).controller("SignInCtrl",["$scope","$route","$location","$localStorage","$timeout","$translate","state","deskworksConfig","isMultiSite",function(e,r,t,n,i,s,o,a,l){"use strict";var c=this;function u(){return window.location=a.getSitesUrl(),i(5e3)}o.setPageTitle(s.instant("SIGN_IN.PAGE_TITLE")),e.$on("dwSignIn:SignIn",function(e){o.setPath(o.getParam("redirect")||a.getDefaultRoute(),!0),o.setParam("redirect"),e.stopPropagation()}),e.$watch(l,function(e){c.back=e?u:null})}]),angular.module("deskworks.SimpleReservationCompleteCtrl",[]).controller("SimpleReservationCompleteCtrl",["$scope","$q","$timeout","$translate","dwAlerts","state","helper","deskworksConfig","center","purchase","settings",function(e,r,t,n,i,s,o,a,l,c,u){"use strict";this.center=l,this.purchase=c,this.accessCode=s.getParam("accessCode"),this.settings=u,s.setPageTitle(n.instant("SIMPLE_RES.COMPLETE.PAGE_TITLE")),e.$on("$routeChangeStart",function(e,r,t){!r.$$route||"SimpleReservationConfirmCtrl"!==r.$$route.controller&&"SimpleReservationBillingCtrl"!==r.$$route.controller||(i.error(n.instant("SIMPLE_RES.COMPLETE.BACK_ERROR")),e.preventDefault())}),this.home=function(){var e=s.getParam("origin"),n=s.getCurrentCenterId();return(e?s.logout():r.when()).finally(function(){s.resetParams(),s.setPath(e||a.getDefaultRoute()),e&&s.setCurrentCenterId(n)}),t(1e4)}}]),angular.module("deskworks.SimpleReservationConfirmCtrl",["deskworks.center.service","deskworks.reservationCategory.service","deskworks.reservationService","deskworks.reservationUnit.optsRepeatFrequency"]).controller("SimpleReservationConfirmCtrl",["$scope","$route","$filter","$translate","dwAlerts","center","helper","state","reservationUnit","reservationCategoryService","reservationService","optsRepeatFrequency",function(e,r,t,n,i,s,o,a,l,c,u,d){"use strict";var f=this;a.setPageTitle(n.instant("RESERVATIONS.CONFIRM.PAGE_TITLE")),f.center=s,f.reservationUnit=l,f.date=t("toDate")(a.getParam("start")),f.timeStart=t("toDate")(a.getParam("start")),f.timeEnd=t("toDate")(a.getParam("end")),f.reservationNote=a.getParam("note")||"",f.emailConfirmation="true"===a.getParam("confirm"),f.repeatFrequencyOptions=d,f.repeatFrequency=f.repeatFrequencyOptions[0],a.getParam("freq")&&(f.repeatFrequency=o.findByKeyValue(f.repeatFrequencyOptions,"id",a.getParam("freq")),f.repeatFrequency&&f.repeatFrequency.repeatDurationOptions&&a.getParam("duration")-1<f.repeatFrequency.repeatDurationOptions.length&&(f.repeatDuration=+a.getParam("duration"))),f.back=a.back,f.next=function(){if(a.isLoggedMember()||a.isLoggedAdmin()){var e={centerId:f.center.id,reservationUnitId:f.reservationUnit.id,from:f.timeStart,to:f.timeEnd,reservationNote:f.reservationNote,emailConfirmation:!!f.emailConfirmation,repeatFrequency:f.repeatFrequency.id,repeatDuration:f.repeatDuration};return u.save(f.center.id,a.getCurrentUserId(),e).catch(function(e){return i.error(e,"Failed to make reservation.")}).then(function(e){return a.setParam("accessCode",e.accessCode||e.access_code),a.setPath("/simple-reservation/complete")})}}}]),angular.module("deskworks.SimpleReservationSignInCtrl",["flexForms","deskworks.state","deskworks.config","deskworks.dwSignIn"]).controller("SimpleReservationSignInCtrl",["$scope","$q","$location","$route","$translate","state",function(e,r,t,n,i,s){"use strict";s.setPageTitle(i.instant("SIGN_IN.PAGE_TITLE")),e.$on("dwSignIn:SignIn",function(e){e.stopPropagation(),s.replace(),s.isLoggedNonMember()?s.setPath(s.getPath()+"/"+s.getLoggedUserId()):s.setPath(s.getPath()+"/"+s.getLoggedUserId()+"/confirm")}),e.$on("dwSignIn:SignUp",function(e){e.stopPropagation(),s.setPath(s.getPath()+"/new")})}]),angular.module("deskworks.simpleReservation",["deskworks.SimpleReservationBillingCtrl","ngRoute","deskworks.center.service","deskworks.reservationUnit.service","deskworks.reservationCategory.service","deskworks.calendarService","deskworks.userProfile.service","deskworks.purchase.service","deskworks.setup.service","deskworks.SimpleReservationCentersCtrl","deskworks.SimpleReservationCategoriesCtrl","deskworks.SimpleReservationCategoryCtrl","deskworks.SimpleReservationDateCtrl","deskworks.SimpleReservationUnitsCtrl","deskworks.SimpleReservationTimeCtrl","deskworks.SimpleReservationSignInCtrl","deskworks.SimpleReservationUserProfileCtrl","deskworks.SimpleReservationConfirmCtrl","deskworks.SimpleReservationCompleteCtrl","deskworks.SimpleReservationPurchaseCtrl","deskworks.StaffHelpCtrl"]).config(["$routeProvider",function(e){"use strict";function r(e,r,t){return t.auth(r.interpolateRoute("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users",e.current.params))}e.when("/simple-reservation",{templateUrl:"simple-reservation/01-centers/centers.tpl.html",controller:"SimpleReservationCentersCtrl as vm",label:"New Reservation",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{centers:["$q","dwAlerts","centerService",function(e,r,t){return t.getCenters().catch(function(e){return r.error(e,"Failed to query centers.")}).then(function(e){return(e=e.filter(function(e){return e.reservationUnitsCount>0})).length?e:r.error("<b>No public centers.</b> At least one center needs <b>Center for Internal Use</b> setting <b>turned off.</b>")})}]}}),e.when("/simple-reservation/centers/:centerId/types",{templateUrl:"simple-reservation/02-reservation-categories/reservation-categories.tpl.html",controller:"SimpleReservationCategoriesCtrl as vm",label:{centers:"centerId"},routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation","reservations"],resolve:{reservationCategories:["$route","state","helper","dwAlerts","calendarService","resolveTimezone",function(e,r,t,n,i,s){return s().then(function(){return i.query(e.current.params.centerId,moment(),moment()).catch(function(e){return n.error(e,"Failed to query reservation categories.")})})}],center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId",{templateUrl:"simple-reservation/03-reservation-category/reservation-category.tpl.html",controller:"SimpleReservationCategoryCtrl as vm",label:{centers:"centerId",reservationTypes:"reservationTypeId"},routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{reservationCategory:["$q","$route","dwAlerts","reservationCategoryService",function(e,r,t,n){return n.get(r.current.params.centerId,r.current.params.reservationTypeId).catch(function(e){return t.error(e,"Failed to get reservation category.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates",{templateUrl:"simple-reservation/04-date/date.tpl.html",controller:"SimpleReservationDateCtrl as vm",label:"Select Date",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{unavailableDates:["$route","dwAlerts","reservationCategoryService",function(e,r,t){return t.getUnavailableDates(e.current.params.centerId,e.current.params.reservationTypeId).catch(function(e){return r.error(e,"Failed to query unavailable dates.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units",{templateUrl:"simple-reservation/05-reservation-units/reservation-units.tpl.html",controller:"SimpleReservationUnitsCtrl as vm",label:"Select Space",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation","reservations"],resolve:{resUnits:["$route","$filter","state","helper","dwAlerts","calendarService","resolveTimezone",function(e,r,t,n,i,s,o){return o().then(function(){var t=r("toDate")(e.current.params.date);return t=moment.isMoment(t)?t:moment(),s.query(e.current.params.centerId,t,t).catch(function(e){return i.error(e,"Failed to fetch calendar data.")}).then(function(r){return(n.findByKeyValue(r,"id",e.current.params.reservationTypeId)||{}).reservationUnits||[]})})}],center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId",{templateUrl:"simple-reservation/06-time/simple-reservation-time.tpl.html",controller:"SimpleReservationTimeCtrl as $ctrl",reloadOnSearch:!1,label:"Select Time",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation","reservations"],resolve:{center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}],calData:["$route","$filter","state","helper","dwAlerts","calendarService","resolveTimezone",function(e,r,t,n,i,s,o){return o().then(function(){var n=r("toDate")(e.current.params.date||t.getParam("date"));return n=moment.isMoment(n)?n:moment(),s.query(e.current.params.centerId,n,n,t.getParam("role")).catch(function(e){return i.error(e,"Failed to fetch calendar data.")})})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users",{templateUrl:"simple-reservation/simple-reservation-sign-in.tpl.html",controller:"SimpleReservationSignInCtrl as vm",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["sign-in"],resolve:{redirect:["$q","state",function(e,r){return r.isLoggedNonMember()?(r.setPath(r.getPath()+"/"+r.getLoggedUserId(),!0),e.reject()):r.getLoggedUserId()?(r.setPath(r.getPath()+"/"+r.getLoggedUserId()+"/confirm",!0),e.reject()):void 0}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId",{templateUrl:"members/user-profile/user-profile.tpl.html",controller:"SimpleReservationUserProfileCtrl as vm",label:"Profile",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["user-profile"],resolve:{reg:["$route",function(e){return{member:!1,selfRegistration:!0,new:"new"===e.current.params.userId}}],userProfile:["dwAlerts","$route","helper","state","routeHelper","userProfileService","centerService",function(e,t,n,i,s,o,a){return"new"===t.current.params.userId?a.get(t.current.params.centerId).then(function(r){return o.new(r,"nonMember","signUp").catch(function(r){return e.error(r,"Failed to get new member profile template.")})}):r(t,n,s).then(function(){return o.getForRegistration(t.current.params.centerId,t.current.params.userId,"nonMember","signUp").catch(function(r){return e.error(r,"Failed to get user profile.")})})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId/confirm",{templateUrl:"simple-reservation/confirm.tpl.html",controller:"SimpleReservationConfirmCtrl",controllerAs:"vm",label:"Confirm Reservation",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation","reservations"],resolve:{center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}],reservationUnit:["$route","dwAlerts","helper","routeHelper","reservationUnitService",function(e,t,n,i,s){return r(e,n,i).then(function(){return s.getReservationUnit(e.current.params.centerId,e.current.params.reservationTypeId,e.current.params.reservationUnitId,e.current.params.date).catch(function(e){return t.error(e,"Failed to get reservation unit.")})})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId/purchases/:purchaseId",{templateUrl:"simple-reservation/08-purchase/purchase.tpl.html",controller:"SimpleReservationPurchaseCtrl",controllerAs:"vm",label:"Purchase",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation","reservations","purchase"],resolve:{reg:function(){return{member:!1,selfRegistration:!0}},center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}],purchase:["$route","dwAlerts","helper","routeHelper","purchaseService",function(e,t,n,i,s){return r(e,n,i).then(function(){return s.get(e.current.params.centerId,e.current.params.userId,e.current.params.purchaseId).catch(function(e){return t.error(e,"Failed to get purchase.")})})}],reservationUnit:["$route","dwAlerts","reservationUnitService",function(e,r,t){return t.getReservationUnit(e.current.params.centerId,e.current.params.reservationTypeId,e.current.params.reservationUnitId,e.current.params.date).catch(function(e){return r.error(e,"Failed to get reservation unit.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId/purchases/:purchaseId/staff-help",{templateUrl:"simple-reservation/staff-help.tpl.html",controller:"StaffHelpCtrl",controllerAs:"vm",label:"Staff Help",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{user:["$route","helper","routeHelper",function(e,t,n){return r(e,t,n)}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId/purchases/:purchaseId/billing",{templateUrl:"simple-reservation/09-billing/billing.tpl.html",controller:"SimpleReservationBillingCtrl",controllerAs:"vm",label:"Billing",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["billing-profile","user-profile","simple-reservation"],resolve:{reg:function(){return{member:!1,selfRegistration:!0}},userProfile:["$q","$route","dwAlerts","helper","state","routeHelper","userProfileService",function(e,t,n,i,s,o,a){return r(t,i,o).then(function(){return a.get(t.current.params.centerId,t.current.params.userId).catch(function(e){return n.error(e,"Failed to get user profile.")})})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/simple-reservation/centers/:centerId/types/:reservationTypeId/dates/:date/units/:reservationUnitId/users/:userId/purchases/:purchaseId/billing/complete",{templateUrl:"simple-reservation/complete.tpl.html",controller:"SimpleReservationCompleteCtrl",label:"Complete",routeBranch:"new-reservation",controllerAs:"vm",hideSidebar:!0,translations:["simple-reservation","purchase"],userTasksPolicy:!1,resolve:{reg:function(){return{member:!1,selfRegistration:!0}},purchase:["$route","dwAlerts","state","helper","routeHelper","purchaseService",function(e,t,n,i,s,o){return r(e,i,s).then(function(){return o.get(e.current.params.centerId,e.current.params.userId,e.current.params.purchaseId).catch(function(e){return t.error(e,"Failed to get purchase.")})})}],center:["$route","dwAlerts","centerService",function(e,r,t){return t.get(e.current.params.centerId).catch(function(e){return r.error(e,"Failed to get center.")})}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}}),e.when("/simple-reservation/complete",{templateUrl:"simple-reservation/complete.tpl.html",controller:"SimpleReservationCompleteCtrl as vm",label:"Complete",routeBranch:"new-reservation",hideSidebar:!0,userTasksPolicy:!1,translations:["simple-reservation"],resolve:{purchase:function(){},center:function(){},auth:["$route","helper","routeHelper",function(e,t,n){return r(e,t,n)}],settings:["dwAlerts","setupService",function(e,r){return r.getSetupSettings().catch(function(r){return e.error(r,"Failed to get setup settings.")})}]}})}]),angular.module("deskworks.StaffHelpCtrl",["ngRoute","deskworks.helper","deskworks.config"]).controller("StaffHelpCtrl",["$scope","$timeout","$q","$route","$window","$translate","dwAlerts","helper","state","deskworksConfig",function(e,r,t,n,i,s,o,a,l,c){"use strict";this.notice=l.getParam("notice"),l.setPageTitle(s.instant("SIMPLE_RES.STAFF_HELP.PAGE_TITLE")),e.$on("$routeChangeStart",function(e,r,t){!r.$$route||"MemberSignUpBillingCtrl"!==r.$$route.controller&&"MemberSignUpPurchaseCtrl"!==r.$$route.controller&&"SimpleReservationBillingCtrl"!==r.$$route.controller&&"SimpleReservationPurchaseCtrl"!==r.$$route.controller||(o.error(s.instant("SIMPLE_RES.STAFF_HELP.BACK_ERROR")),e.preventDefault())}),this.home=function(){if(l.getParam("redirect"))i.location.href=l.getParam("redirect");else{var e=l.getParam("origin"),n=l.getCurrentCenterId();(e?l.logout():t.when()).finally(function(){return l.resetParams(),e&&l.setCurrentCenterId(n),l.setPath(e||c.getDefaultRoute())})}return r(1e4)}}]),angular.module("deskworks.whitelabel",[]).provider("whitelabel",function(){"use strict";var e=/\{\{currentYear}}/g,r=(new Date).getFullYear(),t='<a href="https://thesatellitecenters.com/" title="The Satellite Centers" target="_blank" rel="noopener">The Satellite Centers</a>',n='<a href="https://thesatellitecenters.com/" title="The Satellite Centers" target="_blank" rel="noopener">The Satellite Centers &copy; '+r+". All Rights Reserved<br>(888) 379-2865</a>",i='<a href="https://thesatellitecenters.com/" title="The Satellite Centers" target="_blank" rel="noopener">The Satellite Centers</a>',s='<a href="https://satellitedeskworks.com/#contacts" title="Contact Us" target="_blank" rel="noopener" class="sidebar-item"><span>Contact</span></a>',o='The Satellites <a href="https://thesatellitecenters.com/terms-of-service/" target="_blank" rel="noopener">Terms and Conditions</a>',a="Deskworks";return{setHeaderTemplate:function(e){return t=e,e},setHeaderTemplateMobile:function(e){return e,e},setHeaderTemplateDesktop:function(e){return t=e,e},setFooterTemplate:function(t){return n=t.replace(e,r),t},setFooterTemplateMobile:function(t){return t.replace(e,r),t},setFooterTemplateDesktop:function(t){return n=t.replace(e,r),t},setSidebarTemplate:function(e){return i=e,e},setSidebarTemplateMobile:function(e){return e,e},setSidebarTemplateDesktop:function(e){return i=e,e},setPageTitlePostfix:function(e){return a=e,e},setTermsAndConditionsTemplate:function(e){return o=e,e},setContactTemplate:function(e){return s=c(e)},$get:function(){return{getHeaderTemplate:function(){return t},getFooterTemplate:function(){return n},getSidebarTemplate:function(){return i},getPageTitlePostfix:function(){return a},getTermsAndConditionsTemplate:function(){return o},getContactTemplate:function(){return s},setContactTemplate:function(e){return s=c(e)},setHomepageUrl:function(e){t=l(t,e),n=l(n,e),i=l(i,e)}}}};function l(e,r){if(!e||!r)return e;var t=angular.element("<span>"+e+"</span>");return angular.forEach(t[0].querySelectorAll("a[href]"),function(e){e.href=r}),t.html()}function c(e){var r=angular.element(e);return r[0]&&"A"===r[0].tagName?(r.addClass("sidebar-item"),r.contents().wrap("<span></span>"),r[0].outerHTML):e}});