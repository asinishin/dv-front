(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"/qdO":function(e,t,n){"use strict";n.r(t);var a=n("YoJi");t.default=a.a},"2AQp":function(e,t,n){var a={"./reservation-calendar/index.js":"/qdO","./reservation-form/index.js":"yUci","./user-reservations/user-reservations.controller.js":"qNkH"};function r(e){var t=f(e);return n(t)}function f(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=f,e.exports=r,r.id="2AQp"},Khvr:function(e,t){e.exports='<div class=reservations-list ng-show=!$ctrl.editingReservation ff-bulk-read-only> <h4 class=page-title ng-bind=state.getPageTitle()></h4> <ff-panel> <ff-panel-header class=ff-read-only-ignore> <ff-row class=gutter-h-half> <label ng-repeat="opt in ::$ctrl.optsFilter" flex=none> <ff-radio ff-model=$ctrl.filter ff-value=::opt.id ff-label={{opt.name}} ff-change=$ctrl.onFilter() style=min-height:1rem></ff-radio> </label> </ff-row> </ff-panel-header> <ff-panel> <ff-panel-header> <ff-row> <cell flex="0 1 145px" class=ff-center><span translate=USER_RESERVATIONS.DATE></span></cell> <cell flex="1 1 150px"><span translate=USER_RESERVATIONS.SPACE></span></cell> <cell flex="0 1 145px" class=ff-center><span translate=USER_RESERVATIONS.TIME></span></cell> <cell flex="1 1 200px" class=show-sm><span translate=USER_RESERVATIONS.NOTES></span></cell> <cell flex="0 1 110px" ng-if=::$ctrl.settings.enableAccessCodes> <span translate=USER_RESERVATIONS.ACCESS_CODE></span> </cell> <cell flex="0 1 130px" class=show-md ng-if=::state.isLoggedAdmin()> <span translate=USER_RESERVATIONS.ADDED_BY></span> </cell> <cell flex="0 1 110px" class=show-md ng-if=::state.isLoggedAdmin()> <span translate=USER_RESERVATIONS.UPDATED_ON></span> </cell> </ff-row> </ff-panel-header> </ff-panel> <ff-col infinite-scroll=$ctrl.fetch() infinite-scroll-distance=2 infinite-scroll-container="\'.snap-content-scroller\'"> <ff-row ng-repeat="res in $ctrl.reservations"> <ff-static flex="0 1 145px" ff-bind="::res.from | date:\'weekDate\'" class=ff-right></ff-static> <ff-static flex="1 1 150px" ff-bind=::res.reservationUnitName></ff-static> <ff-static flex="0 1 145px" class=ff-center><span><span nice-time=::res.from></span> - <span nice-time=::res.to></span></span></ff-static> <ff-static flex="1 1 200px" class=show-sm ff-bind=::res.reservationNote></ff-static> <ff-static flex="0 1 110px" ff-bind="::res.accessCode | nd" ng-if=::$ctrl.settings.enableAccessCodes></ff-static> <ff-static flex="0 1 130px" class=show-md ff-bind=::res.addedBy ng-if=::state.isLoggedAdmin()></ff-static> <ff-static flex="0 1 110px" class=show-md ff-bind="::res.updatedAt | date:\'mediumDate\'" ng-if=::state.isLoggedAdmin()></ff-static> <ff-btn-group class=floating-toolbar> <ff-row> <ff-btn sense=edit size=xs class=ff-btn-icon ff-click=$ctrl.editReservation(res) title="{{\'GLOBAL.BTN_EDIT\' | translate}}" ng-if=::$ctrl.isEditable(res)></ff-btn> <ff-btn sense=delete size=xs class=ff-btn-icon ff-click=$ctrl.cancelReservation(res) title="{{\'GLOBAL.BTN_CANCEL\' | translate}}"></ff-btn> </ff-row> </ff-btn-group> </ff-row> <div class="ff-spin ff-spin-placeholder" ng-if=$ctrl.fetching></div> </ff-col> <ff-row ng-if="!$ctrl.reservations.length && !$ctrl.fetching" class=ff-no-frame> <ff-label>{{\'GLOBAL.NONE\' | translate}}</ff-label> </ff-row> </ff-panel> <ff-btn-group class=buttons-bottom> <ff-btn sense=new ff-click=$ctrl.newReservation()> <span translate=USER_RESERVATIONS.BTN_NEW></span> </ff-btn> </ff-btn-group> </div> <form name=formEditReservation class=reservations-edit ng-if=$ctrl.editingReservation ff-bulk-read-only> <h4 class=page-title>Edit Reservation</h4> <div class="ff-grid ff-gutter-v ff-gutter-h"> <ff-panel flex="{md: \'0 0 50%\'}"> <ff-panel-header>{{\'Center: \' + state.getCurrentCenter().name}}</ff-panel-header> <label class=ff-row> <ff-label flex="0 0 80px">Category</ff-label> <ff-static ff-bind=$ctrl.editingReservation.resCategoryName></ff-static> </label> <label class=ff-row> <ff-label flex="0 0 80px">Unit</ff-label> <ff-static ff-bind=$ctrl.editingReservation.reservationUnitName></ff-static> </label> <dw-date-time name=from ff-label="Start Time" ff-model=$ctrl.editingReservation.from label-flex="0 0 80px" ff-required=true ff-date-diff=23 ff-date-order="{ early: $ctrl.editingReservation.from, late: $ctrl.editingReservation.to }" ff-validate-alert="{ field: \'Start Date\', late: \'End Date\' }"> </dw-date-time> <dw-date-time name=to ff-label="End Time" ff-model=$ctrl.editingReservation.to label-flex="0 0 80px" ff-required=true ff-date-diff=23 ff-date-order="{ early: $ctrl.editingReservation.from, late: $ctrl.editingReservation.to }" ff-validate-alert="{ field: \'End Date\', early: \'Start Date\' }"> </dw-date-time> </ff-panel> <ff-panel flex="{md: \'0 0 50%\'}"> <ff-panel-header>Notes</ff-panel-header> <ff-row> <ff-textarea ff-model=$ctrl.editingReservation.reservationNote rowspan=4></ff-textarea> </ff-row> </ff-panel> </div> <ff-btn-group class=buttons-bottom> <ff-btn sense=save type=submit ff-click=$ctrl.saveReservation() ff-disabled=formEditReservation.$pristine>Save Reservation</ff-btn> <ff-btn sense=back ff-click=$ctrl.back()>Back</ff-btn> </ff-btn-group> </form> '},Lkwn:function(e,t,n){var a={"./user-reservations/user-reservations.tpl.html":"Khvr"};function r(e){var t=f(e);return n(t)}function f(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=f,e.exports=r,r.id="Lkwn"},qNkH:function(e,t,n){"use strict";n.r(t);n("lYjL"),n("8cZI"),n("JBxO"),n("FdtR");var a=n("0zKI"),r=n.n(a),f=n("NOor"),i=n.n(f),s=n("hsT8"),l=n.n(s),o=n("6RpP"),c=n.n(o),d=n("nbuU"),m=n.n(d),u=n("WSeP"),v=n.n(u),p=n("2/1H"),g=n("vWHn"),R=n("+l1P");t.default=angular.module("deskworks.userReservations",["session","deskworks.reservationService",p.a.name,g.a.name,R.a.name]).controller("UserReservationsCtrl",["$scope","$filter","$route","$translate","$timeout","dwAlerts","reservationService","ReservationUnit","reservationUnits","user","state","session","helper","settings",function(e,t,n,a,f,s,o,d,u,p,g,R,b,E){var h=this;g.setPageTitle(a.instant("USER_RESERVATIONS.PAGE_TITLE",{userName:b.join([p.firstName,p.lastName]," ")})),h.optsFilter=[{id:"all",name:a.instant("USER_RESERVATIONS.FILTER.ALL")},{id:"upcoming",name:a.instant("USER_RESERVATIONS.FILTER.UPCOMING")},{id:"past",name:a.instant("USER_RESERVATIONS.FILTER.PAST")}],h.filter=h.optsFilter[0].id,h.settings=E,h.reservations=[],h.params={centerId:g.getCurrentCenterId(),userId:g.getCurrentUserId(),offset:0,limit:50},h.fetch=function(){if(h.eof||h.fetching)return h.fetching;h.fetching=o.query(h.params).catch((function(e){return s.error(e,"Failed to query reservations.")})).finally((function(){h.fetching=null})).then((function(e){var t;v()(e).call(e,(function(e){e.resCategoryName=m()(b).call(b,u,e.reservationUnitId),e.resCategoryName&&(e.resCategoryName=e.resCategoryName.reservationTypeName)})),h.reservations=c()(t=h.reservations).call(t,e),h.params.offset=h.reservations.length,h.eof=e.length<h.params.limit}))},h.onFilter=function(){h.reservations=[],h.params.offset=0,h.eof=!1,h.params.from="upcoming"===l()(h)?moment():null,h.params.to="past"===l()(h)?moment():null,h.fetch()},e.$watch("$ctrl.editingReservation.from",(function(e,t){moment.isMoment(e)&&moment.isMoment(t)&&(e.date()===t.date()&&e.month()===t.month()&&e.year()===t.year()||(h.editingReservation.to=moment([e.year(),e.month(),e.date(),h.editingReservation.to.hour()||e.hour(),h.editingReservation.to.minute()||e.minute(),0,0])))})),h.saveReservation=function(){if(h.editingReservation&&!b.pointFirstInvalid(".reservations-edit")){var e={id:h.editingReservation.id,from:h.editingReservation.from,to:h.editingReservation.to,reservationNote:h.editingReservation.reservationNote};return o.save(g.getCurrentCenterId(),g.getCurrentUserId(),e).catch((function(e){return s.error(e,"Failed to update reservation.")})).then((function(){delete h.editingReservation,h.onFilter()}))}},h.isEditable=function(e){return R.isAdmin()||R.isRole("member")},h.editReservation=function(e){if(R.isRole("member"))return g.setParam("date",t("date")(e.from,"yyyy-MM-ddTHH:mm:00Z")),g.setPath("/edit-reservation/"+e.id);R.isAdmin()&&(h.editingReservation=angular.copy(e))},h.back=function(){delete h.editingReservation},h.cancelReservation=function(e){if(confirm(a.instant("USER_RESERVATIONS.CONFIRM_DELETE")))return o.delete(g.getCurrentCenterId(),g.getCurrentUserId(),e.id).catch((function(e){return s.error(e,"Failed to cancel reservation.")})).then((function(){var t,n=i()(b).call(b,h.reservations,e.id);r()(t=h.reservations).call(t,n,1)}))},h.newReservation=function(){return g.setPath("/new-reservation")}}])},roXK:function(e,t,n){"use strict";n.r(t);n("y89P");var a=n("WSeP"),r=n.n(a),f=n("lRNC"),i=n.n(f),s=n("yCd9"),l=n.n(s),o=["$injector",function(e){var t,a,f=(t=n("2AQp"),l()(a=i()(t).call(t)).call(a,t));e.loadNewModules(l()(f).call(f,(function(e){return e.default.name}))),e.invoke(["$templateCache",function(e){var t,a=n("Lkwn");r()(t=i()(a).call(a)).call(t,(function(t){return e.put(t.replace(/^\.\//,""),a(t))}))}])}];t.default=o},vWHn:function(e,t,n){"use strict";t.a=angular.module("deskworks.dwDateTime",["flexForms"]).directive("dwDateTime",(function(){return{restrict:"E",scope:!0,compile:function(e,t){var n=t.ngDisabled?' ng-disabled="'+t.ngDisabled+'"':"",a=t.ngDisabled?' ff-disabled="'+t.ngDisabled+'"':"",r=t.ffRequired?' ff-required="'+t.ffRequired+'"':"",f=t.ffDateOrder?' ff-date-order="'+t.ffDateOrder+'"':"",i=t.ffDateDiff?' ff-date-diff="'+t.ffDateDiff+'"':"",s=t.ffValidateAlert?' ff-validate-alert="'+t.ffValidateAlert+'"':"",l=t.labelClass?' class="'+t.labelClass+'"':"",o='<ff-row><label flex="1 1 auto"><ff-label flex="'+t.labelFlex+'"'+r+n+l+">"+t.ffLabel+'</ff-label><ff-row flex="1 1 1%"><ff-date name="{{\''+(t.name||t.ffModel)+'date\'}}" flex="1 2 150px" ff-model="inner.date"'+r+a+f+i+s+"></ff-date><ff-time name=\"{{'"+(t.name||t.ffModel)+'time\'}}" flex="1 3 150px" ff-model="inner.time"'+r+a+f+i+s+"></ff-time></ff-row></label></ff-row>";return e.append(o),this.link},link:function(e,t,n){e.inner={};var a=e.$eval(n.ffModel);function r(t,n){!moment.isMoment(t)||moment.isMoment(n)&&t.isSame(n)||(e.inner.date=t.clone().second(0).millisecond(0),e.inner.time=t.clone().second(0).millisecond(0))}a instanceof moment&&r(a),e.$watch(n.ffModel,r),e.$watch("inner.date",(function(t,a){var r=e.$eval(n.ffModel);moment.isMoment(t)&&moment.isMoment(r)&&(moment.isMoment(a)&&t.isSame(a)||(e.newDate=t.clone().hour(r.hour()).minute(r.minute()),e.$eval(n.ffModel+" = newDate")))})),e.$watch("inner.time",(function(t,a){var r=e.$eval(n.ffModel);moment.isMoment(t)&&moment.isMoment(r)&&(moment.isMoment(a)&&t.isSame(a)||(e.newDate=r.clone().hour(t.hour()).minute(t.minute()),e.$eval(n.ffModel+" = newDate")))}))}}}))},yUci:function(e,t,n){"use strict";n.r(t);var a=n("bOPx");t.default=a.a}}]);