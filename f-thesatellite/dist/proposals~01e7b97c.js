(window.webpackJsonp=window.webpackJsonp||[]).push([[58,3],{"+EAl":function(e,t){e.exports='<div id="proposal-templates" ff-bulk-read-only> <h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v"> <ff-panel> <ff-header ng-if="$ctrl.templates.length"> <ff-row> <cell flex="1 1 20%"><span translate="PROPOSALS.CATEGORY"></span></cell> <cell flex="1 1 40%"><span translate="PROPOSALS.NAME"></span></cell> <cell flex="1 1 40%"><span translate="PROPOSALS.DESCRIPTION"></span></cell> <ff-btn-group flex="0 0 auto" class="buttons-row zero-height"> <ff-btn sense="edit" size="xs"></ff-btn> <ff-btn sense="delete" size="xs"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-spin class="ff-spin-placeholder" ng-if="!$ctrl.templates"></ff-spin> <span ng-if="$ctrl.templates && !$ctrl.templates.length" translate="GLOBAL.NONE"></span> <ff-row ng-repeat="tpl in $ctrl.templates"> <ff-static flex="1 1 20%">{{tpl.$$category.name}}</ff-static> <ff-static flex="1 1 40%">{{tpl.name}}</ff-static> <ff-static flex="1 1 40%">{{tpl.description}}</ff-static> <ff-btn-group flex="0 0 auto" class="buttons-row"> <ff-btn sense="edit" size="xs" ff-click="$ctrl.edit(tpl)" title="{{\'GLOBAL.BTN_EDIT\' | translate}}"></ff-btn> <ff-btn sense="delete" size="xs" ff-click="$ctrl.delete(tpl)" title="{{\'GLOBAL.BTN_DELETE\' | translate}}"></ff-btn> </ff-btn-group> </ff-row> </ff-panel> <ff-btn-group> <ff-btn sense="new" ff-click="$ctrl.new()"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> </ff-btn-group> </div> </div> '},"/l8F":function(e,t){e.exports='<ff-panel> <ff-panel-header><span> <span translate="SH_CODES.HEADER"></span> <ff-hint><span translate="SH_CODES.HINT"></span></ff-hint> </span></ff-panel-header> <ff-row ng-repeat="code in $ctrl.shortCodes"> <ff-label flex="1 0 140px" ff-bind-html="code.id"></ff-label> <ff-static flex="1 1 350px">{{code._name | translate}}</ff-static> </ff-row> </ff-panel> '},"29E8":function(e,t,r){"use strict";var n=r("yCd9"),o=r.n(n),a=r("6RpP"),l=r.n(a);t.a=angular.module("deskworks.reportSort",[]).factory("reportSort",["$filter",function(e){return function(t,r,n){return angular.isArray(r)||(r=[r]),r=o()(r).call(r,(function(e){var t,r;return l()(t=l()(r="".concat(e," || ")).call(r,e," === 0 ? ")).call(t,e,' : "~~~"')})),e("orderBy")(t,r,n)}}])},"5/DJ":function(e,t,r){"use strict";t.a=angular.module("deskworks.reports.reportStyles",["deskworks.helper"]).factory("reportStyles",["helper",function(e){return{pageMargins:[60,25,50,25],headStyles:{font:"Font",fontSize:9,fontStyle:"normal",valign:"middle",fillColor:e.hex2rgbArr("#444444"),textColor:255,textTransform:"uppercase"},bodyStyles:{font:"Font",overflow:"linebreak",textColor:0},header:{textColor:"#949594"},footer:{textColor:"#949594"},rowOdd:{fillColor:[245,245,245]},h1:{fontStyle:"bold",fillColor:e.hex2rgbArr("#949594"),textColor:[255,255,255]},h2:{fontStyle:"bold",textColor:e.hex2rgbArr("#444444"),borderWidth:1,borderColor:e.hex2rgbArr("#444444")},h3:{fontStyle:"bold"}}}])},"5bca":function(e,t,r){"use strict";t.a=angular.module("deskworks.logo",[]).factory("logo",["$window","$http","$q","deskworksConfig",function(e,t,r,n){var o,a;return{getSiteLogo:function(){return o=o||r((function(e){var t=new Image;t.crossOrigin="anonymous",t.src=n.getApiAbsUrl("/white-label/images/logo-print.png"),t.onerror=function(){console.warn("Report failed to load site logo."),e(null),t=null},t.onload=function(){e(t),t=null}})).then(l)},getSiteLogoInv:function(){return a=a||r((function(e){var t=document.querySelector(".sidebar-logo a img");t||console.warn("Report failed to load site logo."),e(t)})).then(l)},resetSiteLogo:function(){o=null},resetSiteLogoInv:function(){a=null}};function l(e){if(!e)return null;var t=e.width/480,r=e.height/171,n=t>r?t:r,o=Math.round(e.width/n),a=Math.round(e.height/n),l=document.createElement("canvas");document.body.appendChild(l),l.width=o,l.height=a,l.getContext("2d").drawImage(e,0,0,o,a);var i=l.toDataURL("image/png");return document.body.removeChild(l),{width:o,height:a,data:i}}}])},"76E7":function(e,t,r){"use strict";t.a=r.p+"./assets/lato-regular.ttf?_rev=1a161b4d22d2947c3d3e35d012305208"},"81mT":function(e,t,r){"use strict";r("8cZI");var n=r("nbuU"),o=r.n(n),a=r("5/DJ");t.a=angular.module("deskworks.reports.reportHeader",[a.a.name]).factory("reportHeader",["$filter","$translate","reportStyles",function(e,t,r){return function(){return 3===arguments.length?a.apply(void 0,arguments):n.apply(void 0,arguments)};function n(n){var a,l,i,s,c=n.config,f=n.doc,u=n.data,d=n.resources,p=o()(a=d.centers).call(a,(function(e){return e.id===+c.centerId})),g=f.internal.pageSize.width;f.setFont(f.getFont().fontName,"normal"),f.setTextColor(r.header.textColor),i=r.pageMargins[3],s=40,f.setFontSize(14),l=c.reportName.toUpperCase(),f.text(l,i,s),i+=f.getTextWidth(l)+3,(c.fromDate||c.toDate)&&(f.setFontSize(7),l=t.instant("REPORTS.HEADER.FOR_PERIOD").toUpperCase(),c.fromDate&&(l+=" "+t.instant("REPORTS.HEADER.FROM").toUpperCase()+":"),f.text(l,i,s),i+=f.getTextWidth(l)+3,c.fromDate&&(f.setFontSize(9),l=e("date")(c.fromDate,"mediumDate")||"",f.text(l,i,s),i+=f.getTextWidth(l)+3),f.setFontSize(7),l=t.instant("REPORTS.HEADER.THROUGH").toUpperCase()+":",f.text(l,i,s),i+=f.getTextWidth(l)+3,f.setFontSize(9),l=e("date")(c.toDate,"mediumDate")||"",f.text(l,i,s),i+=f.getTextWidth(l)+3),i=g-r.pageMargins[1],f.setFontSize(9),l=""+u.pageCount,i-=f.getTextWidth(l),f.text(l,i,s),f.setFontSize(7),l=t.instant("REPORTS.HEADER.PAGE").toUpperCase()+":",i-=f.getTextWidth(l+" "),f.text(l,i,s-.6),i=r.pageMargins[3],s+=11,f.setFontSize(7),l=t.instant("REPORTS.HEADER.REPORT_FOR").toUpperCase()+":",f.text(l,i,s-.6),i+=f.getTextWidth(l+" "),f.setFontSize(9),l=c.reportFor||(p?[p.name,p.city,p.state].join(", "):"All Centers"),f.text(l,i,s),i+=f.getTextWidth(l+" "),i=g-r.pageMargins[1],f.setFontSize(9),l=e("date")(moment(),"mediumDate"),i-=f.getTextWidth(l),f.text(l,i,s),f.setFontSize(7),l=t.instant("REPORTS.HEADER.REPORT_DATE").toUpperCase()+":",i-=f.getTextWidth(l+" "),f.text(l,i,s-.6)}function a(n,o,a){var l,i,s,c=o.internal.pageSize.width;o.setFont(o.getFont().fontName,"normal"),o.setTextColor(r.header.textColor),i=r.pageMargins[3],s=40,o.setFontSize(14),l=a.reportName.toUpperCase(),o.text(l,i,s),i+=o.getTextWidth(l)+3,a.reportDates&&(o.setFontSize(7),l=t.instant("REPORTS.HEADER.FOR_PERIOD").toUpperCase(),a.reportDates.fromDate&&(l+=" "+t.instant("REPORTS.HEADER.FROM").toUpperCase()+":"),o.text(l,i,s),i+=o.getTextWidth(l)+3,a.reportDates.fromDate&&(o.setFontSize(9),l=e("date")(a.reportDates.fromDate,"mediumDate")||"",o.text(l,i,s),i+=o.getTextWidth(l)+3),o.setFontSize(7),l=t.instant("REPORTS.HEADER.THROUGH").toUpperCase()+":",o.text(l,i,s),i+=o.getTextWidth(l)+3,o.setFontSize(9),l=e("date")(a.reportDates.toDate,"mediumDate")||"",o.text(l,i,s),i+=o.getTextWidth(l)+3),i=c-r.pageMargins[1],o.setFontSize(9),l=""+n.pageCount,i-=o.getTextWidth(l),o.text(l,i,s),o.setFontSize(7),l=t.instant("REPORTS.HEADER.PAGE").toUpperCase()+":",i-=o.getTextWidth(l+" "),o.text(l,i,s-.6),i=r.pageMargins[3],s+=11,o.setFontSize(7),l=t.instant("REPORTS.HEADER.REPORT_FOR").toUpperCase()+":",o.text(l,i,s-.6),i+=o.getTextWidth(l+" "),o.setFontSize(9),l=a.reportFor||(!1===a.reportOptions.centerId||+a.reportOptions.centerId)&&[a.center.name,a.center.city,a.center.state.name].join(", ")||"All Centers",o.text(l,i,s),i+=o.getTextWidth(l+" "),i=c-r.pageMargins[1],o.setFontSize(9),l=e("date")(moment(),"mediumDate"),i-=o.getTextWidth(l),o.text(l,i,s),o.setFontSize(7),l=t.instant("REPORTS.HEADER.REPORT_DATE").toUpperCase()+":",i-=o.getTextWidth(l+" "),o.text(l,i,s-.6)}}])},"8POw":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalPriceListProduct",["ngResource","deskworks.config"]).factory("ProposalPriceListProduct",["$resource","$timeout","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/proposal/price-list-products"));return{query:function(e){var t=e.priceListId;return n.query({priceListId:t}).$promise}}}])},"9ux4":function(e,t,r){"use strict";(function(e){r("JBxO");var n=r("yCd9"),o=r.n(n),a=r("76E7"),l=r("PKSF");t.a=angular.module("deskworks.reportFontInit",[]).factory("reportFontInit",["$q","$http",function(t,r){var n,i;return t.all(o()(n=[a.a,l.a]).call(n,(function(t){return r.get(t,{responseType:"arraybuffer"}).then((function(t){return e.from(t.data).toString("base64")}))}))).then((function(e){return i=e})),function(e){i?(e.getFontList().Font||(e.addFileToVFS("font-regular.ttf",i[0]),e.addFileToVFS("font-bold.ttf",i[1]),e.addFont("font-regular.ttf","Font","normal"),e.addFont("font-bold.ttf","Font","bold")),e.setFont("Font")):console.warn("Report fonts are not loaded yet.")}}])}).call(this,r("zkTx").Buffer)},CZKu:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalCategory",["ngResource","deskworks.config"]).factory("ProposalCategory",["$resource","$timeout","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/proposal/categories/:categoryId"),{},{update:{method:"PUT"}});return{query:function(){return n.query().$promise},save:function(e){return e.categoryId?n.update({categoryId:e.categoryId},e).$promise:n.save({},e).$promise.then((function(t){return e.categoryId=t.categoryId,t}))},delete:function(e){var t=e.categoryId;return n.delete({categoryId:t}).$promise}}}])},EV7g:function(e,t,r){"use strict";r.r(t);r("JBxO");var n=r("ipr/"),o=r.n(n),a=r("RJUJ"),l=r.n(a),i=r("MLik"),s=r.n(i),c=r("wPzF"),f=r.n(c),u=r("4BZO"),d=r.n(u),p=r("nbuU"),g=r.n(p),m=r("0zKI"),h=r.n(m),v=r("CZKu"),b=r("Ngk+");function y(e,t){var r=void 0!==s.a&&f()(e)||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){var r;if(!e)return;if("string"==typeof e)return P(e,t);var n=o()(r=Object.prototype.toString.call(e)).call(r,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return l()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){u=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw i}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.default=angular.module("deskworks.ProposalTemplatesCtrl",[v.default.name,b.default.name]).controller("ProposalTemplatesCtrl",["$scope","$q","$translate","$window","dwAlerts","state","helper","ProposalCategory","ProposalTemplate",function(e,t,r,n,o,a,l,i,s){var c=this;a.setPageTitle(r.instant("PROPOSALS.TEMPLATE.LIST.PAGE_TITLE")),c.onInit=function(){c.load()},c.load=function(){return t.all([i.query().catch((function(e){return o.error(e,"Failed to get proposal categories.")})),s.query().catch((function(e){return o.error(e,"Failed to get proposal templates.")}))]).then((function(e){var t,r=d()(e,2),n=r[0],o=r[1],a=y(o);try{var l=function(){var e=t.value;e.$$category=g()(n).call(n,(function(t){return t.categoryId===e.categoryId}))};for(a.s();!(t=a.n()).done;)l()}catch(e){a.e(e)}finally{a.f()}c.templates=o}))},c.new=function(){return a.setPath(a.getPath()+"/new")},c.edit=function(e){return a.setPath(a.getPath()+"/"+e.templateId)},c.delete=function(e){if(n.confirm(r.instant("PROPOSALS.TEMPLATE.CONFIRM_DELETE")))return s.delete(e).catch((function(e){return o.error(e,"Failed to delete proposal template.")})).then((function(){var t;h()(t=c.templates).call(t,c.templates.indexOf(e),1)}))},c.onInit()}])},Ez1r:function(e,t,r){var n={"./proposals/proposal-edit.controller.js":"VybN","./proposals/proposal-view.controller.js":"bN8k","./proposals/proposals.controller.js":"gbqF","./services/proposal-category.service.js":"CZKu","./services/proposal-filled-template.service.js":"RWGx","./services/proposal-price-list-product.service.js":"8POw","./services/proposal-price-list.service.js":"gJCS","./services/proposal-recurring-billing.service.js":"adyb","./services/proposal-template.service.js":"Ngk+","./services/proposal.service.js":"QFeV","./templates/proposal-categories.controller.js":"uM0a","./templates/proposal-template-edit.controller.js":"N/7F","./templates/proposal-templates.controller.js":"EV7g"};function o(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=a,e.exports=o,o.id="Ez1r"},G6E5:function(e,t,r){"use strict";var n=r("03wM"),o=r.n(n),a=r("Ekwr"),l=r.n(a),i=r("hsT8"),s=r.n(i),c=r("lvz6"),f=r.n(c),u=r("yKah"),d=r.n(u),p=r("fzuT"),g=r.n(p),m=r("yCd9"),h=r.n(m),v=r("6RpP"),b=r.n(v),y=r("G0Vy"),P=r.n(y),x=r("nbuU"),I=r.n(x),w=r("Z9wY"),S=r.n(w),T=(r("3dw1"),r("Muwe"),r("y89P"),r("29E8")),$=r("IE1r"),E=r("UDUI"),L=(r("RKBc"),angular.module("fileSaver",[]).factory("fileSaver",["$window",function(e){return function(t,r,n,o){if(e.cordova&&e.cordova.InAppBrowser&&"ios"===e.cordova.platformId){var a=new FileReader;return a.onloadend=function(){var t=a.result;return e.cordova.InAppBrowser.open(t,"_blank","hidenavigationbuttons=yes,hideurlbar=yes,enableViewportScale=yes,location=no")},void a.readAsDataURL(t)}return e.saveAs(t,r,n,o)}}])),O=r("5bca"),A=r("5/DJ"),C=r("81mT"),R=r("Xjih"),k=r("9ux4");function D(e,t){var r=o()(e);if(l.a){var n=l()(e);t&&(n=s()(n).call(n,(function(t){return f()(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){g()(e,t,r[t])})):d.a?Object.defineProperties(e,d()(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,f()(r,t))}))}return e}t.a=angular.module("deskworks.reportHelper",[T.a.name,$.a.name,E.a.name,L.name,O.a.name,A.a.name,C.a.name,R.a.name,k.a.name]).factory("reportHelper",["$rootScope","$q","$timeout","$window","$filter","$http","dwAlerts","state","logo","jsPDF","csvMake","centerService","reportStyles","reportHeader","reportFooter","reportSort","fileSaver","reportFontInit",function(e,t,r,n,o,a,l,i,s,c,f,u,d,p,g,m,v,y){return{sort:m,paramsChanged:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return r.some((function(r){return moment.isMoment(e[r])?!moment.isMoment(t[r])||!e[r].isSame(t[r]):e[r]!==t[r]}))},loadResources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return{}};return t.all(F(F({},e()),{},{centers:u.query().catch((function(e){return l.error(e,"Failed to query centers.")})),logo:s.getSiteLogo()}))},buildPdf:function(e){var t,r=e.config,n=e.report,o=e.resources,a=e.doc,l=void 0===a?new c(r.paperLayout,"pt",r.paperSize):a,i=e.startY;y(l);var s=angular.copy(n.rows);s.forEach((function(e){var t=0;e.forEach((function(r,o){r&&!angular.isUndefined(r.content)||(e[o]=r={content:r});var a=n.columns[t];if(!1===r.content)r.content="";else{if(a.pdf){var l=a.pdf(r.content);r.content=""===l?r.content:l}r.content=angular.isUndefined(r.content)||null===r.content||""===r.content?"-":r.content}t+=r.colSpan||1}))}));var f={columns:h()(t=n.columns).call(t,(function(e){return r.styles&&"uppercase"!==r.styles.headStyles.textTransform?e.title:e.title.toUpperCase()})),body:s,headStyles:(r.styles||d).headStyles,bodyStyles:(r.styles||d).bodyStyles,columnStyles:(r.styles||d).columnStyles,tableMargin:r.styles&&r.styles.tableMargin||(r.styles||d).pageMargins,startY:i||(r.styles||d).startY||!1,didParseCell:function(e){var t=e.row,r=e.cell,o=e.column;if("body"===e.section){angular.extend(r.styles,{minCellWidth:50,fillColor:!1},n.styles[t.index],n.columns[o.index].styles,s[t.index][o.index]?s[t.index][o.index].styles:null)}else angular.extend(r.styles,n.columns[o.index].styles)},didDrawCell:function(e){return function(e,t){var r=e.cell,n=e.doc;0===e.column.index&&r.styles.borderColor&&r.styles.borderWidth&&(n.setLineWidth(r.styles.borderWidth),n.setDrawColor(r.styles.borderColor[0],r.styles.borderColor[1],r.styles.borderColor[2]),n.rect(e.settings.margin.left+r.styles.borderWidth/2,r.y+r.styles.borderWidth/2,e.table.getWidth(n.internal.pageSize.width)-r.styles.borderWidth,e.row.height-2*r.styles.borderWidth,"S"));return!1}(e,n.columns)},didDrawPage:function(e){(r.header||p)({config:r,doc:l,data:e.table,resources:o}),(r.footer||g)({config:r,doc:l,data:e.table,resources:o})}};return f.margin=f.tableMargin||(r.styles||d).pageMargins,l.autoTable(f),l},buildCsv:function(e){var t,r,n=e.report,o={charset:"utf-8"},a=h()(t=n.rows).call(t,(function(e){return e.reduce((function(e,t){var r;return e.push(t),b()(e).call(e,P()(r=new Array((t&&t.colSpan?t.colSpan:1)-1)).call(r,null))}),[])}));return a.forEach((function(e){e.forEach((function(t,r){e[r]&&angular.isDefined(e[r].content)&&(e[r]=e[r].content);var o=n.columns[r];if(o.csv){var a=o.csv(e[r]);e[r]=""===a?e[r]:a}e[r]=angular.isUndefined(e[r])||null===e[r]||!1===e[r]||""===e[r]?"":e[r]}))})),a.unshift(h()(r=n.columns).call(r,(function(e){return e.title.toUpperCase()}))),new Blob([f.generate(a,o)],{type:"text/csv;charset="+o.charset+";"})},getReportFileName:function(e){var t,r=e.extension,n=void 0===r?"pdf":r,a=e.postfix,l=void 0===a?"":a,i=e.config,s=e.resources,c=i.reportName.toLowerCase().replace(/\s+/g,"-"),f=(I()(t=s.centers).call(t,(function(e){return e.id===+i.centerId}))||{name:"all-centers"}).name.toLowerCase().replace(/\s+/g,"-");return c+"-"+f+"-"+o("date")(moment(),"yyyyMMdd-HHmmss")+l+"."+n.toLowerCase()},download:function(e){var t=e.blob,r=e.fileName;if(!t)return;var o=n.cordova;o&&"android"===o.platformId&&o.plugins.fileOpener2?n.resolveLocalFileSystemURL(o.file.externalDataDirectory,(function(e){e.getFile(r,{create:!0,exclusive:!1},(function(e){e.createWriter((function(r){r.onwrite=function(){return t=e.nativeURL,void n.cordova.plugins.fileOpener2.showOpenWithDialog(t,S()(t).call(t,".csv")?"text/csv":"application/pdf",{error:function(e){return console.error("showOpenWithDialog error:",e)},success:function(){return null},position:[0,0]});var t},r.write(t)}))}),(function(e){return console.error("SAVE FILE ERROR:",e)}))})):v(t,r)}}}])},IE1r:function(e,t,r){"use strict";r("Muwe"),r("y89P"),r("JBxO"),r("3dw1"),r("8cZI");t.a=angular.module("csvMake",[]).service("csvMake",["$q",function(e){this.generate=function(e,t){return t.txtDelim=t.txtDelim||'"',t.decimalSep=t.decimalSep||".",t.fieldSep=t.fieldSep||",",t.charset=t.charset||"utf-8",t.fieldSep=this.isSpecialChar(t.fieldSep)?this.getSpecialChar(t.fieldSep):t.fieldSep,this.stringify(e,t)};var t={"\\t":"\t","\\b":"\b","\\v":"\v","\\f":"\f","\\r":"\r"};this.stringifyField=function(e,t){return"locale"===t.decimalSep&&this.isFloat(e)?e.toLocaleString():"."!==t.decimalSep&&this.isFloat(e)?e.toString().replace(".",t.decimalSep):"string"==typeof e?(e=e.replace(/"/g,'""'),(t.quoteStrings||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=t.txtDelim+e+t.txtDelim),e):"boolean"==typeof e?e?"TRUE":"FALSE":e},this.isFloat=function(e){return+e===e&&(!isFinite(e)||Boolean(e%1))},this.stringifyAsync=function(t,r){var n=e.defer(),o=this,a="",l="",i=e.when(t).then((function(e){var t,i;angular.isDefined(r.header)&&r.header&&(t=[],angular.forEach(r.header,(function(e,t){this.push(o.stringifyField(e,r))}),t),i=t.join(r.fieldSep?r.fieldSep:","),l+=i+"\r\n");var s,c,f=[];(angular.isArray(e)?f=e:angular.isFunction(e)&&(f=e()),angular.isDefined(r.label)&&r.label&&"boolean"==typeof r.label)&&(s=[],angular.forEach(f[0],(function(e,t){this.push(o.stringifyField(t,r))}),s),c=s.join(r.fieldSep?r.fieldSep:","),l+=c+"\r\n");angular.forEach(f,(function(e,t){var n,a,i=angular.copy(f[t]);a=[];var s=r.columnOrder?r.columnOrder:i;angular.forEach(s,(function(e,t){var n=r.columnOrder?i[e]:e;this.push(o.stringifyField(n,r))}),a),n=a.join(r.fieldSep?r.fieldSep:","),l+=t<f.length?n+"\r\n":n})),r.addByteOrderMarker&&(a+="\ufeff"),a+=l,n.resolve(a)}));return"function"==typeof i.catch&&i.catch((function(e){n.reject(e)})),n.promise},this.stringify=function(e,t){var r,n,o=this,a="",l="";angular.isDefined(t.header)&&t.header&&(r=[],angular.forEach(t.header,(function(e,r){this.push(o.stringifyField(e,t))}),r),n=r.join(t.fieldSep?t.fieldSep:","),l+=n+"\r\n");var i,s,c=e;angular.isDefined(t.label)&&t.label&&"boolean"==typeof t.label&&(i=[],angular.forEach(c[0],(function(e,r){this.push(o.stringifyField(r,t))}),i),s=i.join(t.fieldSep?t.fieldSep:","),l+=s+"\r\n");return angular.forEach(c,(function(e,r){var n,a,i=angular.copy(c[r]);a=[];var s=t.columnOrder?t.columnOrder:i;angular.forEach(s,(function(e,r){var n=t.columnOrder?i[e]:e;this.push(o.stringifyField(n,t))}),a),n=a.join(t.fieldSep?t.fieldSep:","),l+=r<c.length?n+"\r\n":n})),t.addByteOrderMarker&&(a+="\ufeff"),a+=l},this.isSpecialChar=function(e){return void 0!==t[e]},this.getSpecialChar=function(e){return t[e]}}])},LGFk:function(e,t,r){var n={"./proposals/proposal-edit.tpl.html":"jvYD","./proposals/proposal-view.tpl.html":"pgmu","./proposals/proposals.tpl.html":"eM+T","./templates/proposal-categories.tpl.html":"uIrw","./templates/proposal-template-edit.tpl.html":"QnS2","./templates/proposal-templates.tpl.html":"+EAl"};function o(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=a,e.exports=o,o.id="LGFk"},"N/7F":function(e,t,r){"use strict";r.r(t);var n=r("4BZO"),o=r.n(n),a=(r("Muwe"),r("y89P"),r("hsT8")),l=r.n(a),i=r("aJ1N"),s=r("iAzO"),c=r("NhWh"),f=r("CZKu"),u=r("Ngk+"),d=r("uIrw"),p=r.n(d);t.default=angular.module("deskworks.ProposalTemplateEditCtrl",[i.a.name,s.a.name,c.a.name,f.default.name,u.default.name]).controller("ProposalTemplateEditCtrl",["$scope","$q","$translate","$route","dwAlerts","state","helper","dwModal","ProposalCategory","ProposalTemplate",function(e,t,r,n,a,i,s,c,f,u){var d=this;i.setPageTitle(r.instant("PROPOSALS.TEMPLATE.EDIT.PAGE_TITLE")),d.placeholders=[{value:"{{center-name}}",text:"Center name"},{value:"{{center-phone}}",text:"Center phone"},{value:"{{center-email}}",text:"Center email"},{value:"{{center-street}}",text:"Center street"},{value:"{{center-city}}",text:"Center city"},{value:"{{center-state}}",text:"Center state"},{value:"{{center-zip}}",text:"Center zip"},{value:"{{company-name}}",text:"Company name"},{value:"{{member-name}}",text:"Member name"},{value:"{{member-first-name}}",text:"Member first name"},{value:"{{member-last-name}}",text:"Member last name"},{value:"{{member-phone}}",text:"Member phone"},{value:"{{member-email}}",text:"Member email"},{value:"{{member-address}}",text:"Member address"},{value:"{{price}}",text:"Price"},{value:"{{registration-fee}}",text:"Registration fee"},{value:"{{security-deposit}}",text:"Security deposit"},{value:"{{tax-rate}}",text:"Tax rate"},{value:"{{total}}",text:"Total"},{value:"{{start-date}}",text:"Start Date"},{value:"{{renewal-date}}",text:"Renewal Date"},{value:"{{renewal-term}}",text:"Renewal Term"},{value:"{{description}}",text:"Description"},{value:"{{dedicated-space}}",text:"Dedicated Space"},{value:"{{discount}}",text:"Discount"},{value:"{{product-name}}",text:"Product Name"},{value:"{{product-description}}",text:"Product Description"}],d.onInit=function(){d.load()},d.load=function(){var e=n.current.params.templateId;return t.all([f.query().catch((function(e){return a.error(e,"Failed to get proposal categories.")})),"new"!==e?u.get({templateId:e}).catch((function(e){return a.error(e,"Failed to get proposal template.")})):{body:""}]).then((function(e){var t=o()(e,2),r=t[0],n=t[1];d.categories=r,d.template=n}))},d.onCategoryChange=function(){if(-1===d.template.categoryId)return d.template.categoryId=null,c.show({scope:e,template:p.a,controller:"ProposalCategoriesCtrl as $ctrl",inputs:{categories:d.categories}}).then((function(e){return e.close})).then((function(e){var t;d.categories=l()(t=d.categories).call(t,(function(e){return!!e.categoryId}))}))},d.save=function(){if(!s.pointFirstInvalid("#proposal-template"))return u.save(d.template).catch((function(e){return a.error(e,"Failed to save proposal template.")})).then((function(){if(d.form.$setPristine(),"new"===n.current.params.templateId)return i.replace(),i.setPath("/proposal-templates/".concat(d.template.templateId))}))},d.back=function(){return i.setPath("/proposal-templates")},d.send=function(){return a.error("Not implemented yet.")},d.onInit()}])},"Ngk+":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalTemplate",["ngResource","deskworks.config"]).factory("ProposalTemplate",["$resource","$timeout","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/proposal/templates/:templateId"),{},{update:{method:"PUT"}});return{get:function(e){var t=e.templateId;return n.get({templateId:t}).$promise},query:function(){return n.query().$promise},save:function(e){return e.templateId?n.update({templateId:e.templateId},e).$promise:n.save({},e).$promise.then((function(t){return e.templateId=t.templateId,t}))},delete:function(e){var t=e.templateId;return n.delete({templateId:t}).$promise}}}])},NhWh:function(e,t,r){"use strict";r("z6HB");var n=r("/l8F"),o=r.n(n);t.a=angular.module("deskworks.shortCodes",[]).directive("shortCodes",(function(){return{template:o.a,restrict:"EAC",scope:!0,controller:"ShortCodesCtrl as $ctrl",bindToController:{shortCodes:"<"}}})).controller("ShortCodesCtrl",(function(){}))},P2GM:function(e,t,r){"use strict";r.r(t);r("3dw1"),r("Muwe"),r("y89P");var n=r("yCd9"),o=r.n(n),a=r("lRNC"),l=r.n(a),i=["$injector",function(e){var t,n,a=(t=r("Ez1r"),o()(n=l()(t).call(t)).call(n,t));e.loadNewModules(o()(a).call(a,(function(e){return e.default.name}))),e.invoke(["$templateCache",function(e){var t=r("LGFk");l()(t).call(t).forEach((function(r){return e.put(r.replace(/^\.\//,""),t(r))}))}])}];t.default=i},PKSF:function(e,t,r){"use strict";t.a=r.p+"./assets/lato-bold.ttf?_rev=1d93f0f9bf99c82f3cbe55f17d016939"},QFeV:function(e,t,r){"use strict";r.r(t);var n=r("fzuT"),o=r.n(n),a=r("yCd9"),l=r.n(a),i=r("03wM"),s=r.n(i),c=r("Ekwr"),f=r.n(c),u=r("hsT8"),d=r.n(u),p=r("lvz6"),g=r.n(p),m=r("yKah"),h=r.n(m);r("3dw1");function v(e,t){var r=s()(e);if(f.a){var n=f()(e);t&&(n=d()(n).call(n,(function(t){return g()(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):h.a?Object.defineProperties(e,h()(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,g()(r,t))}))}return e}t.default=angular.module("deskworks.Proposal",["ngResource","deskworks.config","datesDeserializer"]).factory("Proposal",["$resource","$timeout","$filter","deskworksConfig","datesDeserializer",function(e,t,r,n,o){var a=o(["startDate","renewalDate"]),i=e(n.getApiAbsUrl("/proposal/proposals/:proposalId"),{},{get:{method:"GET",transformResponse:[angular.fromJson,a]},update:{method:"PUT"}});return{get:function(e){var t=e.proposalId;return i.get({proposalId:t}).$promise.then((function(e){return e.charges.forEach((function(e){e.customPrice=null===e.customPrice||void 0===e.customPrice?e.price:e.customPrice,e.discountType=e.discountType||"%"})),e}))},query:function(e){var t=e.userId,r=e.centerId;return i.query({userId:t,centerId:r}).$promise},save:function(e){var t,n=l()(t=e.charges).call(t,(function(e){return e.customPrice=null===e.customPrice?e.price:e.customPrice,b(b({},e),{},{customPrice:e.customPrice===e.price?null:e.customPrice})})),o=b(b({},e),{},{charges:n,startDate:r("date")(e.startDate,"yyyy-MM-dd")});return(e.proposalId?i.update({proposalId:e.proposalId},o).$promise:i.save({},o).$promise.then((function(t){return e.proposalId=t.proposalId,t}))).then((function(e){return e.charges.forEach((function(e){e.customPrice=null===e.customPrice||void 0===e.customPrice?e.price:e.customPrice,e.discountType=e.discountType||"%"})),e}))},delete:function(e){var t=e.proposalId;return i.delete({proposalId:t}).$promise}}}])},QnS2:function(e,t){e.exports='<form name="$ctrl.form" novalidate id="proposal-template" ff-bulk-read-only> <h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v"> <ff-panel ff-dim="!$ctrl.template"> <ff-header> <ff-row> <cell flex="1 1 20%"><span translate="PROPOSALS.CATEGORY"></span></cell> <cell flex="1 1 30%"><span translate="PROPOSALS.NAME"></span></cell> <cell flex="1 1 50%"><span translate="PROPOSALS.DESCRIPTION"></span></cell> </ff-row> </ff-header> <ff-row> <ff-select flex="1 1 20%" ff-model="$ctrl.template.categoryId" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.CATEGORY\' | translate }}" ff-change="$ctrl.onCategoryChange()"> <option ng-value="cat.categoryId" ng-repeat="cat in $ctrl.categories">{{cat.name}}</option> <option ng-value="-1"><span translate="PROPOSALS.EDIT_CATEGORIES"></span></option> </ff-select> <ff-text flex="1 1 30%" ff-model="$ctrl.template.name" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.NAME\' | translate }}"></ff-text> <ff-text flex="1 1 50%" ff-model="$ctrl.template.description" ff-validate-alert="{{ \'PROPOSALS.DESCRIPTION\' | translate }}"></ff-text> </ff-row> </ff-panel> <ff-panel class="email-template-panel" style="max-width:800px"> <label class="ff-row"> <ff-label flex="0 0 70px"><req translate="NOTIFICATIONS.SUBJECT"></req></ff-label> <ff-text ff-model="$ctrl.template.subject" ff-required="true" ff-validate-alert="{{\'NOTIFICATIONS.SUBJECT\' | translate}}"></ff-text> </label> <ff-row> <ff-richtext ff-model="$ctrl.template.body" placeholders="$ctrl.placeholders" charges-table="true" class="ta-email"></ff-richtext> </ff-row> </ff-panel> <ff-btn-group> <ff-btn sense="back" ff-click="$ctrl.back()"><span translate="GLOBAL.BTN_BACK"></span></ff-btn> <ff-btn sense="save" ff-click="$ctrl.save()" ff-disabled="$ctrl.form.$pristine"><span translate="GLOBAL.BTN_SAVE"></span></ff-btn> </ff-btn-group> </div> </form> '},RWGx:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalFilledTemplate",["ngResource","deskworks.config"]).factory("ProposalFilledTemplate",["$resource","$timeout","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/proposal/filled-templates/:templateId"));return{get:function(e){var t=e.templateId,r=e.centerId,o=e.userId,a=e.recurringBillingId;return n.get({templateId:t,centerId:r,userId:o,recurringBillingId:a}).$promise}}}])},UDUI:function(e,t,r){"use strict";var n=r("cgBC");r("dbsv");t.a=angular.module("jsPDF",[]).factory("jsPDF",["$window",function(e){return e.jsPDF=n.default,e.jsPDF}])},VybN:function(e,t,r){"use strict";r.r(t);r("JBxO");var n=r("4BZO"),o=r.n(n),a=(r("Muwe"),r("y89P"),r("iPZ8"),r("kypl"),r("3dw1"),r("nbuU")),l=r.n(a),i=r("hsT8"),s=r.n(i),c=r("0zKI"),f=r.n(c),u=r("ipr/"),d=r.n(u),p=r("RJUJ"),g=r.n(p),m=r("MLik"),h=r.n(m),v=r("wPzF"),b=r.n(v),y=r("aJ1N"),P=r("iAzO"),x=r("Ngk+"),I=r("RWGx"),w=r("QFeV"),S=r("gJCS"),T=r("8POw"),$=r("adyb"),E=r("2/1H");function L(e,t){var r=void 0!==h.a&&b()(e)||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){var r;if(!e)return;if("string"==typeof e)return O(e,t);var n=d()(r=Object.prototype.toString.call(e)).call(r,8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return g()(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==r.return||r.return()}finally{if(i)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A(e,t){if(void 0!==t){var r=tinymce.activeEditor.dom.select(".mce-content-body"),n=o()(r,1)[0];n&&n.querySelectorAll('[data-mtag="'.concat(e,'"]')).forEach((function(e){(function(e,t){for(var r=e,n=0;n<10;n++){if(!(r=r.parentNode))return;if(r.className&&r.className.indexOf(t)>=0)return r}})(e,"charges-table")||(e.innerHTML=null===t||""===t?"-":t)}))}}t.default=angular.module("deskworks.ProposalEditCtrl",[y.a.name,P.a.name,x.default.name,I.default.name,w.default.name,S.default.name,T.default.name,$.default.name,E.a.name]).controller("ProposalEditCtrl",["$scope","$q","$translate","$route","$filter","$timeout","dwAlerts","state","helper","dwModal","userProfileService","centerService","recurringChargeService","productService","ReservationUnit","Proposal","ProposalTemplate","ProposalFilledTemplate","ProposalPriceList","ProposalPriceListProduct","ProposalRecurringBilling",function(e,t,r,n,a,i,c,u,d,p,g,m,h,v,b,y,P,x,I,w,S){var T=this,$=n.current.params.proposalId;u.setPageTitle(r.instant("new"===$?"PROPOSALS.NEW.PAGE_TITLE":"PROPOSALS.EDIT.PAGE_TITLE")),T.onInit=function(){T.proposalId=$,T.initialized="new"!==$,T.optsDiscountType=["%","$"],T.chargesTableCreated=0,T.load()},T.load=function(){var e=u.getCurrentCenterId(),r=u.getCurrentUserId();return t.all(["new"!==$?y.get({proposalId:$}).catch((function(e){return c.error(e,"Failed to get proposal.")})):{body:"",charges:[]},"new"===$?P.query().catch((function(e){return c.error(e,"Failed to get proposal templates.")})):[],I.query({centerId:e}).catch((function(e){return c.error(e,"Failed to get proposal price-lists.")})),m.get(e).catch((function(e){return c.error(e,"Failed to get center.")})),g.get(e,r).catch((function(e){return c.error(e,"Failed to get user.")})),u.getParam("recurringBillingId")?h.get(e,r,+u.getParam("recurringBillingId")).catch((function(e){return c.error(e,"Failed to get recurring charge.")})):null,v.getProducts().catch((function(e){return c.error(e,"Failed to query products.")})),b.query(e).catch((function(e){return c.error(e,"Failed to query reservation units")}))]).then((function(e){var t,r=o()(e,8),n=r[0],a=r[1],f=r[2],d=r[3],p=r[4],g=r[5],m=r[6],h=r[7];if(T.proposal=n,T.templates=a,T.priceLists=f,T.center=d,T.user=p,T.rb=g,T.products=m,T.resUnits=h,"new"!==$)return T.proposal.$$priceList=l()(t=T.priceLists).call(t,(function(e){return e.priceListId===T.proposal.priceListId})),w.query({priceListId:T.proposal.priceListId}).catch((function(e){return c.error(e,"Failed to get proposal price-list-products.")})).then((function(e){T.priceListProducts=e,T.priceListProductsList=s()(e).call(e,(function(e){return"membership"===e.productTypeId||"services"===e.productTypeId})),i((function(){T.replaceSlowPlaceholders(),T.replaceQuickPlaceholders()}),100)}));T.proposal.templateId=(T.templates[0]||{}).templateId,T.proposal.userId=T.user.id,T.proposal.centerId=T.center.id,!T.proposal.priceListId&&u.getParam("priceListId")&&(T.proposal.priceListId=+u.getParam("priceListId")),!T.proposal.recurringBillingId&&T.rb&&(T.proposal.recurringBillingId=T.rb.id,T.proposal.startDate=g.startDate,T.proposal.renewalDate=g.renewalDate,T.proposal.renewalTerm=g.renewalTerm),T.proposal.renewalTerm=T.proposal.renewalTerm||1}))},T.save=function(){if(!d.pointFirstInvalid("#proposal"))return y.save(T.proposal).catch((function(e){return c.error(e,"Failed to save proposal.")})).then((function(e){if(T.form.$setPristine(),"new"===$)return u.replace(),u.setPath("/proposals/".concat(T.proposal.proposalId));T.proposal.charges=e.charges}))},T.createRecurring=function(){return T.save().then((function(){return S.save(T.proposal).catch((function(e){return c.error(e,"Failed to create recurring billing for proposal.")})).then((function(){return g.resetCache(),T.form.$setPristine(),u.setPath("/recurring-charges/".concat(T.proposal.recurringBillingId,"/edit"))}))}))},T.back=function(){return u.setPath("/proposals")},T.next=function(){if(!d.pointFirstInvalid("#proposal"))return x.get({templateId:T.proposal.templateId,centerId:u.getCurrentCenterId(),userId:u.getCurrentUserId(),recurringBillingId:T.proposal.recurringBillingId||null}).catch((function(e){return c.error(e,"Failed to get proposal template.")})).then((function(e){var t;return T.initialized=!0,T.proposal.name=e.name,T.proposal.description=e.description,T.proposal.subject=e.subject,T.proposal.body=e.body,T.proposal.$$priceList=l()(t=T.priceLists).call(t,(function(e){return e.priceListId===T.proposal.priceListId})),T.proposal.charges.push({quantity:1,priceListProductId:u.getParam("priceListProductId")?+u.getParam("priceListProductId"):null,discountType:"%"}),w.query({priceListId:T.proposal.priceListId}).catch((function(e){return c.error(e,"Failed to get proposal price-list-products.")})).then((function(e){if(T.priceListProducts=e,T.priceListProductsList=s()(e).call(e,(function(e){return"membership"===e.productTypeId||"services"===e.productTypeId})),T.proposal.charges[0]&&T.proposal.charges[0].priceListProductId){var t,r,n,o,a,l;if(T.onProductChange(T.proposal.charges[0]),null!==(null===(t=T.rb)||void 0===t?void 0:t.customPrice)&&(null===(r=T.rb)||void 0===r?void 0:r.customPrice)>=0&&(T.proposal.charges[0].customPrice=T.rb.customPrice),null!==(null===(n=T.rb)||void 0===n?void 0:n.discountValue)&&(null===(o=T.rb)||void 0===o?void 0:o.discountValue)>=0)T.proposal.charges[0].discountAmount=T.rb.discountValue,T.proposal.charges[0].discountType=1===(null===(l=T.rb.discountType)||void 0===l?void 0:l.id)?"$":"%";null!==(a=T.rb)&&void 0!==a&&a.attachedReservationUnitId&&(T.proposal.charges[0].attachedReservationUnitId=T.rb.attachedReservationUnitId)}i((function(){T.replaceSlowPlaceholders(),T.replaceQuickPlaceholders()}),100)}))}))},T.add=function(){T.proposal.charges.push({quantity:1,discountType:"%"})},T.delete=function(e){var t;f()(t=T.proposal.charges).call(t,T.proposal.charges.indexOf(e),1),T.form.$setDirty()},T.send=function(){return c.error("Not implemented yet.")},T.onProductChange=function(e){var t,r=l()(t=T.priceListProducts).call(t,(function(t){return t.priceListProductId===e.priceListProductId}));e.description=r.productDescription,e.price=r.price,e.customPrice=r.price},T.getVacantResUnits=function(e){var t;return s()(t=T.resUnits).call(t,(function(t){return!t.attachedUserId||t.id===e.attachedReservationUnitId}))},T.replaceSlowPlaceholders=function(){var e,t,r,n,o,a,l,i,s,c,f,u,d,p,g,m,h,v,b;tinymce.activeEditor&&(A("{{company-name}}",(null===(e=T.user)||void 0===e?void 0:e.company)||(null===(t=T.user)||void 0===t?void 0:t.fullName)),A("{{member-name}}",null===(r=T.user)||void 0===r?void 0:r.fullName),A("{{member-first-name}}",null===(n=T.user)||void 0===n?void 0:n.firstName),A("{{member-last-name}}",null===(o=T.user)||void 0===o?void 0:o.lastName),A("{{member-address}}",null===(a=T.user)||void 0===a||null===(l=a.addresses[0])||void 0===l?void 0:l.street),A("{{member-phone}}",null===(i=T.user)||void 0===i||null===(s=i.phones[0])||void 0===s?void 0:s.number),A("{{member-email}}",null===(c=T.user)||void 0===c?void 0:c.email),A("{{center-name}}",null===(f=T.center)||void 0===f?void 0:f.name),A("{{center-street}}",null===(u=T.center)||void 0===u?void 0:u.street1),A("{{center-city}}",null===(d=T.center)||void 0===d?void 0:d.city),A("{{center-state}}",null===(p=T.center)||void 0===p||null===(g=p.state)||void 0===g?void 0:g.name),A("{{center-zip}}",null===(m=T.center)||void 0===m?void 0:m.zip),A("{{center-phone}}",null===(h=T.center)||void 0===h?void 0:h.phone),A("{{center-email}}",null===(v=T.center)||void 0===v?void 0:v.email),A("{{tax-rate}}",null!==(b=T.center)&&void 0!==b&&b.taxRates[0]?+T.center.taxRates[0].rate+"%":void 0),tinymce.activeEditor.setDirty(!0),tinymce.activeEditor.dispatch("change"))},T.replaceQuickPlaceholders=function(){var e,t,r,n,o,i;if(tinymce.activeEditor&&T.proposal){var s=T.proposal,c=s.startDate,f=s.renewalDate,u=s.renewalTerm;A("{{start-date}}",a("date")(c,"mediumDate")),A("{{renewal-date}}",a("date")(f,"mediumDate")),A("{{renewal-term}}",a("months")(u));var d=null===(e=T.proposal)||void 0===e?void 0:e.charges[0];A("{{dedicated-space}}",(l()(t=T.resUnits).call(t,(function(e){return e.id===(null==d?void 0:d.attachedReservationUnitId)}))||{}).name||null),A("{{price}}",void 0!==(null==d?void 0:d.customPrice)?a("currency")(d.customPrice*d.quantity):void 0),A("{{discount}}",(null==d?void 0:d.discountAmount)>=0?"%"===d.discountType?"".concat(d.discountAmount,"%"):a("currency")(d.discountAmount):null);var p=null===(r=T.priceListProducts)||void 0===r?void 0:l()(r).call(r,(function(e){return"registration"===e.productTypeId}));A("{{registration-fee}}",void 0!==(null==p?void 0:p.price)?a("currency")(p.price):void 0);var g=null===(n=T.priceListProducts)||void 0===n?void 0:l()(n).call(n,(function(e){return e.priceListProductId===(null==d?void 0:d.priceListProductId)})),m=null===(o=T.products)||void 0===o?void 0:l()(o).call(o,(function(e){return e.id===(null==g?void 0:g.productId)}));if(A("{{security-deposit}}",void 0!==(null==m?void 0:m.securityDepositAmount)?a("currency")(m.securityDepositAmount):void 0),A("{{product-name}}",null==m?void 0:m.name),A("{{product-description}}",(null==d?void 0:d.description)||null),A("{{description}}",null===(i=T.proposal)||void 0===i?void 0:i.description),void 0!==(null==d?void 0:d.customPrice)&&void 0!==(null==d?void 0:d.quantity)){var h,v=d.customPrice*d.quantity+((null==p?void 0:p.price)||0)+((null==m?void 0:m.securityDepositAmount)||0);d.discountAmount&&(v-="$"===d.discountType?d.discountAmount:v*d.discountAmount/100),null!==(h=T.center)&&void 0!==h&&h.taxRates[0]&&(v+=v*+T.center.taxRates[0].rate/100),A("{{total}}",a("currency")(v))}T.replaceChargesTablePlaceholders(),tinymce.activeEditor.setDirty(!0),tinymce.activeEditor.dispatch("change")}},T.replaceChargesTablePlaceholders=function(){var e,t,r,n,i=null===(e=T.proposal)||void 0===e?void 0:e.charges,c=tinymce.activeEditor.dom.select(".charges-table"),f=o()(c,1)[0];if(T.multiCharges=!!f,i&&f){var u,d=L(i);try{var p=function(){var e,t=u.value;t.$$priceListProduct=l()(e=T.priceListProducts||[]).call(e,(function(e){return e.priceListProductId===t.priceListProductId}))||{}};for(d.s();!(u=d.n()).done;)p()}catch(e){d.e(e)}finally{d.f()}var g=s()(i).call(i,(function(e){return e.$$priceListProduct.productTypeId&&"membership"!==e.$$priceListProduct.productTypeId})),m=s()(i).call(i,(function(e){return e.$$priceListProduct.productTypeId&&"membership"===e.$$priceListProduct.productTypeId})),h=null===(t=T.priceListProducts)||void 0===t?void 0:l()(t).call(t,(function(e){return"registration"===e.productTypeId})),v=null===(r=T.products)||void 0===r?void 0:l()(r).call(r,(function(e){return e.id===(null==h?void 0:h.productId)}));if(h&&v){var b,y=L(m);try{var P=function(){var e,t=b.value,r=null===(e=T.products)||void 0===e?void 0:l()(e).call(e,(function(e){var r;return e.id===(null===(r=t.$$priceListProduct)||void 0===r?void 0:r.productId)}));if(null!=r&&r.hasRegistrationFee)return g.push({priceListProductId:h.priceListProductId,$$priceListProduct:h,price:h.price,customPrice:h.price,description:v.description}),"break"};for(y.s();!(b=y.n()).done;){if("break"===P())break}}catch(e){y.e(e)}finally{y.f()}}var x=null===(n=T.priceListProducts)||void 0===n?void 0:l()(n).call(n,(function(e){return"security_deposit"===e.productTypeId}));if(x){var I,w=L(m);try{var S=function(){var e,t=I.value,r=null===(e=T.products)||void 0===e?void 0:l()(e).call(e,(function(e){var r;return e.id===(null===(r=t.$$priceListProduct)||void 0===r?void 0:r.productId)}));null!=r&&r.securityDepositAmount&&g.push({priceListProductId:x.priceListProductId,$$priceListProduct:x,price:null==r?void 0:r.securityDepositAmount,customPrice:null==r?void 0:r.securityDepositAmount,description:x.productDescription})};for(w.s();!(I=w.n()).done;)S()}catch(e){w.e(e)}finally{w.f()}}$(g,"onetime"),$(m,"recurring")}function $(e,t){var r=f.querySelector(".".concat(t,"-block"));if(r){r.style.display=e.length?"table-row-group":"none",r.removeAttribute("data-mce-style"),f.querySelectorAll(".".concat(t,"-charge")).forEach((function(e,t){t?e.remove():e.style.display="none"}));var n=f.querySelector(".".concat(t,"-charge"));n.removeAttribute("data-mce-style");var o=0,i=n;e.forEach((function(e){var t,r,c=n.cloneNode(!0);c.style.display="table-row",c.removeAttribute("data-mce-style"),i.after(c),i=c,e.total=(e.customPrice||0)*(e.quantity||1),e.discountAmount&&(e.total-="$"===e.discountType?e.discountAmount:e.total*e.discountAmount/100),o+=e.total;var f=null===(t=T.products)||void 0===t?void 0:l()(t).call(t,(function(t){var r;return t.id===(null===(r=e.$$priceListProduct)||void 0===r?void 0:r.productId)}));s(c,"{{product-name}}",(null==f?void 0:f.name)||(null===(r=e.$$priceListProduct)||void 0===r?void 0:r.productName)),s(c,"{{product-description}}",(null==e?void 0:e.description)||null),s(c,"{{price}}",void 0!==e.customPrice?a("currency")(e.customPrice):void 0),s(c,"{{total}}",a("currency")(e.total)),s(c,"{{quantity}}",(null==e?void 0:e.quantity)||1),s(c,"{{qty}}",(null==e?void 0:e.quantity)||1),s(c,"{{discount}}",e.discountAmount?"%"===e.discountType?"".concat(e.discountAmount,"%"):a("currency")(e.discountAmount):null)})),s(f.querySelector(".".concat(t,"-total")),"{{total}}",a("currency")(o))}function s(e,t,r){e&&void 0!==r&&e.querySelectorAll('[data-mtag="'.concat(t,'"]')).forEach((function(e){e.innerHTML=null===r||""===r?"-":r}))}}},e.$watchGroup(["$ctrl.chargesTableCreated","$ctrl.proposal.startDate","$ctrl.proposal.renewalDate","$ctrl.proposal.renewalTerm","$ctrl.proposal.description"],T.replaceQuickPlaceholders),e.$watch("$ctrl.proposal.charges",T.replaceQuickPlaceholders,!0),T.onInit()}])},Vzov:function(e,t,r){},Xjih:function(e,t,r){"use strict";r("8cZI");var n=r("nbuU"),o=r.n(n),a=r("5/DJ");t.a=angular.module("deskworks.reports.reportFooter",[a.a.name]).factory("reportFooter",["$filter","reportStyles",function(e,t){return function(){return 3===arguments.length?n.apply(void 0,arguments):r.apply(void 0,arguments)};function r(e){var r,n=e.config,a=e.doc,l=(e.data,e.resources),i=o()(r=l.centers).call(r,(function(e){return e.id===+n.centerId}));if(i){var s,c=a.internal.pageSize.width,f=a.internal.pageSize.height;a.setFont(a.getFont().fontName,"normal"),a.setTextColor(t.footer.textColor),a.setFontSize(9),s=[i.name,i.phone,i.street1],i.street2&&s.push(i.street2),s.push(i.city),s.push(i.state.name||i.state),s.push(i.zip),s=s.join(" / "),a.text(s,(c-a.getTextWidth(s))/2,f-30)}}function n(e,r,n){var o,a=r.internal.pageSize.width,l=r.internal.pageSize.height;r.setFont(r.getFont().fontName,"normal"),r.setTextColor(t.footer.textColor),r.setFontSize(9),o=[n.center.name,n.center.phone,n.center.street1],n.center.street2&&o.push(n.center.street2),o.push(n.center.city),o.push(n.center.state.name||n.center.state),o.push(n.center.zip),o=o.join(" / "),r.text(o,(a-r.getTextWidth(o))/2,l-30)}}])},aJ1N:function(e,t,r){"use strict";var n=r("6RpP"),o=r.n(n),a=r("hsT8"),l=r.n(a),i=r("pnvM"),s=r.n(i),c=r("yCd9"),f=r.n(c),u=(r("8cZI"),r("jlzH"),r("9+31"),r("21jw"),r("z3no"),r("ttAN"),r("HJ8U"),r("JqvR"),r("mQgz"),r("IwuQ"),r("WGdK"),r("Lv1b"),r("a8hB")),d=r.n(u);angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(e,t,r,n,o,a,l){return(a=a||{}).baseUrl&&(tinymce.baseURL=a.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(i,s,c,f){if(n.tinymce){var u,p,g=f[0],m=f[1]||null,h={debounce:!0},v=function(t){var r,n=d()(r=t.getContent({format:h.format})).call(r);n=o.trustAsHtml(n),g.$setViewValue(n),e.$$phase||i.$digest()},b=l.getUniqueId();c.$set("id",b),u={},angular.extend(u,i.$eval(c.uiTinymce));var y,P=function(e){r.cancel(y),y=r((function(){return function(e){e.isDirty()&&(e.save(),v(e))}(e)}),400)},x={setup:function(t){t.on("init",(function(){g.$render(),g.$setPristine(),g.$setUntouched(),m&&m.$setPristine()})),t.on("ExecCommand change NodeChange ObjectResized",(function(){if(!h.debounce)return t.save(),void v(t);P(t)})),t.on("blur",(function(){s[0].blur(),g.$setTouched(),e.$$phase||i.$digest()})),t.on("remove",(function(){s.remove()})),a.setup&&a.setup(t,{updateView:v}),u.setup&&u.setup(t,{updateView:v})},format:u.format||"html",selector:"#"+c.id};angular.extend(h,a,u,x),r((function(){h.baseURL&&(tinymce.baseURL=h.baseURL);var e=tinymce.init(h);e&&"function"==typeof e.then?e.then((function(){w(i.$eval(c.ngDisabled))})):w(i.$eval(c.ngDisabled))})),g.$formatters.unshift((function(e){return e?o.trustAsHtml(e):""})),g.$parsers.unshift((function(e){return e?o.getTrustedHtml(e):""})),g.$render=function(){S();var e=g.$viewValue?o.getTrustedHtml(g.$viewValue):"";p&&p.getDoc()&&(p.setContent(e),p.fire("change"))},c.$observe("disabled",w);var I=i.$on("$tinymce:refresh",(function(e,r){var n=c.id;if(angular.isUndefined(r)||r===n){var o=s.parent(),a=s.clone();a.removeAttr("id"),a.removeAttr("style"),a.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,n),o.append(t(a)(i)),I()}}));i.$on("$destroy",(function(){S(),p&&(p.remove(),p=null)}))}function w(e){e?(S(),p&&p.getBody().setAttribute("contenteditable",!1)):(S(),p&&!p.mode.isReadOnly()&&p.getDoc()&&p.getBody().setAttribute("contenteditable",!0))}function S(){p||(p=tinymce.get(c.id))}}}}]).service("uiTinymceService",[function(){return new function(){var e=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++e}}}}]);r("Vzov"),t.a=angular.module("ffRichtext",["ui.tinymce"]).directive("ffRichtext",["ffHelper",function(e){return{restrict:"E",scope:!0,controller:"ffRichtextDirectiveCtrl as $rt",bindToController:{placeholders:"<",chargesTable:"<",chargesTableCreated:"=?",font:"@"},compile:function(t,r){var n=angular.element('<textarea ui-tinymce="$rt.tinymceOptions" ng-if="$rt.tinymceOptions"></textarea>');return e.copyInnerAttrs(t,r,n),t.append(n),this.link},link:function(e,t,r){}}}]).controller("ffRichtextDirectiveCtrl",["$scope","$timeout","dwAlerts",function(e,t,r){var n=this;n.$onInit=function(){var e,a,i,c=[n.font?o()(e="@import url('https://fonts.googleapis.com/css2?family=".concat(n.font,":wght@400;700'); body { font-family: ")).call(e,n.font,"; }"):"body { font-family: Helvetica, sans-serif; }","body { font-size: 15px } td { padding: 3px }",".mce-content-body .mce-offscreen-selection { left: -2000000px; max-width: 1000000px; position: absolute; }",".mce-content-body [contentEditable=false][data-mce-selected] { cursor: not-allowed; outline: 1px solid #b4d7ff; }",".mce-content-body .mce-mergetag:hover { background-color: rgba(0, 108, 231, .1); }",".ephox-snooker-resizer-cols { cursor: col-resize; }",".ephox-snooker-resizer-rows { cursor: ns-resize; }",".ephox-snooker-resizer-bar-dragging { outline: 2px solid #00f; outline-offset: -2px; }","a { color: #000 }"].join(" "),u=l()(a=["blocks","bold italic underline strikethrough","alignleft aligncenter alignright alignjustify","bullist numlist outdent indent","link image table","fontsize forecolor backcolor","code",n.chargesTable?"charges":null]).call(a,(function(e){return!!e})).join(" | "),d=l()(i=["lists link image","table autoresize code",n.chargesTable?"charges-table":null]).call(i,(function(e){return!!e})).join(" ");n.tinymceOptions={skin:!1,plugins:d,toolbar:u,toolbar_mode:"wrap",menubar:!1,promotion:!1,readonly:!1,license_key:"gpl",branding:!1,statusbar:!1,autoresize_bottom_margin:5,max_height:800,image_uploadtab:!0,images_upload_url:"test",automatic_uploads:!1,images_file_types:"jpeg,jpg,png",default_font_stack:["Helvetica","serif"],content_css:"",content_style:c,font_size_formats:"8px 10px 12px 14px 15px 16px 18px 20px 24px 36px",table_resize_bars:!0},n.placeholders&&n.placeholders.length&&(n.tinymceOptions.setup=function(e){e.ui.registry.addAutocompleter("placeholders",{trigger:"{{",minChars:0,columns:1,onAction:function(t,r,n){var a;e.selection.setRng(r),e.insertContent(o()(a='<span contentEditable="false" data-mce-cef-wrappable="true" data-mtag="'.concat(n,'" class="mce-mergetag">')).call(a,n,"</span>")),t.hide()},fetch:function(e){return new s.a((function(t){var r;t(f()(r=function(e){var t;return e=e.toLowerCase(),l()(t=n.placeholders).call(t,(function(t){return-1!==t.text.toLowerCase().indexOf(e)}))}(e)).call(r,(function(e){return{type:"autocompleteitem",value:e.value,text:e.text}})))}))}})}),tinymce.PluginManager.add("charges-table",(function(e,a){e.ui.registry.addButton("charges",{text:"Charges",onAction:function(a){var l,i,s,c,f,u,d,p,g,m,h=e.getContent();if((null==h?void 0:h.indexOf("charges-table"))>=0)return r.error("Charges table is already added to the template.");var v=['<table style="border-collapse: collapse; width: 100%; height: 72px; border-width: 1px;" border="1" class="charges-table">',"<tbody>",'<tr style="height: 2rem;"><td>ITEM</td><td>DESCRIPTION</td><td style="text-align: right;">QTY</td><td style="text-align: right;">PRICE</td><td style="text-align: right;">DISCOUNT</td><td style="text-align: right;">TOTAL</td></tr>',"</tbody>",'<tbody class="onetime-block">','<tr style="height: 2rem;"><td colspan="6" style="font-weight: bold; background-color: #ecf0f1;">One-time Charges</td></tr>',o()(l=o()(i=o()(s=o()(c=o()(f='<tr style="height: 2rem;" class="onetime-charge">\n<td>'.concat(b("{{product-name}}"),"</td>\n<td>")).call(f,b("{{product-description}}"),'</td>\n<td style="text-align: right;">')).call(c,b("{{qty}}"),'</td>\n<td style="text-align: right;">')).call(s,b("{{price}}"),'</td>\n<td style="text-align: right;">')).call(i,b("{{discount}}"),'</td>\n<td style="text-align: right;">')).call(l,b("{{total}}"),"</td>\n</tr>"),'<tr style="height: 2rem;" class="onetime-total"><td colspan="6" style="text-align: right; font-weight: bold;">Total One-time Charges: '.concat(b("{{total}}"),"</td></tr>"),"</tbody>",'<tbody class="recurring-block">','<tr style="height: 2rem;"><td colspan="6" style="font-weight: bold; background-color: #ecf0f1;">Recurring Charges</td></tr>',o()(u=o()(d=o()(p=o()(g=o()(m='<tr style="height: 2rem;" class="recurring-charge">\n<td>'.concat(b("{{product-name}}"),"</td>\n<td>")).call(m,b("{{product-description}}"),'</td>\n<td style="text-align: right;">')).call(g,b("{{qty}}"),'</td>\n<td style="text-align: right;">')).call(p,b("{{price}}"),'</td>\n<td style="text-align: right;">')).call(d,b("{{discount}}"),'</td>\n<td style="text-align: right;">')).call(u,b("{{total}}"),"</td>\n</tr>"),'<tr style="height: 2rem;" class="recurring-total"><td colspan="6" style="text-align: right; font-weight: bold;">Total Recurring Charges: '.concat(b("{{total}}"),"</td></tr>"),"</tbody>","</table>"];function b(e){var t;return o()(t='<span contentEditable="false" data-mce-cef-wrappable="true" data-mtag="'.concat(e,'" class="mce-mergetag">')).call(t,e,"</span>")}e.insertContent(v.join("")),t((function(){n.chargesTableCreated=Date.now()}))}})}))}}])},adyb:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalRecurringBilling",["ngResource","deskworks.config"]).factory("ProposalRecurringBilling",["$resource","$timeout","$filter","deskworksConfig",function(e,t,r,n){var o=e(n.getApiAbsUrl("/proposal/proposals/:proposalId/recurring-billing"),{},{});return{save:function(e){return o.save({proposalId:e.proposalId},{}).$promise.then((function(t){return e.recurringBillingId=t.recurringBillingId,t}))}}}])},bN8k:function(e,t,r){"use strict";r.r(t);var n=r("4BZO"),o=r.n(n),a=r("GlXu"),l=r.n(a),i=r("a8hB"),s=r.n(i),c=r("0zKI"),f=r.n(c),u=r("03wM"),d=r.n(u),p=(r("3dw1"),r("Muwe"),r("y89P"),r("QFeV")),g=r("UDUI"),m=r("G6E5"),h=r("77au"),v=r.n(h),b=r("6qoQ"),y=r.n(b);r("76E7"),r("PKSF"),r.p,r.p,t.default=angular.module("deskworks.ProposalViewCtrl",[p.default.name,g.a.name,m.a.name]).controller("ProposalViewCtrl",["$scope","$q","$translate","$route","$filter","$timeout","dwAlerts","state","helper","jsPDF","reportHelper","Proposal",function(e,t,r,n,a,i,c,u,p,g,m,h){var b=this,P=n.current.params.proposalId;u.setPageTitle(r.instant("PROPOSALS.EDIT.PAGE_TITLE")),b.onInit=function(){v.a.addFonts({font:{normal:"".concat(location.origin,"/assets/lato-regular.ttf"),bold:"".concat(location.origin,"/assets/lato-bold.ttf"),italics:"".concat(location.origin,"/assets/lato-italic.ttf"),bolditalics:"".concat(location.origin,"/assets/lato-bold-italic.ttf")}}),b.load()},b.load=function(){return t.all([h.get({proposalId:P}).catch((function(e){return c.error(e,"Failed to get proposal.")}))]).then((function(t){var r=o()(t,1)[0];b.proposal=r,i((function(){var t=y()(r.body,{defaultStyles:{a:{color:"#000"}}}),n={content:t,defaultStyle:{font:"font",fontSize:11}};t.forEach((function(e){return function e(t,r){var n,o,a;if("IMG"===t.nodeName&&null!==(n=t.image)&&void 0!==n&&l()(o=s()(n).call(n).toLowerCase()).call(o,"file:"))return void f()(r).call(r,r.indexOf(t),1);"TABLE"===t.nodeName&&(t.layout={paddingLeft:function(e,t){return 3},paddingRight:function(e,t){return 3},paddingTop:function(e,t){return 3},paddingBottom:function(e,t){return 3}});d()(t).forEach((function(e){(l()(e).call(e,"mso")||"font"===e)&&delete t[e]})),null!==(a=t.style)&&void 0!==a&&a.some((function(e){var t;return(null==e?void 0:l()(t=e.toLowerCase()).call(t,"mso"))||(null==e?void 0:l()(e).call(e,"WordSection"))}))&&(delete t.margin,delete t._margin,delete t.marginLeft,delete t.marginRight,delete t.marginTop,delete t.marginBottom);(Array.isArray(t.stack)||Array.isArray(t.text))&&(t.stack||t.text).forEach((function(r){return e(r,t.stack||t.text)}))}(e,t)})),v.a.createPdf(n).getBlob((function(t){b.pdf=t,e.$apply()}))}),100)}))},b.back=function(){return u.setPath("/proposals")},b.downloadPdf=function(){if(b.pdf){var e=b.proposal.name.toLowerCase().replace(/\s+/g,"-").replace(/[^A-Za-z0-9-]/g,"")+"-"+a("date")(moment(),"yyyyMMdd-HHmmss")+".pdf";m.download({blob:b.pdf,fileName:e})}},b.onInit()}])},"eM+T":function(e,t){e.exports='<div id="proposal-templates" ff-bulk-read-only> <h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v"> <ff-panel> <ff-header ng-if="$ctrl.proposals.length"> <ff-row> <cell flex="1 1 15%"><span translate="GLOBAL.DATE"></span></cell> <cell flex="1 1 40%"><span translate="PROPOSALS.NAME"></span></cell> <cell flex="1 1 40%"><span translate="PROPOSALS.DESCRIPTION"></span></cell> <cell flex="1 1 5%" class="ff-small ff-center"><span translate="PROPOSALS.RECURRING_BILLING"></span></cell> <ff-btn-group flex="0 0 auto" class="buttons-row zero-height"> <ff-btn sense="view" size="xs"></ff-btn> <ff-btn sense="edit" size="xs"></ff-btn> <ff-btn sense="delete" size="xs"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-spin class="ff-spin-placeholder" ng-if="!$ctrl.proposals"></ff-spin> <span ng-if="$ctrl.proposals && !$ctrl.proposals.length" translate="GLOBAL.NONE"></span> <ff-row ng-repeat="proposal in $ctrl.proposals"> <ff-static flex="1 1 15%">{{proposal.date | date: \'mediumDate\'}}</ff-static> <ff-static flex="1 1 40%">{{proposal.name}}</ff-static> <ff-static flex="1 1 40%">{{proposal.description}}</ff-static> <ff-static flex="1 1 5%" class="ff-center"><ff-icon sense="checkMark" ng-if="proposal.recurringBillingId"></ff-icon></ff-static> <ff-btn-group flex="0 0 auto" class="buttons-row"> <ff-btn sense="view" size="xs" ff-click="$ctrl.view(proposal)" title="{{\'GLOBAL.BTN_VIEW\' | translate}}"></ff-btn> <ff-btn sense="edit" size="xs" ff-click="$ctrl.edit(proposal)" title="{{\'GLOBAL.BTN_EDIT\' | translate}}"></ff-btn> <ff-btn sense="delete" size="xs" ff-click="$ctrl.delete(proposal)" title="{{\'GLOBAL.BTN_DELETE\' | translate}}"></ff-btn> </ff-btn-group> </ff-row> </ff-panel> <ff-btn-group> <ff-btn sense="new" ff-click="$ctrl.new()"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> </ff-btn-group> </div> </div> '},gJCS:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.ProposalPriceList",["ngResource","deskworks.config"]).factory("ProposalPriceList",["$resource","$timeout","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/proposal/price-lists/:priceListId"));return{query:function(e){var t=e.centerId;return n.query({centerId:t}).$promise}}}])},gbqF:function(e,t,r){"use strict";r.r(t);var n=r("4BZO"),o=r.n(n),a=r("0zKI"),l=r.n(a),i=r("QFeV");t.default=angular.module("deskworks.ProposalsCtrl",[i.default.name]).controller("ProposalsCtrl",["$scope","$q","$translate","$window","dwAlerts","state","helper","Proposal",function(e,t,r,n,a,i,s,c){var f=this;i.setPageTitle(r.instant("PROPOSALS.LIST.PAGE_TITLE")),f.onInit=function(){f.load()},f.load=function(){return t.all([c.query({userId:i.getCurrentUserId(),centerId:i.getCurrentCenterId()}).catch((function(e){return a.error(e,"Failed to get proposals.")}))]).then((function(e){var t=o()(e,1)[0];f.proposals=t}))},f.new=function(){return i.setPath(i.getPath()+"/new")},f.edit=function(e){return i.setPath(i.getPath()+"/"+e.proposalId)},f.view=function(e){return i.setPath(i.getPath()+"/view/"+e.proposalId)},f.delete=function(e){if(n.confirm(r.instant("PROPOSALS.CONFIRM_DELETE")))return c.delete(e).catch((function(e){return a.error(e,"Failed to delete proposal.")})).then((function(){var t;l()(t=f.proposals).call(t,f.proposals.indexOf(e),1)}))},f.onInit()}])},jvYD:function(e,t){e.exports='<form name="$ctrl.form" novalidate id="proposal" ff-bulk-read-only> <h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v" ng-if="!$ctrl.initialized"> <ff-panel style="max-width:480px" ff-dim="!$ctrl.templates || !$ctrl.priceLists"> <label class="ff-row"> <ff-label flex="0 0 150px"><req translate="PROPOSALS.NEW.SELECT_TEMPLATE"></req></ff-label> <ff-select flex="1 1 20%" ff-model="$ctrl.proposal.templateId" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.TEMPLATE.EDIT.PAGE_TITLE\' | translate }}"> <option ng-value="tpl.templateId" ng-repeat="tpl in $ctrl.templates">{{tpl.name}}</option> </ff-select> </label> <label class="ff-row"> <ff-label flex="0 0 150px"><req translate="PROPOSALS.NEW.SELECT_PRICE_LIST"></req></ff-label> <ff-select flex="1 1 20%" ff-model="$ctrl.proposal.priceListId" ff-disabled="$ctrl.proposal.recurringBillingId" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.NEW.SELECT_PRICE_LIST\' | translate }}"> <option ng-value="pl.priceListId" ng-repeat="pl in $ctrl.priceLists">{{pl.name}}</option> </ff-select> </label> </ff-panel> <ff-btn-group> <ff-btn sense="back" ff-click="$ctrl.back()"><span translate="GLOBAL.BTN_BACK"></span></ff-btn> <ff-btn sense="next" ff-click="$ctrl.next()" ff-disabled="$ctrl.form.$pristine && !$ctrl.proposal.recurringBillingId"><span translate="GLOBAL.BTN_NEXT"></span></ff-btn> </ff-btn-group> </div> <div class="ff-grid gutter-v gutter-h" ng-if="$ctrl.initialized"> <ff-panel ff-dim="!$ctrl.proposal"> <div class="ff-grid gutter-h"> <div flex="{md: \'0 0 50%\'}"> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="PROPOSALS.PRICE_LIST"></span></ff-label> <ff-static>{{$ctrl.proposal.$$priceList.name}}</ff-static> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="PROPOSALS.RECURRING_BILLING_ID"></span></ff-label> <ff-static>{{$ctrl.proposal.recurringBillingId ? \'#\' + $ctrl.proposal.recurringBillingId : \'-\' }}</ff-static> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><req translate="PROPOSALS.NAME"></req></ff-label> <ff-text ff-model="$ctrl.proposal.name" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.NAME\' | translate }}"></ff-text> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="PROPOSALS.DESCRIPTION"></span></ff-label> <ff-text ff-model="$ctrl.proposal.description" ff-validate-alert="{{ \'PROPOSALS.DESCRIPTION\' | translate }}"></ff-text> </label> </div> <div flex="{md: \'0 0 50%\'}"> <label class="ff-row"> <ff-label flex="0 0 120px"><req translate="RECURRING_BILLING.DATES.START_DATE"></req></ff-label> <ff-date ff-model="$ctrl.proposal.startDate" ff-required="true" ff-bulk-read-only-false="!!$ctrl.proposal.recurringBillingId" ff-validate-alert="{{\'RECURRING_BILLING.DATES.START_DATE\' | translate}}"></ff-date> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><span translate="RECURRING_BILLING.RENEWAL_DATE"></span></ff-label> <ff-date ff-model="$ctrl.proposal.renewalDate" ff-validate-alert="{{\'RECURRING_BILLING.RENEWAL_DATE\' | translate}}"></ff-date> </label> <label class="ff-row"> <ff-label flex="0 0 120px"><req translate="RECURRING_BILLING.RENEWAL_TERM"></req></ff-label> <ff-number flex="0 0 30px" ff-model="$ctrl.proposal.renewalTerm" ff-required="true" ff-gt="0" ff-lte="60" ff-validate-alert="{{\'RECURRING_BILLING.RENEWAL_TERM\' | translate}}"></ff-number> <ff-static>month(s)</ff-static> </label> </div> </div> <ff-header style="margin-top:.5rem"> <ff-row> <cell flex="1 1 30%"><span translate="PROPOSALS.ITEM"></span></cell> <cell flex="1 1 50%"><span translate="PROPOSALS.DESCRIPTION"></span></cell> <cell flex="0 0 50px" class="ff-right"><span translate="PROPOSALS.QUANTITY"></span></cell> <cell flex="0 0 80px" class="ff-right"><span translate="PROPOSALS.PRICE"></span></cell> <cell flex="0 0 90px" class="ff-right"><span translate="GLOBAL.DISCOUNT"></span></cell> <cell flex="0 0 80px" class="ff-right"><span translate="PROPOSALS.TOTAL"></span></cell> <cell flex="0 0 150px" class="ff-right"><span translate="PROPOSALS.DEDICATED_SPACE"></span></cell> <ff-btn-group flex="none" class="buttons-row zero-height" ng-if="$ctrl.multiCharges"> <ff-btn sense="delete" size="xs"></ff-btn> </ff-btn-group> </ff-row> </ff-header> <ff-row ng-repeat="charge in $ctrl.proposal.charges" ff-bulk-read-only-false="!!$ctrl.proposal.recurringBillingId"> <ff-select flex="1 1 30%" ff-model="charge.priceListProductId" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.PRICE_LIST_PRODUCT\' | translate }}" ff-change="$ctrl.onProductChange(charge)" ff-options="pp.priceListProductId as pp.productName for pp in $ctrl.priceListProductsList"> </ff-select> <ff-text flex="1 1 50%" ff-model="charge.description" maxlength="1024" ff-validate-alert="{{ \'PROPOSALS.DESCRIPTION\' | translate }}"></ff-text> <ff-number flex="0 0 50px" class="ff-right" ff-model="charge.quantity" ff-gt="0" ff-required="true" ff-validate-alert="{{ \'PROPOSALS.QUANTITY\' | translate }}"></ff-number> <ff-number flex="0 0 80px" class="ff-right" ff-model="charge.customPrice" ff-required="true" ff-gte="0" ff-validate-alert="{{ \'PROPOSALS.PRICE\' | translate }}"></ff-number> <ff-row flex="0 0 90px"> <ff-number class="ff-right" ff-model="charge.discountAmount" ff-gte="0" placeholder="0" ff-validate-alert="{{ \'GLOBAL.DISCOUNT\' | translate }}"></ff-number> <ff-select flex="0 1 40px" ff-model="charge.discountType" ff-options="opt as opt for opt in $ctrl.optsDiscountType"></ff-select> </ff-row> <ff-static flex="0 0 80px" class="ff-right"> {{charge.customPrice !== undefined ? ((charge.customPrice * charge.quantity - (charge.discountType === \'$\' ? charge.discountAmount || 0 : (charge.customPrice * charge.quantity) * (charge.discountAmount || 0) / 100)) | currency) : \'\'}} </ff-static> <ff-select flex="0 0 150px" ff-model="charge.attachedReservationUnitId" ff-options="opt.id as opt.name for opt in $ctrl.getVacantResUnits(charge)"> <option translate="GLOBAL.NONE"></option> </ff-select> <ff-btn-group flex="0 0 auto" class="buttons-row" ng-if="$ctrl.multiCharges"> <ff-btn sense="delete" size="xs" ff-click="$ctrl.delete(charge)" title="{{\'GLOBAL.BTN_DELETE\' | translate}}"></ff-btn> </ff-btn-group> </ff-row> <ff-btn-group class="ff-section-buttons" ng-if="$ctrl.multiCharges"> <ff-btn sense="add" size="xs" ff-click="$ctrl.add()" title="{{\'GLOBAL.BTN_NEW\' | translate}}"></ff-btn> </ff-btn-group> </ff-panel> <ff-panel class="email-template-panel" style="max-width:800px"> <ff-row> <ff-richtext ff-model="$ctrl.proposal.body" class="ta-email" charges-table="true" charges-table-created="$ctrl.chargesTableCreated" font="Lato"></ff-richtext> </ff-row> </ff-panel> <ff-btn-group> <ff-btn sense="back" ff-click="$ctrl.back()"><span translate="GLOBAL.BTN_BACK"></span></ff-btn> <ff-btn sense="save" ff-click="$ctrl.save()" ff-disabled="$ctrl.form.$pristine"><span translate="GLOBAL.BTN_SAVE"></span></ff-btn> <ff-btn sense="save" ff-click="$ctrl.createRecurring()" ng-if="$ctrl.proposalId !== \'new\'"><span translate="PROPOSALS.BTN_CREATE_RB"></span></ff-btn> </ff-btn-group> </div> </form> '},pgmu:function(e,t){e.exports='<div id="proposal-view" ff-bulk-read-only> <h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v"> <ff-panel> <div pdf-preview="$ctrl.pdf"></div> </ff-panel> <ff-btn-group> <ff-btn sense="download" ff-click="$ctrl.downloadPdf()" ff-disabled="!$ctrl.pdf"> <span translate="PROPOSALS.BTN_DOWNLOAD_PDF"></span> </ff-btn> <ff-btn sense="back" ff-click="$ctrl.back()"><span translate="GLOBAL.BTN_BACK"></span></ff-btn> </ff-btn-group> </div> </div> '},uIrw:function(e,t){e.exports='<div class="dw-modal"> <div class="dw-modal-fade" ng-click="$ctrl.close()"></div> <div class="dw-modal-dialog" style="max-width:320px"> <div class="ff-grid"> <ff-header ff-spin="$ctrl.spin" class="ff-spin-right ff-spin-sm"><span translate="PROPOSALS.CATEGORIES"></span></ff-header> <span ng-if="$ctrl.categories && !$ctrl.categories.length" translate="GLOBAL.NONE" style="line-height:2.4rem"></span> <form name="form" ng-repeat="cat in $ctrl.categories" novalidate> <ff-row> <ff-text ff-model="cat.name" ff-required="true" ff-validate-alert="{{\'PROPOSALS.NAME\' | translate}}" ff-change="$ctrl.save(cat, form)"></ff-text> <ff-btn-group flex="none" class="buttons-row"> <ff-btn sense="remove" size="xs" title="{{\'GLOBAL.BTN_DELETE\' | translate}}" ff-click="$ctrl.delete(cat, $index)"></ff-btn> </ff-btn-group> </ff-row> </form> <ff-btn-group class="ff-tmargin"> <ff-btn sense="new" ff-click="$ctrl.add()"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> <ff-btn sense="ok" ff-click="$ctrl.close()"><span translate="GLOBAL.BTN_OK"></span></ff-btn> </ff-btn-group> </div> </div> </div> '},uM0a:function(e,t,r){"use strict";r.r(t);r("JBxO"),r("FdtR");var n=r("0zKI"),o=r.n(n),a=r("CZKu");t.default=angular.module("deskworks.ProposalCategoriesCtrl",["debounce",a.default.name]).controller("ProposalCategoriesCtrl",["$scope","$q","$translate","dwAlerts","state","helper","close","debounce","ProposalCategory","categories",function(e,t,r,n,a,l,i,s,c,f){var u=this;u.categories=f,u.close=i,u.add=function(){u.categories.push({})},u.delete=function(e,r){return(e.categoryId?c.delete(e):t.when()).catch((function(e){return n.error(e,"Failed to delete proposal category.")})).then((function(){var e;return o()(e=u.categories).call(e,r,1)}))},u.save=s((function(e,t){if(t.$valid)return u.spin=!0,c.save(e).catch((function(e){return n.error(e,"Failed to save proposal category.")})).finally((function(){u.spin=!1}))}),500)}])},z6HB:function(e,t,r){}}]);