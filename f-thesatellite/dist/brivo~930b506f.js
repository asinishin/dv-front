(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"3s9Y":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoProduct",["ngResource","deskworks.config"]).factory("BrivoProduct",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/products/:id"),{},{get:{method:"GET"},update:{method:"PUT"}});return{get:function(e,t){return r.get({centerId:e,id:t}).$promise},save:function(e,t,n){return r.update({centerId:e,id:t},n).$promise}}}])},"5uVd":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoCenter",["ngResource","deskworks.config"]).factory("BrivoCenter",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/centers/:centerId"),{},{update:{method:"PUT"}});return{query:function(){return r.query().$promise},get:function(e){return r.get({centerId:e}).$promise},save:function(e){return r.update({centerId:e.id},e).$promise}}}])},"9I4w":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoUser",["ngResource","deskworks.config"]).factory("BrivoUser",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/users/:id"),{},{get:{method:"GET"},update:{method:"PUT"}});return{get:function(e,t){return r.get({centerId:e,id:t}).$promise},save:function(e,t,n){return r.update({centerId:e,id:t},n).$promise}}}])},ASes:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoGroup",["ngResource","deskworks.config"]).factory("BrivoGroup",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/brivo-groups"));return{query:function(e){return r.query({centerId:e}).$promise}}}])},B2XZ:function(e,t,r){"use strict";r.r(t);var n=r("L6kM"),o=r.n(n),s=r("G8fu"),i=r("c+lc");t.default=angular.module("deskworks.brivoAccessPointsDirective",["debounce",s.default.name,i.default.name]).directive("brivoAccessPoints",(function(){return{template:o.a,restrict:"E",scope:!0,controller:"BrivoAccessPointsCtrl as $ctrl",bindToController:{save:"=",form:"<?",centerId:"<",brivoAccessPoints:"<?"}}})).controller("BrivoAccessPointsCtrl",["$scope","$q","dwAlerts","debounce","helper","BrivoAccessPoint","optsBrivoAction",function(e,t,r,n,o,s,i){var c=this;function a(){return s.save({centerId:c.centerId,data:c.accessPoints}).catch((function(e){return r.error(e,"Failed to save Brivo access points.")}))}c.$onInit=function(){c.optsAction=i,c.load()},c.load=function(){return t.all([(c.brivoAccessPoints?t.when(c.brivoAccessPoints):s.query({centerId:c.centerId})).catch((function(e){return r.error(e,"Failed to load Brivo access points.")})).then((function(e){c.accessPoints=e,c.accessPoints&&c.accessPoints.length&&(c.save=a)}))])}}])},"D+fP":function(e,t){e.exports='<div class="animate-collapse" ng-if="$ctrl.centerId !== \'new\' && ($ctrl.groups.length || $ctrl.accessPoints.length)"> <ff-panel> <ff-panel-header class="ff-spin-right"> <span translate="INTEGRATIONS_SETUP.BRIVO.HEADER"></span> </ff-panel-header> <brivo-groups center-id="$ctrl.centerId" save="$ctrl.saveBrivoGroups" form="$ctrl.form" brivo-groups="$ctrl.groups"></brivo-groups> <brivo-access-points center-id="$ctrl.centerId" save="$ctrl.saveBrivoAccessPoints" form="$ctrl.form" brivo-access-points="$ctrl.accessPoints"></brivo-access-points> </ff-panel> </div> '},Ei7L:function(e,t){e.exports='<div class="animate-collapse" ng-if="$ctrl.groups.length && !$ctrl.userId"> <div class="ff-relative"> <ff-header style="padding-top:.5rem"><span translate="INTEGRATIONS_SETUP.BRIVO_GROUPS"></span></ff-header> <ff-btn sense="new" size="xs" style="position:absolute;right:0;top:1px" title="{{\'GLOBAL.BTN_NEW\' | translate}}" ff-click="$ctrl.add()"></ff-btn> </div> <div class="ff-row" ng-repeat="brivoGroupId in $ctrl.data.brivoGroupIds track by $index"> <ff-select name="saltoAccessGroup" ff-model="$ctrl.data.brivoGroupIds[$index]" ff-required="true" ff-validate-alert="{{\'INTEGRATIONS_SETUP.BRIVO_GROUP\' | translate}}" ff-options="opt.id as opt.name for opt in $ctrl.getGroups($ctrl.data.brivoGroupIds[$index])"> </ff-select> <ff-btn-group flex="0 0 auto" class="buttons-row"> <ff-btn sense="delete" size="xs" ff-click="$ctrl.delete($index)" title="{{\'GLOBAL.BTN_DELETE\' | translate}}"></ff-btn> </ff-btn-group> </div> </div> <div class="animate-collapse" ng-if="$ctrl.groups.length && $ctrl.userId"> <ff-row> <ff-label flex="0 1 116px"><span translate="INTEGRATIONS_SETUP.BRIVO_GROUPS"></span></ff-label> <ff-static>{{$ctrl.groupsAsString}}</ff-static> </ff-row> </div> '},FOhE:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoSite",["ngResource","deskworks.config"]).factory("BrivoSite",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/brivo-sites"));return{query:function(){return r.query().$promise}}}])},G8fu:function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BrivoAccessPoint",["ngResource","deskworks.config"]).factory("BrivoAccessPoint",["$resource","deskworksConfig",function(e,t){var r=e(t.getApiAbsUrl("/brivo/brivo-access-points"),{},{update:{method:"PUT"}});return{query:function(e){var t=e.centerId;return r.query({centerId:t}).$promise},save:function(e){var t=e.centerId,n=e.data;return r.update({centerId:t},{data:n}).$promise}}}])},JXQ0:function(e,t,r){"use strict";r.r(t);r("8cZI");t.default=angular.module("deskworks.BrivoSettings",["ngResource","deskworks.config"]).factory("BrivoSettings",["$resource","$location","deskworksConfig",function(e,t,r){var n=e(r.getApiAbsUrl("/brivo/settings"),{},{update:{method:"PUT"}}),o=e(r.getApiAbsUrl("/brivo/oauth2"));return{get:function(){return n.get().$promise},save:function(e){return n.update({},{apiKey:e.apiKey,noAccessPolicy:e.noAccessPolicy}).$promise},getConnectUrl:function(e){return r.getApiAbsUrl(["/brivo/oauth2?nonce=".concat(e),"redirectUri="+encodeURIComponent(t.absUrl())].join("&"))},disconnect:function(){return o.delete().$promise}}}])},L6kM:function(e,t){e.exports='<ff-spin ng-if="$ctrl.saveSpin"></ff-spin> <form name="form" novalidate ff-dim="$ctrl.spin"> <ff-header style="margin-top:.5rem"> <ff-row> <cell flex="0 0 50%"><span translate="INTEGRATIONS_SETUP.BRIVO.ACCESS_POINT"></span></cell> <cell flex="0 0 50%"><span translate="INTEGRATIONS_SETUP.BRIVO.ACTION"></span></cell> </ff-row> </ff-header> <label class="ff-row" ng-repeat="ap in $ctrl.accessPoints"> <ff-label flex="0 0 50%">{{::ap.name}}</ff-label> <ff-select ff-model="ap.action" name="brivoAccessPointAction" ff-validate-alert="{{\'INTEGRATIONS_SETUP.BRIVO.ACCESS_POINT\' | translate}}" ff-options="act.id as act.name for act in $ctrl.optsAction"></ff-select> </label> </form> '},TAZt:function(e,t,r){var n={"./access-points/brivo-access-points.directive.js":"B2XZ","./center-settings/brivo-center-settings.directive.js":"ddEo","./groups/brivo-groups.directive.js":"Ue4c","./services/brivo-access-point.service.js":"G8fu","./services/brivo-center.service.js":"5uVd","./services/brivo-group.service.js":"ASes","./services/brivo-opts-action.service.js":"c+lc","./services/brivo-product.service.js":"3s9Y","./services/brivo-settings.service.js":"JXQ0","./services/brivo-site.service.js":"FOhE","./services/brivo-user.service.js":"9I4w","./settings/brivo-settings.directive.js":"n7Yw"};function o(e){var t=s(e);return r(t)}function s(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=s,e.exports=o,o.id="TAZt"},Tsul:function(e,t,r){"use strict";r.r(t);var n=r("yCd9"),o=r.n(n),s=r("lRNC"),i=r.n(s),c=["$injector",function(e){var t,n,s=(t=r("TAZt"),o()(n=i()(t).call(t)).call(n,t));e.loadNewModules(o()(s).call(s,(function(e){return e.default.name})))}];t.default=c},Ue4c:function(e,t,r){"use strict";r.r(t);r("8cZI");var n=r("0zKI"),o=r.n(n),s=r("hsT8"),i=r.n(s),c=r("yCd9"),a=r.n(c),l=r("nbuU"),f=r.n(l),u=r("Ei7L"),d=r.n(u),v=r("ASes"),p=r("5uVd"),g=r("3s9Y"),b=r("9I4w");t.default=angular.module("deskworks.brivoGroupsDirective",[v.default.name,p.default.name,g.default.name,b.default.name]).directive("brivoGroups",(function(){return{template:d.a,restrict:"E",scope:!0,controller:"BrivoGroupsCtrl as $ctrl",bindToController:{save:"=",form:"<?",productId:"<?",centerId:"<?",userId:"<?",brivoGroups:"<?"}}})).controller("BrivoGroupsCtrl",["$scope","$q","dwAlerts","helper","state","BrivoGroup","BrivoProduct","BrivoCenter","BrivoUser",function(e,t,r,n,s,c,l,u,d){var v=this;function p(){var t=v.centerId||s.getCurrentCenterId();return(v.productId?l.save(t,v.productId,v.data).catch((function(e){return r.error(e,"Failed to save Brivo product")})):u.save(v.data).catch((function(e){return r.error(e,"Failed to save Brivo center")}))).then((function(t){return(e.formProduct||e.$parent.$ctrl.form).$setPristine(),t}))}v.$onInit=function(){v.load()},v.add=function(){v.data.brivoGroupIds.push(null),v.form&&v.form.$setDirty()},v.delete=function(e){var t;o()(t=v.data.brivoGroupIds).call(t,e,1),v.form&&v.form.$setDirty()},v.getGroups=function(e){var t;return i()(t=v.groups).call(t,(function(t){return v.data.brivoGroupIds.indexOf(t.id)<0||e&&t.id===e}))},v.load=function(){var e=v.centerId||s.getCurrentCenterId(),n=[(v.productId?l.get(e,v.productId).catch((function(e){return r.error(e,"Failed to get Brivo product.")})):v.userId?d.get(e,v.userId).catch((function(e){return r.error(e,"Failed to get Brivo user.")})):u.get(e).catch((function(e){return r.error(e,"Failed to get Brivo center.")}))).then((function(e){return v.data=e})),(v.brivoGroups?t.when(v.brivoGroups):c.query(e)).catch((function(e){return r.error(e,"Failed to query Brivo groups.")})).then((function(e){v.groups=e,v.groups&&v.groups.length&&(v.save=p)}))];return t.all(n).then((function(){var e;v.userId&&(v.groupsAsString=a()(e=v.data.inheritedGroupIds).call(e,(function(e){var t;return(f()(t=v.groups).call(t,(function(t){return t.id===e}))||{name:e}).name})).join(", "))}))}}])},"c+lc":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.optsBrivoAction",[]).factory("optsBrivoAction",["$rootScope","$translate",function(e,t){var r=[{id:null,_name:"-"},{id:"checkIn",_name:"INTEGRATIONS_SETUP.BRIVO.ACTION.CHECK_IN"},{id:"checkOut",_name:"INTEGRATIONS_SETUP.BRIVO.ACTION.CHECK_OUT"}];function n(){r.forEach((function(e){e.name=t.instant(e._name)}))}return n(),e.$on("$setTranslationsSuccess",n),r}])},ddEo:function(e,t,r){"use strict";r.r(t);var n=r("D+fP"),o=r.n(n),s=r("ASes"),i=r("G8fu");t.default=angular.module("deskworks.brivoCenterSettingsDirective",[s.default.name,i.default.name]).directive("brivoCenterSettings",(function(){return{template:o.a,restrict:"E",scope:!0,controller:"BrivoCenterSettingsCtrl as $ctrl",bindToController:{save:"=",form:"<?",centerId:"<"}}})).controller("BrivoCenterSettingsCtrl",["$scope","$q","dwAlerts","helper","state","BrivoGroup","BrivoAccessPoint",function(e,t,r,n,o,s,i){var c=this;function a(){return t.all([c.saveBrivoGroups?c.saveBrivoGroups():t.when(),c.saveBrivoAccessPoints?c.saveBrivoAccessPoints():t.when()])}c.$onInit=function(){c.load()},c.load=function(){var e=c.centerId,n=[s.query(e).catch((function(e){return r.error(e,"Failed to query Brivo groups.")})).then((function(e){c.groups=e,c.groups&&c.groups.length&&(c.save=a)})),i.query({centerId:e}).catch((function(e){return r.error(e,"Failed to load Brivo access points.")})).then((function(e){c.accessPoints=e,c.accessPoints&&c.accessPoints.length&&(c.save=a)}))];return t.all(n)}}])},i3bS:function(e,t){e.exports='<ff-panel> <ff-panel-header class="ff-spin-right"> <span translate="INTEGRATIONS_SETUP.BRIVO.HEADER"></span> </ff-panel-header> <ff-spin ng-if="$ctrl.saveSpin"></ff-spin> <form name="form" novalidate ff-dim="$ctrl.spin"> <label class="ff-row"> <ff-label flex="0 1 130px"><span translate="INTEGRATIONS_SETUP.CONNECTION"></span></ff-label> <ff-static ng-if="!$ctrl.brivoSettings.connected"> <a href="{{$ctrl.getConnectUrl()}}" target="_self" rel="noopener" ng-if="$ctrl.brivoSettings"> <ff-btn sense="ok" size="sm"><span translate="INTEGRATIONS_SETUP.CONNECT"></span></ff-btn> </a> </ff-static> <ff-static ng-if="$ctrl.brivoSettings.connected"> <ff-icon sense="check"></ff-icon>&nbsp;<span translate="INTEGRATIONS_SETUP.CONNECTED"></span> </ff-static> <ff-btn-group flex="none" class="buttons-row" ng-if="$ctrl.brivoSettings.connected"> <ff-btn sense="delete" size="xs" ff-click="$ctrl.disconnect()" title="{{\'INTEGRATIONS_SETUP.DISCONNECT\' | translate}}"></ff-btn> </ff-btn-group> </label> <label class="ff-row" ng-if="$ctrl.brivoSettings.connected"> <ff-label flex="0 1 130px"><req translate="INTEGRATIONS_SETUP.API_KEY"></req></ff-label> <ff-text ff-model="$ctrl.brivoSettings.apiKey" ff-change="$ctrl.saveSettings(form)" ff-required="true" placeholder="a123b342gbe4e49skzxcw42a" ff-validate-alert="{{\'INTEGRATIONS_SETUP.API_KEY\' | translate}}"></ff-text> </label> <label class="ff-row" ng-if="$ctrl.brivoSettings.connected"> <ff-label flex="0 1 130px"><span translate="INTEGRATIONS_SETUP.BRIVO.NO_ACCESS_POLICY"></span></ff-label> <ff-select name="noAccessPolicy" ff-model="$ctrl.brivoSettings.noAccessPolicy" ff-change="$ctrl.saveSettings(form)"> <option value="suspend" translate="INTEGRATIONS_SETUP.BRIVO.NO_ACCESS_POLICY.SUSPEND"></option> <option value="delete" translate="INTEGRATIONS_SETUP.BRIVO.NO_ACCESS_POLICY.DELETE"></option> </ff-select> </label> <div ng-if="$ctrl.brivoSettings.connected && $ctrl.brivoSettings.apiKey && $ctrl.brivoCenters" class="animate-collapse"> <ff-header style="margin-top:.5rem"> <ff-row> <cell flex="0 0 50%"><span translate="INTEGRATIONS_SETUP.BRIVO.CENTER"></span></cell> <cell flex="0 0 50%"><span translate="INTEGRATIONS_SETUP.BRIVO.SITE"></span></cell> </ff-row> </ff-header> <label class="ff-row" ng-repeat="center in $ctrl.brivoCenters"> <ff-label flex="0 0 50%">{{::center.name}}</ff-label> <ff-select ff-model="center.brivoSiteId" name="brivoSiteId" ff-validate-alert="{{\'INTEGRATIONS_SETUP.BRIVO.SITE\' | translate}}" ff-options="site.id as site.name for site in $ctrl.brivoSites" ff-change="$ctrl.saveCenter(center)"></ff-select> </label> </div> </form> </ff-panel> '},n7Yw:function(e,t,r){"use strict";r.r(t);r("JBxO"),r("FdtR");var n=r("i3bS"),o=r.n(n),s=r("JXQ0"),i=r("5uVd"),c=r("FOhE");t.default=angular.module("deskworks.brivoSettingsDirective",["debounce",s.default.name,i.default.name,c.default.name]).directive("brivoSettings",(function(){return{template:o.a,restrict:"E",scope:!0,controller:"BrivoSettingsCtrl as $ctrl"}})).controller("BrivoSettingsCtrl",["$scope","$q","dwAlerts","debounce","helper","BrivoSettings","BrivoCenter","BrivoSite",function(e,t,r,n,o,s,i,c){var a=this;a.$onInit=function(){a.load()},a.getConnectUrl=function(){return s.getConnectUrl(a.brivoSettings?a.brivoSettings.nonce:"")},a.disconnect=function(){return s.disconnect().catch((function(e){return r.error(e,"Failed to disconnect from Brivo.")})).then((function(){a.brivoSettings.connected=!1}))},a.load=function(){return a.spin=!0,t.all([s.get().catch((function(e){return r.error(e,"Failed to load Brivo settings.")})).then((function(e){a.brivoSettings=e})),i.query().catch((function(e){return r.error(e,"Failed to load Brivo centers.")})).then((function(e){a.brivoCenters=e}))]).then((function(){return a.loadBrivoSites()})).finally((function(){a.spin=!1}))},a.loadBrivoSites=function(){return a.brivoSettings.connected&&a.brivoSettings.apiKey?c.query().catch((function(e){return r.error(e,"Failed to load Brivo sites.")})).then((function(e){e.push({id:null,name:"-"}),a.brivoSites=e})):t.when()},a.saveSettings=n((function(e){if(e&&e.$invalid)return;return a.saveSpin=!0,s.save(a.brivoSettings).catch((function(e){return r.error(e,"Failed to save Brivo settings.")})).finally((function(){a.saveSpin=!1})).then((function(){return a.loadBrivoSites()}))}),500),a.saveCenter=n((function(e){return a.saveSpin=!0,i.save(e).catch((function(e){return r.error(e,"Failed to save Brivo center.")})).finally((function(){a.saveSpin=!1}))}),500)}])}}]);