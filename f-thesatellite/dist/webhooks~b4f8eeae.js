(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{"9qs/":function(e,n,t){"use strict";t.r(n),n.default=angular.module("deskworks.Webhook",["ngResource","deskworks.config"]).factory("Webhook",["$resource","deskworksConfig",function(e,n){var t=e(n.getApiAbsUrl("/webhooks/webhooks/:id"),{},{update:{method:"PUT"}});return{query:function(){return t.query().$promise},save:function(e){return e.id?t.update({id:e.id},e).$promise:t.save({},e).$promise.then((function(n){e.id=n.id}))},delete:function(e){return t.delete(e).$promise}}}])},BkUy:function(e,n,t){"use strict";t.r(n);var o=t("4BZO"),r=t.n(o),i=t("hsT8"),s=t.n(i),f=t("0zKI"),a=t.n(f),c=(t("JBxO"),t("FdtR"),t("3dw1"),t("W84Y")),l=t.n(c),u=t("9qs/"),d=t("xZNb"),b=t("tI4i");n.default=angular.module("deskworks.webhooksDirective",["debounce",u.default.name,d.default.name,b.default.name]).directive("webhooks",(function(){return{template:l.a,restrict:"E",scope:!0,controller:"WebhooksCtrl as $ctrl"}})).controller("WebhooksCtrl",["$q","$timeout","$translate","$window","dwAlerts","helper","state","debounce","Webhook","WebhookSubscription","optsWebhookEvent",function(e,n,t,o,i,f,c,l,u,d,b){var h=this;h.$onInit=function(){h.optsWebhookEvent=b,c.setPageTitle(t.instant("WEBHOOKS.PAGE_TITLE")),h.load()},h.load=function(){return h.spin=!0,e.all([u.query().catch((function(e){return i.error(e,"Failed to load webhooks.")})),d.query().catch((function(e){return i.error(e,"Failed to load webhooks subscriptions.")}))]).then((function(e){var n=r()(e,2),t=n[0],o=n[1];h.webhooks=t,h.webhooks.forEach((function(e){e.$subscriptions=s()(o).call(o,(function(n){return n.webhookId===e.id}))}))})).finally((function(){h.spin=!1}))},h.addWebhook=function(){h.webhooks&&h.webhooks.push({$subscriptions:[]})},h.deleteWebhook=function(n){if(!n.id||o.confirm(t.instant("WEBHOOKS.CONFIRM_DELETE")))return(n.id?u.delete({id:n.id}).catch((function(e){return i.error(e,"Failed to delete webhook.")})):e.when()).then((function(){var e;a()(e=h.webhooks).call(e,h.webhooks.indexOf(n),1)}))},h.saveWebhook=l((function(e,n){if(n.$invalid)return;return e.$spin=!0,u.save(e).catch((function(e){return i.error(e,"Failed to save webhook.")})).finally((function(){e.$spin=!1}))}),1e3),h.addSubscription=function(e){h.webhooks&&e.$subscriptions.push({webhookId:e.id,enabled:!0})},h.deleteSubscription=function(n,r){if(!r.id||o.confirm(t.instant("WEBHOOKS.CONFIRM_DELETE_SUBSCRIPTION")))return(r.id?d.delete({id:r.id}).catch((function(e){return i.error(e,"Failed to delete subscription.")})):e.when()).then((function(){var e;a()(e=n.$subscriptions).call(e,n.$subscriptions.indexOf(r),1)}))},h.saveSubscription=function(e,n,t){if(!t.$invalid)return e.$spin=!0,d.save(n).catch((function(e){return i.error(e,"Failed to save subscription.")})).finally((function(){e.$spin=!1}))}}])},FLid:function(e,n,t){var o={"./services/opts-webhook-event.service.js":"tI4i","./services/webhook-subscription.service.js":"xZNb","./services/webhook.service.js":"9qs/","./webhooks/webhooks.directive.js":"BkUy"};function r(e){var n=i(e);return t(n)}function i(e){if(!t.o(o,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id="FLid"},IcPW:function(e,n,t){"use strict";t.r(n);var o=t("yCd9"),r=t.n(o),i=t("lRNC"),s=t.n(i),f=["$injector",function(e){var n,o,i=(n=t("FLid"),r()(o=s()(n).call(n)).call(o,n));e.loadNewModules(r()(i).call(i,(function(e){return e.default.name})))}];n.default=f},W84Y:function(e,n){e.exports='<h1 class="page-title">{{state.getPageTitle()}}</h1> <ff-panel> <div class="ff-grid"> <ff-spin class="ff-spin-placeholder" ng-if="$ctrl.spin"></ff-spin> <span ng-if="!$ctrl.spin && !$ctrl.webhooks.length" translate="GLOBAL.NONE"></span> <div ng-repeat="hook in $ctrl.webhooks"> <div class="ff-grid gutter-h-half"> <form name="form" flex="{md: \'0 0 50%\'}"> <ff-header style="margin-top:.5rem"> <ff-row> <cell><span> <span translate="WEBHOOKS.WEBHOOK"></span> #{{$index + 1}} <ff-spin class="ff-spin-sm" style="margin-left:1rem" ng-if="hook.$spin"></ff-spin> </span></cell> <ff-btn sense="delete" size="xs" flex="none" style="margin:-.5rem 0" title="{{\'GLOBAL.BTN_DELETE\' | translate}}" ff-click="$ctrl.deleteWebhook(hook)"></ff-btn> </ff-row> </ff-header> <label class="ff-row" style="align-self:start"> <ff-label flex="0 0 50px"><req translate="WEBHOOKS.URL"></req></ff-label> <ff-url ff-model="hook.url" ff-required="true" ff-validate-alert="{{ \'WEBHOOKS.URL\' | translate }}" ff-change="$ctrl.saveWebhook(hook, form)"></ff-url> </label> </form> <div flex="{md: \'0 0 50%\'}"> <ff-header style="margin-top:.5rem"> <ff-row> <cell><span translate="WEBHOOKS.SUBSCRIPTIONS"></span></cell> <ff-btn sense="new" size="xs" flex="none" style="margin:-.5rem 0" title="{{\'GLOBAL.BTN_NEW\' | translate}}" ff-click="$ctrl.addSubscription(hook)" ff-disabled="!hook.id"></ff-btn> </ff-row> </ff-header> <ff-static ng-if="!hook.$subscriptions.length"><span translate="GLOBAL.NONE"></span></ff-static> <form name="form" class="ff-row" ng-repeat="sub in hook.$subscriptions"> <ff-select ff-model="sub.event" ff-options="event.id as event.name for event in $ctrl.optsWebhookEvent" ff-required="true" ff-validate-alert="{{ \'WEBHOOKS.EVENT\' | translate }}" ff-change="$ctrl.saveSubscription(hook, sub, form)"></ff-select> <ff-checkbox flex="none" class="ff-center" style="width:2.4rem" title="{{\'WEBHOOKS.ENABLED\' | translate}}" ff-model="sub.enabled" ff-change="$ctrl.saveSubscription(hook, sub, form)"></ff-checkbox> <ff-btn sense="delete" size="xs" flex="none" title="{{\'GLOBAL.BTN_DELETE\' | translate}}" ff-click="$ctrl.deleteSubscription(hook, sub)"></ff-btn> </form> </div> </div> </div> </div> </ff-panel> <ff-btn-group class="buttons-bottom"> <ff-btn sense="new" ff-click="$ctrl.addWebhook()"><span translate="GLOBAL.BTN_NEW"></span></ff-btn> </ff-btn-group> '},tI4i:function(e,n,t){"use strict";t.r(n),n.default=angular.module("deskworks.optsWebhookEvent",[]).factory("optsWebhookEvent",["$rootScope","$translate",function(e,n){var t=[{id:"User",_name:"WEBHOOKS.EVENTS.USER"},{id:"Member",_name:"WEBHOOKS.EVENTS.MEMBER"},{id:"RecurringBilling",_name:"WEBHOOKS.EVENTS.RECURRING_BILLING"},{id:"ProductCategory",_name:"WEBHOOKS.EVENTS.PRODUCT_CATEGORY"},{id:"Product",_name:"WEBHOOKS.EVENTS.PRODUCT"},{id:"PriceList",_name:"WEBHOOKS.EVENTS.PRICE_LIST"},{id:"PriceListProduct",_name:"WEBHOOKS.EVENTS.PRICE_LIST_PRODUCT"},{id:"ReservationCategory",_name:"WEBHOOKS.EVENTS.RESERVATION_CATEGORY"},{id:"ReservationUnit",_name:"WEBHOOKS.EVENTS.RESERVATION_UNIT"},{id:"Reservation",_name:"WEBHOOKS.EVENTS.RESERVATION"}];function o(){t.forEach((function(e){e.name=n.instant(e._name)}))}return o(),e.$on("$setTranslationsSuccess",o),t}])},xZNb:function(e,n,t){"use strict";t.r(n),n.default=angular.module("deskworks.WebhookSubscription",["ngResource","deskworks.config"]).factory("WebhookSubscription",["$resource","deskworksConfig",function(e,n){var t=e(n.getApiAbsUrl("/webhooks/subscriptions/:id"),{},{update:{method:"PUT"}});return{query:function(){return t.query().$promise},save:function(e){return e.id?t.update({id:e.id},e).$promise:t.save({},e).$promise.then((function(n){e.id=n.id}))},delete:function(e){return t.delete(e).$promise}}}])}}]);