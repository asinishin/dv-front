(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"/Add":function(e,t,r){"use strict";r.r(t),t.default=angular.module("deskworks.BuyProductCompleteCtrl",[]).controller("BuyProductCompleteCtrl",["$scope","$translate","dwAlerts","state","deskworksConfig","session",function(e,t,r,n,s,a){n.setPageTitle("Thank you for your order!"),e.$on("$locationChangeStart",(function(e,t){t&&t.indexOf("/buy-a-product")>=0&&!a.isAdmin()&&(e.preventDefault(),r.error("Back is not allowed. Order complete."))})),this.home=function(){return n.resetParams(),n.setPath(s.getDefaultRoute())}}])},"1/Md":function(e,t,r){"use strict";var n=r("NOor"),s=r.n(n),a=r("0zKI"),l=r.n(a);t.a=angular.module("deskworks.dwInvoicePaymentProcessingFee",["deskworks.state","deskworks.helper"]).directive("dwInvoicePaymentProcessingFee",(function(){return{restrict:"A",scope:!0,controller:"DwInvoicePaymentProcessingFeeCtrl as $ctrl",bindToController:{invoice:"<",settings:"<",creditCards:"<",eChecks:"<"}}})).controller("DwInvoicePaymentProcessingFeeCtrl",["$scope","$timeout","state","helper",function(e,t,r,n){var a=this;a.$onChanges=function(){return t((function(){var e,t;if(a.invoice&&a.settings&&a.creditCards&&a.eChecks&&a.settings.enablePaymentProcessingCharges){var r=0;a.creditCards.length?r=a.settings.paymentProcessingRates.cc||0:a.eChecks.length&&(r=a.settings.paymentProcessingRates.ach||0);var i=s()(e=a.invoice.items).call(e,(function(e){return"fake-payment-processing-fee"===e.id}));if(i>=0&&l()(t=a.invoice.items).call(t,i,1),r&&+a.invoice.balance){var c=n.round(r*+a.invoice.balance/100),o={addedBy:"system",amount:c,billedAt:moment(),createdAt:moment(),description:"Payment processing fee",id:"fake-payment-processing-fee",name:"Payment Fee",price:c,quantity:1};a.invoice.items.push(o),angular.isUndefined(a.invoice.chargesTotalInitial)&&(a.invoice.chargesTotalInitial=+a.invoice.chargesTotal),angular.isUndefined(a.invoice.balanceInitial)&&(a.invoice.balanceInitial=+a.invoice.balance),a.invoice.chargesTotal=n.round(a.invoice.chargesTotalInitial+c),a.invoice.balance=n.round(a.invoice.balanceInitial+c)}}}))}}])},"4x3V":function(e,t,r){"use strict";r.r(t);var n=r("a8hB"),s=r.n(n),a=r("ipr/"),l=r.n(a),i=(r("Muwe"),r("w13K"),r("JBxO"),r("FdtR"),r("J//M"),r("dLOS")),c=r("aIjk"),o=r("Vtxe"),u=r("1/Md"),f=r("+l1P");t.default=angular.module("deskworks.BuyProductPurchaseCtrl",["ngRoute","deskworks.helper","deskworks.StaffHelpCtrl","deskworks.purchase.service","deskworks.userProfile.service",i.a.name,c.a.name,o.a.name,u.a.name,f.a.name]).controller("BuyProductPurchaseCtrl",["$scope","$filter","$q","$route","$translate","$timeout","dwAlerts","helper","session","state","data","settings","purchaseService","userProfileService",function(e,t,r,n,a,i,c,o,u,f,d,p,h,m){var g=this;g.center=d.center,g.user=d.user,g.purchase=d.purchase,g.settings=p,f.setPageTitle(a.instant("BUY_A_PRODUCT.PURCHASE.PAGE_TITLE",{centerName:g.center.name})),g.isGuest=g.user.email&&g.user.email.match(/guest\d+@guest\d+\.com/),g.user.fullName.match(/guest\d+/)&&(g.user.firstName="",g.user.lastName=""),g.contact={fullName:g.user.fullName.match(/guest\d+/)?"":g.user.fullName,phone:g.user.phones[0]&&g.user.phones[0].number||"",email:g.isGuest?"":g.user.email},g.next=function(){if(!o.pointFirstInvalid("#buyProductPurchase"))return g.user.phones[0]||g.user.phones.push(m.phone.new()),g.user.phones[0].number=g.contact.phone,g.spin=!0,m.updateRaw(f.getCurrentCenterId(),g.user,{firstName:g.user.firstName,lastName:g.user.lastName,email:g.contact.email}).catch((function(e){return c.error(e,"Failed to update user.")})).then((function(){return m.phone.save(f.getCurrentCenterId(),g.user.id,g.user.phones[0]).catch((function(e){return c.error(e,"Failed to save phone.")}))})).then((function(){return m.saveBillingProfile(f.getCurrentCenterId(),g.user).then((function(){return+g.purchase.balance<=0?f.setPath("/buy-a-product/complete"):h.createPayment(g.center.id,g.user.id,g.purchase.id,{},void 0,+f.getParam("productId")).catch((function(e){return c.error(e,"Failed to make payment.")})).then((function(e){return g.updatePurchase().then((function(t){return e}))})).then((function(e){return f.setPath("/buy-a-product/complete")}))}))})).finally((function(){g.spin=!1}))},g.updatePurchase=function(e){return h.get(g.center.id,g.user.id,g.purchase.id).catch((function(e){return c.error(e,"Failed to get purchase.")})).then((function(e){g.purchase=e}))},g.staffHelp=function(){return h.createStaffHelp(g.center.id,g.user.id,g.purchase.id).catch((function(e){return c.error(e,"Failed to create staff help.")})).then((function(e){return f.setParam("notice",e.notice),f.setPath("/buy-a-product/staff-help")}))},g.onNameChange=function(){var e,t=s()(e=g.contact.fullName||"").call(e),r=t.indexOf(" ");if(g.user.firstName=r>=0?l()(t).call(t,0,r):t,g.user.lastName=r>=0?l()(t).call(t,r):"",g.form.firstName.$pristine&&g.form.lastName.$pristine){var n=g.user.creditCards[0]||{};n.firstName=g.user.firstName,n.lastName=g.user.lastName}}}])},E4g4:function(e,t,r){var n={"./01-purchase/purchase.tpl.html":"pUFB","./02-complete/complete.tpl.html":"OjT8"};function s(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=a,e.exports=s,s.id="E4g4"},G5Je:function(e,t,r){"use strict";var n=r("IOh7"),s=r.n(n);angular.module("deskworks.StaffHelpCtrl",["ngRoute","deskworks.helper","deskworks.config"]).directive("staffHelp",(function(){return{template:s.a,restrict:"E",scope:!0,controller:"StaffHelpDirectiveCtrl as $ctrl"}})).controller("StaffHelpDirectiveCtrl",["$scope","$translate","dwAlerts","helper","state","deskworksConfig",function(e,t,r,n,s,a){this.notice=s.getParam("notice"),s.setPageTitle(t.instant("SIMPLE_RES.STAFF_HELP.PAGE_TITLE")),e.$on("$routeChangeStart",(function(e,n,s){!n.$$route||"MemberSignUpBillingCtrl"!==n.$$route.controller&&"MemberSignUpPurchaseCtrl"!==n.$$route.controller&&"SimpleReservationBillingCtrl"!==n.$$route.controller&&"SimpleReservationPurchaseCtrl"!==n.$$route.controller&&"BuyPassBillingCtrl"!==n.$$route.controller&&"BuyPassPurchaseCtrl"!==n.$$route.controller||(r.error(t.instant("SIMPLE_RES.STAFF_HELP.BACK_ERROR")),e.preventDefault())})),this.home=function(){return s.resetParams(),s.setPath(a.getDefaultRoute())}}])},IOh7:function(e,t){e.exports='<h1 class="page-title">{{state.getPageTitle()}}</h1> <div class="gutter-v"> <ff-panel> <span ng-bind="::$ctrl.notice"></span> </ff-panel> <ff-btn-group> <ff-btn sense="home" type="submit" ff-click="$ctrl.home()"><span translate="GLOBAL.BTN_HOME"></span></ff-btn> </ff-btn-group> </div> '},"J//M":function(e,t,r){},OjT8:function(e,t){e.exports='<div class="bay-reservation"> <h1 class="page-title ff-center">{{state.getPageTitle()}}</h1> <ff-btn-group class="buttons-bottom ff-center"> <ff-btn sense="home" type="submit" ff-click="$ctrl.home()"><span translate="GLOBAL.BTN_HOME"></span></ff-btn> </ff-btn-group> </div> '},QEpw:function(e,t){e.exports='<span translate="BILLING_PROFILE.PAYMENT_METHOD.EMPTY" ng-if="$ctrl.showSwitchCC() && $ctrl.showSwitchACH()"></span> <up-billing-method user="$ctrl.user" settings="$ctrl.settings" ng-if="!$ctrl.isSingleMode()"></up-billing-method> <up-credit-cards user-profile="$ctrl.user" settings="$ctrl.settings" single="$ctrl.isSingleMode()" ng-if="$ctrl.user.creditCards.length || !$ctrl.isSingleMode()" hide-fields="$ctrl.hideFields"></up-credit-cards> <up-e-checks user-profile="$ctrl.user" single="$ctrl.isSingleMode()" ng-if="$ctrl.settings.enableEChecks && ($ctrl.user.eChecks.length || !$ctrl.isSingleMode())"></up-e-checks> '},ZTuD:function(e,t,r){"use strict";r.r(t);r("3dw1"),r("Muwe"),r("y89P");var n=r("yCd9"),s=r.n(n),a=r("lRNC"),l=r.n(a),i=r("hsT8"),c=r.n(i),o=(r("G5Je"),["$injector",function(e){var t,n,a,i=(n=r("mGg4"),s()(a=l()(n).call(n)).call(a,n));e.loadNewModules(s()(t=c()(i).call(i,(function(e){return e.default}))).call(t,(function(e){return e.default.name}))),e.invoke(["$templateCache",function(e){var t=r("E4g4");l()(t).call(t).forEach((function(r){return e.put(r.replace(/^\.\//,""),t(r))}))}])}]);t.default=o},aIjk:function(e,t,r){"use strict";t.a=angular.module("needHelp",[]).directive("needHelp",(function(){return{restrict:"E",scope:!0,controller:function(){},controllerAs:"$ctrl",template:'<span translate="GLOBAL.NEED_HELP" class="need-help" ng-if="$ctrl.phone" translate-values="{ phone: \'<a href=&quot;tel:\' + $ctrl.phone + \'&quot;>\' + $ctrl.phone + \'</a>\' }"></span>',bindToController:{phone:"<"}}}))},dLOS:function(e,t,r){"use strict";r("3dw1");var n=r("hsT8"),s=r.n(n),a=r("nbuU"),l=r.n(a),i=r("6RpP"),c=r.n(i),o=r("QEpw"),u=r.n(o);t.a=angular.module("newBillingProfile",[]).directive("newBillingProfile",(function(){return{template:u.a,restrict:"E",scope:!0,controller:"NewBillingProfileCtrl as $ctrl",bindToController:{settings:"<",user:"<",hideFields:"<?"}}})).controller("NewBillingProfileCtrl",["$scope","userProfileService",function(e,t){var r=this;r.$onInit=function(){var n;if(r.settings.creditCardTypes=s()(n=r.settings.creditCardTypes).call(n,(function(e){return e.enable})),r.user.creditCards.forEach((function(e){var t;e.type=l()(t=r.settings.creditCardTypes).call(t,(function(t){return t.id===e.type}))||e.type||{}})),r.user.creditCards=r.user.creditCards||[],!r.user.creditCards.length&&!r.user.eChecks.length){var a=t.creditCard.new(r.user);a.type=r.settings.creditCardTypes[0],r.user.creditCards.push(a)}e.$watchCollection((function(e){var t;return c()(t=r.user.creditCards).call(t,r.user.eChecks)}),(function(e){e&&r.user.paymentMethodId&&!l()(e).call(e,(function(e){return e.id===r.user.paymentMethodId}))&&(r.user.billingMethod=null,r.user.paymentMethodId=null)})),t.bindTestBillingGenerator(e,r.user)},r.isSingleMode=function(){var e=r.user,n=e.creditCards,s=e.eChecks;return!n.length&&(!s.length||t.eCheck.isNew(s[0]))||!s.length&&(!n.length||t.creditCard.isNew(n[0]))}}])},mGg4:function(e,t,r){var n={"./01-purchase/purchase.controller.js":"4x3V","./02-complete/complete.controller.js":"/Add"};function s(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=a,e.exports=s,s.id="mGg4"},pUFB:function(e,t){e.exports='<div class="bay-reservation"> <h1 class="page-title"> <span>{{state.getPageTitle()}}</span> <need-help phone="$ctrl.center.phone" style="float:right"></need-help> <div style="clear:both"></div> </h1> <form name="$ctrl.form" id="buyProductPurchase" class="ff-grid gutter-v gutter-h" novalidate ff-dim="$ctrl.spin"> <ff-panel> <ff-panel-header> <span translate="SIMPLE_RES.PURCHASE.ORDER.HEADER" translate-values="{ orderId: $ctrl.purchase.orderId }"></span> </ff-panel-header> <dw-invoice invoice="$ctrl.purchase" center="$ctrl.center" allow-remove="false" simple="true" dw-invoice-payment-processing-fee update-invoice="$ctrl.updatePurchase()" settings="$resolve.settings" credit-cards="$resolve.user.creditCards" e-checks="$resolve.user.eChecks"></dw-invoice> </ff-panel> <ff-panel flex="{md: \'0 0 50%\'}"> <ff-header>Contact</ff-header> <label class="ff-row"> <ff-label flex="0 1 135px"><req>Full name</req></ff-label> <ff-text ff-model="$ctrl.contact.fullName" ff-change="$ctrl.onNameChange()" ff-required="true" ff-validate-alert="Full name" placeholder="John Doe"></ff-text> </label> <label class="ff-row"> <ff-label flex="0 1 135px"><req>Phone number</req></ff-label> <ff-text ff-model="$ctrl.contact.phone" dw-phone ff-required="true" placeholder="888-123-1234"></ff-text> </label> <label class="ff-row"> <ff-label flex="0 1 135px"><req>Email address</req></ff-label> <ff-email ff-model="$ctrl.contact.email" ff-required="true" ff-validate-alert="Email address"></ff-email> </label> </ff-panel> <new-billing-profile flex="{md: \'0 0 50%\'}" user="$ctrl.user" settings="$ctrl.settings" id="newBillingProfile" hide-fields="{ addrType: true, addrStreet: true, addrCity: true, addrState: true }"></new-billing-profile> <ff-btn-group> <ff-btn sense="help" ff-click="$ctrl.staffHelp()"><span translate="GLOBAL.BTN_STAFF_HELP"></span></ff-btn> <ff-btn sense="next" type="submit" ff-click="$ctrl.next()"><span translate="GLOBAL.BTN_NEXT"></span></ff-btn> </ff-btn-group> </form> </div> '}}]);