(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+n1t":function(e,r,i){"use strict";i.r(r),r.default=angular.module("deskworks.KisiUser",["ngResource","deskworks.config"]).factory("KisiUser",["$resource","deskworksConfig",function(e,r){var i=e(r.getApiAbsUrl("/kisi/centers/:centerId/users/:userId"),{},{update:{method:"PUT"}});return{get:function(e,r){return i.get({centerId:e,userId:r}).$promise},save:function(e,r){return i.update({centerId:e,userId:r.id},r).$promise}}}])},"2D+T":function(e,r,i){"use strict";i.r(r);i("it7j"),i("DbwS"),i("t91x");r.default=angular.module("deskworks.kisiSettingsDirective",["debounce","deskworks.KisiSettings","deskworks.KisiCenter","deskworks.KisiPlace","deskworks.KisiAccessGroup","deskworks.center.service"]).directive("kisiSettings",function(){return{templateUrl:"settings/kisi-settings.tpl.html",restrict:"E",scope:!0,controller:"KisiSettingsCtrl as $ctrl"}}).controller("KisiSettingsCtrl",["dwAlerts","$q","debounce","helper","centerService","KisiSettings","KisiCenter","KisiAccessGroup","KisiPlace",function(e,r,i,s,t,n,c,o,a){var u=this;function f(i){return i.$$kisiGroups=null,i.kisiPlaceId?(i.$$spin=!0,o.query(i.kisiPlaceId).catch(function(r){return e.error(r,"Failed to query Kisi access groups.")}).then(function(e){return i.$$kisiGroups=e,e}).finally(function(){i.$$spin=!1})):r.when(null)}u.$onInit=function(){u.load()},u.load=function(){var i={kisiSettings:n.get().catch(function(r){return e.error(r,"Failed to load Kisi settings.")}),centers:t.getCenters().catch(function(r){return e.error(r,"Failed to query centers.")}),kisiCenters:c.query().catch(function(r){return e.error(r,"Failed to query Kisi centers.")}),kisiPlaces:a.query().catch(function(r){return e.error(r,"Failed to query Kisi places.")})};return u.spin=!0,r.all(i).then(function(e){return u.kisiSettings=e.kisiSettings,u.kisiCenters=e.kisiCenters,u.kisiPlaces=e.kisiPlaces,e}).finally(function(){u.spin=!1}).then(function(e){var i=u.kisiCenters.map(function(r){return r.$$name=(s.find(e.centers,r.id)||{}).name,f(r)});return r.all(i)})},u.saveSettings=i(function(r){if(r&&r.$invalid)return;return u.spin=!0,n.save(u.kisiSettings).catch(function(r){return e.error(r,"Failed to save Kisi settings.")}).finally(function(){u.spin=!1}).then(function(){return delete u.kisiCenters,u.load()})},1e3),u.saveCenter=i(function(r,i){if(i&&i.$invalid)return;return r.$$spin=!0,c.save(r).finally(function(){r.$$spin=!1}).catch(function(r){return e.error(r,"Failed to save Kisi center.")})},500),u.changePlace=function(e,r){return f(e).then(function(){return u.saveCenter(e,r)})}}])},AtqB:function(e,r){e.exports='<ff-panel> <ff-panel-header ff-spin=$ctrl.spin class=ff-spin-right> <span translate=INTEGRATIONS_SETUP.KISI.HEADER></span> </ff-panel-header> <form name=form novalidate ff-dim=$ctrl.spin> <label class=ff-row> <ff-label flex="0 0 120px"><req translate=INTEGRATIONS_SETUP.API_KEY></req></ff-label> <ff-text ff-model=$ctrl.kisiSettings.apiKey ff-change=$ctrl.saveSettings(form) ff-required=true ff-validate-alert="{{\'INTEGRATIONS_SETUP.API_KEY\' | translate}}"></ff-text> </label> </form> <form name=form novalidate ng-repeat="center in $ctrl.kisiCenters" class=animate-collapse> <ff-header ff-dim=center.$$spin style=padding-top:.6rem><cell>{{center.$$name}}</cell></ff-header> <label class=ff-row> <ff-label flex="1 1 270px"><span translate=INTEGRATIONS_SETUP.ENABLED></span></ff-label> <ff-static flex="1 1 305px"> <ff-checkbox name=enabled ff-model=center.enabled ff-change="$ctrl.saveCenter(center, form)"></ff-checkbox> </ff-static> </label> <label class=ff-row> <ff-label flex="1 1 270px"><req translate=INTEGRATIONS_SETUP.KISI.PLACE></req></ff-label> <ff-select flex="1 1 305px" name=kisiPlaceId ff-model=center.kisiPlaceId ff-required=true ff-options="place.id as place.name for place in $ctrl.kisiPlaces" ff-change="$ctrl.changePlace(center, form)" ff-validate-alert="{{\'INTEGRATIONS_SETUP.KISI.PLACE\' | translate}}"></ff-select> </label> <ff-row ff-dim="center.$$spin && !center.$$kisiGroups"> <label> <ff-label flex="1 1 270px"><req translate=INTEGRATIONS_SETUP.KISI.DEFAULT_ACCESS_GROUP></req></ff-label> <ff-select flex="1 1 305px" name=defaultKisiGroupId ff-model=center.defaultKisiGroupId ff-options="group.id as group.name for group in center.$$kisiGroups" ff-change="$ctrl.saveCenter(center, form)" ff-validate-alert="{{\'INTEGRATIONS_SETUP.KISI.DEFAULT_ACCESS_GROUP\' | translate}}"></ff-select> </label> </ff-row> </form> </ff-panel> '},BAIu:function(e,r,i){"use strict";i.r(r);i("t91x");var s=["$injector",function(e){var r,s=(r=i("Lsfu")).keys().map(r);e.loadNewModules(s.map(function(e){return e.default.name})),e.invoke(["$templateCache",function(e){var r=i("cBTd");r.keys().forEach(function(i){return e.put(i.replace(/^\.\//,""),r(i))})}])}];r.default=s},"K+2R":function(e,r,i){"use strict";i.r(r),r.default=angular.module("deskworks.KisiCenter",["ngResource","deskworks.config"]).factory("KisiCenter",["$resource","deskworksConfig",function(e,r){var i=e(r.getApiAbsUrl("/kisi/centers/:centerId"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise},save:function(e){return i.update({centerId:e.id},e).$promise}}}])},KAtn:function(e,r,i){"use strict";i.r(r),r.default=angular.module("deskworks.KisiAccessGroup",["ngResource","deskworks.config"]).factory("KisiAccessGroup",["$resource","deskworksConfig",function(e,r){var i=e(r.getApiAbsUrl("/kisi/kisi-places/:placeId/kisi-groups"));return{query:function(e){return i.query({placeId:e}).$promise.then(function(e){return e.unshift({id:null,name:"No Access"}),e})}}}])},Lsfu:function(e,r,i){var s={"./access-group/kisi-access-group.directive.js":"SXRw","./services/kisi-access-group.service.js":"KAtn","./services/kisi-center.service.js":"K+2R","./services/kisi-place.service.js":"Pof/","./services/kisi-settings.service.js":"f4YS","./services/kisi-user.service.js":"+n1t","./settings/kisi-settings.directive.js":"2D+T"};function t(e){var r=n(e);return i(r)}function n(e){if(!i.o(s,e)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return s[e]}t.keys=function(){return Object.keys(s)},t.resolve=n,e.exports=t,t.id="Lsfu"},"Pof/":function(e,r,i){"use strict";i.r(r),r.default=angular.module("deskworks.KisiPlace",["ngResource","deskworks.config"]).factory("KisiPlace",["$resource","deskworksConfig",function(e,r){var i=e(r.getApiAbsUrl("/kisi/kisi-places"),{},{update:{method:"PUT"}});return{query:function(){return i.query().$promise}}}])},SXRw:function(e,r,i){"use strict";i.r(r);i("it7j");r.default=angular.module("deskworks.kisiAccessGroupDirective",["deskworks.KisiCenter","deskworks.KisiUser","deskworks.KisiAccessGroup"]).directive("kisiAccessGroup",function(){return{templateUrl:"access-group/kisi-access-group.tpl.html",restrict:"E",scope:!0,controller:"KisiAccessGroupCtrl as $ctrl",bindToController:{userId:"<",save:"="}}}).controller("KisiAccessGroupCtrl",["$q","dwAlerts","helper","state","KisiCenter","KisiUser","KisiAccessGroup",function(e,r,i,s,t,n,c){var o=this;function a(){if(o.kisiCenter.enabled)return o.kisiUser.id=o.userId,n.save(s.getCurrentCenterId(),o.kisiUser).catch(function(e){return r.error(e,"Failed to save Kisi user.")})}o.$onInit=function(){o.load()},o.load=function(){return t.query().catch(function(e){return r.error(e,"Failed to query Kisi centers.")}).then(function(t){if(o.kisiCenter=i.find(t,s.getCurrentCenterId()),o.kisiCenter&&o.kisiCenter.enabled){var u={};return o.kisiCenter.kisiPlaceId&&(u.kisiGroups=c.query(o.kisiCenter.kisiPlaceId).catch(function(e){return r.error(e,"Failed to query Kisi access groups.")})),o.userId&&"new"!==o.userId&&!i.isUid(o.userId)&&(u.kisiUser=n.get(s.getCurrentCenterId(),o.userId).catch(function(e){return r.error(e,"Failed to get Kisi user.")})),e.all(u).then(function(e){e.kisiUser?o.kisiUser=e.kisiUser:o.kisiUser={kisiGroupId:o.kisiCenter.defaultKisiGroupId},o.kisiGroups=e.kisiGroups,o.kisiGroups&&o.kisiGroups.length&&o.kisiCenter.enabled&&(o.save=a)})}})}}])},XwCg:function(e,r){e.exports='<label class="ff-row animate-collapse" ng-if="$ctrl.kisiGroups.length && $ctrl.kisiCenter.enabled"> <ff-label flex="0 1 116px" class=ff-small><span translate=USER_PROFILE.MEMBERSHIP.KISI_ACCESS_GROUP></span></ff-label> <ff-select name=kisiGroupId ff-model=$ctrl.kisiUser.kisiGroupId ff-options="opt.id as opt.name for opt in $ctrl.kisiGroups"> </ff-select> </label> '},cBTd:function(e,r,i){var s={"./access-group/kisi-access-group.tpl.html":"XwCg","./settings/kisi-settings.tpl.html":"AtqB"};function t(e){var r=n(e);return i(r)}function n(e){if(!i.o(s,e)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return s[e]}t.keys=function(){return Object.keys(s)},t.resolve=n,e.exports=t,t.id="cBTd"},f4YS:function(e,r,i){"use strict";i.r(r),r.default=angular.module("deskworks.KisiSettings",["ngResource","deskworks.config"]).factory("KisiSettings",["$resource","deskworksConfig",function(e,r){var i=e(r.getApiAbsUrl("/kisi/settings"),{},{update:{method:"PUT"}});return{get:function(){return i.get().$promise},save:function(e){return i.update({},e).$promise}}}])}}]);